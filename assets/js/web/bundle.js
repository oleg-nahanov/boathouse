!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).THREE={})}(this,(function(t){function e(){}function i(t,e){this.x=t||0,this.y=e||0}function r(t,e,i,r){this._x=t||0,this._y=e||0,this._z=i||0,this._w=void 0!==r?r:1}function n(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0}function a(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&void 0}function o(t,e,r,n,s,c,h,l,u,p){Object.defineProperty(this,"id",{value:Oa++}),this.uuid=Ta.generateUUID(),this.name="",this.image=void 0!==t?t:o.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:o.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:1001,this.wrapT=void 0!==n?n:1001,this.magFilter=void 0!==s?s:1006,this.minFilter=void 0!==c?c:1008,this.anisotropy=void 0!==u?u:1,this.format=void 0!==h?h:1023,this.type=void 0!==l?l:1009,this.offset=new i(0,0),this.repeat=new i(1,1),this.center=new i(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new a,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==p?p:3e3,this.version=0,this.onUpdate=null}function s(t,e,i,r){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==r?r:1}function c(t,e,i){this.width=t,this.height=e,this.scissor=new s(0,0,t,e),this.scissorTest=!1,this.viewport=new s(0,0,t,e),i=i||{},this.texture=new o(void 0,void 0,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=e,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:1006,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function h(t,e,i){c.call(this,t,e,i),this.samples=4}function l(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&void 0}function u(t,e,i,r){this._x=t||0,this._y=e||0,this._z=i||0,this._order=r||u.DefaultOrder}function p(){this.mask=1}function d(){Object.defineProperty(this,"id",{value:Va++}),this.uuid=Ta.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=d.DefaultUp.clone();var t=new n,e=new u,i=new r,o=new n(1,1,1);e._onChange((function(){i.setFromEuler(e,!1)})),i._onChange((function(){e.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new l},normalMatrix:{value:new a}}),this.matrix=new l,this.matrixWorld=new l,this.matrixAutoUpdate=d.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new p,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function f(){d.call(this),this.type="Scene",this.overrideMaterial=this.fog=this.background=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function m(t,e){this.min=void 0!==t?t:new n(1/0,1/0,1/0),this.max=void 0!==e?e:new n(-1/0,-1/0,-1/0)}function g(t,e,i,r,n){var a,o=0;for(a=t.length-3;o<=a;o+=3){fo.fromArray(t,o);var s=n.x*Math.abs(fo.x)+n.y*Math.abs(fo.y)+n.z*Math.abs(fo.z),c=e.dot(fo),h=i.dot(fo),l=r.dot(fo);if(Math.max(-Math.max(c,h,l),Math.min(c,h,l))>s)return!1}return!0}function v(t,e){this.center=void 0!==t?t:new n,this.radius=void 0!==e?e:0}function y(t,e){this.origin=void 0!==t?t:new n,this.direction=void 0!==e?e:new n}function E(t,e){this.normal=void 0!==t?t:new n(1,0,0),this.constant=void 0!==e?e:0}function x(t,e,i){this.a=void 0!==t?t:new n,this.b=void 0!==e?e:new n,this.c=void 0!==i?i:new n}function b(t,e,i){return void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}function S(t,e,i){return 0>i&&(i+=1),1<i&&--i,i<1/6?t+6*(e-t)*i:.5>i?e:i<2/3?t+6*(e-t)*(2/3-i):t}function w(t){return.04045>t?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function _(t){return.0031308>t?12.92*t:1.055*Math.pow(t,.41666)-.055}function M(t,e,i,r,a,o){this.a=t,this.b=e,this.c=i,this.normal=r&&r.isVector3?r:new n,this.vertexNormals=Array.isArray(r)?r:[],this.color=a&&a.isColor?a:new b,this.vertexColors=Array.isArray(a)?a:[],this.materialIndex=void 0!==o?o:0}function A(){Object.defineProperty(this,"id",{value:Bo++}),this.uuid=Ta.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexTangents=this.flatShading=!1,this.vertexColors=0,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null,this.depthFunc=3,this.depthWrite=this.depthTest=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilZPass=this.stencilZFail=this.stencilFail=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipShadows=this.clipIntersection=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetUnits=this.polygonOffsetFactor=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.toneMapped=this.visible=!0,this.userData={},this.needsUpdate=!0}function T(t){A.call(this),this.type="MeshBasicMaterial",this.color=new b(16777215),this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.envMap=this.alphaMap=this.specularMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphTargets=this.skinning=!1,this.setValues(t)}function D(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===i,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}function R(t,e,i){D.call(this,new Int8Array(t),e,i)}function L(t,e,i){D.call(this,new Uint8Array(t),e,i)}function C(t,e,i){D.call(this,new Uint8ClampedArray(t),e,i)}function P(t,e,i){D.call(this,new Int16Array(t),e,i)}function O(t,e,i){D.call(this,new Uint16Array(t),e,i)}function I(t,e,i){D.call(this,new Int32Array(t),e,i)}function H(t,e,i){D.call(this,new Uint32Array(t),e,i)}function N(t,e,i){D.call(this,new Float32Array(t),e,i)}function U(t,e,i){D.call(this,new Float64Array(t),e,i)}function F(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1}function B(t){if(0===t.length)return-1/0;for(var e=t[0],i=1,r=t.length;i<r;++i)t[i]>e&&(e=t[i]);return e}function z(){Object.defineProperty(this,"id",{value:zo+=2}),this.uuid=Ta.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingSphere=this.boundingBox=null,this.drawRange={start:0,count:1/0},this.userData={}}function G(t,e){d.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new z,this.material=void 0!==e?e:new T({color:16777215*Math.random()}),this.drawMode=0,this.updateMorphTargets()}function j(t,e,i,r,n,a,o,s){return null===(1===e.side?r.intersectTriangle(o,a,n,!0,s):r.intersectTriangle(n,a,o,2!==e.side,s))?null:(hs.copy(s),hs.applyMatrix4(t.matrixWorld),(e=i.ray.origin.distanceTo(hs))<i.near||e>i.far?null:{distance:e,point:hs.clone(),object:t})}function V(t,e,r,n,a,o,s,c,h,l,u){if(Zo.fromBufferAttribute(a,h),Ko.fromBufferAttribute(a,l),Qo.fromBufferAttribute(a,u),a=t.morphTargetInfluences,e.morphTargets&&o&&a){is.set(0,0,0),rs.set(0,0,0),ns.set(0,0,0);for(var p=0,d=o.length;p<d;p++){var f=a[p],m=o[p];0!==f&&($o.fromBufferAttribute(m,h),ts.fromBufferAttribute(m,l),es.fromBufferAttribute(m,u),is.addScaledVector($o.sub(Zo),f),rs.addScaledVector(ts.sub(Ko),f),ns.addScaledVector(es.sub(Qo),f))}Zo.add(is),Ko.add(rs),Qo.add(ns)}return(t=j(t,e,r,n,Zo,Ko,Qo,cs))&&(s&&(as.fromBufferAttribute(s,h),os.fromBufferAttribute(s,l),ss.fromBufferAttribute(s,u),t.uv=x.getUV(cs,Zo,Ko,Qo,as,os,ss,new i)),c&&(as.fromBufferAttribute(c,h),os.fromBufferAttribute(c,l),ss.fromBufferAttribute(c,u),t.uv2=x.getUV(cs,Zo,Ko,Qo,as,os,ss,new i)),s=new M(h,l,u),x.getNormal(Zo,Ko,Qo,s.normal),t.face=s),t}function k(){Object.defineProperty(this,"id",{value:ls+=2}),this.uuid=Ta.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.verticesNeedUpdate=this.elementsNeedUpdate=!1}function W(t){var e,i={};for(e in t)for(var r in i[e]={},t[e]){var n=t[e][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture)?i[e][r]=n.clone():Array.isArray(n)?i[e][r]=n.slice():i[e][r]=n}return i}function q(t){for(var e={},i=0;i<t.length;i++){var r,n=W(t[i]);for(r in n)e[r]=n[r]}return e}function X(t){A.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(void 0!==t.attributes&&void 0,this.setValues(t))}function Y(){d.call(this),this.type="Camera",this.matrixWorldInverse=new l,this.projectionMatrix=new l,this.projectionMatrixInverse=new l}function J(t,e,i,r){Y.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function Z(t,e,i,r){d.call(this),this.type="CubeCamera";var a=new J(90,1,t,e);a.up.set(0,-1,0),a.lookAt(new n(1,0,0)),this.add(a);var o=new J(90,1,t,e);o.up.set(0,-1,0),o.lookAt(new n(-1,0,0)),this.add(o);var s=new J(90,1,t,e);s.up.set(0,0,1),s.lookAt(new n(0,1,0)),this.add(s);var c=new J(90,1,t,e);c.up.set(0,0,-1),c.lookAt(new n(0,-1,0)),this.add(c);var h=new J(90,1,t,e);h.up.set(0,-1,0),h.lookAt(new n(0,0,1)),this.add(h);var l=new J(90,1,t,e);l.up.set(0,-1,0),l.lookAt(new n(0,0,-1)),this.add(l),r=r||{format:1022,magFilter:1006,minFilter:1006},this.renderTarget=new K(i,i,r),this.renderTarget.texture.name="CubeCamera",this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();var i=t.getRenderTarget(),r=this.renderTarget,n=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,t.setRenderTarget(r,0),t.render(e,a),t.setRenderTarget(r,1),t.render(e,o),t.setRenderTarget(r,2),t.render(e,s),t.setRenderTarget(r,3),t.render(e,c),t.setRenderTarget(r,4),t.render(e,h),r.texture.generateMipmaps=n,t.setRenderTarget(r,5),t.render(e,l),t.setRenderTarget(i)},this.clear=function(t,e,i,r){for(var n=t.getRenderTarget(),a=this.renderTarget,o=0;6>o;o++)t.setRenderTarget(a,o),t.clear(e,i,r);t.setRenderTarget(n)}}function K(t,e,i){c.call(this,t,e,i)}function Q(t,e,i,r,n,a,s,c,h,l,u,p){o.call(this,null,a,s,c,h,l,r,n,u,p),this.image={data:t||null,width:e||1,height:i||1},this.magFilter=void 0!==h?h:1003,this.minFilter=void 0!==l?l:1003,this.flipY=this.generateMipmaps=!1,this.unpackAlignment=1,this.needsUpdate=!0}function $(t,e,i,r,n,a){this.planes=[void 0!==t?t:new E,void 0!==e?e:new E,void 0!==i?i:new E,void 0!==r?r:new E,void 0!==n?n:new E,void 0!==a?a:new E]}function tt(){function t(n,a){!1!==i&&(r(n,a),e.requestAnimationFrame(t))}var e=null,i=!1,r=null;return{start:function(){!0!==i&&null!==r&&(e.requestAnimationFrame(t),i=!0)},stop:function(){i=!1},setAnimationLoop:function(t){r=t},setContext:function(t){e=t}}}function et(t){var e=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e.get(t)},remove:function(i){i.isInterleavedBufferAttribute&&(i=i.data);var r=e.get(i);r&&(t.deleteBuffer(r.buffer),e.delete(i))},update:function(i,r){i.isInterleavedBufferAttribute&&(i=i.data);var n=e.get(i);if(void 0===n)e.set(i,function(e,i){var r=e.array,n=e.usage,a=t.createBuffer();return t.bindBuffer(i,a),t.bufferData(i,r,n),e.onUploadCallback(),i=5126,r instanceof Float32Array?i=5126:r instanceof Float64Array?void 0:r instanceof Uint16Array?i=5123:r instanceof Int16Array?i=5122:r instanceof Uint32Array?i=5125:r instanceof Int32Array?i=5124:r instanceof Int8Array?i=5120:r instanceof Uint8Array&&(i=5121),{buffer:a,type:i,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(i,r));else if(n.version<i.version){var a=i.array,o=i.updateRange;t.bindBuffer(r,n.buffer),-1===o.count?t.bufferSubData(r,0,a):(t.bufferSubData(r,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1),n.version=i.version}}}}function it(t,e,i,r){k.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:r},this.fromBufferGeometry(new rt(t,e,i,r)),this.mergeVertices()}function rt(t,e,i,r){z.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:r};var n=(t=t||1)/2,a=(e=e||1)/2,o=(i=Math.floor(i)||1)+1,s=(r=Math.floor(r)||1)+1,c=t/i,h=e/r,l=[],u=[],p=[],d=[];for(t=0;t<s;t++){var f=t*h-a;for(e=0;e<o;e++)u.push(e*c-n,-f,0),p.push(0,0,1),d.push(e/i),d.push(1-t/r)}for(t=0;t<r;t++)for(e=0;e<i;e++)n=e+o*(t+1),a=e+1+o*(t+1),s=e+1+o*t,l.push(e+o*t,n,s),l.push(n,a,s);this.setIndex(l),this.setAttribute("position",new N(u,3)),this.setAttribute("normal",new N(p,3)),this.setAttribute("uv",new N(d,2))}function nt(t,e,i,r){function n(t,i){e.buffers.color.setClear(t.r,t.g,t.b,i,r)}var a,o,s=new b(0),c=0,h=null,l=0;return{getClearColor:function(){return s},setClearColor:function(t,e){s.set(t),n(s,c=void 0!==e?e:1)},getClearAlpha:function(){return c},setClearAlpha:function(t){n(s,c=t)},render:function(e,r,u,p){r=r.background,(u=(u=t.vr).getSession&&u.getSession())&&"additive"===u.environmentBlendMode&&(r=null),null===r?(n(s,c),h=null,l=0):r&&r.isColor&&(n(r,1),p=!0,h=null,l=0),(t.autoClear||p)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),r&&(r.isCubeTexture||r.isWebGLRenderTargetCube)?(void 0===o&&((o=new G(new ms(1,1,1),new X({type:"BackgroundCubeMaterial",uniforms:W(bs.cube.uniforms),vertexShader:bs.cube.vertexShader,fragmentShader:bs.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.tCube.value}}),i.update(o)),p=r.isWebGLRenderTargetCube?r.texture:r,o.material.uniforms.tCube.value=p,o.material.uniforms.tFlip.value=r.isWebGLRenderTargetCube?1:-1,h===r&&l===p.version||(o.material.needsUpdate=!0,h=r,l=p.version),e.unshift(o,o.geometry,o.material,0,0,null)):r&&r.isTexture&&(void 0===a&&((a=new G(new rt(2,2),new X({type:"BackgroundMaterial",uniforms:W(bs.background.uniforms),vertexShader:bs.background.vertexShader,fragmentShader:bs.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(a)),a.material.uniforms.t2D.value=r,!0===r.matrixAutoUpdate&&r.updateMatrix(),a.material.uniforms.uvTransform.value.copy(r.matrix),h===r&&l===r.version||(a.material.needsUpdate=!0,h=r,l=r.version),e.unshift(a,a.geometry,a.material,0,0,null))}}}function at(t,e,i,r){var n,a=r.isWebGL2;this.setMode=function(t){n=t},this.render=function(e,r){t.drawArrays(n,e,r),i.update(r,n)},this.renderInstances=function(r,o,s,c){if(0!==c){if(a){r=t;var h="drawArraysInstanced"}else if(h="drawArraysInstancedANGLE",null===(r=e.get("ANGLE_instanced_arrays")))return void void 0;r[h](n,o,s,c),i.update(s,n,c)}}}function ot(t,e,i){function r(e){if("highp"===e){if(0<t.getShaderPrecisionFormat(35633,36338).precision&&0<t.getShaderPrecisionFormat(35632,36338).precision)return"highp";e="mediump"}return"mediump"===e&&0<t.getShaderPrecisionFormat(35633,36337).precision&&0<t.getShaderPrecisionFormat(35632,36337).precision?"mediump":"lowp"}var n,a="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext,o=void 0!==i.precision?i.precision:"highp",s=r(o);s!==o&&(void 0,o=s),i=!0===i.logarithmicDepthBuffer,s=t.getParameter(34930);var c=t.getParameter(35660),h=t.getParameter(3379),l=t.getParameter(34076),u=t.getParameter(34921),p=t.getParameter(36347),d=t.getParameter(36348),f=t.getParameter(36349),m=0<c,g=a||!!e.get("OES_texture_float");return{isWebGL2:a,getMaxAnisotropy:function(){if(void 0!==n)return n;var i=e.get("EXT_texture_filter_anisotropic");return n=null!==i?t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:i,maxTextures:s,maxVertexTextures:c,maxTextureSize:h,maxCubemapSize:l,maxAttributes:u,maxVertexUniforms:p,maxVaryings:d,maxFragmentUniforms:f,vertexTextures:m,floatFragmentTextures:g,floatVertexTextures:m&&g,maxSamples:a?t.getParameter(36183):0}}function st(){function t(){l.value!==r&&(l.value=r,l.needsUpdate=0<n),i.numPlanes=n,i.numIntersection=0}function e(t,e,r,n){var a=null!==t?t.length:0,o=null;if(0!==a){if(o=l.value,!0!==n||null===o)for(n=r+4*a,e=e.matrixWorldInverse,h.getNormalMatrix(e),(null===o||o.length<n)&&(o=new Float32Array(n)),n=0;n!==a;++n,r+=4)c.copy(t[n]).applyMatrix4(e,h),c.normal.toArray(o,r),o[r+3]=c.constant;l.value=o,l.needsUpdate=!0}return i.numPlanes=a,o}var i=this,r=null,n=0,o=!1,s=!1,c=new E,h=new a,l={value:null,needsUpdate:!1};this.uniform=l,this.numIntersection=this.numPlanes=0,this.init=function(t,i,a){var s=0!==t.length||i||0!==n||o;return o=i,r=e(t,a,0),n=t.length,s},this.beginShadows=function(){s=!0,e(null)},this.endShadows=function(){s=!1,t()},this.setState=function(i,a,c,h,u,p){if(!o||null===i||0===i.length||s&&!c)s?e(null):t();else{var d=4*(c=s?0:n),f=u.clippingState||null;for(l.value=f,f=e(i,h,d,p),i=0;i!==d;++i)f[i]=r[i];u.clippingState=f,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=c}}}function ct(t){var e={};return{get:function(i){if(void 0!==e[i])return e[i];switch(i){case"WEBGL_depth_texture":var r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(i)}return null===r&&void 0,e[i]=r}}}function ht(t,e,i){function r(t){var n=t.target;for(var s in null!==(t=a.get(n)).index&&e.remove(t.index),t.attributes)e.remove(t.attributes[s]);n.removeEventListener("dispose",r),a.delete(n),(s=o.get(t))&&(e.remove(s),o.delete(t)),i.memory.geometries--}function n(t){var i=[],r=t.index,n=t.attributes.position;if(null!==r){var a=r.array;r=r.version,n=0;for(var s=a.length;n<s;n+=3){var c=a[n+0],h=a[n+1],l=a[n+2];i.push(c,h,h,l,l,c)}}else for(a=n.array,r=n.version,n=0,s=a.length/3-1;n<s;n+=3)c=n+0,h=n+1,l=n+2,i.push(c,h,h,l,l,c);(i=new(65535<B(i)?H:O)(i,1)).version=r,e.update(i,34963),(a=o.get(t))&&e.remove(a),o.set(t,i)}var a=new WeakMap,o=new WeakMap;return{get:function(t,e){var n=a.get(e);return n||(e.addEventListener("dispose",r),e.isBufferGeometry?n=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new z).setFromObject(t)),n=e._bufferGeometry),a.set(e,n),i.memory.geometries++,n)},update:function(t){var i=t.index,r=t.attributes;for(var n in null!==i&&e.update(i,34963),r)e.update(r[n],34962);for(n in t=t.morphAttributes){r=0;for(var a=(i=t[n]).length;r<a;r++)e.update(i[r],34962)}},getWireframeAttribute:function(t){var e=o.get(t);if(e){var i=t.index;null!==i&&e.version<i.version&&n(t)}else n(t);return o.get(t)}}}function lt(t,e,i,r){var n,a,o,s=r.isWebGL2;this.setMode=function(t){n=t},this.setIndex=function(t){a=t.type,o=t.bytesPerElement},this.render=function(e,r){t.drawElements(n,r,a,e*o),i.update(r,n)},this.renderInstances=function(r,c,h,l){if(0!==l){if(s){r=t;var u="drawElementsInstanced"}else if(u="drawElementsInstancedANGLE",null===(r=e.get("ANGLE_instanced_arrays")))return void void 0;r[u](n,h,a,c*o,l),i.update(h,n,l)}}}function ut(t){var e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,i,r){switch(r=r||1,e.calls++,i){case 4:e.triangles+=t/3*r;break;case 5:case 6:e.triangles+=r*(t-2);break;case 1:e.lines+=t/2*r;break;case 3:e.lines+=r*(t-1);break;case 2:e.lines+=r*t;break;case 0:e.points+=r*t;break;default:void 0}}}}function pt(t,e){return Math.abs(e[1])-Math.abs(t[1])}function dt(t){var e={},i=new Float32Array(8);return{update:function(r,n,a,o){var s=r.morphTargetInfluences,c=s.length;if(void 0===(r=e[n.id])){r=[];for(var h=0;h<c;h++)r[h]=[h,0];e[n.id]=r}var l=a.morphTargets&&n.morphAttributes.position;for(a=a.morphNormals&&n.morphAttributes.normal,h=0;h<c;h++){var u=r[h];0!==u[1]&&(l&&n.deleteAttribute("morphTarget"+h),a&&n.deleteAttribute("morphNormal"+h))}for(h=0;h<c;h++)(u=r[h])[0]=h,u[1]=s[h];for(r.sort(pt),h=0;8>h;h++)(u=r[h])&&(s=u[0],c=u[1])?(l&&n.setAttribute("morphTarget"+h,l[s]),a&&n.setAttribute("morphNormal"+h,a[s]),i[h]=c):i[h]=0;o.getUniforms().setValue(t,"morphTargetInfluences",i)}}}function ft(t,e,i,r){var n={};return{update:function(t){var a=r.render.frame,o=t.geometry,s=e.get(t,o);return n[s.id]!==a&&(o.isGeometry&&s.updateFromObject(t),e.update(s),n[s.id]=a),t.isInstancedMesh&&i.update(t.instanceMatrix,34962),s},dispose:function(){n={}}}}function mt(t,e,i,r,n,a,s,c,h,l){t=void 0!==t?t:[],o.call(this,t,void 0!==e?e:301,i,r,n,a,void 0!==s?s:1022,c,h,l),this.flipY=!1}function gt(t,e,i,r){o.call(this,null),this.image={data:t||null,width:e||1,height:i||1,depth:r||1},this.minFilter=this.magFilter=1003,this.wrapR=1001,this.flipY=this.generateMipmaps=!1,this.needsUpdate=!0}function vt(t,e,i,r){o.call(this,null),this.image={data:t||null,width:e||1,height:i||1,depth:r||1},this.minFilter=this.magFilter=1003,this.wrapR=1001,this.flipY=this.generateMipmaps=!1,this.needsUpdate=!0}function yt(t,e,i){var r=t[0];if(0>=r||0<r)return t;var n=e*i,a=As[n];if(void 0===a&&(a=new Float32Array(n),As[n]=a),0!==e)for(r.toArray(a,0),r=1,n=0;r!==e;++r)n+=i,t[r].toArray(a,n);return a}function Et(t,e){if(t.length!==e.length)return!1;for(var i=0,r=t.length;i<r;i++)if(t[i]!==e[i])return!1;return!0}function xt(t,e){for(var i=0,r=e.length;i<r;i++)t[i]=e[i]}function bt(t,e){var i=Ts[e];void 0===i&&(i=new Int32Array(e),Ts[e]=i);for(var r=0;r!==e;++r)i[r]=t.allocateTextureUnit();return i}function St(t,e){var i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function wt(t,e){var i=this.cache;void 0!==e.x?i[0]===e.x&&i[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y):Et(i,e)||(t.uniform2fv(this.addr,e),xt(i,e))}function _t(t,e){var i=this.cache;void 0!==e.x?i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z):void 0!==e.r?i[0]===e.r&&i[1]===e.g&&i[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b):Et(i,e)||(t.uniform3fv(this.addr,e),xt(i,e))}function Mt(t,e){var i=this.cache;void 0!==e.x?i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w):Et(i,e)||(t.uniform4fv(this.addr,e),xt(i,e))}function At(t,e){var i=this.cache,r=e.elements;void 0===r?Et(i,e)||(t.uniformMatrix2fv(this.addr,!1,e),xt(i,e)):Et(i,r)||(Ls.set(r),t.uniformMatrix2fv(this.addr,!1,Ls),xt(i,r))}function Tt(t,e){var i=this.cache,r=e.elements;void 0===r?Et(i,e)||(t.uniformMatrix3fv(this.addr,!1,e),xt(i,e)):Et(i,r)||(Rs.set(r),t.uniformMatrix3fv(this.addr,!1,Rs),xt(i,r))}function Dt(t,e){var i=this.cache,r=e.elements;void 0===r?Et(i,e)||(t.uniformMatrix4fv(this.addr,!1,e),xt(i,e)):Et(i,r)||(Ds.set(r),t.uniformMatrix4fv(this.addr,!1,Ds),xt(i,r))}function Rt(t,e,i){var r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.safeSetTexture2D(e||Ss,n)}function Lt(t,e,i){var r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(e||ws,n)}function Ct(t,e,i){var r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(e||_s,n)}function Pt(t,e,i){var r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.safeSetTextureCube(e||Ms,n)}function Ot(t,e){var i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function It(t,e){var i=this.cache;Et(i,e)||(t.uniform2iv(this.addr,e),xt(i,e))}function Ht(t,e){var i=this.cache;Et(i,e)||(t.uniform3iv(this.addr,e),xt(i,e))}function Nt(t,e){var i=this.cache;Et(i,e)||(t.uniform4iv(this.addr,e),xt(i,e))}function Ut(t,e){t.uniform1fv(this.addr,e)}function Ft(t,e){t.uniform1iv(this.addr,e)}function Bt(t,e){t.uniform2iv(this.addr,e)}function zt(t,e){t.uniform3iv(this.addr,e)}function Gt(t,e){t.uniform4iv(this.addr,e)}function jt(t,e){e=yt(e,this.size,2),t.uniform2fv(this.addr,e)}function Vt(t,e){e=yt(e,this.size,3),t.uniform3fv(this.addr,e)}function kt(t,e){e=yt(e,this.size,4),t.uniform4fv(this.addr,e)}function Wt(t,e){e=yt(e,this.size,4),t.uniformMatrix2fv(this.addr,!1,e)}function qt(t,e){e=yt(e,this.size,9),t.uniformMatrix3fv(this.addr,!1,e)}function Xt(t,e){e=yt(e,this.size,16),t.uniformMatrix4fv(this.addr,!1,e)}function Yt(t,e,i){var r=e.length,n=bt(i,r);for(t.uniform1iv(this.addr,n),t=0;t!==r;++t)i.safeSetTexture2D(e[t]||Ss,n[t])}function Jt(t,e,i){var r=e.length,n=bt(i,r);for(t.uniform1iv(this.addr,n),t=0;t!==r;++t)i.safeSetTextureCube(e[t]||Ms,n[t])}function Zt(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=function(t){switch(t){case 5126:return St;case 35664:return wt;case 35665:return _t;case 35666:return Mt;case 35674:return At;case 35675:return Tt;case 35676:return Dt;case 35678:case 36198:return Rt;case 35679:return Ct;case 35680:return Pt;case 36289:return Lt;case 5124:case 35670:return Ot;case 35667:case 35671:return It;case 35668:case 35672:return Ht;case 35669:case 35673:return Nt}}(e.type)}function Kt(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Ut;case 35664:return jt;case 35665:return Vt;case 35666:return kt;case 35674:return Wt;case 35675:return qt;case 35676:return Xt;case 35678:return Yt;case 35680:return Jt;case 5124:case 35670:return Ft;case 35667:case 35671:return Bt;case 35668:case 35672:return zt;case 35669:case 35673:return Gt}}(e.type)}function Qt(t){this.id=t,this.seq=[],this.map={}}function $t(t,e){this.seq=[],this.map={};for(var i=t.getProgramParameter(e,35718),r=0;r<i;++r){var n=t.getActiveUniform(e,r),a=t.getUniformLocation(e,n.name),o=this,s=n.name,c=s.length;for(Cs.lastIndex=0;;){var h=Cs.exec(s),l=Cs.lastIndex,u=h[1],p=h[3];if("]"===h[2]&&(u|=0),void 0===p||"["===p&&l+2===c){s=o,n=void 0===p?new Zt(u,n,a):new Kt(u,n,a),s.seq.push(n),s.map[n.id]=n;break}void 0===(p=o.map[u])&&(p=new Qt(u),u=o,o=p,u.seq.push(o),u.map[o.id]=o),o=p}}}function te(t,e,i){return e=t.createShader(e),t.shaderSource(e,i),t.compileShader(e),e}function ee(t){switch(t){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:throw Error("unsupported encoding: "+t)}}function ie(t,e,i){var r=t.getShaderParameter(e,35713),n=t.getShaderInfoLog(e).trim();if(r&&""===n)return"";for(t=t.getShaderSource(e).split("\n"),e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return"THREE.WebGLShader: gl.getShaderInfoLog() "+i+"\n"+n+(t=t.join("\n"))}function re(t,e){return"vec4 "+t+"( vec4 value ) { return "+(e=ee(e))[0]+"ToLinear"+e[1]+"; }"}function ne(t,e){return"vec4 "+t+"( vec4 value ) { return LinearTo"+(e=ee(e))[0]+e[1]+"; }"}function ae(t,e){switch(e){case 1:e="Linear";break;case 2:e="Reinhard";break;case 3:e="Uncharted2";break;case 4:e="OptimizedCineon";break;case 5:e="ACESFilmic";break;default:throw Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+e+"ToneMapping( color ); }"}function oe(t){return""!==t}function se(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function ce(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}function he(t,e){if(void 0===(t=Es[e]))throw Error("Can not resolve #include <"+e+">");return t.replace(Os,he)}function le(t,e,i,r){for(t="",e=parseInt(e);e<parseInt(i);e++)t+=r.replace(/\[ i \]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return t}function ue(t){var e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function pe(t,e,i,r,n,a){var o,s,c=t.getContext(),h=r.defines,l=n.vertexShader,u=n.fragmentShader,p=function(t){var e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(a),d=function(t){var e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case 301:case 302:e="ENVMAP_TYPE_CUBE";break;case 306:case 307:e="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:e="ENVMAP_TYPE_EQUIREC";break;case 305:e="ENVMAP_TYPE_SPHERE"}return e}(a),f=function(t){var e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case 302:case 304:e="ENVMAP_MODE_REFRACTION"}return e}(a),m=function(t){var e="ENVMAP_BLENDING_MULTIPLY";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(a),g=0<t.gammaFactor?t.gammaFactor:1,v=a.isWebGL2?"":function(t,e,i){return[(t=t||{}).derivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(t.fragDepth||e.logarithmicDepthBuffer)&&i.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",t.drawBuffers&&i.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(t.shaderTextureLOD||e.envMap)&&i.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(oe).join("\n")}(r.extensions,a,e),y=function(t){var e,i=[];for(e in t){var r=t[e];!1!==r&&i.push("#define "+e+" "+r)}return i.join("\n")}(h),E=c.createProgram(),x=a.numMultiviewViews;return r.isRawShaderMaterial?(0<(h=[y].filter(oe).join("\n")).length&&(h+="\n"),0<(e=[v,y].filter(oe).join("\n")).length&&(e+="\n")):(h=[ue(a),"#define SHADER_NAME "+n.name,y,a.instancing?"#define USE_INSTANCING":"",a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+g,"#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp2?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+f:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.normalMap&&a.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",a.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.vertexUvs?"#define USE_UV":"",a.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&!1===a.flatShading?"#define USE_MORPHNORMALS":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+p:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(a.isWebGL2||e.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(oe).join("\n"),e=[v,ue(a),"#define SHADER_NAME "+n.name,y,a.alphaTest?"#define ALPHATEST "+a.alphaTest+(a.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+g,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp2?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.matcap?"#define USE_MATCAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+d:"",a.envMap?"#define "+f:"",a.envMap?"#define "+m:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.normalMap&&a.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",a.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.sheen?"#define USE_SHEEN":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.vertexUvs?"#define USE_UV":"",a.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+p:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(a.isWebGL2||e.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",(r.extensions&&r.extensions.shaderTextureLOD||a.envMap)&&(a.isWebGL2||e.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==a.toneMapping?"#define TONE_MAPPING":"",0!==a.toneMapping?Es.tonemapping_pars_fragment:"",0!==a.toneMapping?ae("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.outputEncoding||a.mapEncoding||a.matcapEncoding||a.envMapEncoding||a.emissiveMapEncoding?Es.encodings_pars_fragment:"",a.mapEncoding?re("mapTexelToLinear",a.mapEncoding):"",a.matcapEncoding?re("matcapTexelToLinear",a.matcapEncoding):"",a.envMapEncoding?re("envMapTexelToLinear",a.envMapEncoding):"",a.emissiveMapEncoding?re("emissiveMapTexelToLinear",a.emissiveMapEncoding):"",a.outputEncoding?ne("linearToOutputTexel",a.outputEncoding):"",a.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(oe).join("\n")),l=ce(l=se(l=l.replace(Os,he),a),a),u=ce(u=se(u=u.replace(Os,he),a),a),l=l.replace(Is,le),u=u.replace(Is,le),a.isWebGL2&&!r.isRawShaderMaterial&&(p=!1,d=/^\s*#version\s+300\s+es\s*\n/,r.isShaderMaterial&&null!==l.match(d)&&null!==u.match(d)&&(p=!0,l=l.replace(d,""),u=u.replace(d,"")),h="#version 300 es\n\n#define attribute in\n#define varying out\n#define texture2D texture\n"+h,e=["#version 300 es\n\n#define varying in",p?"":"out highp vec4 pc_fragColor;",p?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth\n#define texture2D texture\n#define textureCube texture\n#define texture2DProj textureProj\n#define texture2DLodEXT textureLod\n#define texture2DProjLodEXT textureProjLod\n#define textureCubeLodEXT textureLod\n#define texture2DGradEXT textureGrad\n#define texture2DProjGradEXT textureProjGrad\n#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+e,0<x&&(h=(h=h.replace("#version 300 es\n",["#version 300 es\n\n#extension GL_OVR_multiview2 : require","layout(num_views = "+x+") in;","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace("uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;",["uniform mat4 modelViewMatrices["+x+"];","uniform mat4 projectionMatrices["+x+"];","uniform mat4 viewMatrices["+x+"];","uniform mat3 normalMatrices["+x+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]\n#define projectionMatrix projectionMatrices[VIEW_ID]\n#define viewMatrix viewMatrices[VIEW_ID]\n#define normalMatrix normalMatrices[VIEW_ID]"].join("\n")),e=(e=e.replace("#version 300 es\n","#version 300 es\n\n#extension GL_OVR_multiview2 : require\n#define VIEW_ID gl_ViewID_OVR")).replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+x+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join("\n")))),u=e+u,l=te(c,35633,h+l),u=te(c,35632,u),c.attachShader(E,l),c.attachShader(E,u),void 0!==r.index0AttributeName?c.bindAttribLocation(E,0,r.index0AttributeName):!0===a.morphTargets&&c.bindAttribLocation(E,0,"position"),c.linkProgram(E),t.debug.checkShaderErrors&&(t=c.getProgramInfoLog(E).trim(),a=c.getShaderInfoLog(l).trim(),p=c.getShaderInfoLog(u).trim(),f=d=!0,!1===c.getProgramParameter(E,35714)?(d=!1,m=ie(c,l,"vertex"),g=ie(c,u,"fragment"),void 0):""!==t?void 0:""!==a&&""!==p||(f=!1),f&&(this.diagnostics={runnable:d,material:r,programLog:t,vertexShader:{log:a,prefix:h},fragmentShader:{log:p,prefix:e}})),c.deleteShader(l),c.deleteShader(u),this.getUniforms=function(){return void 0===o&&(o=new $t(c,E)),o},this.getAttributes=function(){if(void 0===s){for(var t={},e=c.getProgramParameter(E,35721),i=0;i<e;i++){var r=c.getActiveAttrib(E,i).name;t[r]=c.getAttribLocation(E,r)}s=t}return s},this.destroy=function(){c.deleteProgram(E),this.program=void 0},this.name=n.name,this.id=Ps++,this.cacheKey=i,this.usedTimes=1,this.program=E,this.vertexShader=l,this.fragmentShader=u,this.numMultiviewViews=x,this}function de(t,e,i){function r(t,e){if(t)t.isTexture?i=t.encoding:t.isWebGLRenderTarget&&(void 0,i=t.texture.encoding);else var i=3e3;return 3e3===i&&e&&(i=3007),i}var n=[],a=i.isWebGL2,o=i.logarithmicDepthBuffer,s=i.floatVertexTextures,c=i.precision,h=i.maxVertexUniforms,l=i.vertexTextures,u={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},p="precision isWebGL2 supportsVertexTextures outputEncoding instancing numMultiviewViews map mapEncoding matcap matcapEncoding envMap envMapMode envMapEncoding envMapCubeUV lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap objectSpaceNormalMap tangentSpaceNormalMap clearcoatNormalMap displacementMap specularMap roughnessMap metalnessMap gradientMap alphaMap combine vertexColors vertexTangents vertexUvs uvsVertexOnly fog useFog fogExp2 flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights numRectAreaLights numDirLightShadows numPointLightShadows numSpotLightShadows shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes numClipIntersection depthPacking dithering sheen".split(" ");this.getParameters=function(e,n,p,d,f,m,g){var v=u[e.type];if(g.isSkinnedMesh){var y=g.skeleton.bones;if(s)y=1024;else{var E=Math.min(Math.floor((h-20)/4),y.length);E<y.length?(void 0,y=0):y=E}}else y=0;return null!==e.precision&&((c=i.getMaxPrecision(e.precision))!==e.precision&&void 0),E=t.getRenderTarget(),{isWebGL2:a,shaderID:v,precision:c,instancing:!0===g.isInstancedMesh,supportsVertexTextures:l,numMultiviewViews:E&&E.isWebGLMultiviewRenderTarget?E.numViews:0,outputEncoding:r(E?E.texture:null,t.gammaOutput),map:!!e.map,mapEncoding:r(e.map,t.gammaInput),matcap:!!e.matcap,matcapEncoding:r(e.matcap,t.gammaInput),envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,envMapEncoding:r(e.envMap,t.gammaInput),envMapCubeUV:!!e.envMap&&(306===e.envMap.mapping||307===e.envMap.mapping),lightMap:!!e.lightMap,aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,emissiveMapEncoding:r(e.emissiveMap,t.gammaInput),bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,objectSpaceNormalMap:1===e.normalMapType,tangentSpaceNormalMap:0===e.normalMapType,clearcoatNormalMap:!!e.clearcoatNormalMap,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,gradientMap:!!e.gradientMap,sheen:!!e.sheen,combine:e.combine,vertexTangents:e.normalMap&&e.vertexTangents,vertexColors:e.vertexColors,vertexUvs:!!(e.map||e.bumpMap||e.normalMap||e.specularMap||e.alphaMap||e.emissiveMap||e.roughnessMap||e.metalnessMap||e.clearcoatNormalMap||e.displacementMap),uvsVertexOnly:!(e.map||e.bumpMap||e.normalMap||e.specularMap||e.alphaMap||e.emissiveMap||e.roughnessMap||e.metalnessMap||e.clearcoatNormalMap||!e.displacementMap),fog:!!d,useFog:e.fog,fogExp2:d&&d.isFogExp2,flatShading:e.flatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:o,skinning:e.skinning&&0<y,maxBones:y,useVertexTexture:s,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:n.directional.length,numPointLights:n.point.length,numSpotLights:n.spot.length,numRectAreaLights:n.rectArea.length,numHemiLights:n.hemi.length,numDirLightShadows:n.directionalShadowMap.length,numPointLightShadows:n.pointShadowMap.length,numSpotLightShadows:n.spotShadowMap.length,numClippingPlanes:f,numClipIntersection:m,dithering:e.dithering,shadowMapEnabled:t.shadowMap.enabled&&0<p.length,shadowMapType:t.shadowMap.type,toneMapping:e.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:e.premultipliedAlpha,alphaTest:e.alphaTest,doubleSided:2===e.side,flipSided:1===e.side,depthPacking:void 0!==e.depthPacking&&e.depthPacking}},this.getProgramCacheKey=function(e,i){var r=[];if(i.shaderID?r.push(i.shaderID):(r.push(e.fragmentShader),r.push(e.vertexShader)),void 0!==e.defines)for(var n in e.defines)r.push(n),r.push(e.defines[n]);for(n=0;n<p.length;n++)r.push(i[p[n]]);return r.push(e.onBeforeCompile.toString()),r.push(t.gammaOutput),r.push(t.gammaFactor),r.join()},this.acquireProgram=function(i,r,a,o){for(var s,c=0,h=n.length;c<h;c++){var l=n[c];if(l.cacheKey===o){++(s=l).usedTimes;break}}return void 0===s&&(s=new pe(t,e,o,i,r,a),n.push(s)),s},this.releaseProgram=function(t){if(0==--t.usedTimes){var e=n.indexOf(t);n[e]=n[n.length-1],n.pop(),t.destroy()}},this.programs=n}function fe(){var t=new WeakMap;return{get:function(e){var i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i},remove:function(e){t.delete(e)},update:function(e,i,r){t.get(e)[i]=r},dispose:function(){t=new WeakMap}}}function me(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function ge(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function ve(){function t(t,r,n,o,s,c){var h=e[i];return void 0===h?(h={id:t.id,object:t,geometry:r,material:n,program:n.program||a,groupOrder:o,renderOrder:t.renderOrder,z:s,group:c},e[i]=h):(h.id=t.id,h.object=t,h.geometry=r,h.material=n,h.program=n.program||a,h.groupOrder=o,h.renderOrder=t.renderOrder,h.z=s,h.group=c),i++,h}var e=[],i=0,r=[],n=[],a={id:-1};return{opaque:r,transparent:n,init:function(){i=0,r.length=0,n.length=0},push:function(e,i,a,o,s,c){e=t(e,i,a,o,s,c),(!0===a.transparent?n:r).push(e)},unshift:function(e,i,a,o,s,c){e=t(e,i,a,o,s,c),(!0===a.transparent?n:r).unshift(e)},sort:function(){1<r.length&&r.sort(me),1<n.length&&n.sort(ge)}}}function ye(){function t(i){(i=i.target).removeEventListener("dispose",t),e.delete(i)}var e=new WeakMap;return{get:function(i,r){var n=e.get(i);if(void 0===n){var a=new ve;e.set(i,new WeakMap),e.get(i).set(r,a),i.addEventListener("dispose",t)}else void 0===(a=n.get(r))&&(a=new ve,n.set(r,a));return a},dispose:function(){e=new WeakMap}}}function Ee(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];switch(e.type){case"DirectionalLight":var r={direction:new n,color:new b,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new i};break;case"SpotLight":r={position:new n,direction:new n,color:new b,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new i};break;case"PointLight":r={position:new n,color:new b,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new i,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":r={direction:new n,skyColor:new b,groundColor:new b};break;case"RectAreaLight":r={color:new b,position:new n,halfWidth:new n,halfHeight:new n}}return t[e.id]=r}}}function xe(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function be(){for(var t=new Ee,e={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},i=0;9>i;i++)e.probe.push(new n);var r=new n,a=new l,o=new l;return{setup:function(i,n,s){for(var c=0,h=0,l=0,u=0;9>u;u++)e.probe[u].set(0,0,0);var p=n=0,d=0,f=0,m=0,g=0,v=0,y=0;s=s.matrixWorldInverse,i.sort(xe),u=0;for(var E=i.length;u<E;u++){var x=i[u],b=x.color,S=x.intensity,w=x.distance,_=x.shadow&&x.shadow.map?x.shadow.map.texture:null;if(x.isAmbientLight)c+=b.r*S,h+=b.g*S,l+=b.b*S;else if(x.isLightProbe)for(_=0;9>_;_++)e.probe[_].addScaledVector(x.sh.coefficients[_],S);else if(x.isDirectionalLight){var M=t.get(x);M.color.copy(x.color).multiplyScalar(x.intensity),M.direction.setFromMatrixPosition(x.matrixWorld),r.setFromMatrixPosition(x.target.matrixWorld),M.direction.sub(r),M.direction.transformDirection(s),(M.shadow=x.castShadow)&&(S=x.shadow,M.shadowBias=S.bias,M.shadowRadius=S.radius,M.shadowMapSize=S.mapSize,e.directionalShadowMap[n]=_,e.directionalShadowMatrix[n]=x.shadow.matrix,g++),e.directional[n]=M,n++}else x.isSpotLight?((M=t.get(x)).position.setFromMatrixPosition(x.matrixWorld),M.position.applyMatrix4(s),M.color.copy(b).multiplyScalar(S),M.distance=w,M.direction.setFromMatrixPosition(x.matrixWorld),r.setFromMatrixPosition(x.target.matrixWorld),M.direction.sub(r),M.direction.transformDirection(s),M.coneCos=Math.cos(x.angle),M.penumbraCos=Math.cos(x.angle*(1-x.penumbra)),M.decay=x.decay,(M.shadow=x.castShadow)&&(S=x.shadow,M.shadowBias=S.bias,M.shadowRadius=S.radius,M.shadowMapSize=S.mapSize,e.spotShadowMap[d]=_,e.spotShadowMatrix[d]=x.shadow.matrix,y++),e.spot[d]=M,d++):x.isRectAreaLight?((M=t.get(x)).color.copy(b).multiplyScalar(S),M.position.setFromMatrixPosition(x.matrixWorld),M.position.applyMatrix4(s),o.identity(),a.copy(x.matrixWorld),a.premultiply(s),o.extractRotation(a),M.halfWidth.set(.5*x.width,0,0),M.halfHeight.set(0,.5*x.height,0),M.halfWidth.applyMatrix4(o),M.halfHeight.applyMatrix4(o),e.rectArea[f]=M,f++):x.isPointLight?((M=t.get(x)).position.setFromMatrixPosition(x.matrixWorld),M.position.applyMatrix4(s),M.color.copy(x.color).multiplyScalar(x.intensity),M.distance=x.distance,M.decay=x.decay,(M.shadow=x.castShadow)&&(S=x.shadow,M.shadowBias=S.bias,M.shadowRadius=S.radius,M.shadowMapSize=S.mapSize,M.shadowCameraNear=S.camera.near,M.shadowCameraFar=S.camera.far,e.pointShadowMap[p]=_,e.pointShadowMatrix[p]=x.shadow.matrix,v++),e.point[p]=M,p++):x.isHemisphereLight&&((M=t.get(x)).direction.setFromMatrixPosition(x.matrixWorld),M.direction.transformDirection(s),M.direction.normalize(),M.skyColor.copy(x.color).multiplyScalar(S),M.groundColor.copy(x.groundColor).multiplyScalar(S),e.hemi[m]=M,m++)}e.ambient[0]=c,e.ambient[1]=h,e.ambient[2]=l,(i=e.hash).directionalLength===n&&i.pointLength===p&&i.spotLength===d&&i.rectAreaLength===f&&i.hemiLength===m&&i.numDirectionalShadows===g&&i.numPointShadows===v&&i.numSpotShadows===y||(e.directional.length=n,e.spot.length=d,e.rectArea.length=f,e.point.length=p,e.hemi.length=m,e.directionalShadowMap.length=g,e.pointShadowMap.length=v,e.spotShadowMap.length=y,e.directionalShadowMatrix.length=g,e.pointShadowMatrix.length=v,e.spotShadowMatrix.length=y,i.directionalLength=n,i.pointLength=p,i.spotLength=d,i.rectAreaLength=f,i.hemiLength=m,i.numDirectionalShadows=g,i.numPointShadows=v,i.numSpotShadows=y,e.version=Hs++)},state:e}}function Se(){var t=new be,e=[],i=[];return{init:function(){e.length=0,i.length=0},state:{lightsArray:e,shadowsArray:i,lights:t},setupLights:function(r){t.setup(e,i,r)},pushLight:function(t){e.push(t)},pushShadow:function(t){i.push(t)}}}function we(){function t(i){(i=i.target).removeEventListener("dispose",t),e.delete(i)}var e=new WeakMap;return{get:function(i,r){if(!1===e.has(i)){var n=new Se;e.set(i,new WeakMap),e.get(i).set(r,n),i.addEventListener("dispose",t)}else!1===e.get(i).has(r)?(n=new Se,e.get(i).set(r,n)):n=e.get(i).get(r);return n},dispose:function(){e=new WeakMap}}}function _e(t){A.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.morphTargets=this.skinning=!1,this.displacementMap=this.alphaMap=this.map=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function Me(t){A.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new n,this.nearDistance=1,this.farDistance=1e3,this.morphTargets=this.skinning=!1,this.displacementMap=this.alphaMap=this.map=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}function Ae(t,e,r){function n(t,e,i){var r=f[i=t<<0|e<<1|i<<2];return void 0===r&&(r=new _e({depthPacking:3201,morphTargets:t,skinning:e}),f[i]=r),r}function a(t,e,i){var r=m[i=t<<0|e<<1|i<<2];return void 0===r&&(r=new Me({morphTargets:t,skinning:e}),m[i]=r),r}function o(e,i,r,o,s,c){var h=e.geometry,l=n,u=e.customDepthMaterial;return!0===r.isPointLight&&(l=a,u=e.customDistanceMaterial),void 0===u?(u=!1,!0===i.morphTargets&&(!0===h.isBufferGeometry?u=h.morphAttributes&&h.morphAttributes.position&&0<h.morphAttributes.position.length:!0===h.isGeometry&&(u=h.morphTargets&&0<h.morphTargets.length)),h=!1,!0===e.isSkinnedMesh&&(!0===i.skinning?h=!0:void 0),e=l(u,h,!0===e.isInstancedMesh)):e=u,t.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length&&(u=e.uuid,l=i.uuid,void 0===(h=g[u])&&(h={},g[u]=h),void 0===(u=h[l])&&(u=e.clone(),h[l]=u),e=u),e.visible=i.visible,e.wireframe=i.wireframe,e.side=3===c?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:v[i.side],e.clipShadows=i.clipShadows,e.clippingPlanes=i.clippingPlanes,e.clipIntersection=i.clipIntersection,e.wireframeLinewidth=i.wireframeLinewidth,e.linewidth=i.linewidth,!0===r.isPointLight&&!0===e.isMeshDistanceMaterial&&(e.referencePosition.setFromMatrixPosition(r.matrixWorld),e.nearDistance=o,e.farDistance=s),e}function h(i,r,n,a,s){if(!1!==i.visible){if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&3===s)&&(!i.frustumCulled||l.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,i.matrixWorld);var c=e.update(i),u=i.material;if(Array.isArray(u))for(var p=c.groups,d=0,f=p.length;d<f;d++){var m=p[d],g=u[m.materialIndex];g&&g.visible&&(g=o(i,g,a,n.near,n.far,s),t.renderBufferDirect(n,null,c,g,i,m))}else u.visible&&(g=o(i,u,a,n.near,n.far,s),t.renderBufferDirect(n,null,c,g,i,null))}for(c=0,u=(i=i.children).length;c<u;c++)h(i[c],r,n,a,s)}}var l=new $,u=new i,p=new i,d=new s,f=[],m=[],g={},v={0:1,1:0,2:2},y=new X({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:.125},uniforms:{shadow_pass:{value:null},resolution:{value:new i},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n  \n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = decodeHalfRGBA ( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = pow( squared_mean - mean * mean, 0.5 );\n  gl_FragColor = encodeHalfRGBA( vec2( mean, std_dev ) );\n}"}),E=y.clone();E.defines.HORIZONAL_PASS=1;var x=new z;x.setAttribute("position",new D(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var b=new G(x,y),S=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(i,n,a){if(!1!==S.enabled&&(!1!==S.autoUpdate||!1!==S.needsUpdate)&&0!==i.length){var o=t.getRenderTarget(),s=t.getActiveCubeFace(),f=t.getActiveMipmapLevel(),m=t.state;m.setBlending(0),m.buffers.color.setClear(1,1,1,1),m.buffers.depth.setTest(!0),m.setScissorTest(!1);for(var g=0,v=i.length;g<v;g++){var x=i[g],w=x.shadow;if(void 0===w)void 0;else{u.copy(w.mapSize);var _=w.getFrameExtents();u.multiply(_),p.copy(w.mapSize),(u.x>r||u.y>r)&&(void 0,u.x>r&&(p.x=Math.floor(r/_.x),u.x=p.x*_.x,w.mapSize.x=p.x),u.y>r&&(p.y=Math.floor(r/_.y),u.y=p.y*_.y,w.mapSize.y=p.y)),null!==w.map||w.isPointLightShadow||3!==this.type||(_={minFilter:1006,magFilter:1006,format:1023},w.map=new c(u.x,u.y,_),w.map.texture.name=x.name+".shadowMap",w.mapPass=new c(u.x,u.y,_),w.camera.updateProjectionMatrix()),null===w.map&&(_={minFilter:1003,magFilter:1003,format:1023},w.map=new c(u.x,u.y,_),w.map.texture.name=x.name+".shadowMap",w.camera.updateProjectionMatrix()),t.setRenderTarget(w.map),t.clear(),_=w.getViewportCount();for(var M=0;M<_;M++){var A=w.getViewport(M);d.set(p.x*A.x,p.y*A.y,p.x*A.z,p.y*A.w),m.viewport(d),w.updateMatrices(x,M),l=w.getFrustum(),h(n,a,w.camera,x,this.type)}w.isPointLightShadow||3!==this.type||(x=w,w=a,_=e.update(b),y.uniforms.shadow_pass.value=x.map.texture,y.uniforms.resolution.value=x.mapSize,y.uniforms.radius.value=x.radius,t.setRenderTarget(x.mapPass),t.clear(),t.renderBufferDirect(w,null,_,y,b,null),E.uniforms.shadow_pass.value=x.mapPass.texture,E.uniforms.resolution.value=x.mapSize,E.uniforms.radius.value=x.radius,t.setRenderTarget(x.map),t.clear(),t.renderBufferDirect(w,null,_,E,b,null))}}S.needsUpdate=!1,t.setRenderTarget(o,s,f)}}}function Te(t,e,i){function r(e,i,r){var n=new Uint8Array(4),a=t.createTexture();for(t.bindTexture(e,a),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728),e=0;e<r;e++)t.texImage2D(i+e,0,6408,1,1,0,6408,5121,n);return a}function n(i,r){v[i]=1,0===y[i]&&(t.enableVertexAttribArray(i),y[i]=1),E[i]!==r&&((d?t:e.get("ANGLE_instanced_arrays"))[d?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),E[i]=r)}function a(e){!0!==x[e]&&(t.enable(e),x[e]=!0)}function o(e){!1!==x[e]&&(t.disable(e),x[e]=!1)}function c(e,i,r,n,s,c,h,l){if(0===e)S&&(o(3042),S=!1);else if(S||(a(3042),S=!0),5!==e){if(e!==w||l!==L){if(100===_&&100===T||(t.blendEquation(32774),T=_=100),l)switch(e){case 1:t.blendFuncSeparate(1,771,1,771);break;case 2:t.blendFunc(1,1);break;case 3:t.blendFuncSeparate(0,0,769,771);break;case 4:t.blendFuncSeparate(0,768,0,770);break;default:void 0}else switch(e){case 1:t.blendFuncSeparate(770,771,1,771);break;case 2:t.blendFunc(770,1);break;case 3:t.blendFunc(0,769);break;case 4:t.blendFunc(0,768);break;default:void 0}R=D=A=M=null,w=e,L=l}}else s=s||i,c=c||r,h=h||n,i===_&&s===T||(t.blendEquationSeparate(V[i],V[s]),_=i,T=s),r===M&&n===A&&c===D&&h===R||(t.blendFuncSeparate(k[r],k[n],k[c],k[h]),M=r,A=n,D=c,R=h),w=e,L=null}function h(e){C!==e&&(e?t.frontFace(2304):t.frontFace(2305),C=e)}function l(e){0!==e?(a(2884),e!==P&&(1===e?t.cullFace(1029):2===e?t.cullFace(1028):t.cullFace(1032))):o(2884),P=e}function u(e,i,r){e?(a(32823),(I!==i||H!==r)&&(t.polygonOffset(i,r),I=i,H=r)):o(32823)}function p(e){void 0===e&&(e=33984+N-1),F!==e&&(t.activeTexture(e),F=e)}var d=i.isWebGL2,f=new function(){var e=!1,i=new s,r=null,n=new s(0,0,0,0);return{setMask:function(i){r===i||e||(t.colorMask(i,i,i,i),r=i)},setLocked:function(t){e=t},setClear:function(e,r,a,o,s){!0===s&&(e*=o,r*=o,a*=o),i.set(e,r,a,o),!1===n.equals(i)&&(t.clearColor(e,r,a,o),n.copy(i))},reset:function(){e=!1,r=null,n.set(-1,0,0,0)}}},m=new function(){var e=!1,i=null,r=null,n=null;return{setTest:function(t){t?a(2929):o(2929)},setMask:function(r){i===r||e||(t.depthMask(r),i=r)},setFunc:function(e){if(r!==e){if(e)switch(e){case 0:t.depthFunc(512);break;case 1:t.depthFunc(519);break;case 2:t.depthFunc(513);break;case 3:t.depthFunc(515);break;case 4:t.depthFunc(514);break;case 5:t.depthFunc(518);break;case 6:t.depthFunc(516);break;case 7:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);r=e}},setLocked:function(t){e=t},setClear:function(e){n!==e&&(t.clearDepth(e),n=e)},reset:function(){e=!1,n=r=i=null}}},g=new function(){var e=!1,i=null,r=null,n=null,s=null,c=null,h=null,l=null,u=null;return{setTest:function(t){e||(t?a(2960):o(2960))},setMask:function(r){i===r||e||(t.stencilMask(r),i=r)},setFunc:function(e,i,a){r===e&&n===i&&s===a||(t.stencilFunc(e,i,a),r=e,n=i,s=a)},setOp:function(e,i,r){c===e&&h===i&&l===r||(t.stencilOp(e,i,r),c=e,h=i,l=r)},setLocked:function(t){e=t},setClear:function(e){u!==e&&(t.clearStencil(e),u=e)},reset:function(){e=!1,u=l=h=c=s=n=r=i=null}}};i=t.getParameter(34921);var v=new Uint8Array(i),y=new Uint8Array(i),E=new Uint8Array(i),x={},b=null,S=null,w=null,_=null,M=null,A=null,T=null,D=null,R=null,L=!1,C=null,P=null,O=null,I=null,H=null,N=t.getParameter(35661),U=!1;i=0,-1!==(i=t.getParameter(7938)).indexOf("WebGL")?(i=parseFloat(/^WebGL ([0-9])/.exec(i)[1]),U=1<=i):-1!==i.indexOf("OpenGL ES")&&(i=parseFloat(/^OpenGL ES ([0-9])/.exec(i)[1]),U=2<=i);var F=null,B={},z=new s,G=new s,j={};j[3553]=r(3553,3553,1),j[34067]=r(34067,34069,6),f.setClear(0,0,0,1),m.setClear(1),g.setClear(0),a(2929),m.setFunc(3),h(!1),l(1),a(2884),c(0);var V={100:32774,101:32778,102:32779};d?(V[103]=32775,V[104]=32776):null!==(i=e.get("EXT_blend_minmax"))&&(V[103]=i.MIN_EXT,V[104]=i.MIN_EXT);var k={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};return{buffers:{color:f,depth:m,stencil:g},initAttributes:function(){for(var t=0,e=v.length;t<e;t++)v[t]=0},enableAttribute:function(t){n(t,0)},enableAttributeAndDivisor:n,disableUnusedAttributes:function(){for(var e=0,i=y.length;e!==i;++e)y[e]!==v[e]&&(t.disableVertexAttribArray(e),y[e]=0)},enable:a,disable:o,useProgram:function(e){return b!==e&&(t.useProgram(e),b=e,!0)},setBlending:c,setMaterial:function(t,e){2===t.side?o(2884):a(2884);var i=1===t.side;e&&(i=!i),h(i),1===t.blending&&!1===t.transparent?c(0):c(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),m.setFunc(t.depthFunc),m.setTest(t.depthTest),m.setMask(t.depthWrite),f.setMask(t.colorWrite),e=t.stencilWrite,g.setTest(e),e&&(g.setMask(t.stencilWriteMask),g.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),g.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),u(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:h,setCullFace:l,setLineWidth:function(e){e!==O&&(U&&t.lineWidth(e),O=e)},setPolygonOffset:u,setScissorTest:function(t){t?a(3089):o(3089)},activeTexture:p,bindTexture:function(e,i){null===F&&p();var r=B[F];void 0===r&&(r={type:void 0,texture:void 0},B[F]=r),r.type===e&&r.texture===i||(t.bindTexture(e,i||j[e]),r.type=e,r.texture=i)},unbindTexture:function(){var e=B[F];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){void 0}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){void 0}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){void 0}},scissor:function(e){!1===z.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),z.copy(e))},viewport:function(e){!1===G.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),G.copy(e))},reset:function(){for(var e=0;e<y.length;e++)1===y[e]&&(t.disableVertexAttribArray(e),y[e]=0);x={},F=null,B={},P=C=w=b=null,f.reset(),m.reset(),g.reset()}}}function De(t,e,i,r,n,a,o){function s(t,e){return P?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function c(t,e,i,r){var n=1;if((t.width>r||t.height>r)&&(n=r/Math.max(t.width,t.height)),1>n||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap)return e=(r=e?Ta.floorPowerOfTwo:Math.floor)(n*t.width),n=r(n*t.height),void 0===M&&(M=s(e,n)),(i=i?s(e,n):M).width=e,i.height=n,i.getContext("2d").drawImage(t,0,0,e,n),void 0,i;"data"in t&&void 0}return t}function h(t){return Ta.isPowerOfTwo(t.width)&&Ta.isPowerOfTwo(t.height)}function l(t,e){return t.generateMipmaps&&e&&1003!==t.minFilter&&1006!==t.minFilter}function u(e,i,n,a){t.generateMipmap(e),r.get(i).__maxMipLevel=Math.log(Math.max(n,a))*Math.LOG2E}function p(t,i){if(!1===A)return t;var r=t;return 6403===t&&(5126===i&&(r=33326),5131===i&&(r=33325),5121===i&&(r=33321)),6407===t&&(5126===i&&(r=34837),5131===i&&(r=34843),5121===i&&(r=32849)),6408===t&&(5126===i&&(r=34836),5131===i&&(r=34842),5121===i&&(r=32856)),33325===r||33326===r||34842===r||34836===r?e.get("EXT_color_buffer_float"):(34843===r||34837===r)&&void 0,r}function d(t){return 1003===t||1004===t||1005===t?9728:9729}function f(e){(e=e.target).removeEventListener("dispose",f);var i=r.get(e);void 0!==i.__webglInit&&(t.deleteTexture(i.__webglTexture),r.remove(e)),e.isVideoTexture&&C.delete(e),o.memory.textures--}function m(e){(e=e.target).removeEventListener("dispose",m);var i=r.get(e),n=r.get(e.texture);if(e){if(void 0!==n.__webglTexture&&t.deleteTexture(n.__webglTexture),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLRenderTargetCube)for(n=0;6>n;n++)t.deleteFramebuffer(i.__webglFramebuffer[n]),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer[n]);else t.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer);if(e.isWebGLMultiviewRenderTarget){t.deleteTexture(i.__webglColorTexture),t.deleteTexture(i.__webglDepthStencilTexture),o.memory.textures-=2,n=0;for(var a=i.__webglViewFramebuffers.length;n<a;n++)t.deleteFramebuffer(i.__webglViewFramebuffers[n])}r.remove(e.texture),r.remove(e)}o.memory.textures--}function g(t,e){var n=r.get(t);if(t.isVideoTexture){var a=o.render.frame;C.get(t)!==a&&(C.set(t,a),t.update())}if(0<t.version&&n.__version!==t.version)if(void 0===(a=t.image))void 0;else{if(!1!==a.complete)return void b(n,t,e);void 0}i.activeTexture(33984+e),i.bindTexture(3553,n.__webglTexture)}function v(e,n){if(6===e.image.length){var o=r.get(e);if(0<e.version&&o.__version!==e.version){x(o,e),i.activeTexture(33984+n),i.bindTexture(34067,o.__webglTexture),t.pixelStorei(37440,e.flipY);var s=e&&e.isCompressedTexture;n=e.image[0]&&e.image[0].isDataTexture;for(var d=[],f=0;6>f;f++)d[f]=s||n?n?e.image[f].image:e.image[f]:c(e.image[f],!1,!0,D);var m=d[0],g=h(m)||A,v=a.convert(e.format),y=a.convert(e.type),b=p(v,y);if(E(34067,e,g),s){for(f=0;6>f;f++){var S=d[f].mipmaps;for(s=0;s<S.length;s++){var w=S[s];1023!==e.format&&1022!==e.format?null!==v?i.compressedTexImage2D(34069+f,s,b,w.width,w.height,0,w.data):void 0:i.texImage2D(34069+f,s,b,w.width,w.height,0,v,y,w.data)}}o.__maxMipLevel=S.length-1}else{for(S=e.mipmaps,f=0;6>f;f++)if(n)for(i.texImage2D(34069+f,0,b,d[f].width,d[f].height,0,v,y,d[f].data),s=0;s<S.length;s++)w=(w=S[s]).image[f].image,i.texImage2D(34069+f,s+1,b,w.width,w.height,0,v,y,w.data);else for(i.texImage2D(34069+f,0,b,v,y,d[f]),s=0;s<S.length;s++)w=S[s],i.texImage2D(34069+f,s+1,b,v,y,w.image[f]);o.__maxMipLevel=S.length}l(e,g)&&u(34067,e,m.width,m.height),o.__version=e.version,e.onUpdate&&e.onUpdate(e)}else i.activeTexture(33984+n),i.bindTexture(34067,o.__webglTexture)}}function y(t,e){i.activeTexture(33984+e),i.bindTexture(34067,r.get(t).__webglTexture)}function E(i,a,o){o?(t.texParameteri(i,10242,I[a.wrapS]),t.texParameteri(i,10243,I[a.wrapT]),32879!==i&&35866!==i||t.texParameteri(i,32882,I[a.wrapR]),t.texParameteri(i,10240,H[a.magFilter]),t.texParameteri(i,10241,H[a.minFilter])):(t.texParameteri(i,10242,33071),t.texParameteri(i,10243,33071),32879!==i&&35866!==i||t.texParameteri(i,32882,33071),1001===a.wrapS&&1001===a.wrapT||void 0,t.texParameteri(i,10240,d(a.magFilter)),t.texParameteri(i,10241,d(a.minFilter)),1003!==a.minFilter&&1006!==a.minFilter&&void 0),!(o=e.get("EXT_texture_filter_anisotropic"))||1015===a.type&&null===e.get("OES_texture_float_linear")||1016===a.type&&null===(A||e.get("OES_texture_half_float_linear"))||!(1<a.anisotropy||r.get(a).__currentAnisotropy)||(t.texParameterf(i,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,n.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy)}function x(e,i){void 0===e.__webglInit&&(e.__webglInit=!0,i.addEventListener("dispose",f),e.__webglTexture=t.createTexture(),o.memory.textures++)}function b(e,r,n){var o=3553;r.isDataTexture2DArray&&(o=35866),r.isDataTexture3D&&(o=32879),x(e,r),i.activeTexture(33984+n),i.bindTexture(o,e.__webglTexture),t.pixelStorei(37440,r.flipY),t.pixelStorei(37441,r.premultiplyAlpha),t.pixelStorei(3317,r.unpackAlignment),n=(n=!A&&(1001!==r.wrapS||1001!==r.wrapT||1003!==r.minFilter&&1006!==r.minFilter))&&!1===h(r.image);var s=h(n=c(r.image,n,!1,R))||A,d=a.convert(r.format),f=a.convert(r.type),m=p(d,f);E(o,r,s);var g=r.mipmaps;if(r.isDepthTexture){if(m=6402,1015===r.type){if(!1===A)throw Error("Float Depth Texture only supported in WebGL2.0");m=36012}else A&&(m=33189);1026===r.format&&6402===m&&1012!==r.type&&1014!==r.type&&(void 0,r.type=1012,f=a.convert(r.type)),1027===r.format&&(m=34041,1020!==r.type&&(void 0,r.type=1020,f=a.convert(r.type))),i.texImage2D(3553,0,m,n.width,n.height,0,d,f,null)}else if(r.isDataTexture)if(0<g.length&&s){for(var v=0,y=g.length;v<y;v++)o=g[v],i.texImage2D(3553,v,m,o.width,o.height,0,d,f,o.data);r.generateMipmaps=!1,e.__maxMipLevel=g.length-1}else i.texImage2D(3553,0,m,n.width,n.height,0,d,f,n.data),e.__maxMipLevel=0;else if(r.isCompressedTexture){for(v=0,y=g.length;v<y;v++)o=g[v],1023!==r.format&&1022!==r.format?null!==d?i.compressedTexImage2D(3553,v,m,o.width,o.height,0,o.data):void 0:i.texImage2D(3553,v,m,o.width,o.height,0,d,f,o.data);e.__maxMipLevel=g.length-1}else if(r.isDataTexture2DArray)i.texImage3D(35866,0,m,n.width,n.height,n.depth,0,d,f,n.data),e.__maxMipLevel=0;else if(r.isDataTexture3D)i.texImage3D(32879,0,m,n.width,n.height,n.depth,0,d,f,n.data),e.__maxMipLevel=0;else if(0<g.length&&s){for(v=0,y=g.length;v<y;v++)o=g[v],i.texImage2D(3553,v,m,d,f,o);r.generateMipmaps=!1,e.__maxMipLevel=g.length-1}else i.texImage2D(3553,0,m,d,f,n),e.__maxMipLevel=0;l(r,s)&&u(3553,r,n.width,n.height),e.__version=r.version,r.onUpdate&&r.onUpdate(r)}function S(e,n,o,s){var c=a.convert(n.texture.format),h=a.convert(n.texture.type),l=p(c,h);i.texImage2D(s,0,l,n.width,n.height,0,c,h,null),t.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,o,s,r.get(n.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function w(e,i,r){if(t.bindRenderbuffer(36161,e),i.depthBuffer&&!i.stencilBuffer)r?(r=_(i),t.renderbufferStorageMultisample(36161,r,33189,i.width,i.height)):t.renderbufferStorage(36161,33189,i.width,i.height),t.framebufferRenderbuffer(36160,36096,36161,e);else if(i.depthBuffer&&i.stencilBuffer)r?(r=_(i),t.renderbufferStorageMultisample(36161,r,35056,i.width,i.height)):t.renderbufferStorage(36161,34041,i.width,i.height),t.framebufferRenderbuffer(36160,33306,36161,e);else{e=p(e=a.convert(i.texture.format),a.convert(i.texture.type)),r?(r=_(i),t.renderbufferStorageMultisample(36161,r,e,i.width,i.height)):t.renderbufferStorage(36161,e,i.width,i.height)}t.bindRenderbuffer(36161,null)}function _(t){return A&&t.isWebGLMultisampleRenderTarget?Math.min(L,t.samples):0}var M,A=n.isWebGL2,T=n.maxTextures,D=n.maxCubemapSize,R=n.maxTextureSize,L=n.maxSamples,C=new WeakMap,P="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d"),O=0,I={1e3:10497,1001:33071,1002:33648},H={1003:9728,1004:9984,1005:9986,1006:9729,1007:9985,1008:9987},N=!1,U=!1;this.allocateTextureUnit=function(){var t=O;return t>=T&&void 0,O+=1,t},this.resetTextureUnits=function(){O=0},this.setTexture2D=g,this.setTexture2DArray=function(t,e){var n=r.get(t);0<t.version&&n.__version!==t.version?b(n,t,e):(i.activeTexture(33984+e),i.bindTexture(35866,n.__webglTexture))},this.setTexture3D=function(t,e){var n=r.get(t);0<t.version&&n.__version!==t.version?b(n,t,e):(i.activeTexture(33984+e),i.bindTexture(32879,n.__webglTexture))},this.setTextureCube=v,this.setTextureCubeDynamic=y,this.setupRenderTarget=function(n){var s=r.get(n),c=r.get(n.texture);n.addEventListener("dispose",m),c.__webglTexture=t.createTexture(),o.memory.textures++;var d=!0===n.isWebGLRenderTargetCube,f=!0===n.isWebGLMultisampleRenderTarget,v=!0===n.isWebGLMultiviewRenderTarget,y=h(n)||A;if(d){s.__webglFramebuffer=[];for(var x=0;6>x;x++)s.__webglFramebuffer[x]=t.createFramebuffer()}else if(s.__webglFramebuffer=t.createFramebuffer(),f)if(A){s.__webglMultisampledFramebuffer=t.createFramebuffer(),s.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,s.__webglColorRenderbuffer),f=a.convert(n.texture.format);var b=a.convert(n.texture.type);f=p(f,b),b=_(n),t.renderbufferStorageMultisample(36161,b,f,n.width,n.height),t.bindFramebuffer(36160,s.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,s.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),n.depthBuffer&&(s.__webglDepthRenderbuffer=t.createRenderbuffer(),w(s.__webglDepthRenderbuffer,n,!0)),t.bindFramebuffer(36160,null)}else void 0;else if(v){x=n.width;var M=n.height;f=n.numViews,t.bindFramebuffer(36160,s.__webglFramebuffer);var T=e.get("OVR_multiview2");o.memory.textures+=2,b=t.createTexture(),t.bindTexture(35866,b),t.texParameteri(35866,10240,9728),t.texParameteri(35866,10241,9728),t.texImage3D(35866,0,32856,x,M,f,0,6408,5121,null),T.framebufferTextureMultiviewOVR(36160,36064,b,0,0,f);var D=t.createTexture();for(t.bindTexture(35866,D),t.texParameteri(35866,10240,9728),t.texParameteri(35866,10241,9728),t.texImage3D(35866,0,35056,x,M,f,0,34041,34042,null),T.framebufferTextureMultiviewOVR(36160,33306,D,0,0,f),M=Array(f),x=0;x<f;++x)M[x]=t.createFramebuffer(),t.bindFramebuffer(36160,M[x]),t.framebufferTextureLayer(36160,36064,b,0,x);s.__webglColorTexture=b,s.__webglDepthStencilTexture=D,s.__webglViewFramebuffers=M,t.bindFramebuffer(36160,null),t.bindTexture(35866,null)}if(d){for(i.bindTexture(34067,c.__webglTexture),E(34067,n.texture,y),x=0;6>x;x++)S(s.__webglFramebuffer[x],n,36064,34069+x);l(n.texture,y)&&u(34067,n.texture,n.width,n.height),i.bindTexture(34067,null)}else v||(i.bindTexture(3553,c.__webglTexture),E(3553,n.texture,y),S(s.__webglFramebuffer,n,36064,3553),l(n.texture,y)&&u(3553,n.texture,n.width,n.height),i.bindTexture(3553,null));if(n.depthBuffer){if(s=r.get(n),c=!0===n.isWebGLRenderTargetCube,n.depthTexture){if(c)throw Error("target.depthTexture not supported in Cube render targets");if(n&&n.isWebGLRenderTargetCube)throw Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,s.__webglFramebuffer),!n.depthTexture||!n.depthTexture.isDepthTexture)throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");if(r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),g(n.depthTexture,0),s=r.get(n.depthTexture).__webglTexture,1026===n.depthTexture.format)t.framebufferTexture2D(36160,36096,3553,s,0);else{if(1027!==n.depthTexture.format)throw Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,s,0)}}else if(c)for(s.__webglDepthbuffer=[],c=0;6>c;c++)t.bindFramebuffer(36160,s.__webglFramebuffer[c]),s.__webglDepthbuffer[c]=t.createRenderbuffer(),w(s.__webglDepthbuffer[c],n);else t.bindFramebuffer(36160,s.__webglFramebuffer),s.__webglDepthbuffer=t.createRenderbuffer(),w(s.__webglDepthbuffer,n);t.bindFramebuffer(36160,null)}},this.updateRenderTargetMipmap=function(t){var e=t.texture,n=h(t)||A;if(l(e,n)){n=t.isWebGLRenderTargetCube?34067:3553;var a=r.get(e).__webglTexture;i.bindTexture(n,a),u(n,e,t.width,t.height),i.bindTexture(n,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(A){var i=r.get(e);t.bindFramebuffer(36008,i.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,i.__webglFramebuffer),i=e.width;var n=e.height,a=16384;e.depthBuffer&&(a|=256),e.stencilBuffer&&(a|=1024),t.blitFramebuffer(0,0,i,n,0,0,i,n,a,9728)}else void 0},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===N&&(void 0,N=!0),t=t.texture),g(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLRenderTargetCube&&(!1===U&&(void 0,U=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?v(t,e):y(t,e)}}function Re(t,e,i){var r=i.isWebGL2;return{convert:function(t){if(1009===t)return 5121;if(1017===t)return 32819;if(1018===t)return 32820;if(1019===t)return 33635;if(1010===t)return 5120;if(1011===t)return 5122;if(1012===t)return 5123;if(1013===t)return 5124;if(1014===t)return 5125;if(1015===t)return 5126;if(1016===t){if(r)return 5131;var i=e.get("OES_texture_half_float");return null!==i?i.HALF_FLOAT_OES:null}if(1021===t)return 6406;if(1022===t)return 6407;if(1023===t)return 6408;if(1024===t)return 6409;if(1025===t)return 6410;if(1026===t)return 6402;if(1027===t)return 34041;if(1028===t)return 6403;if(33776===t||33777===t||33778===t||33779===t){if(null===(i=e.get("WEBGL_compressed_texture_s3tc")))return null;if(33776===t)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===t)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===t)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===t)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===t||35841===t||35842===t||35843===t){if(null===(i=e.get("WEBGL_compressed_texture_pvrtc")))return null;if(35840===t)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===t)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===t)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===t)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}return 36196===t?null!==(i=e.get("WEBGL_compressed_texture_etc1"))?i.COMPRESSED_RGB_ETC1_WEBGL:null:37808===t||37809===t||37810===t||37811===t||37812===t||37813===t||37814===t||37815===t||37816===t||37817===t||37818===t||37819===t||37820===t||37821===t?null!==(i=e.get("WEBGL_compressed_texture_astc"))?t:null:1020===t?r?34042:null!==(i=e.get("WEBGL_depth_texture"))?i.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function Le(t,e,i,r){c.call(this,t,e,r),this.stencilBuffer=this.depthBuffer=!1,this.numViews=i}function Ce(t,e){function r(t){return t.isArrayCamera?t.cameras:(h[0]=t,h)}var n,o,s,c,h,u,p,d=t.extensions,f=t.properties,m=0;this.isAvailable=function(){if(void 0===p){var t=d.get("OVR_multiview2");if(p=null!==t&&!1===e.getContextAttributes().antialias)for(m=e.getParameter(t.MAX_VIEWS_OVR),n=new Le(0,0,2),u=new i,c=[],s=[],h=[],t=0;t<m;t++)c[t]=new l,s[t]=new a}return p},this.attachCamera=function(e){if(!1!==function(t){if(void 0===t.isArrayCamera)return!0;if((t=t.cameras).length>m)return!1;for(var e=1,i=t.length;e<i;e++)if(t[0].viewport.z!==t[e].viewport.z||t[0].viewport.w!==t[e].viewport.w)return!1;return!0}(e)){if((o=t.getRenderTarget())?u.set(o.width,o.height):t.getDrawingBufferSize(u),e.isArrayCamera){var i=e.cameras[0].viewport;n.setSize(i.z,i.w),n.setNumViews(e.cameras.length)}else n.setSize(u.x,u.y),n.setNumViews(2);t.setRenderTarget(n)}},this.detachCamera=function(i){if(n===t.getRenderTarget()){t.setRenderTarget(o);var r=n,a=r.numViews,s=f.get(r).__webglViewFramebuffers,c=r.width;if(r=r.height,i.isArrayCamera)for(var h=0;h<a;h++){var l=i.cameras[h].viewport,p=l.x,d=l.y,m=p+l.z;l=d+l.w,e.bindFramebuffer(36008,s[h]),e.blitFramebuffer(0,0,c,r,p,d,m,l,16384,9728)}else e.bindFramebuffer(36008,s[0]),e.blitFramebuffer(0,0,c,r,0,0,u.x,u.y,16384,9728)}},this.updateCameraProjectionMatricesUniform=function(t,i){t=r(t);for(var n=0;n<t.length;n++)c[n].copy(t[n].projectionMatrix);i.setValue(e,"projectionMatrices",c)},this.updateCameraViewMatricesUniform=function(t,i){t=r(t);for(var n=0;n<t.length;n++)c[n].copy(t[n].matrixWorldInverse);i.setValue(e,"viewMatrices",c)},this.updateObjectMatricesUniforms=function(t,i,n){i=r(i);for(var a=0;a<i.length;a++)c[a].multiplyMatrices(i[a].matrixWorldInverse,t.matrixWorld),s[a].getNormalMatrix(c[a]);n.setValue(e,"modelViewMatrices",c),n.setValue(e,"normalMatrices",s)}}function Pe(){d.call(this),this.type="Group"}function Oe(t){J.call(this),this.cameras=t||[]}function Ie(t,e,i){Ns.setFromMatrixPosition(e.matrixWorld),Us.setFromMatrixPosition(i.matrixWorld);var r=Ns.distanceTo(Us),n=e.projectionMatrix.elements,a=i.projectionMatrix.elements,o=n[14]/(n[10]-1);i=n[14]/(n[10]+1);var s=(n[9]+1)/n[5],c=(n[9]-1)/n[5],h=(n[8]-1)/n[0],l=(a[8]+1)/a[0];n=o*h,a=o*l,h=(l=r/(-h+l))*-h,e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(h),t.translateZ(l),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.getInverse(t.matrixWorld),e=o+l,o=i+l,t.projectionMatrix.makePerspective(n-h,a+(r-h),s*i/o*e,c*i/o*e,e,o)}function He(t){function e(){return null!==p&&!0===p.isPresenting}function a(){if(e()){var i=p.getEyeParameters("left");c=2*i.renderWidth*y,h=i.renderHeight*y,A=t.getPixelRatio(),t.getSize(T),t.setDrawingBufferSize(c,h,1),w.viewport.set(0,0,c/2,h),_.viewport.set(c/2,0,c/2,h),R.start(),u.dispatchEvent({type:"sessionstart"})}else u.enabled&&t.setDrawingBufferSize(T.width,T.height,A),R.stop(),u.dispatchEvent({type:"sessionend"})}function o(t,e){null!==e&&4===e.length&&t.set(e[0]*c,e[1]*h,e[2]*c,e[3]*h)}var c,h,u=this,p=null,d=null,f=null,m=[],g=new l,v=new l,y=1,E="local-floor";"undefined"!=typeof window&&"VRFrameData"in window&&(d=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",a,!1));var x=new l,b=new r,S=new n,w=new J;w.viewport=new s,w.layers.enable(1);var _=new J;_.viewport=new s,_.layers.enable(2);var M=new Oe([w,_]);M.layers.enable(1),M.layers.enable(2);var A,T=new i,D=[];this.enabled=!1,this.getController=function(t){var e=m[t];return void 0===e&&((e=new Pe).matrixAutoUpdate=!1,e.visible=!1,m[t]=e),e},this.getDevice=function(){return p},this.setDevice=function(t){void 0!==t&&(p=t),R.setContext(t)},this.setFramebufferScaleFactor=function(t){y=t},this.setReferenceSpaceType=function(t){E=t},this.setPoseTarget=function(t){void 0!==t&&(f=t)},this.getCamera=function(t){var i="local-floor"===E?1.6:0;if(!1===e())return t.position.set(0,i,0),t.rotation.set(0,0,0),t;if(p.depthNear=t.near,p.depthFar=t.far,p.getFrameData(d),"local-floor"===E){var r=p.stageParameters;r?g.fromArray(r.sittingToStandingTransform):g.makeTranslation(0,i,0)}i=d.pose,(r=null!==f?f:t).matrix.copy(g),r.matrix.decompose(r.position,r.quaternion,r.scale),null!==i.orientation&&(b.fromArray(i.orientation),r.quaternion.multiply(b)),null!==i.position&&(b.setFromRotationMatrix(g),S.fromArray(i.position),S.applyQuaternion(b),r.position.add(S)),r.updateMatrixWorld(),w.near=t.near,_.near=t.near,w.far=t.far,_.far=t.far,w.matrixWorldInverse.fromArray(d.leftViewMatrix),_.matrixWorldInverse.fromArray(d.rightViewMatrix),v.getInverse(g),"local-floor"===E&&(w.matrixWorldInverse.multiply(v),_.matrixWorldInverse.multiply(v)),null!==(t=r.parent)&&(x.getInverse(t.matrixWorld),w.matrixWorldInverse.multiply(x),_.matrixWorldInverse.multiply(x)),w.matrixWorld.getInverse(w.matrixWorldInverse),_.matrixWorld.getInverse(_.matrixWorldInverse),w.projectionMatrix.fromArray(d.leftProjectionMatrix),_.projectionMatrix.fromArray(d.rightProjectionMatrix),Ie(M,w,_),(t=p.getLayers()).length&&(t=t[0],o(w.viewport,t.leftBounds),o(_.viewport,t.rightBounds));t:for(t=0;t<m.length;t++){i=m[t];e:{r=t;for(var n=navigator.getGamepads&&navigator.getGamepads(),a=0,s=n.length;a<s;a++){var c=n[a];if(c&&("Daydream Controller"===c.id||"Gear VR Controller"===c.id||"Oculus Go Controller"===c.id||"OpenVR Gamepad"===c.id||c.id.startsWith("Oculus Touch")||c.id.startsWith("HTC Vive Focus")||c.id.startsWith("Spatial Controller"))){var h=c.hand;if(0===r&&(""===h||"right"===h)||1===r&&"left"===h){r=c;break e}}}r=void 0}if(void 0!==r&&void 0!==r.pose){if(null===r.pose)break t;!1===(n=r.pose).hasPosition&&i.position.set(.2,-.6,-.05),null!==n.position&&i.position.fromArray(n.position),null!==n.orientation&&i.quaternion.fromArray(n.orientation),i.matrix.compose(i.position,i.quaternion,i.scale),i.matrix.premultiply(g),i.matrix.decompose(i.position,i.quaternion,i.scale),i.matrixWorldNeedsUpdate=!0,i.visible=!0,n="Daydream Controller"===r.id?0:1,void 0===D[t]&&(D[t]=!1),D[t]!==r.buttons[n].pressed&&(D[t]=r.buttons[n].pressed,!0===D[t]?i.dispatchEvent({type:"selectstart"}):(i.dispatchEvent({type:"selectend"}),i.dispatchEvent({type:"select"})))}else i.visible=!1}return M},this.getStandingMatrix=function(){return g},this.isPresenting=e;var R=new tt;this.setAnimationLoop=function(t){R.setAnimationLoop(t),e()&&R.start()},this.submitFrame=function(){e()&&p.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",a)},this.setFrameOfReferenceType=function(){void 0}}function Ne(t,e){function i(){return null!==u&&null!==p}function r(t){for(var e=0;e<m.length;e++)g[e]===t.inputSource&&m[e].dispatchEvent({type:t.type})}function n(){t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),b.stop(),h.dispatchEvent({type:"sessionend"})}function a(t){p=t,b.setContext(u),b.start(),h.dispatchEvent({type:"sessionstart"})}function o(){for(var t=0;t<m.length;t++){var e=t;t:{for(var i=u.inputSources,r=0;r<i.length;r++){var n=i[r],a=n.handedness;if(0===t&&("none"===a||"right"===a)){i=n;break t}if(1===t&&"left"===a){i=n;break t}}i=void 0}g[e]=i}}function c(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.getInverse(t.matrixWorld)}var h=this,u=null,p=null,d="local-floor",f=null,m=[],g=[],v=new J;v.layers.enable(1),v.viewport=new s;var y=new J;y.layers.enable(2),y.viewport=new s;var E=new Oe([v,y]);E.layers.enable(1),E.layers.enable(2),this.enabled=!1,this.getController=function(t){var e=m[t];return void 0===e&&((e=new Pe).matrixAutoUpdate=!1,e.visible=!1,m[t]=e),e},this.setFramebufferScaleFactor=function(){},this.setReferenceSpaceType=function(t){d=t},this.getSession=function(){return u},this.setSession=function(t){null!==(u=t)&&(u.addEventListener("select",r),u.addEventListener("selectstart",r),u.addEventListener("selectend",r),u.addEventListener("end",n),u.updateRenderState({baseLayer:new XRWebGLLayer(u,e)}),u.requestReferenceSpace(d).then(a),u.addEventListener("inputsourceschange",o),o())},this.getCamera=function(t){if(i()){var e=t.parent,r=E.cameras;c(E,e);for(var n=0;n<r.length;n++)c(r[n],e);for(t.matrixWorld.copy(E.matrixWorld),n=0,e=(t=t.children).length;n<e;n++)t[n].updateMatrixWorld(!0);return Ie(E,v,y),E}return t},this.isPresenting=i;var x=null,b=new tt;b.setAnimationLoop((function(e,i){if(null!==(f=i.getViewerPose(p))){var r=f.views,n=u.renderState.baseLayer;t.setFramebuffer(n.framebuffer);for(var a=0;a<r.length;a++){var o=r[a],s=n.getViewport(o),c=E.cameras[a];c.matrix.fromArray(o.transform.inverse.matrix).getInverse(c.matrix),c.projectionMatrix.fromArray(o.projectionMatrix),c.viewport.set(s.x,s.y,s.width,s.height),0===a&&E.matrix.copy(c.matrix)}}for(a=0;a<m.length;a++)r=m[a],(n=g[a])&&null!==(n=i.getPose(n.targetRaySpace,p))?(r.matrix.fromArray(n.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.visible=!0):r.visible=!1;x&&x(e)})),this.setAnimationLoop=function(t){x=t},this.dispose=function(){},this.getStandingMatrix=function(){return void 0,new l},this.getDevice=function(){void 0},this.setDevice=function(){void 0},this.setFrameOfReferenceType=function(){void 0},this.submitFrame=function(){}}function Ue(t){var e;function r(){L=new ct(Ht),!1===(C=new ot(Ht,L,t)).isWebGL2&&(L.get("WEBGL_depth_texture"),L.get("OES_texture_float"),L.get("OES_texture_half_float"),L.get("OES_texture_half_float_linear"),L.get("OES_standard_derivatives"),L.get("OES_element_index_uint"),L.get("ANGLE_instanced_arrays")),L.get("OES_texture_float_linear"),X=new Re(Ht,L,C),(P=new Te(Ht,L,C)).scissor(bt.copy(Tt).multiplyScalar(Mt).floor()),P.viewport(xt.copy(At).multiplyScalar(Mt).floor()),O=new ut(Ht),I=new fe,H=new De(Ht,L,P,I,C,X,O),N=new et(Ht),U=new ht(Ht,N,O),F=new ft(Ht,U,N,O),V=new dt(Ht),B=new de(Y,L,C),z=new ye,G=new we,j=new nt(Y,P,F,_),k=new at(Ht,L,O,C),q=new lt(Ht,L,O,C),O.programs=B.programs,Y.capabilities=C,Y.extensions=L,Y.properties=I,Y.renderLists=z,Y.state=P,Y.info=O}function a(t){t.preventDefault(),void 0,J=!0}function o(){void 0,J=!1,r()}function c(t){(t=t.target).removeEventListener("dispose",c),h(t),I.remove(t)}function h(t){var e=I.get(t).program;t.program=void 0,void 0!==e&&B.releaseProgram(e)}function u(t,e,i,r){for(var n=0,a=t.length;n<a;n++){var o=t[n],s=o.object,c=o.geometry,h=void 0===r?o.material:r;if(o=o.group,i.isArrayCamera)if(Et=i,Nt.enabled&&Ut.isAvailable())p(s,e,i,c,h,o);else for(var l=i.cameras,u=0,d=l.length;u<d;u++){var f=l[u];s.layers.test(f.layers)&&(P.viewport(xt.copy(f.viewport)),R.setupLights(f),p(s,e,f,c,h,o))}else Et=null,p(s,e,i,c,h,o)}}function p(t,i,r,n,a,o){if(t.onBeforeRender(Y,i,r,n,a,o),R=G.get(i,Et||r),t.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){P.setMaterial(a);var s=f(r,i.fog,a,t);gt=e=null,vt=!1,function(t,e){t.render((function(t){Y.renderBufferImmediate(t,e)}))}(t,s)}else Y.renderBufferDirect(r,i.fog,n,a,t,o);t.onAfterRender(Y,i,r,n,a,o),R=G.get(i,Et||r)}function d(t,e,i){var r=I.get(t),n=R.state.lights,a=n.state.version;i=B.getParameters(t,n.state,R.state.shadowsArray,e,Lt.numPlanes,Lt.numIntersection,i);var o=B.getProgramCacheKey(t,i),s=r.program,l=!0;if(void 0===s)t.addEventListener("dispose",c);else if(s.cacheKey!==o)h(t);else{if(r.lightsStateVersion!==a)r.lightsStateVersion=a;else if(void 0!==i.shaderID)return;l=!1}if(l&&(i.shaderID?(o=bs[i.shaderID],r.shader={name:t.type,uniforms:W(o.uniforms),vertexShader:o.vertexShader,fragmentShader:o.fragmentShader}):r.shader={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader},t.onBeforeCompile(r.shader,Y),o=B.getProgramCacheKey(t,i),s=B.acquireProgram(t,r.shader,i,o),r.program=s,t.program=s),i=s.getAttributes(),t.morphTargets)for(o=t.numSupportedMorphTargets=0;o<Y.maxMorphTargets;o++)0<=i["morphTarget"+o]&&t.numSupportedMorphTargets++;if(t.morphNormals)for(o=t.numSupportedMorphNormals=0;o<Y.maxMorphNormals;o++)0<=i["morphNormal"+o]&&t.numSupportedMorphNormals++;i=r.shader.uniforms,(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(r.numClippingPlanes=Lt.numPlanes,r.numIntersection=Lt.numIntersection,i.clippingPlanes=Lt.uniform),r.fog=e,r.needsLights=t.isMeshLambertMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights,r.lightsStateVersion=a,r.needsLights&&(i.ambientLightColor.value=n.state.ambient,i.lightProbe.value=n.state.probe,i.directionalLights.value=n.state.directional,i.spotLights.value=n.state.spot,i.rectAreaLights.value=n.state.rectArea,i.pointLights.value=n.state.point,i.hemisphereLights.value=n.state.hemi,i.directionalShadowMap.value=n.state.directionalShadowMap,i.directionalShadowMatrix.value=n.state.directionalShadowMatrix,i.spotShadowMap.value=n.state.spotShadowMap,i.spotShadowMatrix.value=n.state.spotShadowMatrix,i.pointShadowMap.value=n.state.pointShadowMap,i.pointShadowMatrix.value=n.state.pointShadowMatrix),t=r.program.getUniforms(),t=$t.seqWithValue(t.seq,i),r.uniformsList=t}function f(t,e,i,r){H.resetTextureUnits();var n=I.get(i),a=R.state.lights;Ct&&(Pt||t!==yt)&&Lt.setState(i.clippingPlanes,i.clipIntersection,i.clipShadows,t,n,t===yt&&i.id===mt),!1===i.needsUpdate&&(void 0===n.program||i.fog&&n.fog!==e||n.needsLights&&n.lightsStateVersion!==a.state.version?i.needsUpdate=!0:void 0===n.numClippingPlanes||n.numClippingPlanes===Lt.numPlanes&&n.numIntersection===Lt.numIntersection||(i.needsUpdate=!0)),i.needsUpdate&&(d(i,e,r),i.needsUpdate=!1);var o=!1,s=!1,c=!1,h=(a=n.program).getUniforms(),l=n.shader.uniforms;if(P.useProgram(a.program)&&(c=s=o=!0),i.id!==mt&&(mt=i.id,s=!0),(o||yt!==t)&&(0<a.numMultiviewViews?Ut.updateCameraProjectionMatricesUniform(t,h):h.setValue(Ht,"projectionMatrix",t.projectionMatrix),C.logarithmicDepthBuffer&&h.setValue(Ht,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),yt!==t&&(yt=t,c=s=!0),(i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.envMap)&&(void 0!==(o=h.map.cameraPosition)&&o.setValue(Ht,It.setFromMatrixPosition(t.matrixWorld))),(i.isMeshPhongMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&h.setValue(Ht,"isOrthographic",!0===t.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.skinning)&&(0<a.numMultiviewViews?Ut.updateCameraViewMatricesUniform(t,h):h.setValue(Ht,"viewMatrix",t.matrixWorldInverse))),i.skinning&&(h.setOptional(Ht,r,"bindMatrix"),h.setOptional(Ht,r,"bindMatrixInverse"),o=r.skeleton)){var u=o.bones;if(C.floatVertexTextures){if(void 0===o.boneTexture){u=Math.sqrt(4*u.length),u=Ta.ceilPowerOfTwo(u),u=Math.max(u,4);var p=new Float32Array(u*u*4);p.set(o.boneMatrices);var f=new Q(p,u,u,1023,1015);o.boneMatrices=p,o.boneTexture=f,o.boneTextureSize=u}h.setValue(Ht,"boneTexture",o.boneTexture,H),h.setValue(Ht,"boneTextureSize",o.boneTextureSize)}else h.setOptional(Ht,o,"boneMatrices")}if((s||n.receiveShadow!==r.receiveShadow)&&(n.receiveShadow=r.receiveShadow,h.setValue(Ht,"receiveShadow",r.receiveShadow)),s){if(h.setValue(Ht,"toneMappingExposure",Y.toneMappingExposure),h.setValue(Ht,"toneMappingWhitePoint",Y.toneMappingWhitePoint),n.needsLights&&(s=c,l.ambientLightColor.needsUpdate=s,l.lightProbe.needsUpdate=s,l.directionalLights.needsUpdate=s,l.pointLights.needsUpdate=s,l.spotLights.needsUpdate=s,l.rectAreaLights.needsUpdate=s,l.hemisphereLights.needsUpdate=s),e&&i.fog&&(l.fogColor.value.copy(e.color),e.isFog?(l.fogNear.value=e.near,l.fogFar.value=e.far):e.isFogExp2&&(l.fogDensity.value=e.density)),i.isMeshBasicMaterial)m(l,i);else if(i.isMeshLambertMaterial)m(l,i),i.emissiveMap&&(l.emissiveMap.value=i.emissiveMap);else if(i.isMeshPhongMaterial)m(l,i),i.isMeshToonMaterial?(g(l,i),i.gradientMap&&(l.gradientMap.value=i.gradientMap)):g(l,i);else if(i.isMeshStandardMaterial)m(l,i),i.isMeshPhysicalMaterial?(v(l,i),l.reflectivity.value=i.reflectivity,l.clearcoat.value=i.clearcoat,l.clearcoatRoughness.value=i.clearcoatRoughness,i.sheen&&l.sheen.value.copy(i.sheen),i.clearcoatNormalMap&&(l.clearcoatNormalScale.value.copy(i.clearcoatNormalScale),l.clearcoatNormalMap.value=i.clearcoatNormalMap,1===i.side&&l.clearcoatNormalScale.value.negate()),l.transparency.value=i.transparency):v(l,i);else if(i.isMeshMatcapMaterial)m(l,i),i.matcap&&(l.matcap.value=i.matcap),i.bumpMap&&(l.bumpMap.value=i.bumpMap,l.bumpScale.value=i.bumpScale,1===i.side&&(l.bumpScale.value*=-1)),i.normalMap&&(l.normalMap.value=i.normalMap,l.normalScale.value.copy(i.normalScale),1===i.side&&l.normalScale.value.negate()),i.displacementMap&&(l.displacementMap.value=i.displacementMap,l.displacementScale.value=i.displacementScale,l.displacementBias.value=i.displacementBias);else if(i.isMeshDepthMaterial)m(l,i),i.displacementMap&&(l.displacementMap.value=i.displacementMap,l.displacementScale.value=i.displacementScale,l.displacementBias.value=i.displacementBias);else if(i.isMeshDistanceMaterial)m(l,i),i.displacementMap&&(l.displacementMap.value=i.displacementMap,l.displacementScale.value=i.displacementScale,l.displacementBias.value=i.displacementBias),l.referencePosition.value.copy(i.referencePosition),l.nearDistance.value=i.nearDistance,l.farDistance.value=i.farDistance;else if(i.isMeshNormalMaterial)m(l,i),i.bumpMap&&(l.bumpMap.value=i.bumpMap,l.bumpScale.value=i.bumpScale,1===i.side&&(l.bumpScale.value*=-1)),i.normalMap&&(l.normalMap.value=i.normalMap,l.normalScale.value.copy(i.normalScale),1===i.side&&l.normalScale.value.negate()),i.displacementMap&&(l.displacementMap.value=i.displacementMap,l.displacementScale.value=i.displacementScale,l.displacementBias.value=i.displacementBias);else if(i.isLineBasicMaterial)l.diffuse.value.copy(i.color),l.opacity.value=i.opacity,i.isLineDashedMaterial&&(l.dashSize.value=i.dashSize,l.totalSize.value=i.dashSize+i.gapSize,l.scale.value=i.scale);else if(i.isPointsMaterial){if(l.diffuse.value.copy(i.color),l.opacity.value=i.opacity,l.size.value=i.size*Mt,l.scale.value=.5*_t,i.map&&(l.map.value=i.map),i.alphaMap&&(l.alphaMap.value=i.alphaMap),i.map)var y=i.map;else i.alphaMap&&(y=i.alphaMap);void 0!==y&&(!0===y.matrixAutoUpdate&&y.updateMatrix(),l.uvTransform.value.copy(y.matrix))}else if(i.isSpriteMaterial){if(l.diffuse.value.copy(i.color),l.opacity.value=i.opacity,l.rotation.value=i.rotation,i.map&&(l.map.value=i.map),i.alphaMap&&(l.alphaMap.value=i.alphaMap),i.map)var E=i.map;else i.alphaMap&&(E=i.alphaMap);void 0!==E&&(!0===E.matrixAutoUpdate&&E.updateMatrix(),l.uvTransform.value.copy(E.matrix))}else i.isShadowMaterial&&(l.color.value.copy(i.color),l.opacity.value=i.opacity);void 0!==l.ltc_1&&(l.ltc_1.value=xs.LTC_1),void 0!==l.ltc_2&&(l.ltc_2.value=xs.LTC_2),$t.upload(Ht,n.uniformsList,l,H),i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}return i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&($t.upload(Ht,n.uniformsList,l,H),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&h.setValue(Ht,"center",r.center),0<a.numMultiviewViews?Ut.updateObjectMatricesUniforms(r,t,h):(h.setValue(Ht,"modelViewMatrix",r.modelViewMatrix),h.setValue(Ht,"normalMatrix",r.normalMatrix)),h.setValue(Ht,"modelMatrix",r.matrixWorld),a}function m(t,e){if(t.opacity.value=e.opacity,e.color&&t.diffuse.value.copy(e.color),e.emissive&&t.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity),e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.specularMap&&(t.specularMap.value=e.specularMap),e.envMap&&(t.envMap.value=e.envMap,t.flipEnvMap.value=e.envMap.isCubeTexture?-1:1,t.reflectivity.value=e.reflectivity,t.refractionRatio.value=e.refractionRatio,t.maxMipLevel.value=I.get(e.envMap).__maxMipLevel),e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity),e.aoMap&&(t.aoMap.value=e.aoMap,t.aoMapIntensity.value=e.aoMapIntensity),e.map)var i=e.map;else e.specularMap?i=e.specularMap:e.displacementMap?i=e.displacementMap:e.normalMap?i=e.normalMap:e.bumpMap?i=e.bumpMap:e.roughnessMap?i=e.roughnessMap:e.metalnessMap?i=e.metalnessMap:e.alphaMap?i=e.alphaMap:e.emissiveMap&&(i=e.emissiveMap);void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}function g(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function v(t,e){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}var y=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),E=void 0!==t.context?t.context:null,x=void 0!==t.alpha&&t.alpha,b=void 0===t.depth||t.depth,S=void 0===t.stencil||t.stencil,w=void 0!==t.antialias&&t.antialias,_=void 0===t.premultipliedAlpha||t.premultipliedAlpha,M=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,A=void 0!==t.powerPreference?t.powerPreference:"default",T=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat,D=null,R=null;this.domElement=y,this.debug={checkShaderErrors:!0},this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=!1,this.toneMappingWhitePoint=this.toneMappingExposure=this.toneMapping=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var L,C,P,O,I,H,N,U,F,B,z,G,j,V,k,q,X,Y=this,J=!1,Z=null,K=0,it=0,rt=null,pt=null,mt=-1,gt=e=null,vt=!1,yt=null,Et=null,xt=new s,bt=new s,St=null,wt=y.width,_t=y.height,Mt=1,At=new s(0,0,wt,_t),Tt=new s(0,0,wt,_t),Dt=!1,Rt=new $,Lt=new st,Ct=!1,Pt=!1,Ot=new l,It=new n;try{x={alpha:x,depth:b,stencil:S,antialias:w,premultipliedAlpha:_,preserveDrawingBuffer:M,powerPreference:A,failIfMajorPerformanceCaveat:T,xrCompatible:!0},y.addEventListener("webglcontextlost",a,!1),y.addEventListener("webglcontextrestored",o,!1);var Ht=E||y.getContext("webgl",x)||y.getContext("experimental-webgl",x);if(null===Ht){if(null!==y.getContext("webgl"))throw Error("Error creating WebGL context with your selected attributes.");throw Error("Error creating WebGL context.")}void 0===Ht.getShaderPrecisionFormat&&(Ht.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw void 0,t}r();var Nt="undefined"!=typeof navigator&&"xr"in navigator&&"isSessionSupported"in navigator.xr?new Ne(Y,Ht):new He(Y);this.vr=Nt;var Ut=new Ce(Y,Ht),Ft=new Ae(Y,F,C.maxTextureSize);this.shadowMap=Ft,this.getContext=function(){return Ht},this.getContextAttributes=function(){return Ht.getContextAttributes()},this.forceContextLoss=function(){var t=L.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){var t=L.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return Mt},this.setPixelRatio=function(t){void 0!==t&&(Mt=t,this.setSize(wt,_t,!1))},this.getSize=function(t){return void 0===t&&(void 0,t=new i),t.set(wt,_t)},this.setSize=function(t,e,i){Nt.isPresenting()?void 0:(wt=t,_t=e,y.width=Math.floor(t*Mt),y.height=Math.floor(e*Mt),!1!==i&&(y.style.width=t+"px",y.style.height=e+"px"),this.setViewport(0,0,t,e))},this.getDrawingBufferSize=function(t){return void 0===t&&(void 0,t=new i),t.set(wt*Mt,_t*Mt).floor()},this.setDrawingBufferSize=function(t,e,i){wt=t,_t=e,Mt=i,y.width=Math.floor(t*i),y.height=Math.floor(e*i),this.setViewport(0,0,t,e)},this.getCurrentViewport=function(t){return void 0===t&&(void 0,t=new s),t.copy(xt)},this.getViewport=function(t){return t.copy(At)},this.setViewport=function(t,e,i,r){t.isVector4?At.set(t.x,t.y,t.z,t.w):At.set(t,e,i,r),P.viewport(xt.copy(At).multiplyScalar(Mt).floor())},this.getScissor=function(t){return t.copy(Tt)},this.setScissor=function(t,e,i,r){t.isVector4?Tt.set(t.x,t.y,t.z,t.w):Tt.set(t,e,i,r),P.scissor(bt.copy(Tt).multiplyScalar(Mt).floor())},this.getScissorTest=function(){return Dt},this.setScissorTest=function(t){P.setScissorTest(Dt=t)},this.getClearColor=function(){return j.getClearColor()},this.setClearColor=function(){j.setClearColor.apply(j,arguments)},this.getClearAlpha=function(){return j.getClearAlpha()},this.setClearAlpha=function(){j.setClearAlpha.apply(j,arguments)},this.clear=function(t,e,i){var r=0;(void 0===t||t)&&(r|=16384),(void 0===e||e)&&(r|=256),(void 0===i||i)&&(r|=1024),Ht.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){y.removeEventListener("webglcontextlost",a,!1),y.removeEventListener("webglcontextrestored",o,!1),z.dispose(),G.dispose(),I.dispose(),F.dispose(),Nt.dispose(),zt.stop()},this.renderBufferImmediate=function(t,e){P.initAttributes();var i=I.get(t);t.hasPositions&&!i.position&&(i.position=Ht.createBuffer()),t.hasNormals&&!i.normal&&(i.normal=Ht.createBuffer()),t.hasUvs&&!i.uv&&(i.uv=Ht.createBuffer()),t.hasColors&&!i.color&&(i.color=Ht.createBuffer()),e=e.getAttributes(),t.hasPositions&&(Ht.bindBuffer(34962,i.position),Ht.bufferData(34962,t.positionArray,35048),P.enableAttribute(e.position),Ht.vertexAttribPointer(e.position,3,5126,!1,0,0)),t.hasNormals&&(Ht.bindBuffer(34962,i.normal),Ht.bufferData(34962,t.normalArray,35048),P.enableAttribute(e.normal),Ht.vertexAttribPointer(e.normal,3,5126,!1,0,0)),t.hasUvs&&(Ht.bindBuffer(34962,i.uv),Ht.bufferData(34962,t.uvArray,35048),P.enableAttribute(e.uv),Ht.vertexAttribPointer(e.uv,2,5126,!1,0,0)),t.hasColors&&(Ht.bindBuffer(34962,i.color),Ht.bufferData(34962,t.colorArray,35048),P.enableAttribute(e.color),Ht.vertexAttribPointer(e.color,3,5126,!1,0,0)),P.disableUnusedAttributes(),Ht.drawArrays(4,0,t.count),t.count=0},this.renderBufferDirect=function(t,i,r,n,a,o){var s=a.isMesh&&0>a.matrixWorld.determinant();P.setMaterial(n,s);var c=f(t,i,n,a),h=!1;e===r.id&&gt===c.id&&vt===(!0===n.wireframe)||(e=r.id,gt=c.id,vt=!0===n.wireframe,h=!0),a.morphTargetInfluences&&(V.update(a,r,n,c),h=!0),s=r.index;var l=r.attributes.position;if(i=1,!0===n.wireframe&&(s=U.getWireframeAttribute(r),i=2),t=k,null!==s){var u=N.get(s);(t=q).setIndex(u)}if(h){if(!1!==C.isWebGL2||!a.isInstancedMesh&&!r.isInstancedBufferGeometry||null!==L.get("ANGLE_instanced_arrays")){P.initAttributes(),h=r.attributes,c=c.getAttributes();var p=n.defaultAttributeValues;for(w in c){var d=c[w];if(0<=d){var m=h[w];if(void 0!==m){var g=m.normalized,v=m.itemSize,y=N.get(m);if(void 0!==y){var E=y.buffer,x=y.type;if(y=y.bytesPerElement,m.isInterleavedBufferAttribute){var b=m.data,S=b.stride;m=m.offset,b&&b.isInstancedInterleavedBuffer?(P.enableAttributeAndDivisor(d,b.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=b.meshPerAttribute*b.count)):P.enableAttribute(d),Ht.bindBuffer(34962,E),Ht.vertexAttribPointer(d,v,x,g,S*y,m*y)}else m.isInstancedBufferAttribute?(P.enableAttributeAndDivisor(d,m.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=m.meshPerAttribute*m.count)):P.enableAttribute(d),Ht.bindBuffer(34962,E),Ht.vertexAttribPointer(d,v,x,g,0,0)}}else if("instanceMatrix"===w)void 0!==(y=N.get(a.instanceMatrix))&&(E=y.buffer,x=y.type,P.enableAttributeAndDivisor(d+0,1),P.enableAttributeAndDivisor(d+1,1),P.enableAttributeAndDivisor(d+2,1),P.enableAttributeAndDivisor(d+3,1),Ht.bindBuffer(34962,E),Ht.vertexAttribPointer(d+0,4,x,!1,64,0),Ht.vertexAttribPointer(d+1,4,x,!1,64,16),Ht.vertexAttribPointer(d+2,4,x,!1,64,32),Ht.vertexAttribPointer(d+3,4,x,!1,64,48));else if(void 0!==p&&void 0!==(g=p[w]))switch(g.length){case 2:Ht.vertexAttrib2fv(d,g);break;case 3:Ht.vertexAttrib3fv(d,g);break;case 4:Ht.vertexAttrib4fv(d,g);break;default:Ht.vertexAttrib1fv(d,g)}}}P.disableUnusedAttributes()}null!==s&&Ht.bindBuffer(34963,u.buffer)}u=1/0,null!==s?u=s.count:void 0!==l&&(u=l.count),s=r.drawRange.start*i,l=null!==o?o.start*i:0;var w=Math.max(s,l);if(0!==(o=Math.max(0,Math.min(u,s+r.drawRange.count*i,l+(null!==o?o.count*i:1/0))-1-w+1))){if(a.isMesh)if(!0===n.wireframe)P.setLineWidth(n.wireframeLinewidth*(null===rt?Mt:1)),t.setMode(1);else switch(a.drawMode){case 0:t.setMode(4);break;case 1:t.setMode(5);break;case 2:t.setMode(6)}else a.isLine?(void 0===(n=n.linewidth)&&(n=1),P.setLineWidth(n*(null===rt?Mt:1)),a.isLineSegments?t.setMode(1):a.isLineLoop?t.setMode(2):t.setMode(3)):a.isPoints?t.setMode(0):a.isSprite&&t.setMode(4);a.isInstancedMesh?t.renderInstances(r,w,o,a.count):r.isInstancedBufferGeometry?t.renderInstances(r,w,o,r.maxInstancedCount):t.render(w,o)}},this.compile=function(t,e){(R=G.get(t,e)).init(),t.traverse((function(t){t.isLight&&(R.pushLight(t),t.castShadow&&R.pushShadow(t))})),R.setupLights(e),t.traverse((function(e){if(e.material)if(Array.isArray(e.material))for(var i=0;i<e.material.length;i++)d(e.material[i],t.fog,e);else d(e.material,t.fog,e)}))};var Bt=null,zt=new tt;zt.setAnimationLoop((function(t){Nt.isPresenting()||Bt&&Bt(t)})),"undefined"!=typeof window&&zt.setContext(window),this.setAnimationLoop=function(t){Bt=t,Nt.setAnimationLoop(t),zt.start()},this.render=function(t,i,r,n){if(void 0!==r){void 0;var a=r}if(void 0!==n){void 0;var o=n}i&&i.isCamera?J||(gt=e=null,vt=!1,mt=-1,yt=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===i.parent&&i.updateMatrixWorld(),Nt.enabled&&(i=Nt.getCamera(i)),(R=G.get(t,i)).init(),t.onBeforeRender(Y,t,i,a||rt),Ot.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),Rt.setFromMatrix(Ot),Pt=this.localClippingEnabled,Ct=Lt.init(this.clippingPlanes,Pt,i),(D=z.get(t,i)).init(),function t(e,i,r,n){if(!1!==e.visible){if(e.layers.test(i.layers))if(e.isGroup)r=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(i);else if(e.isLight)R.pushLight(e),e.castShadow&&R.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||Rt.intersectsSprite(e)){n&&It.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Ot);var a=F.update(e),o=e.material;o.visible&&D.push(e,a,o,r,It.z,null)}}else if(e.isImmediateRenderObject)n&&It.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Ot),D.push(e,null,e.material,r,It.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==O.render.frame&&(e.skeleton.update(),e.skeleton.frame=O.render.frame),!e.frustumCulled||Rt.intersectsObject(e)))if(n&&It.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Ot),a=F.update(e),o=e.material,Array.isArray(o))for(var s=a.groups,c=0,h=s.length;c<h;c++){var l=s[c],u=o[l.materialIndex];u&&u.visible&&D.push(e,a,u,r,It.z,l)}else o.visible&&D.push(e,a,o,r,It.z,null);for(c=0,h=(e=e.children).length;c<h;c++)t(e[c],i,r,n)}}(t,i,0,Y.sortObjects),!0===Y.sortObjects&&D.sort(),Ct&&Lt.beginShadows(),Ft.render(R.state.shadowsArray,t,i),R.setupLights(i),Ct&&Lt.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==a&&this.setRenderTarget(a),Nt.enabled&&Ut.isAvailable()&&Ut.attachCamera(i),j.render(D,t,i,o),r=D.opaque,n=D.transparent,t.overrideMaterial?(a=t.overrideMaterial,r.length&&u(r,t,i,a),n.length&&u(n,t,i,a)):(r.length&&u(r,t,i),n.length&&u(n,t,i)),t.onAfterRender(Y,t,i),null!==rt&&(H.updateRenderTargetMipmap(rt),H.updateMultisampleRenderTarget(rt)),P.buffers.depth.setTest(!0),P.buffers.depth.setMask(!0),P.buffers.color.setMask(!0),P.setPolygonOffset(!1),Nt.enabled&&(Ut.isAvailable()&&Ut.detachCamera(i),Nt.submitFrame()),R=D=null):void 0},this.setFramebuffer=function(t){Z!==t&&null===rt&&Ht.bindFramebuffer(36160,t),Z=t},this.getActiveCubeFace=function(){return K},this.getActiveMipmapLevel=function(){return it},this.getRenderTarget=function(){return rt},this.setRenderTarget=function(t,e,i){rt=t,K=e,it=i,t&&void 0===I.get(t).__webglFramebuffer&&H.setupRenderTarget(t);var r=Z,n=!1;t?(r=I.get(t).__webglFramebuffer,t.isWebGLRenderTargetCube?(r=r[e||0],n=!0):r=t.isWebGLMultisampleRenderTarget?I.get(t).__webglMultisampledFramebuffer:r,xt.copy(t.viewport),bt.copy(t.scissor),St=t.scissorTest):(xt.copy(At).multiplyScalar(Mt).floor(),bt.copy(Tt).multiplyScalar(Mt).floor(),St=Dt),pt!==r&&(Ht.bindFramebuffer(36160,r),pt=r),P.viewport(xt),P.scissor(bt),P.setScissorTest(St),n&&(t=I.get(t.texture),Ht.framebufferTexture2D(36160,36064,34069+(e||0),t.__webglTexture,i||0))},this.readRenderTargetPixels=function(t,e,i,r,n,a,o){if(t&&t.isWebGLRenderTarget){var s=I.get(t).__webglFramebuffer;if(t.isWebGLRenderTargetCube&&void 0!==o&&(s=s[o]),s){o=!1,s!==pt&&(Ht.bindFramebuffer(36160,s),o=!0);try{var c=t.texture,h=c.format,l=c.type;1023!==h&&X.convert(h)!==Ht.getParameter(35739)?void 0:1009===l||X.convert(l)===Ht.getParameter(35738)||1015===l&&(C.isWebGL2||L.get("OES_texture_float")||L.get("WEBGL_color_buffer_float"))||1016===l&&(C.isWebGL2?L.get("EXT_color_buffer_float"):L.get("EXT_color_buffer_half_float"))?36053===Ht.checkFramebufferStatus(36160)?0<=e&&e<=t.width-r&&0<=i&&i<=t.height-n&&Ht.readPixels(e,i,r,n,X.convert(h),X.convert(l),a):void 0:void 0}finally{o&&Ht.bindFramebuffer(36160,pt)}}}else void 0},this.copyFramebufferToTexture=function(t,e,i){void 0===i&&(i=0);var r=Math.pow(2,-i),n=Math.floor(e.image.width*r);r=Math.floor(e.image.height*r);var a=X.convert(e.format);H.setTexture2D(e,0),Ht.copyTexImage2D(3553,i,a,t.x,t.y,n,r,0),P.unbindTexture()},this.copyTextureToTexture=function(t,e,i,r){var n=e.image.width,a=e.image.height,o=X.convert(i.format),s=X.convert(i.type);H.setTexture2D(i,0),e.isDataTexture?Ht.texSubImage2D(3553,r||0,t.x,t.y,n,a,o,s,e.image.data):Ht.texSubImage2D(3553,r||0,t.x,t.y,o,s,e.image),P.unbindTexture()},this.initTexture=function(t){H.setTexture2D(t,0),P.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Fe(t,e){this.name="",this.color=new b(t),this.density=void 0!==e?e:25e-5}function Be(t,e,i){this.name="",this.color=new b(t),this.near=void 0!==e?e:1,this.far=void 0!==i?i:1e3}function ze(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}function Ge(t,e,i,r){this.data=t,this.itemSize=e,this.offset=i,this.normalized=!0===r}function je(t){A.call(this),this.type="SpriteMaterial",this.color=new b(16777215),this.alphaMap=this.map=null,this.rotation=0,this.transparent=this.sizeAttenuation=!0,this.setValues(t)}function Ve(t){if(d.call(this),this.type="Sprite",void 0===Fs){Fs=new z;var e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]);e=new ze(e,5),Fs.setIndex([0,1,2,0,2,3]),Fs.setAttribute("position",new Ge(e,3,0,!1)),Fs.setAttribute("uv",new Ge(e,2,3,!1))}this.geometry=Fs,this.material=void 0!==t?t:new je,this.center=new i(.5,.5)}function ke(t,e,i,r,n,a){js.subVectors(t,i).addScalar(.5).multiply(r),void 0!==n?(Vs.x=a*js.x-n*js.y,Vs.y=n*js.x+a*js.y):Vs.copy(js),t.copy(e),t.x+=Vs.x,t.y+=Vs.y,t.applyMatrix4(ks)}function We(){d.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function qe(t,e){t&&t.isGeometry&&void 0,G.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new l,this.bindMatrixInverse=new l}function Xe(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else for(void 0,this.boneInverses=[],t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new l)}function Ye(){d.call(this),this.type="Bone"}function Je(t,e,i){G.call(this,t,e),this.instanceMatrix=new D(new Float32Array(16*i),16),this.count=i}function Ze(t){A.call(this),this.type="LineBasicMaterial",this.color=new b(16777215),this.linewidth=1,this.linejoin=this.linecap="round",this.setValues(t)}function Ke(t,e,i){1===i&&void 0,d.call(this),this.type="Line",this.geometry=void 0!==t?t:new z,this.material=void 0!==e?e:new Ze({color:16777215*Math.random()})}function Qe(t,e){Ke.call(this,t,e),this.type="LineSegments"}function $e(t,e){Ke.call(this,t,e),this.type="LineLoop"}function ti(t){A.call(this),this.type="PointsMaterial",this.color=new b(16777215),this.alphaMap=this.map=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}function ei(t,e){d.call(this),this.type="Points",this.geometry=void 0!==t?t:new z,this.material=void 0!==e?e:new ti({color:16777215*Math.random()}),this.updateMorphTargets()}function ii(t,e,i,r,a,o,s){var c=hc.distanceSqToPoint(t);c<i&&(i=new n,hc.closestPointToPoint(t,i),i.applyMatrix4(r),(t=a.ray.origin.distanceTo(i))<a.near||t>a.far||o.push({distance:t,distanceToRay:Math.sqrt(c),point:i,index:e,face:null,object:s}))}function ri(t,e,i,r,n,a,s,c,h){o.call(this,t,e,i,r,n,a,s,c,h),this.format=void 0!==s?s:1022,this.minFilter=void 0!==a?a:1006,this.magFilter=void 0!==n?n:1006,this.generateMipmaps=!1}function ni(t,e,i,r,n,a,s,c,h,l,u,p){o.call(this,null,a,s,c,h,l,r,n,u,p),this.image={width:e,height:i},this.mipmaps=t,this.generateMipmaps=this.flipY=!1}function ai(t,e,i,r,n,a,s,c,h){o.call(this,t,e,i,r,n,a,s,c,h),this.needsUpdate=!0}function oi(t,e,i,r,n,a,s,c,h,l){if(1026!==(l=void 0!==l?l:1026)&&1027!==l)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&1026===l&&(i=1012),void 0===i&&1027===l&&(i=1020),o.call(this,null,r,n,a,s,c,l,i,h),this.image={width:t,height:e},this.magFilter=void 0!==s?s:1003,this.minFilter=void 0!==c?c:1003,this.generateMipmaps=this.flipY=!1}function si(t){z.call(this),this.type="WireframeGeometry";var e,i,r,a=[],o=[0,0],s={},c=["a","b","c"];if(t&&t.isGeometry){var h=t.faces,l=0;for(i=h.length;l<i;l++){var u=h[l];for(e=0;3>e;e++){var p=u[c[e]],d=u[c[(e+1)%3]];o[0]=Math.min(p,d),o[1]=Math.max(p,d),void 0===s[p=o[0]+","+o[1]]&&(s[p]={index1:o[0],index2:o[1]})}}for(p in s)l=s[p],c=t.vertices[l.index1],a.push(c.x,c.y,c.z),c=t.vertices[l.index2],a.push(c.x,c.y,c.z)}else if(t&&t.isBufferGeometry)if(c=new n,null!==t.index){h=t.attributes.position,u=t.index;var f=t.groups;for(0===f.length&&(f=[{start:0,count:u.count,materialIndex:0}]),t=0,r=f.length;t<r;++t)for(e=(l=f[t]).start,i=l.count,l=e,i=e+i;l<i;l+=3)for(e=0;3>e;e++)p=u.getX(l+e),d=u.getX(l+(e+1)%3),o[0]=Math.min(p,d),o[1]=Math.max(p,d),void 0===s[p=o[0]+","+o[1]]&&(s[p]={index1:o[0],index2:o[1]});for(p in s)l=s[p],c.fromBufferAttribute(h,l.index1),a.push(c.x,c.y,c.z),c.fromBufferAttribute(h,l.index2),a.push(c.x,c.y,c.z)}else for(l=0,i=(h=t.attributes.position).count/3;l<i;l++)for(e=0;3>e;e++)s=3*l+e,c.fromBufferAttribute(h,s),a.push(c.x,c.y,c.z),s=3*l+(e+1)%3,c.fromBufferAttribute(h,s),a.push(c.x,c.y,c.z);this.setAttribute("position",new N(a,3))}function ci(t,e,i){k.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:i},this.fromBufferGeometry(new hi(t,e,i)),this.mergeVertices()}function hi(t,e,i){z.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:i};var r,a,o=[],s=[],c=[],h=[],l=new n,u=new n,p=new n,d=new n,f=new n;3>t.length&&void 0;var m=e+1;for(r=0;r<=i;r++){var g=r/i;for(a=0;a<=e;a++){var v=a/e;t(v,g,u),s.push(u.x,u.y,u.z),0<=v-1e-5?(t(v-1e-5,g,p),d.subVectors(u,p)):(t(v+1e-5,g,p),d.subVectors(p,u)),0<=g-1e-5?(t(v,g-1e-5,p),f.subVectors(u,p)):(t(v,g+1e-5,p),f.subVectors(p,u)),l.crossVectors(d,f).normalize(),c.push(l.x,l.y,l.z),h.push(v,g)}}for(r=0;r<i;r++)for(a=0;a<e;a++)t=r*m+a+1,l=(r+1)*m+a+1,u=(r+1)*m+a,o.push(r*m+a,t,u),o.push(t,l,u);this.setIndex(o),this.setAttribute("position",new N(s,3)),this.setAttribute("normal",new N(c,3)),this.setAttribute("uv",new N(h,2))}function li(t,e,i,r){k.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:r},this.fromBufferGeometry(new ui(t,e,i,r)),this.mergeVertices()}function ui(t,e,r,a){function o(t){h.push(t.x,t.y,t.z)}function s(e,i){e*=3,i.x=t[e+0],i.y=t[e+1],i.z=t[e+2]}function c(t,e,i,r){0>r&&1===t.x&&(l[e]=t.x-1),0===i.x&&0===i.z&&(l[e]=r/2/Math.PI+.5)}z.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:a},r=r||1;var h=[],l=[];!function(t){for(var i=new n,r=new n,a=new n,c=0;c<e.length;c+=3){s(e[c+0],i),s(e[c+1],r),s(e[c+2],a);var h,l,u=i,p=r,d=a,f=Math.pow(2,t),m=[];for(l=0;l<=f;l++){m[l]=[];var g=u.clone().lerp(d,l/f),v=p.clone().lerp(d,l/f),y=f-l;for(h=0;h<=y;h++)m[l][h]=0===h&&l===f?g:g.clone().lerp(v,h/y)}for(l=0;l<f;l++)for(h=0;h<2*(f-l)-1;h++)u=Math.floor(h/2),0==h%2?(o(m[l][u+1]),o(m[l+1][u]),o(m[l][u])):(o(m[l][u+1]),o(m[l+1][u+1]),o(m[l+1][u]))}}(a=a||0),function(t){for(var e=new n,i=0;i<h.length;i+=3)e.x=h[i+0],e.y=h[i+1],e.z=h[i+2],e.normalize().multiplyScalar(t),h[i+0]=e.x,h[i+1]=e.y,h[i+2]=e.z}(r),function(){for(var t=new n,e=0;e<h.length;e+=3)t.x=h[e+0],t.y=h[e+1],t.z=h[e+2],l.push(Math.atan2(t.z,-t.x)/2/Math.PI+.5,1-(Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5));t=new n,e=new n;for(var r=new n,a=new n,o=new i,s=new i,u=new i,p=0,d=0;p<h.length;p+=9,d+=6){t.set(h[p+0],h[p+1],h[p+2]),e.set(h[p+3],h[p+4],h[p+5]),r.set(h[p+6],h[p+7],h[p+8]),o.set(l[d+0],l[d+1]),s.set(l[d+2],l[d+3]),u.set(l[d+4],l[d+5]),a.copy(t).add(e).add(r).divideScalar(3);var f=Math.atan2(a.z,-a.x);c(o,d+0,t,f),c(s,d+2,e,f),c(u,d+4,r,f)}for(t=0;t<l.length;t+=6)e=l[t+0],r=l[t+2],a=l[t+4],o=Math.min(e,r,a),.9<Math.max(e,r,a)&&.1>o&&(.2>e&&(l[t+0]+=1),.2>r&&(l[t+2]+=1),.2>a&&(l[t+4]+=1))}(),this.setAttribute("position",new N(h,3)),this.setAttribute("normal",new N(h.slice(),3)),this.setAttribute("uv",new N(l,2)),0===a?this.computeVertexNormals():this.normalizeNormals()}function pi(t,e){k.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new di(t,e)),this.mergeVertices()}function di(t,e){ui.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function fi(t,e){k.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new mi(t,e)),this.mergeVertices()}function mi(t,e){ui.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function gi(t,e){k.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new vi(t,e)),this.mergeVertices()}function vi(t,e){var i=(1+Math.sqrt(5))/2;ui.call(this,[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function yi(t,e){k.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Ei(t,e)),this.mergeVertices()}function Ei(t,e){var i=(1+Math.sqrt(5))/2,r=1/i;ui.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function xi(t,e,i,r,n,a){k.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:r,closed:n},void 0!==a&&void 0,t=new bi(t,e,i,r,n),this.tangents=t.tangents,this.normals=t.normals,this.binormals=t.binormals,this.fromBufferGeometry(t),this.mergeVertices()}function bi(t,e,r,a,o){function s(i){f=t.getPointAt(i/e,f);var n=c.normals[i];for(i=c.binormals[i],l=0;l<=a;l++){var o=l/a*Math.PI*2,s=Math.sin(o);o=-Math.cos(o),p.x=o*n.x+s*i.x,p.y=o*n.y+s*i.y,p.z=o*n.z+s*i.z,p.normalize(),g.push(p.x,p.y,p.z),u.x=f.x+r*p.x,u.y=f.y+r*p.y,u.z=f.z+r*p.z,m.push(u.x,u.y,u.z)}}z.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:a,closed:o},e=e||64,r=r||1,a=a||8,o=o||!1;var c=t.computeFrenetFrames(e,o);this.tangents=c.tangents,this.normals=c.normals,this.binormals=c.binormals;var h,l,u=new n,p=new n,d=new i,f=new n,m=[],g=[],v=[],y=[];for(h=0;h<e;h++)s(h);for(s(!1===o?e:0),h=0;h<=e;h++)for(l=0;l<=a;l++)d.x=h/e,d.y=l/a,v.push(d.x,d.y);!function(){for(l=1;l<=e;l++)for(h=1;h<=a;h++){var t=(a+1)*l+(h-1),i=(a+1)*l+h,r=(a+1)*(l-1)+h;y.push((a+1)*(l-1)+(h-1),t,r),y.push(t,i,r)}}(),this.setIndex(y),this.setAttribute("position",new N(m,3)),this.setAttribute("normal",new N(g,3)),this.setAttribute("uv",new N(v,2))}function Si(t,e,i,r,n,a,o){k.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:r,p:n,q:a},void 0!==o&&void 0,this.fromBufferGeometry(new wi(t,e,i,r,n,a)),this.mergeVertices()}function wi(t,e,i,r,a,o){function s(t,e,i,r,n){var a=Math.sin(t);e=i/e*t,i=Math.cos(e),n.x=r*(2+i)*.5*Math.cos(t),n.y=r*(2+i)*a*.5,n.z=r*Math.sin(e)*.5}z.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:r,p:a,q:o},t=t||1,e=e||.4,i=Math.floor(i)||64,r=Math.floor(r)||8,a=a||2,o=o||3;var c,h=[],l=[],u=[],p=[],d=new n,f=new n,m=new n,g=new n,v=new n,y=new n,E=new n;for(c=0;c<=i;++c){var x=c/i*a*Math.PI*2;for(s(x,a,o,t,m),s(x+.01,a,o,t,g),y.subVectors(g,m),E.addVectors(g,m),v.crossVectors(y,E),E.crossVectors(v,y),v.normalize(),E.normalize(),x=0;x<=r;++x){var b=x/r*Math.PI*2,S=-e*Math.cos(b);b=e*Math.sin(b),d.x=m.x+(S*E.x+b*v.x),d.y=m.y+(S*E.y+b*v.y),d.z=m.z+(S*E.z+b*v.z),l.push(d.x,d.y,d.z),f.subVectors(d,m).normalize(),u.push(f.x,f.y,f.z),p.push(c/i),p.push(x/r)}}for(x=1;x<=i;x++)for(c=1;c<=r;c++)t=(r+1)*x+(c-1),e=(r+1)*x+c,a=(r+1)*(x-1)+c,h.push((r+1)*(x-1)+(c-1),t,a),h.push(t,e,a);this.setIndex(h),this.setAttribute("position",new N(l,3)),this.setAttribute("normal",new N(u,3)),this.setAttribute("uv",new N(p,2))}function _i(t,e,i,r,n){k.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:r,arc:n},this.fromBufferGeometry(new Mi(t,e,i,r,n)),this.mergeVertices()}function Mi(t,e,i,r,a){z.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:r,arc:a},t=t||1,e=e||.4,i=Math.floor(i)||8,r=Math.floor(r)||6,a=a||2*Math.PI;var o,s,c=[],h=[],l=[],u=[],p=new n,d=new n,f=new n;for(o=0;o<=i;o++)for(s=0;s<=r;s++){var m=s/r*a,g=o/i*Math.PI*2;d.x=(t+e*Math.cos(g))*Math.cos(m),d.y=(t+e*Math.cos(g))*Math.sin(m),d.z=e*Math.sin(g),h.push(d.x,d.y,d.z),p.x=t*Math.cos(m),p.y=t*Math.sin(m),f.subVectors(d,p).normalize(),l.push(f.x,f.y,f.z),u.push(s/r),u.push(o/i)}for(o=1;o<=i;o++)for(s=1;s<=r;s++)t=(r+1)*(o-1)+s-1,e=(r+1)*(o-1)+s,a=(r+1)*o+s,c.push((r+1)*o+s-1,t,a),c.push(t,e,a);this.setIndex(c),this.setAttribute("position",new N(h,3)),this.setAttribute("normal",new N(l,3)),this.setAttribute("uv",new N(u,2))}function Ai(t,e,i,r,n){for(var a,o=0,s=e,c=i-r;s<i;s+=r)o+=(t[c]-t[s])*(t[s+1]+t[c+1]),c=s;if(n===0<o)for(n=e;n<i;n+=r)a=Bi(n,t[n],t[n+1],a);else for(n=i-r;n>=e;n-=r)a=Bi(n,t[n],t[n+1],a);return a&&Hi(a,a.next)&&(zi(a),a=a.next),a}function Ti(t,e){if(!t)return t;e||(e=t);do{var i=!1;if(t.steiner||!Hi(t,t.next)&&0!==Ii(t.prev,t,t.next))t=t.next;else{if(zi(t),(t=e=t.prev)===t.next)break;i=!0}}while(i||t!==e);return e}function Di(t,e,i,r){var n=t.prev,a=t.next;if(0<=Ii(n,t,a))return!1;var o=n.x>t.x?n.x>a.x?n.x:a.x:t.x>a.x?t.x:a.x,s=n.y>t.y?n.y>a.y?n.y:a.y:t.y>a.y?t.y:a.y,c=Ci(n.x<t.x?n.x<a.x?n.x:a.x:t.x<a.x?t.x:a.x,n.y<t.y?n.y<a.y?n.y:a.y:t.y<a.y?t.y:a.y,e,i,r);for(e=Ci(o,s,e,i,r),i=t.prevZ,r=t.nextZ;i&&i.z>=c&&r&&r.z<=e;){if(i!==t.prev&&i!==t.next&&Oi(n.x,n.y,t.x,t.y,a.x,a.y,i.x,i.y)&&0<=Ii(i.prev,i,i.next))return!1;if(i=i.prevZ,r!==t.prev&&r!==t.next&&Oi(n.x,n.y,t.x,t.y,a.x,a.y,r.x,r.y)&&0<=Ii(r.prev,r,r.next))return!1;r=r.nextZ}for(;i&&i.z>=c;){if(i!==t.prev&&i!==t.next&&Oi(n.x,n.y,t.x,t.y,a.x,a.y,i.x,i.y)&&0<=Ii(i.prev,i,i.next))return!1;i=i.prevZ}for(;r&&r.z<=e;){if(r!==t.prev&&r!==t.next&&Oi(n.x,n.y,t.x,t.y,a.x,a.y,r.x,r.y)&&0<=Ii(r.prev,r,r.next))return!1;r=r.nextZ}return!0}function Ri(t,e){return t.x-e.x}function Li(t,e){var i=e,r=t.x,n=t.y,a=-1/0;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){var o=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=r&&o>a){if(a=o,o===r){if(n===i.y)return i;if(n===i.next.y)return i.next}var s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!s)return null;if(r===a)return s.prev;e=s,o=s.x;var c=s.y,h=1/0;for(i=s.next;i!==e;){if(r>=i.x&&i.x>=o&&r!==i.x&&Oi(n<c?r:a,n,o,c,n<c?a:r,n,i.x,i.y)){var l=Math.abs(n-i.y)/(r-i.x);(l<h||l===h&&i.x>s.x)&&Ui(i,t)&&(s=i,h=l)}i=i.next}return s}function Ci(t,e,i,r,n){return 1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1)|(1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Pi(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function Oi(t,e,i,r,n,a,o,s){return 0<=(n-o)*(e-s)-(t-o)*(a-s)&&0<=(t-o)*(r-s)-(i-o)*(e-s)&&0<=(i-o)*(a-s)-(n-o)*(r-s)}function Ii(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Hi(t,e){return t.x===e.x&&t.y===e.y}function Ni(t,e,i,r){return!!(Hi(t,i)&&Hi(e,r)||Hi(t,r)&&Hi(i,e))||0<Ii(t,e,i)!=0<Ii(t,e,r)&&0<Ii(i,r,t)!=0<Ii(i,r,e)}function Ui(t,e){return 0>Ii(t.prev,t,t.next)?0<=Ii(t,e,t.next)&&0<=Ii(t,t.prev,e):0>Ii(t,e,t.prev)||0>Ii(t,t.next,e)}function Fi(t,e){var i=new Gi(t.i,t.x,t.y),r=new Gi(e.i,e.x,e.y),n=t.next,a=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,a.next=r,r.prev=a,r}function Bi(t,e,i,r){return t=new Gi(t,e,i),r?(t.next=r.next,t.prev=r,r.next.prev=t,r.next=t):(t.prev=t,t.next=t),t}function zi(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Gi(t,e,i){this.i=t,this.x=e,this.y=i,this.nextZ=this.prevZ=this.z=this.next=this.prev=null,this.steiner=!1}function ji(t){var e=t.length;2<e&&t[e-1].equals(t[0])&&t.pop()}function Vi(t,e){for(var i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}function ki(t,e){k.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new Wi(t,e)),this.mergeVertices()}function Wi(t,e){function r(t){function r(t,e,i){return e||void 0,e.clone().multiplyScalar(i).add(t)}function c(t,e,r){var n=t.x-e.x,a=t.y-e.y,o=r.x-t.x,s=r.y-t.y,c=n*n+a*a;if(Math.abs(n*s-a*o)>Number.EPSILON){var h=Math.sqrt(c),l=Math.sqrt(o*o+s*s);if(c=e.x-a/h,e=e.y+n/h,2>=(a=(o=c+n*(s=((r.x-s/l-c)*s-(r.y+o/l-e)*o)/(n*s-a*o))-t.x)*o+(n=e+a*s-t.y)*n))return new i(o,n);a=Math.sqrt(a/2)}else t=!1,n>Number.EPSILON?o>Number.EPSILON&&(t=!0):n<-Number.EPSILON?o<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(s)&&(t=!0),t?(o=-a,a=Math.sqrt(c)):(o=n,n=a,a=Math.sqrt(c/2));return new i(o/a,n/a)}function h(t,e){for(G=t.length;0<=--G;){var i=G,r=G-1;0>r&&(r=t.length-1);var n,s=g+2*S;for(n=0;n<s;n++){var c=B*n,h=B*(n+1),l=e+r+c,u=e+r+h;h=e+i+h,p(e+i+c),p(l),p(h),p(l),p(u),p(h),c=o.length/3,d((c=_.generateSideWallUV(a,o,c-6,c-3,c-2,c-1))[0]),d(c[1]),d(c[3]),d(c[1]),d(c[2]),d(c[3])}}}function l(t,e,i){f.push(t),f.push(e),f.push(i)}function u(t,e,i){p(t),p(e),p(i),t=o.length/3,d((t=_.generateTopUV(a,o,t-3,t-2,t-1))[0]),d(t[1]),d(t[2])}function p(t){o.push(f[3*t]),o.push(f[3*t+1]),o.push(f[3*t+2])}function d(t){s.push(t.x),s.push(t.y)}var f=[],m=void 0!==e.curveSegments?e.curveSegments:12,g=void 0!==e.steps?e.steps:1,v=void 0!==e.depth?e.depth:100,y=void 0===e.bevelEnabled||e.bevelEnabled,E=void 0!==e.bevelThickness?e.bevelThickness:6,x=void 0!==e.bevelSize?e.bevelSize:E-2,b=void 0!==e.bevelOffset?e.bevelOffset:0,S=void 0!==e.bevelSegments?e.bevelSegments:3,w=e.extrudePath,_=void 0!==e.UVGenerator?e.UVGenerator:fc;void 0!==e.amount&&(void 0,v=e.amount);var M,A=!1;if(w){var T=w.getSpacedPoints(g);A=!0,y=!1;var D=w.computeFrenetFrames(g,!1),R=new n,L=new n,C=new n}y||(b=x=E=S=0),m=t.extractPoints(m),t=m.shape;var P=m.holes;if(!dc.isClockWise(t)){t=t.reverse();var O=0;for(M=P.length;O<M;O++){var I=P[O];dc.isClockWise(I)&&(P[O]=I.reverse())}}var H=dc.triangulateShape(t,P),N=t;for(O=0,M=P.length;O<M;O++)I=P[O],t=t.concat(I);var U,F,B=t.length,z=H.length;m=[];var G=0,j=N.length,V=j-1;for(U=G+1;G<j;G++,V++,U++)V===j&&(V=0),U===j&&(U=0),m[G]=c(N[G],N[V],N[U]);w=[];var k=m.concat();for(O=0,M=P.length;O<M;O++){I=P[O];var W=[];for(G=0,V=(j=I.length)-1,U=G+1;G<j;G++,V++,U++)V===j&&(V=0),U===j&&(U=0),W[G]=c(I[G],I[V],I[U]);w.push(W),k=k.concat(W)}for(V=0;V<S;V++){j=V/S;var q=E*Math.cos(j*Math.PI/2);for(U=x*Math.sin(j*Math.PI/2)+b,G=0,j=N.length;G<j;G++){var X=r(N[G],m[G],U);l(X.x,X.y,-q)}for(O=0,M=P.length;O<M;O++)for(I=P[O],W=w[O],G=0,j=I.length;G<j;G++)l((X=r(I[G],W[G],U)).x,X.y,-q)}for(U=x+b,G=0;G<B;G++)X=y?r(t[G],k[G],U):t[G],A?(L.copy(D.normals[0]).multiplyScalar(X.x),R.copy(D.binormals[0]).multiplyScalar(X.y),C.copy(T[0]).add(L).add(R),l(C.x,C.y,C.z)):l(X.x,X.y,0);for(j=1;j<=g;j++)for(G=0;G<B;G++)X=y?r(t[G],k[G],U):t[G],A?(L.copy(D.normals[j]).multiplyScalar(X.x),R.copy(D.binormals[j]).multiplyScalar(X.y),C.copy(T[j]).add(L).add(R),l(C.x,C.y,C.z)):l(X.x,X.y,v/g*j);for(V=S-1;0<=V;V--){for(j=V/S,q=E*Math.cos(j*Math.PI/2),U=x*Math.sin(j*Math.PI/2)+b,G=0,j=N.length;G<j;G++)l((X=r(N[G],m[G],U)).x,X.y,v+q);for(O=0,M=P.length;O<M;O++)for(I=P[O],W=w[O],G=0,j=I.length;G<j;G++)X=r(I[G],W[G],U),A?l(X.x,X.y+T[g-1].y,T[g-1].x+q):l(X.x,X.y,v+q)}!function(){var t=o.length/3;if(y){var e=0*B;for(G=0;G<z;G++)u((F=H[G])[2]+e,F[1]+e,F[0]+e);for(e=B*(g+2*S),G=0;G<z;G++)u((F=H[G])[0]+e,F[1]+e,F[2]+e)}else{for(G=0;G<z;G++)u((F=H[G])[2],F[1],F[0]);for(G=0;G<z;G++)u((F=H[G])[0]+B*g,F[1]+B*g,F[2]+B*g)}a.addGroup(t,o.length/3-t,0)}(),function(){var t=o.length/3,e=0;for(h(N,e),e+=N.length,O=0,M=P.length;O<M;O++)h(I=P[O],e),e+=I.length;a.addGroup(t,o.length/3-t,1)}()}z.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];for(var a=this,o=[],s=[],c=0,h=t.length;c<h;c++)r(t[c]);this.setAttribute("position",new N(o,3)),this.setAttribute("uv",new N(s,2)),this.computeVertexNormals()}function qi(t,e,i){if(i.shapes=[],Array.isArray(t))for(var r=0,n=t.length;r<n;r++)i.shapes.push(t[r].uuid);else i.shapes.push(t.uuid);return void 0!==e.extrudePath&&(i.options.extrudePath=e.extrudePath.toJSON()),i}function Xi(t,e){k.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new Yi(t,e)),this.mergeVertices()}function Yi(t,e){var i=(e=e||{}).font;if(!i||!i.isFont)return void 0,new k;t=i.generateShapes(t,e.size),e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),Wi.call(this,t,e),this.type="TextBufferGeometry"}function Ji(t,e,i,r,n,a,o){k.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:r,phiLength:n,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new Zi(t,e,i,r,n,a,o)),this.mergeVertices()}function Zi(t,e,i,r,a,o,s){z.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:r,phiLength:a,thetaStart:o,thetaLength:s},t=t||1,e=Math.max(3,Math.floor(e)||8),i=Math.max(2,Math.floor(i)||6),r=void 0!==r?r:0,a=void 0!==a?a:2*Math.PI,o=void 0!==o?o:0,s=void 0!==s?s:Math.PI;var c,h,l=Math.min(o+s,Math.PI),u=0,p=[],d=new n,f=new n,m=[],g=[],v=[],y=[];for(h=0;h<=i;h++){var E=[],x=h/i,b=0;for(0==h&&0==o?b=.5/e:h==i&&l==Math.PI&&(b=-.5/e),c=0;c<=e;c++){var S=c/e;d.x=-t*Math.cos(r+S*a)*Math.sin(o+x*s),d.y=t*Math.cos(o+x*s),d.z=t*Math.sin(r+S*a)*Math.sin(o+x*s),g.push(d.x,d.y,d.z),f.copy(d).normalize(),v.push(f.x,f.y,f.z),y.push(S+b,1-x),E.push(u++)}p.push(E)}for(h=0;h<i;h++)for(c=0;c<e;c++)t=p[h][c+1],r=p[h][c],a=p[h+1][c],s=p[h+1][c+1],(0!==h||0<o)&&m.push(t,r,s),(h!==i-1||l<Math.PI)&&m.push(r,a,s);this.setIndex(m),this.setAttribute("position",new N(g,3)),this.setAttribute("normal",new N(v,3)),this.setAttribute("uv",new N(y,2))}function Ki(t,e,i,r,n,a){k.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:a},this.fromBufferGeometry(new Qi(t,e,i,r,n,a)),this.mergeVertices()}function Qi(t,e,r,a,o,s){z.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:a,thetaStart:o,thetaLength:s},t=t||.5,e=e||1,o=void 0!==o?o:0,s=void 0!==s?s:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var c,h,l=[],u=[],p=[],d=[],f=t,m=(e-t)/(a=void 0!==a?Math.max(1,a):1),g=new n,v=new i;for(c=0;c<=a;c++){for(h=0;h<=r;h++)t=o+h/r*s,g.x=f*Math.cos(t),g.y=f*Math.sin(t),u.push(g.x,g.y,g.z),p.push(0,0,1),v.x=(g.x/e+1)/2,v.y=(g.y/e+1)/2,d.push(v.x,v.y);f+=m}for(c=0;c<a;c++)for(e=c*(r+1),h=0;h<r;h++)o=(t=h+e)+r+1,s=t+r+2,f=t+1,l.push(t,o,f),l.push(o,s,f);this.setIndex(l),this.setAttribute("position",new N(u,3)),this.setAttribute("normal",new N(p,3)),this.setAttribute("uv",new N(d,2))}function $i(t,e,i,r){k.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:r},this.fromBufferGeometry(new tr(t,e,i,r)),this.mergeVertices()}function tr(t,e,r,a){z.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:a},e=Math.floor(e)||12,r=r||0,a=a||2*Math.PI,a=Ta.clamp(a,0,2*Math.PI);var o,s=[],c=[],h=[],l=1/e,u=new n,p=new i;for(o=0;o<=e;o++){var d=r+o*l*a,f=Math.sin(d),m=Math.cos(d);for(d=0;d<=t.length-1;d++)u.x=t[d].x*f,u.y=t[d].y,u.z=t[d].x*m,c.push(u.x,u.y,u.z),p.x=o/e,p.y=d/(t.length-1),h.push(p.x,p.y)}for(o=0;o<e;o++)for(d=0;d<t.length-1;d++)l=(r=d+o*t.length)+t.length,u=r+t.length+1,p=r+1,s.push(r,l,p),s.push(l,u,p);if(this.setIndex(s),this.setAttribute("position",new N(c,3)),this.setAttribute("uv",new N(h,2)),this.computeVertexNormals(),a===2*Math.PI)for(a=this.attributes.normal.array,s=new n,c=new n,h=new n,r=e*t.length*3,d=o=0;o<t.length;o++,d+=3)s.x=a[d+0],s.y=a[d+1],s.z=a[d+2],c.x=a[r+d+0],c.y=a[r+d+1],c.z=a[r+d+2],h.addVectors(s,c).normalize(),a[d+0]=a[r+d+0]=h.x,a[d+1]=a[r+d+1]=h.y,a[d+2]=a[r+d+2]=h.z}function er(t,e){k.call(this),this.type="ShapeGeometry","object"==typeof e&&(void 0,e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new ir(t,e)),this.mergeVertices()}function ir(t,e){function i(t){var i,s=n.length/3,h=(t=t.extractPoints(e)).shape,l=t.holes;for(!1===dc.isClockWise(h)&&(h=h.reverse()),t=0,i=l.length;t<i;t++){var u=l[t];!0===dc.isClockWise(u)&&(l[t]=u.reverse())}var p=dc.triangulateShape(h,l);for(t=0,i=l.length;t<i;t++)u=l[t],h=h.concat(u);for(t=0,i=h.length;t<i;t++)u=h[t],n.push(u.x,u.y,0),a.push(0,0,1),o.push(u.x,u.y);for(t=0,i=p.length;t<i;t++)h=p[t],r.push(h[0]+s,h[1]+s,h[2]+s),c+=3}z.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;var r=[],n=[],a=[],o=[],s=0,c=0;if(!1===Array.isArray(t))i(t);else for(var h=0;h<t.length;h++)i(t[h]),this.addGroup(s,c,h),s+=c,c=0;this.setIndex(r),this.setAttribute("position",new N(n,3)),this.setAttribute("normal",new N(a,3)),this.setAttribute("uv",new N(o,2))}function rr(t,e){if(e.shapes=[],Array.isArray(t))for(var i=0,r=t.length;i<r;i++)e.shapes.push(t[i].uuid);else e.shapes.push(t.uuid);return e}function nr(t,e){z.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e};var i=[];e=Math.cos(Ta.DEG2RAD*(void 0!==e?e:1));var r=[0,0],n={},a=["a","b","c"];if(t.isBufferGeometry){var o=new k;o.fromBufferGeometry(t)}else o=t.clone();o.mergeVertices(),o.computeFaceNormals(),t=o.vertices;for(var s=0,c=(o=o.faces).length;s<c;s++)for(var h=o[s],l=0;3>l;l++){var u=h[a[l]],p=h[a[(l+1)%3]];r[0]=Math.min(u,p),r[1]=Math.max(u,p),void 0===n[u=r[0]+","+r[1]]?n[u]={index1:r[0],index2:r[1],face1:s,face2:void 0}:n[u].face2=s}for(u in n)(void 0===(r=n[u]).face2||o[r.face1].normal.dot(o[r.face2].normal)<=e)&&(a=t[r.index1],i.push(a.x,a.y,a.z),a=t[r.index2],i.push(a.x,a.y,a.z));this.setAttribute("position",new N(i,3))}function ar(t,e,i,r,n,a,o,s){k.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:r,heightSegments:n,openEnded:a,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new or(t,e,i,r,n,a,o,s)),this.mergeVertices()}function or(t,e,r,a,o,s,c,h){function l(r){var o,s=new i,l=new n,v=0,x=!0===r?t:e,b=!0===r?1:-1,S=g;for(o=1;o<=a;o++)d.push(0,y*b,0),f.push(0,b,0),m.push(.5,.5),g++;var w=g;for(o=0;o<=a;o++){var _=o/a*h+c,M=Math.cos(_);_=Math.sin(_),l.x=x*_,l.y=y*b,l.z=x*M,d.push(l.x,l.y,l.z),f.push(0,b,0),s.x=.5*M+.5,s.y=.5*_*b+.5,m.push(s.x,s.y),g++}for(o=0;o<a;o++)s=S+o,l=w+o,!0===r?p.push(l,l+1,s):p.push(l+1,l,s),v+=3;u.addGroup(E,v,!0===r?1:2),E+=v}z.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:a,heightSegments:o,openEnded:s,thetaStart:c,thetaLength:h};var u=this;t=void 0!==t?t:1,e=void 0!==e?e:1,r=r||1,a=Math.floor(a)||8,o=Math.floor(o)||1,s=void 0!==s&&s,c=void 0!==c?c:0,h=void 0!==h?h:2*Math.PI;var p=[],d=[],f=[],m=[],g=0,v=[],y=r/2,E=0;!function(){var i,s,l=new n,x=new n,b=0,S=(e-t)/r;for(s=0;s<=o;s++){var w=[],_=s/o,M=_*(e-t)+t;for(i=0;i<=a;i++){var A=i/a,T=A*h+c,D=Math.sin(T);T=Math.cos(T),x.x=M*D,x.y=-_*r+y,x.z=M*T,d.push(x.x,x.y,x.z),l.set(D,S,T).normalize(),f.push(l.x,l.y,l.z),m.push(A,1-_),w.push(g++)}v.push(w)}for(i=0;i<a;i++)for(s=0;s<o;s++)l=v[s+1][i],x=v[s+1][i+1],S=v[s][i+1],p.push(v[s][i],l,S),p.push(l,x,S),b+=6;u.addGroup(E,b,0),E+=b}(),!1===s&&(0<t&&l(!0),0<e&&l(!1)),this.setIndex(p),this.setAttribute("position",new N(d,3)),this.setAttribute("normal",new N(f,3)),this.setAttribute("uv",new N(m,2))}function sr(t,e,i,r,n,a,o){ar.call(this,0,t,e,i,r,n,a,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:a,thetaLength:o}}function cr(t,e,i,r,n,a,o){or.call(this,0,t,e,i,r,n,a,o),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:a,thetaLength:o}}function hr(t,e,i,r){k.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:r},this.fromBufferGeometry(new lr(t,e,i,r)),this.mergeVertices()}function lr(t,e,r,a){z.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:a},t=t||1,e=void 0!==e?Math.max(3,e):8,r=void 0!==r?r:0,a=void 0!==a?a:2*Math.PI;var o,s=[],c=[],h=[],l=[],u=new n,p=new i;c.push(0,0,0),h.push(0,0,1),l.push(.5,.5);var d=0;for(o=3;d<=e;d++,o+=3){var f=r+d/e*a;u.x=t*Math.cos(f),u.y=t*Math.sin(f),c.push(u.x,u.y,u.z),h.push(0,0,1),p.x=(c[o]/t+1)/2,p.y=(c[o+1]/t+1)/2,l.push(p.x,p.y)}for(o=1;o<=e;o++)s.push(o,o+1,0);this.setIndex(s),this.setAttribute("position",new N(c,3)),this.setAttribute("normal",new N(h,3)),this.setAttribute("uv",new N(l,2))}function ur(t){A.call(this),this.type="ShadowMaterial",this.color=new b(0),this.transparent=!0,this.setValues(t)}function pr(t){X.call(this,t),this.type="RawShaderMaterial"}function dr(t){A.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new b(16777215),this.metalness=this.roughness=.5,this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new b(0),this.emissiveIntensity=1,this.bumpMap=this.emissiveMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)}function fr(t){dr.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearcoatRoughness=this.clearcoat=0,this.sheen=null,this.clearcoatNormalScale=new i(1,1),this.clearcoatNormalMap=null,this.transparency=0,this.setValues(t)}function mr(t){A.call(this),this.type="MeshPhongMaterial",this.color=new b(16777215),this.specular=new b(1118481),this.shininess=30,this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new b(0),this.emissiveIntensity=1,this.bumpMap=this.emissiveMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.envMap=this.alphaMap=this.specularMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)}function gr(t){mr.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(t)}function vr(t){A.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.morphNormals=this.morphTargets=this.skinning=this.fog=!1,this.setValues(t)}function yr(t){A.call(this),this.type="MeshLambertMaterial",this.color=new b(16777215),this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new b(0),this.emissiveIntensity=1,this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)}function Er(t){A.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new b(16777215),this.bumpMap=this.map=this.matcap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)}function xr(t){Ze.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}function br(t,e,i,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(i),this.sampleValues=e,this.valueSize=i}function Sr(t,e,i,r){br.call(this,t,e,i,r),this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0}function wr(t,e,i,r){br.call(this,t,e,i,r)}function _r(t,e,i,r){br.call(this,t,e,i,r)}function Mr(t,e,i,r){if(void 0===t)throw Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=vc.convertArray(e,this.TimeBufferType),this.values=vc.convertArray(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function Ar(t,e,i){Mr.call(this,t,e,i)}function Tr(t,e,i,r){Mr.call(this,t,e,i,r)}function Dr(t,e,i,r){Mr.call(this,t,e,i,r)}function Rr(t,e,i,r){br.call(this,t,e,i,r)}function Lr(t,e,i,r){Mr.call(this,t,e,i,r)}function Cr(t,e,i,r){Mr.call(this,t,e,i,r)}function Pr(t,e,i,r){Mr.call(this,t,e,i,r)}function Or(t,e,i){this.name=t,this.tracks=i,this.duration=void 0!==e?e:-1,this.uuid=Ta.generateUUID(),0>this.duration&&this.resetDuration()}function Ir(t){if(void 0===t.type)throw Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Dr;case"vector":case"vector2":case"vector3":case"vector4":return Pr;case"color":return Tr;case"quaternion":return Lr;case"bool":case"boolean":return Ar;case"string":return Cr}throw Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){var i=[],r=[];vc.flattenJSON(t.keys,i,r,"value"),t.times=i,t.values=r}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}function Hr(t,e,i){var r=this,n=!1,a=0,o=0,s=void 0,c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){o++,!1===n&&void 0!==r.onStart&&r.onStart(t,a,o),n=!0},this.itemEnd=function(t){a++,void 0!==r.onProgress&&r.onProgress(t,a,o),a===o&&(n=!1,void 0!==r.onLoad)&&r.onLoad()},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return s?s(t):t},this.setURLModifier=function(t){return s=t,this},this.addHandler=function(t,e){return c.push(t,e),this},this.removeHandler=function(t){return-1!==(t=c.indexOf(t))&&c.splice(t,2),this},this.getHandler=function(t){for(var e=0,i=c.length;e<i;e+=2){var r=c[e+1];if(c[e].test(t))return r}return null}}function Nr(t){this.manager=void 0!==t?t:Ec,this.crossOrigin="anonymous",this.resourcePath=this.path=""}function Ur(t){Nr.call(this,t)}function Fr(t){Nr.call(this,t)}function Br(t){Nr.call(this,t)}function zr(t){Nr.call(this,t)}function Gr(t){Nr.call(this,t)}function jr(t){Nr.call(this,t)}function Vr(t){Nr.call(this,t)}function kr(){this.type="Curve",this.arcLengthDivisions=200}function Wr(t,e,i,r,n,a,o,s){kr.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=i||1,this.yRadius=r||1,this.aStartAngle=n||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=o||!1,this.aRotation=s||0}function qr(t,e,i,r,n,a){Wr.call(this,t,e,i,i,r,n,a),this.type="ArcCurve"}function Xr(){var t=0,e=0,i=0,r=0;return{initCatmullRom:function(n,a,o,s,c){t=a,e=n=c*(o-n),i=-3*a+3*o-2*n-(s=c*(s-a)),r=2*a-2*o+n+s},initNonuniformCatmullRom:function(n,a,o,s,c,h,l){t=a,e=n=((a-n)/c-(o-n)/(c+h)+(o-a)/h)*h,i=-3*a+3*o-2*n-(s=((o-a)/h-(s-a)/(h+l)+(s-o)/l)*h),r=2*a-2*o+n+s},calc:function(n){var a=n*n;return t+e*n+i*a+r*a*n}}}function Yr(t,e,i,r){kr.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=i||"centripetal",this.tension=r||.5}function Jr(t,e,i,r,n){var a=t*t;return(2*i-2*r+(e=.5*(r-e))+(n=.5*(n-i)))*t*a+(-3*i+3*r-2*e-n)*a+e*t+i}function Zr(t,e,i,r){var n=1-t;return n*n*e+2*(1-t)*t*i+t*t*r}function Kr(t,e,i,r,n){var a=1-t,o=1-t;return a*a*a*e+3*o*o*t*i+3*(1-t)*t*t*r+t*t*t*n}function Qr(t,e,r,n){kr.call(this),this.type="CubicBezierCurve",this.v0=t||new i,this.v1=e||new i,this.v2=r||new i,this.v3=n||new i}function $r(t,e,i,r){kr.call(this),this.type="CubicBezierCurve3",this.v0=t||new n,this.v1=e||new n,this.v2=i||new n,this.v3=r||new n}function tn(t,e){kr.call(this),this.type="LineCurve",this.v1=t||new i,this.v2=e||new i}function en(t,e){kr.call(this),this.type="LineCurve3",this.v1=t||new n,this.v2=e||new n}function rn(t,e,r){kr.call(this),this.type="QuadraticBezierCurve",this.v0=t||new i,this.v1=e||new i,this.v2=r||new i}function nn(t,e,i){kr.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new n,this.v1=e||new n,this.v2=i||new n}function an(t){kr.call(this),this.type="SplineCurve",this.points=t||[]}function on(){kr.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function sn(t){on.call(this),this.type="Path",this.currentPoint=new i,t&&this.setFromPoints(t)}function cn(t){sn.call(this,t),this.uuid=Ta.generateUUID(),this.type="Shape",this.holes=[]}function hn(t,e){d.call(this),this.type="Light",this.color=new b(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function ln(t,e,i){hn.call(this,t,i),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(d.DefaultUp),this.updateMatrix(),this.groundColor=new b(e)}function un(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new i(512,512),this.mapPass=this.map=null,this.matrix=new l,this._frustum=new $,this._frameExtents=new i(1,1),this._viewportCount=1,this._viewports=[new s(0,0,1,1)]}function pn(){un.call(this,new J(50,1,.5,500))}function dn(t,e,i,r,n,a){hn.call(this,t,e),this.type="SpotLight",this.position.copy(d.DefaultUp),this.updateMatrix(),this.target=new d,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==n?n:0,this.decay=void 0!==a?a:1,this.shadow=new pn}function fn(){un.call(this,new J(90,1,.5,500)),this._frameExtents=new i(4,2),this._viewportCount=6,this._viewports=[new s(2,1,1,1),new s(0,1,1,1),new s(3,1,1,1),new s(1,1,1,1),new s(3,0,1,1),new s(1,0,1,1)],this._cubeDirections=[new n(1,0,0),new n(-1,0,0),new n(0,0,1),new n(0,0,-1),new n(0,1,0),new n(0,-1,0)],this._cubeUps=[new n(0,1,0),new n(0,1,0),new n(0,1,0),new n(0,1,0),new n(0,0,1),new n(0,0,-1)]}function mn(t,e,i,r){hn.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==r?r:1,this.shadow=new fn}function gn(t,e,i,r,n,a){Y.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==t?t:-1,this.right=void 0!==e?e:1,this.top=void 0!==i?i:1,this.bottom=void 0!==r?r:-1,this.near=void 0!==n?n:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}function vn(){un.call(this,new gn(-5,5,5,-5,.5,500))}function yn(t,e){hn.call(this,t,e),this.type="DirectionalLight",this.position.copy(d.DefaultUp),this.updateMatrix(),this.target=new d,this.shadow=new vn}function En(t,e){hn.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function xn(t,e,i,r){hn.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==i?i:10,this.height=void 0!==r?r:10}function bn(t){Nr.call(this,t),this.textures={}}function Sn(){z.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function wn(t,e,i,r){"number"==typeof i&&(r=i,i=!1,void 0),D.call(this,t,e,i),this.meshPerAttribute=r||1}function _n(t){Nr.call(this,t)}function Mn(t){Nr.call(this,t)}function An(t){"undefined"==typeof createImageBitmap&&void 0,"undefined"==typeof fetch&&void 0,Nr.call(this,t),this.options=void 0}function Tn(){this.type="ShapePath",this.color=new b,this.subPaths=[],this.currentPath=null}function Dn(t){this.type="Font",this.data=t}function Rn(t){Nr.call(this,t)}function Ln(t){Nr.call(this,t)}function Cn(){this.coefficients=[];for(var t=0;9>t;t++)this.coefficients.push(new n)}function Pn(t,e){hn.call(this,void 0,e),this.sh=void 0!==t?t:new Cn}function On(t,e,i){Pn.call(this,void 0,i),t=(new b).set(t),i=(new b).set(e),e=new n(t.r,t.g,t.b),t=new n(i.r,i.g,i.b);var r=(i=Math.sqrt(Math.PI))*Math.sqrt(.75);this.sh.coefficients[0].copy(e).add(t).multiplyScalar(i),this.sh.coefficients[1].copy(e).sub(t).multiplyScalar(r)}function In(t,e){Pn.call(this,void 0,e),t=(new b).set(t),this.sh.coefficients[0].set(t.r,t.g,t.b).multiplyScalar(2*Math.sqrt(Math.PI))}function Hn(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new J,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new J,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function Nn(t){this.autoStart=void 0===t||t,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1}function Un(){d.call(this),this.type="AudioListener",this.context=Pc.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Nn}function Fn(t){d.call(this),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.offset=this.loopEnd=this.loopStart=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._pausedAt=this._startedAt=0,this.filters=[]}function Bn(t){Fn.call(this,t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function zn(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}function Gn(t,e,i){switch(this.binding=t,this.valueSize=i,t=Float64Array,e){case"quaternion":e=this._slerp;break;case"string":case"bool":t=Array,e=this._select;break;default:e=this._lerp}this.buffer=new t(4*i),this._mixBufferRegion=e,this.referenceCount=this.useCount=this.cumulativeWeight=0}function jn(t,e,i){i=i||Vn.parseTrackName(e),this._targetGroup=t,this._bindings=t.subscribe_(e,i)}function Vn(t,e,i){this.path=e,this.parsedPath=i||Vn.parseTrackName(e),this.node=Vn.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function kn(){this.uuid=Ta.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var e=0,i=arguments.length;e!==i;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}function Wn(t,e,i){this._mixer=t,this._clip=e,this._localRoot=i||null,e=(t=e.tracks).length,i=Array(e);for(var r={endingStart:2400,endingEnd:2400},n=0;n!==e;++n){var a=t[n].createInterpolant(null);i[n]=a,a.settings=r}this._interpolantSettings=r,this._interpolants=i,this._propertyBindings=Array(e),this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0}function qn(t){this._root=t,this._initMemoryManager(),this.time=this._accuIndex=0,this.timeScale=1}function Xn(t,e){"string"==typeof t&&(void 0,t=e),this.value=t}function Yn(t,e,i){ze.call(this,t,e),this.meshPerAttribute=i||1}function Jn(t,e,i,r){this.ray=new y(t,e),this.near=i||0,this.far=r||1/0,this.camera=null,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return void 0,this.Points}}})}function Zn(t,e){return t.distance-e.distance}function Kn(t,e,i,r){if(!1!==t.visible&&(t.raycast(e,i),!0===r)){r=0;for(var n=(t=t.children).length;r<n;r++)Kn(t[r],e,i,!0)}}function Qn(t,e,i){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==i?i:0,this}function $n(t,e,i){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==i?i:0,this}function ta(t,e){this.min=void 0!==t?t:new i(1/0,1/0),this.max=void 0!==e?e:new i(-1/0,-1/0)}function ea(t,e){this.start=void 0!==t?t:new n,this.end=void 0!==e?e:new n}function ia(t){d.call(this),this.material=t,this.render=function(){}}function ra(t,e,i,r){this.object=t,this.size=void 0!==e?e:1,t=void 0!==i?i:16711680,r=void 0!==r?r:1,e=0,(i=this.object.geometry)&&i.isGeometry?e=3*i.faces.length:i&&i.isBufferGeometry&&(e=i.attributes.normal.count),i=new z,e=new N(6*e,3),i.setAttribute("position",e),Qe.call(this,i,new Ze({color:t,linewidth:r})),this.matrixAutoUpdate=!1,this.update()}function na(t,e){d.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e,t=new z,e=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(var i=0,r=1;32>i;i++,r++){var n=i/32*Math.PI*2,a=r/32*Math.PI*2;e.push(Math.cos(n),Math.sin(n),1,Math.cos(a),Math.sin(a),1)}t.setAttribute("position",new N(e,3)),e=new Ze({fog:!1}),this.cone=new Qe(t,e),this.add(this.cone),this.update()}function aa(t){for(var e=function t(e){var i=[];e&&e.isBone&&i.push(e);for(var r=0;r<e.children.length;r++)i.push.apply(i,t(e.children[r]));return i}(t),i=new z,r=[],n=[],a=new b(0,0,1),o=new b(0,1,0),s=0;s<e.length;s++){var c=e[s];c.parent&&c.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),n.push(a.r,a.g,a.b),n.push(o.r,o.g,o.b))}i.setAttribute("position",new N(r,3)),i.setAttribute("color",new N(n,3)),r=new Ze({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0}),Qe.call(this,i,r),this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function oa(t,e,i){this.light=t,this.light.updateMatrixWorld(),this.color=i,t=new Zi(e,4,2),e=new T({wireframe:!0,fog:!1}),G.call(this,t,e),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function sa(t,e){this.type="RectAreaLightHelper",this.light=t,this.color=e,(t=new z).setAttribute("position",new N([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),t.computeBoundingSphere(),e=new Ze({fog:!1}),Ke.call(this,t,e),(t=new z).setAttribute("position",new N([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),t.computeBoundingSphere(),this.add(new G(t,new T({side:1,fog:!1}))),this.update()}function ca(t,e,i){d.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,(t=new mi(e)).rotateY(.5*Math.PI),this.material=new T({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=2),e=t.getAttribute("position"),e=new Float32Array(3*e.count),t.setAttribute("color",new D(e,3)),this.add(new G(t,this.material)),this.update()}function ha(t,e){this.lightProbe=t,this.size=e,t=new X({defines:{GAMMA_OUTPUT:""},uniforms:{sh:{value:this.lightProbe.sh.coefficients},intensity:{value:this.lightProbe.intensity}},vertexShader:"varying vec3 vNormal;\nvoid main() {\n\tvNormal = normalize( normalMatrix * normal );\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#define RECIPROCAL_PI 0.318309886\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n\t// matrix is assumed to be orthogonal\n\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n}\nvec3 linearToOutput( in vec3 a ) {\n\t#ifdef GAMMA_OUTPUT\n\t\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n\t#else\n\t\treturn a;\n\t#endif\n}\n// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\t// normal is assumed to have unit length\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\t// band 0\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\t// band 1\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\t// band 2\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nuniform vec3 sh[ 9 ]; // sh coefficients\nuniform float intensity; // light probe intensity\nvarying vec3 vNormal;\nvoid main() {\n\tvec3 normal = normalize( vNormal );\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, sh );\n\tvec3 outgoingLight = RECIPROCAL_PI * irradiance * intensity;\n\toutgoingLight = linearToOutput( outgoingLight );\n\tgl_FragColor = vec4( outgoingLight, 1.0 );\n}"}),e=new Zi(1,32,16),G.call(this,e,t),this.onBeforeRender()}function la(t,e,i,r){t=t||10,e=e||10,i=new b(void 0!==i?i:4473924),r=new b(void 0!==r?r:8947848);var n=e/2,a=t/e,o=t/2;t=[];for(var s=[],c=0,h=0,l=-o;c<=e;c++,l+=a){t.push(-o,0,l,o,0,l),t.push(l,0,-o,l,0,o);var u=c===n?i:r;u.toArray(s,h),h+=3,u.toArray(s,h),h+=3,u.toArray(s,h),h+=3,u.toArray(s,h),h+=3}(e=new z).setAttribute("position",new N(t,3)),e.setAttribute("color",new N(s,3)),i=new Ze({vertexColors:2}),Qe.call(this,e,i)}function ua(t,e,i,r,n,a){t=t||10,e=e||16,i=i||8,r=r||64,n=new b(void 0!==n?n:4473924),a=new b(void 0!==a?a:8947848);var o,s=[],c=[];for(o=0;o<=e;o++){var h=o/e*2*Math.PI,l=Math.sin(h)*t;h=Math.cos(h)*t,s.push(0,0,0),s.push(l,0,h);var u=1&o?n:a;c.push(u.r,u.g,u.b),c.push(u.r,u.g,u.b)}for(o=0;o<=i;o++){u=1&o?n:a;var p=t-t/i*o;for(e=0;e<r;e++)h=e/r*2*Math.PI,l=Math.sin(h)*p,h=Math.cos(h)*p,s.push(l,0,h),c.push(u.r,u.g,u.b),h=(e+1)/r*2*Math.PI,l=Math.sin(h)*p,h=Math.cos(h)*p,s.push(l,0,h),c.push(u.r,u.g,u.b)}(t=new z).setAttribute("position",new N(s,3)),t.setAttribute("color",new N(c,3)),s=new Ze({vertexColors:2}),Qe.call(this,t,s)}function pa(t,e,i,r){this.audio=t,this.range=e||1,this.divisionsInnerAngle=i||16,this.divisionsOuterAngle=r||2,t=new z,e=new Float32Array(3*(3*(this.divisionsInnerAngle+2*this.divisionsOuterAngle)+3)),t.setAttribute("position",new D(e,3)),e=new Ze({color:65280}),i=new Ze({color:16776960}),Ke.call(this,t,[i,e]),this.update()}function da(t,e,i,r){this.object=t,this.size=void 0!==e?e:1,t=void 0!==i?i:16776960,r=void 0!==r?r:1,e=0,(i=this.object.geometry)&&i.isGeometry?e=i.faces.length:void 0,i=new z,e=new N(6*e,3),i.setAttribute("position",e),Qe.call(this,i,new Ze({color:t,linewidth:r})),this.matrixAutoUpdate=!1,this.update()}function fa(t,e,i){d.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===e&&(e=1),(t=new z).setAttribute("position",new N([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3)),e=new Ze({fog:!1}),this.lightPlane=new Ke(t,e),this.add(this.lightPlane),(t=new z).setAttribute("position",new N([0,0,0,0,0,1],3)),this.targetLine=new Ke(t,e),this.add(this.targetLine),this.update()}function ma(t){function e(t,e,r){i(t,r),i(e,r)}function i(t,e){a.push(0,0,0),o.push(e.r,e.g,e.b),void 0===s[t]&&(s[t]=[]),s[t].push(a.length/3-1)}var r=new z,n=new Ze({color:16777215,vertexColors:1}),a=[],o=[],s={},c=new b(16755200),h=new b(16711680),l=new b(43775),u=new b(16777215),p=new b(3355443);e("n1","n2",c),e("n2","n4",c),e("n4","n3",c),e("n3","n1",c),e("f1","f2",c),e("f2","f4",c),e("f4","f3",c),e("f3","f1",c),e("n1","f1",c),e("n2","f2",c),e("n3","f3",c),e("n4","f4",c),e("p","n1",h),e("p","n2",h),e("p","n3",h),e("p","n4",h),e("u1","u2",l),e("u2","u3",l),e("u3","u1",l),e("c","t",u),e("p","c",p),e("cn1","cn2",p),e("cn3","cn4",p),e("cf1","cf2",p),e("cf3","cf4",p),r.setAttribute("position",new N(a,3)),r.setAttribute("color",new N(o,3)),Qe.call(this,r,n),this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}function ga(t,e,i,r,n,a,o){if(vh.set(n,a,o).unproject(r),void 0!==(t=e[t]))for(i=i.getAttribute("position"),e=0,r=t.length;e<r;e++)i.setXYZ(t[e],vh.x,vh.y,vh.z)}function va(t,e){this.object=t,void 0===e&&(e=16776960),t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var i=new Float32Array(24),r=new z;r.setIndex(new D(t,1)),r.setAttribute("position",new D(i,3)),Qe.call(this,r,new Ze({color:e})),this.matrixAutoUpdate=!1,this.update()}function ya(t,e){this.type="Box3Helper",this.box=t,e=e||16776960,t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var i=new z;i.setIndex(new D(t,1)),i.setAttribute("position",new N([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Qe.call(this,i,new Ze({color:e})),this.geometry.computeBoundingSphere()}function Ea(t,e,i){this.type="PlaneHelper",this.plane=t,this.size=void 0===e?1:e,t=void 0!==i?i:16776960,(e=new z).setAttribute("position",new N([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),e.computeBoundingSphere(),Ke.call(this,e,new Ze({color:t})),(e=new z).setAttribute("position",new N([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),e.computeBoundingSphere(),this.add(new G(e,new T({color:t,opacity:.2,transparent:!0,depthWrite:!1})))}function xa(t,e,i,r,a,o){d.call(this),void 0===t&&(t=new n(0,0,1)),void 0===e&&(e=new n(0,0,0)),void 0===i&&(i=1),void 0===r&&(r=16776960),void 0===a&&(a=.2*i),void 0===o&&(o=.2*a),void 0===xh&&((xh=new z).setAttribute("position",new N([0,0,0,0,1,0],3)),(bh=new or(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new Ke(xh,new Ze({color:r})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new G(bh,new T({color:r})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,a,o)}function ba(t){var e=[0,0,0,t=t||1,0,0,0,0,0,0,t,0,0,0,0,0,0,t];(t=new z).setAttribute("position",new N(e,3)),t.setAttribute("color",new N([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),e=new Ze({vertexColors:2}),Qe.call(this,t,e)}function Sa(t){void 0,Yr.call(this,t),this.type="catmullrom",this.closed=!0}function wa(t){void 0,Yr.call(this,t),this.type="catmullrom"}function _a(t){void 0,Yr.call(this,t),this.type="catmullrom"}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return 0>t?-1:0<t?1:+t}),!1=="name"in Function.prototype&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}),Object.assign(e.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)},removeEventListener:function(t,e){void 0!==this._listeners&&(void 0!==(t=this._listeners[t])&&(-1!==(e=t.indexOf(e))&&t.splice(e,1)))},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var i=0,r=(e=e.slice(0)).length;i<r;i++)e[i].call(this,t)}}}});for(var Ma=[],Aa=0;256>Aa;Aa++)Ma[Aa]=(16>Aa?"0":"")+Aa.toString(16);var Ta={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Ma[255&t]+Ma[t>>8&255]+Ma[t>>16&255]+Ma[t>>24&255]+"-"+Ma[255&e]+Ma[e>>8&255]+"-"+Ma[e>>16&15|64]+Ma[e>>24&255]+"-"+Ma[63&i|128]+Ma[i>>8&255]+"-"+Ma[i>>16&255]+Ma[i>>24&255]+Ma[255&r]+Ma[r>>8&255]+Ma[r>>16&255]+Ma[r>>24&255]).toUpperCase()},clamp:function(t,e,i){return Math.max(e,Math.min(i,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,i,r,n){return r+(t-e)*(n-r)/(i-e)},lerp:function(t,e,i){return(1-i)*t+i*e},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*Ta.DEG2RAD},radToDeg:function(t){return t*Ta.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}};Object.defineProperties(i.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(i.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.y=this.x=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(void 0,this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(void 0,this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,i=this.y;return t=t.elements,this.x=t[0]*e+t[3]*i+t[6],this.y=t[1]*e+t[4]*i+t[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this},clampLength:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return 0>t&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x;return e*e+(t=this.y-t.y)*t},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,i){return void 0!==i&&void 0,this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var i=Math.cos(e);e=Math.sin(e);var r=this.x-t.x,n=this.y-t.y;return this.x=r*i-n*e+t.x,this.y=r*e+n*i+t.y,this}}),Object.assign(r,{slerp:function(t,e,i,r){return i.copy(t).slerp(e,r)},slerpFlat:function(t,e,i,r,n,a,o){var s=i[r+0],c=i[r+1],h=i[r+2];i=i[r+3],r=n[a+0];var l=n[a+1],u=n[a+2];if(i!==(n=n[a+3])||s!==r||c!==l||h!==u){a=1-o;var p=s*r+c*l+h*u+i*n,d=0<=p?1:-1,f=1-p*p;f>Number.EPSILON&&(f=Math.sqrt(f),p=Math.atan2(f,p*d),a=Math.sin(a*p)/f,o=Math.sin(o*p)/f),s=s*a+r*(d*=o),c=c*a+l*d,h=h*a+u*d,i=i*a+n*d,a===1-o&&(s*=o=1/Math.sqrt(s*s+c*c+h*h+i*i),c*=o,h*=o,i*=o)}t[e]=s,t[e+1]=c,t[e+2]=h,t[e+3]=i}}),Object.defineProperties(r.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}}}),Object.assign(r.prototype,{isQuaternion:!0,set:function(t,e,i,r){return this._x=t,this._y=e,this._z=i,this._w=r,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=t._x,r=t._y,n=t._z;t=t.order;var a=Math.cos,o=Math.sin,s=a(i/2),c=a(r/2);return a=a(n/2),i=o(i/2),r=o(r/2),n=o(n/2),"XYZ"===t?(this._x=i*c*a+s*r*n,this._y=s*r*a-i*c*n,this._z=s*c*n+i*r*a,this._w=s*c*a-i*r*n):"YXZ"===t?(this._x=i*c*a+s*r*n,this._y=s*r*a-i*c*n,this._z=s*c*n-i*r*a,this._w=s*c*a+i*r*n):"ZXY"===t?(this._x=i*c*a-s*r*n,this._y=s*r*a+i*c*n,this._z=s*c*n+i*r*a,this._w=s*c*a-i*r*n):"ZYX"===t?(this._x=i*c*a-s*r*n,this._y=s*r*a+i*c*n,this._z=s*c*n-i*r*a,this._w=s*c*a+i*r*n):"YZX"===t?(this._x=i*c*a+s*r*n,this._y=s*r*a+i*c*n,this._z=s*c*n-i*r*a,this._w=s*c*a-i*r*n):"XZY"===t&&(this._x=i*c*a-s*r*n,this._y=s*r*a-i*c*n,this._z=s*c*n+i*r*a,this._w=s*c*a+i*r*n),!1!==e&&this._onChangeCallback(),this},setFromAxisAngle:function(t,e){e/=2;var i=Math.sin(e);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(e),this._onChangeCallback(),this},setFromRotationMatrix:function(t){var e=t.elements,i=e[0];t=e[4];var r=e[8],n=e[1],a=e[5],o=e[9],s=e[2],c=e[6],h=i+a+(e=e[10]);return 0<h?(i=.5/Math.sqrt(h+1),this._w=.25/i,this._x=(c-o)*i,this._y=(r-s)*i,this._z=(n-t)*i):i>a&&i>e?(i=2*Math.sqrt(1+i-a-e),this._w=(c-o)/i,this._x=.25*i,this._y=(t+n)/i,this._z=(r+s)/i):a>e?(i=2*Math.sqrt(1+a-i-e),this._w=(r-s)/i,this._x=(t+n)/i,this._y=.25*i,this._z=(o+c)/i):(i=2*Math.sqrt(1+e-i-a),this._w=(n-t)/i,this._x=(r+s)/i,this._y=(o+c)/i,this._z=.25*i),this._onChangeCallback(),this},setFromUnitVectors:function(t,e){var i=t.dot(e)+1;return 1e-6>i?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0):(this._x=0,this._y=-t.z,this._z=t.y)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x),this._w=i,this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(Ta.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){var i=this.angleTo(t);return 0===i||this.slerp(t,Math.min(1,e/i)),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._z=this._y=this._x=0,this._w=1):(t=1/t,this._x*=t,this._y*=t,this._z*=t,this._w*=t),this._onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(void 0,this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var i=t._x,r=t._y,n=t._z;t=t._w;var a=e._x,o=e._y,s=e._z;return e=e._w,this._x=i*e+t*a+r*s-n*o,this._y=r*e+t*o+n*a-i*s,this._z=n*e+t*s+i*o-r*a,this._w=t*e-i*a-r*o-n*s,this._onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var i=this._x,r=this._y,n=this._z,a=this._w,o=a*t._w+i*t._x+r*t._y+n*t._z;if(0>o?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),1<=o)return this._w=a,this._x=i,this._y=r,this._z=n,this;if((t=1-o*o)<=Number.EPSILON)return o=1-e,this._w=o*a+e*this._w,this._x=o*i+e*this._x,this._y=o*r+e*this._y,this._z=o*n+e*this._z,this.normalize(),this._onChangeCallback(),this;t=Math.sqrt(t);var s=Math.atan2(t,o);return o=Math.sin((1-e)*s)/t,e=Math.sin(e*s)/t,this._w=a*o+this._w*e,this._x=i*o+this._x*e,this._y=r*o+this._y*e,this._z=n*o+this._z*e,this._onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}});var Da=new n,Ra=new r;Object.assign(n.prototype,{isVector3:!0,set:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setScalar:function(t){return this.z=this.y=this.x=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(void 0,this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(void 0,this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(void 0,this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(t){return t&&t.isEuler||void 0,this.applyQuaternion(Ra.setFromEuler(t))},applyAxisAngle:function(t,e){return this.applyQuaternion(Ra.setFromAxisAngle(t,e))},applyMatrix3:function(t){var e=this.x,i=this.y,r=this.z;return t=t.elements,this.x=t[0]*e+t[3]*i+t[6]*r,this.y=t[1]*e+t[4]*i+t[7]*r,this.z=t[2]*e+t[5]*i+t[8]*r,this},applyMatrix4:function(t){var e=this.x,i=this.y,r=this.z,n=1/((t=t.elements)[3]*e+t[7]*i+t[11]*r+t[15]);return this.x=(t[0]*e+t[4]*i+t[8]*r+t[12])*n,this.y=(t[1]*e+t[5]*i+t[9]*r+t[13])*n,this.z=(t[2]*e+t[6]*i+t[10]*r+t[14])*n,this},applyQuaternion:function(t){var e=this.x,i=this.y,r=this.z,n=t.x,a=t.y,o=t.z,s=(t=t.w)*e+a*r-o*i,c=t*i+o*e-n*r,h=t*r+n*i-a*e;return e=-n*e-a*i-o*r,this.x=s*t+e*-n+c*-o-h*-a,this.y=c*t+e*-a+h*-n-s*-o,this.z=h*t+e*-o+s*-a-c*-n,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var e=this.x,i=this.y,r=this.z;return t=t.elements,this.x=t[0]*e+t[4]*i+t[8]*r,this.y=t[1]*e+t[5]*i+t[9]*r,this.z=t[2]*e+t[6]*i+t[10]*r,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},clampLength:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},cross:function(t,e){return void 0!==e?(void 0,this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var i=t.x,r=t.y;t=t.z;var n=e.x,a=e.y;return e=e.z,this.x=r*e-t*a,this.y=t*n-i*e,this.z=i*a-r*n,this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:function(t){return Da.copy(this).projectOnVector(t),this.sub(Da)},reflect:function(t){return this.sub(Da.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());return 0===e&&void 0,t=this.dot(t)/e,Math.acos(Ta.clamp(t,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i+(t=this.z-t.z)*t},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,e,i){var r=Math.sin(e)*t;return this.x=r*Math.sin(i),this.y=Math.cos(e)*t,this.z=r*Math.cos(i),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this},setFromMatrixPosition:function(t){return t=t.elements,this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length();return t=this.setFromMatrixColumn(t,2).length(),this.x=e,this.y=i,this.z=t,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,i){return void 0!==i&&void 0,this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}});var La=new n;Object.assign(a.prototype,{isMatrix3:!0,set:function(t,e,i,r,n,a,o,s,c){var h=this.elements;return h[0]=t,h[1]=r,h[2]=o,h[3]=e,h[4]=n,h[5]=s,h[6]=i,h[7]=a,h[8]=c,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements;return t=t.elements,e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],this},setFromMatrix4:function(t){return t=t.elements,this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(t){for(var e=0,i=t.count;e<i;e++)La.x=t.getX(e),La.y=t.getY(e),La.z=t.getZ(e),La.applyMatrix3(this),t.setXYZ(e,La.x,La.y,La.z);return t},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var i=t.elements,r=e.elements;e=this.elements,t=i[0];var n=i[3],a=i[6],o=i[1],s=i[4],c=i[7],h=i[2],l=i[5];i=i[8];var u=r[0],p=r[3],d=r[6],f=r[1],m=r[4],g=r[7],v=r[2],y=r[5];return r=r[8],e[0]=t*u+n*f+a*v,e[3]=t*p+n*m+a*y,e[6]=t*d+n*g+a*r,e[1]=o*u+s*f+c*v,e[4]=o*p+s*m+c*y,e[7]=o*d+s*g+c*r,e[2]=h*u+l*f+i*v,e[5]=h*p+l*m+i*y,e[8]=h*d+l*g+i*r,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],s=t[6],c=t[7];return e*a*(t=t[8])-e*o*c-i*n*t+i*o*s+r*n*c-r*a*s},getInverse:function(t,e){t&&t.isMatrix4&&void 0;var i=t.elements;t=this.elements;var r=i[0],n=i[1],a=i[2],o=i[3],s=i[4],c=i[5],h=i[6],l=i[7],u=(i=i[8])*s-c*l,p=c*h-i*o,d=l*o-s*h,f=r*u+n*p+a*d;if(0===f){if(!0===e)throw Error("THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0");return void 0,this.identity()}return e=1/f,t[0]=u*e,t[1]=(a*l-i*n)*e,t[2]=(c*n-a*s)*e,t[3]=p*e,t[4]=(i*r-a*h)*e,t[5]=(a*o-c*r)*e,t[6]=d*e,t[7]=(n*h-l*r)*e,t[8]=(s*r-n*o)*e,this},transpose:function(){var t=this.elements,e=t[1];return t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,i,r,n,a,o){var s=Math.cos(n);n=Math.sin(n),this.set(i*s,i*n,-i*(s*a+n*o)+a+t,-r*n,r*s,-r*(-n*a+s*o)+o+e,0,0,1)},scale:function(t,e){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this},rotate:function(t){var e=Math.cos(t);t=Math.sin(t);var i=this.elements,r=i[0],n=i[3],a=i[6],o=i[1],s=i[4],c=i[7];return i[0]=e*r+t*o,i[3]=e*n+t*s,i[6]=e*a+t*c,i[1]=-t*r+e*o,i[4]=-t*n+e*s,i[7]=-t*a+e*c,this},translate:function(t,e){var i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this},equals:function(t){var e=this.elements;t=t.elements;for(var i=0;9>i;i++)if(e[i]!==t[i])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var i=0;9>i;i++)this.elements[i]=t[i+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}});var Ca,Pa={getDataURL:function(t){if("undefined"==typeof HTMLCanvasElement)return t.src;if(!(t instanceof HTMLCanvasElement)){void 0===Ca&&(Ca=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Ca.width=t.width,Ca.height=t.height;var e=Ca.getContext("2d");t instanceof ImageData?e.putImageData(t,0,0):e.drawImage(t,0,0,t.width,t.height),t=Ca}return 2048<t.width||2048<t.height?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},Oa=0;o.DEFAULT_IMAGE=void 0,o.DEFAULT_MAPPING=300,o.prototype=Object.assign(Object.create(e.prototype),{constructor:o,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=Ta.generateUUID()),!e&&void 0===t.images[r.uuid]){if(Array.isArray(r))for(var n=[],a=0,o=r.length;a<o;a++)n.push(Pa.getDataURL(r[a]));else n=Pa.getDataURL(r);t.images[r.uuid]={uuid:r.uuid,url:n}}i.image=r.uuid}return e||(t.textures[this.uuid]=i),i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),0>t.x||1<t.x)switch(this.wrapS){case 1e3:t.x-=Math.floor(t.x);break;case 1001:t.x=0>t.x?0:1;break;case 1002:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(0>t.y||1<t.y)switch(this.wrapT){case 1e3:t.y-=Math.floor(t.y);break;case 1001:t.y=0>t.y?0:1;break;case 1002:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(o.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.defineProperties(s.prototype,{width:{get:function(){return this.z},set:function(t){this.z=t}},height:{get:function(){return this.w},set:function(t){this.w=t}}}),Object.assign(s.prototype,{isVector4:!0,set:function(t,e,i,r){return this.x=t,this.y=e,this.z=i,this.w=r,this},setScalar:function(t){return this.w=this.z=this.y=this.x=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(void 0,this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(void 0,this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,i=this.y,r=this.z,n=this.w;return t=t.elements,this.x=t[0]*e+t[4]*i+t[8]*r+t[12]*n,this.y=t[1]*e+t[5]*i+t[9]*r+t[13]*n,this.z=t[2]*e+t[6]*i+t[10]*r+t[14]*n,this.w=t[3]*e+t[7]*i+t[11]*r+t[15]*n,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return 1e-4>e?(this.x=1,this.z=this.y=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e=(t=t.elements)[0],i=t[4],r=t[8],n=t[1],a=t[5],o=t[9],s=t[2],c=t[6],h=t[10];return.01>Math.abs(i-n)&&.01>Math.abs(r-s)&&.01>Math.abs(o-c)?.1>Math.abs(i+n)&&.1>Math.abs(r+s)&&.1>Math.abs(o+c)&&.1>Math.abs(e+a+h-3)?(this.set(1,0,0,0),this):(t=Math.PI,h=(h+1)/2,i=(i+n)/4,r=(r+s)/4,o=(o+c)/4,(e=(e+1)/2)>(a=(a+1)/2)&&e>h?.01>e?(c=0,i=s=.707106781):(s=i/(c=Math.sqrt(e)),i=r/c):a>h?.01>a?(c=.707106781,s=0,i=.707106781):(c=i/(s=Math.sqrt(a)),i=o/s):.01>h?(s=c=.707106781,i=0):(c=r/(i=Math.sqrt(h)),s=o/i),this.set(c,s,i,t),this):(t=Math.sqrt((c-o)*(c-o)+(r-s)*(r-s)+(n-i)*(n-i)),.001>Math.abs(t)&&(t=1),this.x=(c-o)/t,this.y=(r-s)/t,this.z=(n-i)/t,this.w=Math.acos((e+a+h-1)/2),this)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this},clampLength:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,i){return void 0!==i&&void 0,this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}}),c.prototype=Object.assign(Object.create(e.prototype),{constructor:c,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.texture.image.width=t,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),h.prototype=Object.assign(Object.create(c.prototype),{constructor:h,isWebGLMultisampleRenderTarget:!0,copy:function(t){return c.prototype.copy.call(this,t),this.samples=t.samples,this}});var Ia=new n,Ha=new l,Na=new n(0,0,0),Ua=new n(1,1,1),Fa=new n,Ba=new n,za=new n;Object.assign(l.prototype,{isMatrix4:!0,set:function(t,e,i,r,n,a,o,s,c,h,l,u,p,d,f,m){var g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=r,g[1]=n,g[5]=a,g[9]=o,g[13]=s,g[2]=c,g[6]=h,g[10]=l,g[14]=u,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new l).fromArray(this.elements)},copy:function(t){var e=this.elements;return t=t.elements,e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],this},copyPosition:function(t){var e=this.elements;return t=t.elements,e[12]=t[12],e[13]=t[13],e[14]=t[14],this},extractBasis:function(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this},extractRotation:function(t){var e=this.elements,i=t.elements,r=1/Ia.setFromMatrixColumn(t,0).length(),n=1/Ia.setFromMatrixColumn(t,1).length();return t=1/Ia.setFromMatrixColumn(t,2).length(),e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=0,e[4]=i[4]*n,e[5]=i[5]*n,e[6]=i[6]*n,e[7]=0,e[8]=i[8]*t,e[9]=i[9]*t,e[10]=i[10]*t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||void 0;var e=this.elements,i=t.x,r=t.y,n=t.z,a=Math.cos(i);i=Math.sin(i);var o=Math.cos(r);r=Math.sin(r);var s=Math.cos(n);if(n=Math.sin(n),"XYZ"===t.order){t=a*s;var c=a*n,h=i*s,l=i*n;e[0]=o*s,e[4]=-o*n,e[8]=r,e[1]=c+h*r,e[5]=t-l*r,e[9]=-i*o,e[2]=l-t*r,e[6]=h+c*r,e[10]=a*o}else"YXZ"===t.order?(t=o*s,c=o*n,h=r*s,l=r*n,e[0]=t+l*i,e[4]=h*i-c,e[8]=a*r,e[1]=a*n,e[5]=a*s,e[9]=-i,e[2]=c*i-h,e[6]=l+t*i,e[10]=a*o):"ZXY"===t.order?(t=o*s,c=o*n,h=r*s,l=r*n,e[0]=t-l*i,e[4]=-a*n,e[8]=h+c*i,e[1]=c+h*i,e[5]=a*s,e[9]=l-t*i,e[2]=-a*r,e[6]=i,e[10]=a*o):"ZYX"===t.order?(t=a*s,c=a*n,h=i*s,l=i*n,e[0]=o*s,e[4]=h*r-c,e[8]=t*r+l,e[1]=o*n,e[5]=l*r+t,e[9]=c*r-h,e[2]=-r,e[6]=i*o,e[10]=a*o):"YZX"===t.order?(t=a*o,c=a*r,h=i*o,l=i*r,e[0]=o*s,e[4]=l-t*n,e[8]=h*n+c,e[1]=n,e[5]=a*s,e[9]=-i*s,e[2]=-r*s,e[6]=c*n+h,e[10]=t-l*n):"XZY"===t.order&&(t=a*o,c=a*r,h=i*o,l=i*r,e[0]=o*s,e[4]=-n,e[8]=r*s,e[1]=t*n+l,e[5]=a*s,e[9]=c*n-h,e[2]=h*n-c,e[6]=i*s,e[10]=l*n+t);return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(Na,t,Ua)},lookAt:function(t,e,i){var r=this.elements;return za.subVectors(t,e),0===za.lengthSq()&&(za.z=1),za.normalize(),Fa.crossVectors(i,za),0===Fa.lengthSq()&&(1===Math.abs(i.z)?za.x+=1e-4:za.z+=1e-4,za.normalize(),Fa.crossVectors(i,za)),Fa.normalize(),Ba.crossVectors(za,Fa),r[0]=Fa.x,r[4]=Ba.x,r[8]=za.x,r[1]=Fa.y,r[5]=Ba.y,r[9]=za.y,r[2]=Fa.z,r[6]=Ba.z,r[10]=za.z,this},multiply:function(t,e){return void 0!==e?(void 0,this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var i=t.elements,r=e.elements;e=this.elements,t=i[0];var n=i[4],a=i[8],o=i[12],s=i[1],c=i[5],h=i[9],l=i[13],u=i[2],p=i[6],d=i[10],f=i[14],m=i[3],g=i[7],v=i[11];i=i[15];var y=r[0],E=r[4],x=r[8],b=r[12],S=r[1],w=r[5],_=r[9],M=r[13],A=r[2],T=r[6],D=r[10],R=r[14],L=r[3],C=r[7],P=r[11];return r=r[15],e[0]=t*y+n*S+a*A+o*L,e[4]=t*E+n*w+a*T+o*C,e[8]=t*x+n*_+a*D+o*P,e[12]=t*b+n*M+a*R+o*r,e[1]=s*y+c*S+h*A+l*L,e[5]=s*E+c*w+h*T+l*C,e[9]=s*x+c*_+h*D+l*P,e[13]=s*b+c*M+h*R+l*r,e[2]=u*y+p*S+d*A+f*L,e[6]=u*E+p*w+d*T+f*C,e[10]=u*x+p*_+d*D+f*P,e[14]=u*b+p*M+d*R+f*r,e[3]=m*y+g*S+v*A+i*L,e[7]=m*E+g*w+v*T+i*C,e[11]=m*x+g*_+v*D+i*P,e[15]=m*b+g*M+v*R+i*r,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToBufferAttribute:function(t){for(var e=0,i=t.count;e<i;e++)Ia.x=t.getX(e),Ia.y=t.getY(e),Ia.z=t.getZ(e),Ia.applyMatrix4(this),t.setXYZ(e,Ia.x,Ia.y,Ia.z);return t},determinant:function(){var t=this.elements,e=t[0],i=t[4],r=t[8],n=t[12],a=t[1],o=t[5],s=t[9],c=t[13],h=t[2],l=t[6],u=t[10],p=t[14];return t[3]*(+n*s*l-r*c*l-n*o*u+i*c*u+r*o*p-i*s*p)+t[7]*(+e*s*p-e*c*u+n*a*u-r*a*p+r*c*h-n*s*h)+t[11]*(+e*c*l-e*o*p-n*a*l+i*a*p+n*o*h-i*c*h)+t[15]*(-r*o*h-e*s*l+e*o*u+r*a*l-i*a*u+i*s*h)},transpose:function(){var t=this.elements,e=t[1];return t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(t,e,i){var r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=i),this},getInverse:function(t,e){var i=this.elements,r=t.elements;t=r[0];var n=r[1],a=r[2],o=r[3],s=r[4],c=r[5],h=r[6],l=r[7],u=r[8],p=r[9],d=r[10],f=r[11],m=r[12],g=r[13],v=r[14],y=p*v*l-g*d*l+g*h*f-c*v*f-p*h*(r=r[15])+c*d*r,E=m*d*l-u*v*l-m*h*f+s*v*f+u*h*r-s*d*r,x=u*g*l-m*p*l+m*c*f-s*g*f-u*c*r+s*p*r,b=m*p*h-u*g*h-m*c*d+s*g*d+u*c*v-s*p*v,S=t*y+n*E+a*x+o*b;if(0===S){if(!0===e)throw Error("THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0");return void 0,this.identity()}return e=1/S,i[0]=y*e,i[1]=(g*d*o-p*v*o-g*a*f+n*v*f+p*a*r-n*d*r)*e,i[2]=(c*v*o-g*h*o+g*a*l-n*v*l-c*a*r+n*h*r)*e,i[3]=(p*h*o-c*d*o-p*a*l+n*d*l+c*a*f-n*h*f)*e,i[4]=E*e,i[5]=(u*v*o-m*d*o+m*a*f-t*v*f-u*a*r+t*d*r)*e,i[6]=(m*h*o-s*v*o-m*a*l+t*v*l+s*a*r-t*h*r)*e,i[7]=(s*d*o-u*h*o+u*a*l-t*d*l-s*a*f+t*h*f)*e,i[8]=x*e,i[9]=(m*p*o-u*g*o-m*n*f+t*g*f+u*n*r-t*p*r)*e,i[10]=(s*g*o-m*c*o+m*n*l-t*g*l-s*n*r+t*c*r)*e,i[11]=(u*c*o-s*p*o-u*n*l+t*p*l+s*n*f-t*c*f)*e,i[12]=b*e,i[13]=(u*g*a-m*p*a+m*n*d-t*g*d-u*n*v+t*p*v)*e,i[14]=(m*c*a-s*g*a-m*n*h+t*g*h+s*n*v-t*c*v)*e,i[15]=(s*p*a-u*c*a+u*n*h-t*p*h-s*n*d+t*c*d)*e,this},scale:function(t){var e=this.elements,i=t.x,r=t.y;return t=t.z,e[0]*=i,e[4]*=r,e[8]*=t,e[1]*=i,e[5]*=r,e[9]*=t,e[2]*=i,e[6]*=r,e[10]*=t,e[3]*=i,e[7]*=r,e[11]*=t,this},getMaxScaleOnAxis:function(){var t=this.elements;return Math.sqrt(Math.max(t[0]*t[0]+t[1]*t[1]+t[2]*t[2],t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t[8]*t[8]+t[9]*t[9]+t[10]*t[10]))},makeTranslation:function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t);return t=Math.sin(t),this.set(1,0,0,0,0,e,-t,0,0,t,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t);return t=Math.sin(t),this.set(e,0,t,0,0,1,0,0,-t,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t);return t=Math.sin(t),this.set(e,-t,0,0,t,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var i=Math.cos(e);e=Math.sin(e);var r=1-i,n=t.x,a=t.y;t=t.z;var o=r*n,s=r*a;return this.set(o*n+i,o*a-e*t,o*t+e*a,0,o*a+e*t,s*a+i,s*t-e*n,0,o*t-e*a,s*t+e*n,r*t*t+i,0,0,0,0,1),this},makeScale:function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(t,e,i){return this.set(1,e,i,0,t,1,i,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,i){var r=this.elements,n=e._x,a=e._y,o=e._z,s=e._w,c=n+n,h=a+a,l=o+o;e=n*c;var u=n*h;n*=l;var p=a*h;a*=l,o*=l,c*=s,h*=s,s*=l,l=i.x;var d=i.y;return i=i.z,r[0]=(1-(p+o))*l,r[1]=(u+s)*l,r[2]=(n-h)*l,r[3]=0,r[4]=(u-s)*d,r[5]=(1-(e+o))*d,r[6]=(a+c)*d,r[7]=0,r[8]=(n+h)*i,r[9]=(a-c)*i,r[10]=(1-(e+p))*i,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this},decompose:function(t,e,i){var r=this.elements,n=Ia.set(r[0],r[1],r[2]).length(),a=Ia.set(r[4],r[5],r[6]).length(),o=Ia.set(r[8],r[9],r[10]).length();0>this.determinant()&&(n=-n),t.x=r[12],t.y=r[13],t.z=r[14],Ha.copy(this),t=1/n,r=1/a;var s=1/o;return Ha.elements[0]*=t,Ha.elements[1]*=t,Ha.elements[2]*=t,Ha.elements[4]*=r,Ha.elements[5]*=r,Ha.elements[6]*=r,Ha.elements[8]*=s,Ha.elements[9]*=s,Ha.elements[10]*=s,e.setFromRotationMatrix(Ha),i.x=n,i.y=a,i.z=o,this},makePerspective:function(t,e,i,r,n,a){void 0===a&&void 0;var o=this.elements;return o[0]=2*n/(e-t),o[4]=0,o[8]=(e+t)/(e-t),o[12]=0,o[1]=0,o[5]=2*n/(i-r),o[9]=(i+r)/(i-r),o[13]=0,o[2]=0,o[6]=0,o[10]=-(a+n)/(a-n),o[14]=-2*a*n/(a-n),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(t,e,i,r,n,a){var o=this.elements,s=1/(e-t),c=1/(i-r),h=1/(a-n);return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-(e+t)*s,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-(i+r)*c,o[2]=0,o[6]=0,o[10]=-2*h,o[14]=-(a+n)*h,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(t){var e=this.elements;t=t.elements;for(var i=0;16>i;i++)if(e[i]!==t[i])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var i=0;16>i;i++)this.elements[i]=t[i+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}});var Ga=new l,ja=new r;u.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" "),u.DefaultOrder="XYZ",Object.defineProperties(u.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}}),Object.assign(u.prototype,{isEuler:!0,set:function(t,e,i,r){return this._x=t,this._y=e,this._z=i,this._order=r||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},setFromRotationMatrix:function(t,e,i){var r=Ta.clamp,n=t.elements;t=n[0];var a=n[4],o=n[8],s=n[1],c=n[5],h=n[9],l=n[2],u=n[6];return n=n[10],"XYZ"===(e=e||this._order)?(this._y=Math.asin(r(o,-1,1)),.9999999>Math.abs(o)?(this._x=Math.atan2(-h,n),this._z=Math.atan2(-a,t)):(this._x=Math.atan2(u,c),this._z=0)):"YXZ"===e?(this._x=Math.asin(-r(h,-1,1)),.9999999>Math.abs(h)?(this._y=Math.atan2(o,n),this._z=Math.atan2(s,c)):(this._y=Math.atan2(-l,t),this._z=0)):"ZXY"===e?(this._x=Math.asin(r(u,-1,1)),.9999999>Math.abs(u)?(this._y=Math.atan2(-l,n),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(s,t))):"ZYX"===e?(this._y=Math.asin(-r(l,-1,1)),.9999999>Math.abs(l)?(this._x=Math.atan2(u,n),this._z=Math.atan2(s,t)):(this._x=0,this._z=Math.atan2(-a,c))):"YZX"===e?(this._z=Math.asin(r(s,-1,1)),.9999999>Math.abs(s)?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-l,t)):(this._x=0,this._y=Math.atan2(o,n))):"XZY"===e?(this._z=Math.asin(-r(a,-1,1)),.9999999>Math.abs(a)?(this._x=Math.atan2(u,c),this._y=Math.atan2(o,t)):(this._x=Math.atan2(-h,n),this._y=0)):void 0,this._order=e,!1!==i&&this._onChangeCallback(),this},setFromQuaternion:function(t,e,i){return Ga.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Ga,e,i)},setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(t){return ja.setFromEuler(this),this.setFromQuaternion(ja,t)},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new n(this._x,this._y,this._z)},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}}),Object.assign(p.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask=this.mask|1<<t|0},enableAll:function(){this.mask=-1},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return 0!=(this.mask&t.mask)}});var Va=0,ka=new n,Wa=new r,qa=new l,Xa=new n,Ya=new n,Ja=new n,Za=new r,Ka=new n(1,0,0),Qa=new n(0,1,0),$a=new n(0,0,1),to={type:"added"},eo={type:"removed"};d.DefaultUp=new n(0,1,0),d.DefaultMatrixAutoUpdate=!0,d.prototype=Object.assign(Object.create(e.prototype),{constructor:d,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return Wa.setFromAxisAngle(t,e),this.quaternion.multiply(Wa),this},rotateOnWorldAxis:function(t,e){return Wa.setFromAxisAngle(t,e),this.quaternion.premultiply(Wa),this},rotateX:function(t){return this.rotateOnAxis(Ka,t)},rotateY:function(t){return this.rotateOnAxis(Qa,t)},rotateZ:function(t){return this.rotateOnAxis($a,t)},translateOnAxis:function(t,e){return ka.copy(t).applyQuaternion(this.quaternion),this.position.add(ka.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(Ka,t)},translateY:function(t){return this.translateOnAxis(Qa,t)},translateZ:function(t){return this.translateOnAxis($a,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(qa.getInverse(this.matrixWorld))},lookAt:function(t,e,i){t.isVector3?Xa.copy(t):Xa.set(t,e,i),t=this.parent,this.updateWorldMatrix(!0,!1),Ya.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?qa.lookAt(Ya,Xa,this.up):qa.lookAt(Xa,Ya,this.up),this.quaternion.setFromRotationMatrix(qa),t&&(qa.extractRotation(t.matrixWorld),Wa.setFromRotationMatrix(qa),this.quaternion.premultiply(Wa.inverse()))},add:function(t){if(1<arguments.length){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(void 0,this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(to)):void 0,this)},remove:function(t){if(1<arguments.length){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}return-1!==(e=this.children.indexOf(t))&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(eo)),this},attach:function(t){return this.updateWorldMatrix(!0,!1),qa.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),qa.multiply(t.parent.matrixWorld)),t.applyMatrix(qa),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var i=0,r=this.children.length;i<r;i++){var n=this.children[i].getObjectByProperty(t,e);if(void 0!==n)return n}},getWorldPosition:function(t){return void 0===t&&(void 0,t=new n),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(void 0,t=new r),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Ya,t,Ja),t},getWorldScale:function(t){return void 0===t&&(void 0,t=new n),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Ya,Za,t),t},getWorldDirection:function(t){void 0===t&&(void 0,t=new n),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var e=this.children,i=0,r=e.length;i<r;i++)e[i].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,i=0,r=e.length;i<r;i++)e[i].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,i=0,r=e.length;i<r;i++)e[i].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){var i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e)for(e=0,i=(t=this.children).length;e<i;e++)t[e].updateWorldMatrix(!1,!0)},toJSON:function(t){function e(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}function i(t){var e,i=[];for(e in t){var r=t[e];delete r.metadata,i.push(r)}return i}var r=void 0===t||"string"==typeof t,n={};r&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var a={};if(a.uuid=this.uuid,a.type=this.type,""!==this.name&&(a.name=this.name),!0===this.castShadow&&(a.castShadow=!0),!0===this.receiveShadow&&(a.receiveShadow=!0),!1===this.visible&&(a.visible=!1),!1===this.frustumCulled&&(a.frustumCulled=!1),0!==this.renderOrder&&(a.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(a.userData=this.userData),a.layers=this.layers.mask,a.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(a.matrixAutoUpdate=!1),this.isMesh&&0!==this.drawMode&&(a.drawMode=this.drawMode),this.isInstancedMesh&&(a.type="InstancedMesh",a.count=this.count,a.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){a.geometry=e(t.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes)if(o=o.shapes,Array.isArray(o))for(var s=0,c=o.length;s<c;s++)e(t.shapes,o[s]);else e(t.shapes,o)}if(void 0!==this.material)if(Array.isArray(this.material)){for(o=[],s=0,c=this.material.length;s<c;s++)o.push(e(t.materials,this.material[s]));a.material=o}else a.material=e(t.materials,this.material);if(0<this.children.length)for(a.children=[],s=0;s<this.children.length;s++)a.children.push(this.children[s].toJSON(t).object);if(r){r=i(t.geometries),s=i(t.materials),c=i(t.textures);var h=i(t.images);o=i(t.shapes),0<r.length&&(n.geometries=r),0<s.length&&(n.materials=s),0<c.length&&(n.textures=c),0<h.length&&(n.images=h),0<o.length&&(n.shapes=o)}return n.object=a,n},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(e=0;e<t.children.length;e++)this.add(t.children[e].clone());return this}}),f.prototype=Object.assign(Object.create(d.prototype),{constructor:f,isScene:!0,copy:function(t,e){return d.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=d.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e},dispose:function(){this.dispatchEvent({type:"dispose"})}});var io=[new n,new n,new n,new n,new n,new n,new n,new n],ro=new n,no=new n,ao=new n,oo=new n,so=new n,co=new n,ho=new n,lo=new n,uo=new n,po=new n,fo=new n;Object.assign(m.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,i=1/0,r=1/0,n=-1/0,a=-1/0,o=-1/0,s=0,c=t.length;s<c;s+=3){var h=t[s],l=t[s+1],u=t[s+2];h<e&&(e=h),l<i&&(i=l),u<r&&(r=u),h>n&&(n=h),l>a&&(a=l),u>o&&(o=u)}return this.min.set(e,i,r),this.max.set(n,a,o),this},setFromBufferAttribute:function(t){for(var e=1/0,i=1/0,r=1/0,n=-1/0,a=-1/0,o=-1/0,s=0,c=t.count;s<c;s++){var h=t.getX(s),l=t.getY(s),u=t.getZ(s);h<e&&(e=h),l<i&&(i=l),u<r&&(r=u),h>n&&(n=h),l>a&&(a=l),u>o&&(o=u)}return this.min.set(e,i,r),this.max.set(n,a,o),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){return e=ro.copy(e).multiplyScalar(.5),this.min.copy(t).sub(e),this.max.copy(t).add(e),this},setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(void 0,t=new n),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(void 0,t=new n),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(t){var e;t.updateWorldMatrix(!1,!1);var i=t.geometry;if(void 0!==i)if(i.isGeometry){var r=i.vertices;for(i=0,e=r.length;i<e;i++)ro.copy(r[i]),ro.applyMatrix4(t.matrixWorld),this.expandByPoint(ro)}else if(i.isBufferGeometry&&void 0!==(r=i.attributes.position))for(i=0,e=r.count;i<e;i++)ro.fromBufferAttribute(r,i).applyMatrix4(t.matrixWorld),this.expandByPoint(ro);for(i=0,e=(t=t.children).length;i<e;i++)this.expandByObject(t[i]);return this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return void 0===e&&(void 0,e=new n),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(t){return this.clampPoint(t.center,ro),ro.distanceToSquared(t.center)<=t.radius*t.radius},intersectsPlane:function(t){if(0<t.normal.x)var e=t.normal.x*this.min.x,i=t.normal.x*this.max.x;else e=t.normal.x*this.max.x,i=t.normal.x*this.min.x;return 0<t.normal.y?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),0<t.normal.z?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant},intersectsTriangle:function(t){return!this.isEmpty()&&(this.getCenter(lo),uo.subVectors(this.max,lo),no.subVectors(t.a,lo),ao.subVectors(t.b,lo),oo.subVectors(t.c,lo),so.subVectors(ao,no),co.subVectors(oo,ao),ho.subVectors(no,oo),!!g(t=[0,-so.z,so.y,0,-co.z,co.y,0,-ho.z,ho.y,so.z,0,-so.x,co.z,0,-co.x,ho.z,0,-ho.x,-so.y,so.x,0,-co.y,co.x,0,-ho.y,ho.x,0],no,ao,oo,uo)&&(!!g(t=[1,0,0,0,1,0,0,0,1],no,ao,oo,uo)&&(po.crossVectors(so,co),g(t=[po.x,po.y,po.z],no,ao,oo,uo))))},clampPoint:function(t,e){return void 0===e&&(void 0,e=new n),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return ro.copy(t).clamp(this.min,this.max).sub(t).length()},getBoundingSphere:function(t){return void 0===t&&void 0,this.getCenter(t.center),t.radius=.5*this.getSize(ro).length(),t},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(t){return this.isEmpty()||(io[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),io[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),io[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),io[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),io[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),io[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),io[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),io[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(io)),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var mo=new m;Object.assign(v.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(t,e){var i=this.center;void 0!==e?i.copy(e):mo.setFromPoints(t).getCenter(i);for(var r=e=0,n=t.length;r<n;r++)e=Math.max(e,i.distanceToSquared(t[r]));return this.radius=Math.sqrt(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var i=this.center.distanceToSquared(t);return void 0===e&&(void 0,e=new n),e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return void 0===t&&(void 0,t=new m),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius*=t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}});var go=new n,vo=new n,yo=new n,Eo=new n,xo=new n,bo=new n,So=new n;Object.assign(y.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return void 0===e&&(void 0,e=new n),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(t){return this.origin.copy(this.at(t,go)),this},closestPointToPoint:function(t,e){return void 0===e&&(void 0,e=new n),e.subVectors(t,this.origin),0>(t=e.dot(this.direction))?e.copy(this.origin):e.copy(this.direction).multiplyScalar(t).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(t){var e=go.subVectors(t,this.origin).dot(this.direction);return 0>e?this.origin.distanceToSquared(t):(go.copy(this.direction).multiplyScalar(e).add(this.origin),go.distanceToSquared(t))},distanceSqToSegment:function(t,e,i,r){vo.copy(t).add(e).multiplyScalar(.5),yo.copy(e).sub(t).normalize(),Eo.copy(this.origin).sub(vo);var n=.5*t.distanceTo(e),a=-this.direction.dot(yo),o=Eo.dot(this.direction),s=-Eo.dot(yo),c=Eo.lengthSq(),h=Math.abs(1-a*a);if(0<h){e=a*o-s;var l=n*h;0<=(t=a*s-o)?e>=-l?e<=l?a=(t*=n=1/h)*(t+a*(e*=n)+2*o)+e*(a*t+e+2*s)+c:(e=n,a=-(t=Math.max(0,-(a*e+o)))*t+e*(e+2*s)+c):(e=-n,a=-(t=Math.max(0,-(a*e+o)))*t+e*(e+2*s)+c):e<=-l?a=-(t=Math.max(0,-(-a*n+o)))*t+(e=0<t?-n:Math.min(Math.max(-n,-s),n))*(e+2*s)+c:e<=l?(t=0,a=(e=Math.min(Math.max(-n,-s),n))*(e+2*s)+c):a=-(t=Math.max(0,-(a*n+o)))*t+(e=0<t?n:Math.min(Math.max(-n,-s),n))*(e+2*s)+c}else e=0<a?-n:n,a=-(t=Math.max(0,-(a*e+o)))*t+e*(e+2*s)+c;return i&&i.copy(this.direction).multiplyScalar(t).add(this.origin),r&&r.copy(yo).multiplyScalar(e).add(vo),a},intersectSphere:function(t,e){go.subVectors(t.center,this.origin);var i=go.dot(this.direction),r=go.dot(go)-i*i;return r>(t=t.radius*t.radius)?null:(r=i-(t=Math.sqrt(t-r)),i+=t,0>r&&0>i?null:0>r?this.at(i,e):this.at(r,e))},intersectsSphere:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);return 0===e?0===t.distanceToPoint(this.origin)?0:null:0<=(t=-(this.origin.dot(t.normal)+t.constant)/e)?t:null},intersectPlane:function(t,e){return null===(t=this.distanceToPlane(t))?null:this.at(t,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||0>t.normal.dot(this.direction)*e},intersectBox:function(t,e){var i=1/this.direction.x,r=1/this.direction.y,n=1/this.direction.z,a=this.origin;if(0<=i){var o=(t.min.x-a.x)*i;i*=t.max.x-a.x}else o=(t.max.x-a.x)*i,i*=t.min.x-a.x;if(0<=r){var s=(t.min.y-a.y)*r;r*=t.max.y-a.y}else s=(t.max.y-a.y)*r,r*=t.min.y-a.y;return o>r||s>i?null:((s>o||o!=o)&&(o=s),(r<i||i!=i)&&(i=r),0<=n?(s=(t.min.z-a.z)*n,t=(t.max.z-a.z)*n):(s=(t.max.z-a.z)*n,t=(t.min.z-a.z)*n),o>t||s>i?null:((s>o||o!=o)&&(o=s),(t<i||i!=i)&&(i=t),0>i?null:this.at(0<=o?o:i,e)))},intersectsBox:function(t){return null!==this.intersectBox(t,go)},intersectTriangle:function(t,e,i,r,n){if(xo.subVectors(e,t),bo.subVectors(i,t),So.crossVectors(xo,bo),0<(e=this.direction.dot(So))){if(r)return null;r=1}else{if(!(0>e))return null;r=-1,e=-e}return Eo.subVectors(this.origin,t),0>(t=r*this.direction.dot(bo.crossVectors(Eo,bo)))||0>(i=r*this.direction.dot(xo.cross(Eo)))||t+i>e||0>(t=-r*Eo.dot(So))?null:this.at(t/e,n)},applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}});var wo=new n,_o=new n,Mo=new a;Object.assign(E.prototype,{isPlane:!0,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,i,r){return this.normal.set(t,e,i),this.constant=r,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(t,e,i){return e=wo.subVectors(i,e).cross(_o.subVectors(t,e)).normalize(),this.setFromNormalAndCoplanarPoint(e,t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return void 0===e&&(void 0,e=new n),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(t,e){void 0===e&&(void 0,e=new n);var i=t.delta(wo),r=this.normal.dot(i);if(0===r){if(0===this.distanceToPoint(t.start))return e.copy(t.start)}else if(!(0>(r=-(t.start.dot(this.normal)+this.constant)/r)||1<r))return e.copy(i).multiplyScalar(r).add(t.start)},intersectsLine:function(t){var e=this.distanceToPoint(t.start);return t=this.distanceToPoint(t.end),0>e&&0<t||0>t&&0<e},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(void 0,t=new n),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(t,e){return e=e||Mo.getNormalMatrix(t),t=this.coplanarPoint(wo).applyMatrix4(t),e=this.normal.applyMatrix3(e).normalize(),this.constant=-t.dot(e),this},translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}});var Ao=new n,To=new n,Do=new n,Ro=new n,Lo=new n,Co=new n,Po=new n,Oo=new n,Io=new n,Ho=new n;Object.assign(x,{getNormal:function(t,e,i,r){return void 0===r&&(void 0,r=new n),r.subVectors(i,e),Ao.subVectors(t,e),r.cross(Ao),0<(t=r.lengthSq())?r.multiplyScalar(1/Math.sqrt(t)):r.set(0,0,0)},getBarycoord:function(t,e,i,r,a){Ao.subVectors(r,e),To.subVectors(i,e),Do.subVectors(t,e),t=Ao.dot(Ao),e=Ao.dot(To),i=Ao.dot(Do);var o=To.dot(To);r=To.dot(Do);var s=t*o-e*e;return void 0===a&&(void 0,a=new n),0===s?a.set(-2,-1,-1):(o=(o*i-e*r)*(s=1/s),t=(t*r-e*i)*s,a.set(1-o-t,t,o))},containsPoint:function(t,e,i,r){return x.getBarycoord(t,e,i,r,Ro),0<=Ro.x&&0<=Ro.y&&1>=Ro.x+Ro.y},getUV:function(t,e,i,r,n,a,o,s){return this.getBarycoord(t,e,i,r,Ro),s.set(0,0),s.addScaledVector(n,Ro.x),s.addScaledVector(a,Ro.y),s.addScaledVector(o,Ro.z),s},isFrontFacing:function(t,e,i,r){return Ao.subVectors(i,e),To.subVectors(t,e),0>Ao.cross(To).dot(r)}}),Object.assign(x.prototype,{set:function(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this},setFromPointsAndIndices:function(t,e,i,r){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){return Ao.subVectors(this.c,this.b),To.subVectors(this.a,this.b),.5*Ao.cross(To).length()},getMidpoint:function(t){return void 0===t&&(void 0,t=new n),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return x.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(void 0,t=new E),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return x.getBarycoord(t,this.a,this.b,this.c,e)},getUV:function(t,e,i,r,n){return x.getUV(t,this.a,this.b,this.c,e,i,r,n)},containsPoint:function(t){return x.containsPoint(t,this.a,this.b,this.c)},isFrontFacing:function(t){return x.isFrontFacing(this.a,this.b,this.c,t)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(t,e){void 0===e&&(void 0,e=new n);var i=this.a,r=this.b,a=this.c;Lo.subVectors(r,i),Co.subVectors(a,i),Oo.subVectors(t,i);var o=Lo.dot(Oo),s=Co.dot(Oo);if(0>=o&&0>=s)return e.copy(i);Io.subVectors(t,r);var c=Lo.dot(Io),h=Co.dot(Io);if(0<=c&&h<=c)return e.copy(r);var l=o*h-c*s;if(0>=l&&0<=o&&0>=c)return r=o/(o-c),e.copy(i).addScaledVector(Lo,r);Ho.subVectors(t,a),t=Lo.dot(Ho);var u=Co.dot(Ho);return 0<=u&&t<=u?e.copy(a):0>=(o=t*s-o*u)&&0<=s&&0>=u?(l=s/(s-u),e.copy(i).addScaledVector(Co,l)):0>=(s=c*u-t*h)&&0<=h-c&&0<=t-u?(Po.subVectors(a,r),l=(h-c)/(h-c+(t-u)),e.copy(r).addScaledVector(Po,l)):(r=o*(a=1/(s+o+l)),l*=a,e.copy(i).addScaledVector(Lo,r).addScaledVector(Co,l))},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}});var No={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Uo={h:0,s:0,l:0},Fo={h:0,s:0,l:0};Object.assign(b.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.b=this.g=this.r=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,i){return this.r=t,this.g=e,this.b=i,this},setHSL:function(t,e,i){return t=Ta.euclideanModulo(t,1),e=Ta.clamp(e,0,1),i=Ta.clamp(i,0,1),0===e?this.r=this.g=this.b=i:(i=2*i-(e=.5>=i?i*(1+e):i+e-i*e),this.r=S(i,e,t+1/3),this.g=S(i,e,t),this.b=S(i,e,t-1/3)),this},setStyle:function(t){function e(e){void 0!==e&&1>parseFloat(e)&&void 0}var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var r=i[2];switch(i[1]){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,e(i[5]),this;if(i=/^(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,e(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r)){r=parseFloat(i[1])/360;var n=parseInt(i[2],10)/100,a=parseInt(i[3],10)/100;return e(i[5]),this.setHSL(r,n,a)}}}else if(i=/^#([A-Fa-f0-9]+)$/.exec(t)){if(3===(r=(i=i[1]).length))return this.r=parseInt(i.charAt(0)+i.charAt(0),16)/255,this.g=parseInt(i.charAt(1)+i.charAt(1),16)/255,this.b=parseInt(i.charAt(2)+i.charAt(2),16)/255,this;if(6===r)return this.r=parseInt(i.charAt(0)+i.charAt(1),16)/255,this.g=parseInt(i.charAt(2)+i.charAt(3),16)/255,this.b=parseInt(i.charAt(4)+i.charAt(5),16)/255,this}return t&&0<t.length?this.setColorName(t):this},setColorName:function(t){var e=No[t];return void 0!==e?this.setHex(e):void 0,this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){return void 0===e&&(e=2),e=0<e?1/e:1,this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(t){return this.r=w(t.r),this.g=w(t.g),this.b=w(t.b),this},copyLinearToSRGB:function(t){return this.r=_(t.r),this.g=_(t.g),this.b=_(t.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(void 0,t={h:0,s:0,l:0});var e,i=this.r,r=this.g,n=this.b,a=Math.max(i,r,n),o=Math.min(i,r,n),s=(o+a)/2;if(o===a)o=e=0;else{var c=a-o;switch(o=.5>=s?c/(a+o):c/(2-a-o),a){case i:e=(r-n)/c+(r<n?6:0);break;case r:e=(n-i)/c+2;break;case n:e=(i-r)/c+4}e/=6}return t.h=e,t.s=o,t.l=s,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,i){return this.getHSL(Uo),Uo.h+=t,Uo.s+=e,Uo.l+=i,this.setHSL(Uo.h,Uo.s,Uo.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},lerpHSL:function(t,e){this.getHSL(Uo),t.getHSL(Fo),t=Ta.lerp(Uo.h,Fo.h,e);var i=Ta.lerp(Uo.s,Fo.s,e);return e=Ta.lerp(Uo.l,Fo.l,e),this.setHSL(t,i,e),this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}}),b.NAMES=No,Object.assign(M.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,i=t.vertexNormals.length;e<i;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,i=t.vertexColors.length;e<i;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}});var Bo=0;A.prototype=Object.assign(Object.create(e.prototype),{constructor:A,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var e in t){var i=t[e];if(void 0===i)void 0;else if("shading"===e)void 0,this.flatShading=1===i;else{var r=this[e];void 0===r?void 0:r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[e]=i}}},toJSON:function(t){function e(t){var e,i=[];for(e in t){var r=t[e];delete r.metadata,i.push(r)}return i}var i=void 0===t||"string"==typeof t;i&&(t={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};return r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(r.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(t).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(t).uuid,r.reflectivity=this.reflectivity,r.refractionRatio=this.refractionRatio,void 0!==this.combine&&(r.combine=this.combine),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),0!==this.side&&(r.side=this.side),0!==this.vertexColors&&(r.vertexColors=this.vertexColors),1>this.opacity&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),0<this.alphaTest&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),1<this.wireframeLinewidth&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.morphNormals&&(r.morphNormals=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),i&&(i=e(t.textures),t=e(t.images),0<i.length&&(r.textures=i),0<t.length&&(r.images=t)),r},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexTangents=t.vertexTangents,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;var e=t.clippingPlanes,i=null;if(null!==e){var r=e.length;i=Array(r);for(var n=0;n!==r;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),T.prototype=Object.create(A.prototype),T.prototype.constructor=T,T.prototype.isMeshBasicMaterial=!0,T.prototype.copy=function(t){return A.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this},Object.defineProperty(D.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(D.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,e,i){t*=this.itemSize,i*=e.itemSize;for(var r=0,n=this.itemSize;r<n;r++)this.array[t+r]=e.array[i+r];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,i=0,r=0,n=t.length;r<n;r++){var a=t[r];void 0===a&&(void 0,a=new b),e[i++]=a.r,e[i++]=a.g,e[i++]=a.b}return this},copyVector2sArray:function(t){for(var e=this.array,r=0,n=0,a=t.length;n<a;n++){var o=t[n];void 0===o&&(void 0,o=new i),e[r++]=o.x,e[r++]=o.y}return this},copyVector3sArray:function(t){for(var e=this.array,i=0,r=0,a=t.length;r<a;r++){var o=t[r];void 0===o&&(void 0,o=new n),e[i++]=o.x,e[i++]=o.y,e[i++]=o.z}return this},copyVector4sArray:function(t){for(var e=this.array,i=0,r=0,n=t.length;r<n;r++){var a=t[r];void 0===a&&(void 0,a=new s),e[i++]=a.x,e[i++]=a.y,e[i++]=a.z,e[i++]=a.w}return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this},setXYZ:function(t,e,i,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this},setXYZW:function(t,e,i,r,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this.array[t+3]=n,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),R.prototype=Object.create(D.prototype),R.prototype.constructor=R,L.prototype=Object.create(D.prototype),L.prototype.constructor=L,C.prototype=Object.create(D.prototype),C.prototype.constructor=C,P.prototype=Object.create(D.prototype),P.prototype.constructor=P,O.prototype=Object.create(D.prototype),O.prototype.constructor=O,I.prototype=Object.create(D.prototype),I.prototype.constructor=I,H.prototype=Object.create(D.prototype),H.prototype.constructor=H,N.prototype=Object.create(D.prototype),N.prototype.constructor=N,U.prototype=Object.create(D.prototype),U.prototype.constructor=U,Object.assign(F.prototype,{computeGroups:function(t){var e=[],i=void 0;t=t.faces;for(var r=0;r<t.length;r++){var n=t[r];if(n.materialIndex!==i){i=n.materialIndex,void 0!==a&&(a.count=3*r-a.start,e.push(a));var a={start:3*r,materialIndex:i}}}void 0!==a&&(a.count=3*r-a.start,e.push(a)),this.groups=e},fromGeometry:function(t){var e=t.faces,r=t.vertices,n=t.faceVertexUvs,a=n[0]&&0<n[0].length,o=n[1]&&0<n[1].length,s=t.morphTargets,c=s.length;if(0<c){for(var h=[],l=0;l<c;l++)h[l]={name:s[l].name,data:[]};this.morphTargets.position=h}var u=t.morphNormals,p=u.length;if(0<p){var d=[];for(l=0;l<p;l++)d[l]={name:u[l].name,data:[]};this.morphTargets.normal=d}var f=t.skinIndices,m=t.skinWeights,g=f.length===r.length,v=m.length===r.length;for(0<r.length&&0===e.length&&void 0,l=0;l<e.length;l++){var y=e[l];this.vertices.push(r[y.a],r[y.b],r[y.c]);var E=y.vertexNormals;for(3===E.length?this.normals.push(E[0],E[1],E[2]):(E=y.normal,this.normals.push(E,E,E)),3===(E=y.vertexColors).length?this.colors.push(E[0],E[1],E[2]):(E=y.color,this.colors.push(E,E,E)),!0===a&&(void 0!==(E=n[0][l])?this.uvs.push(E[0],E[1],E[2]):(void 0,this.uvs.push(new i,new i,new i))),!0===o&&(void 0!==(E=n[1][l])?this.uvs2.push(E[0],E[1],E[2]):(void 0,this.uvs2.push(new i,new i,new i))),E=0;E<c;E++){var x=s[E].vertices;h[E].data.push(x[y.a],x[y.b],x[y.c])}for(E=0;E<p;E++)x=u[E].vertexNormals[l],d[E].data.push(x.a,x.b,x.c);g&&this.skinIndices.push(f[y.a],f[y.b],f[y.c]),v&&this.skinWeights.push(m[y.a],m[y.b],m[y.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}});var zo=1,Go=new l,jo=new d,Vo=new n,ko=new m,Wo=new m,qo=new n;z.prototype=Object.assign(Object.create(e.prototype),{constructor:z,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(65535<B(t)?H:O)(t,1):this.index=t},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){return this.attributes[t]=e,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,i){this.groups.push({start:t,count:e,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(t.applyToBufferAttribute(e),e.needsUpdate=!0);var i=this.attributes.normal;return void 0!==i&&((e=(new a).getNormalMatrix(t)).applyToBufferAttribute(i),i.needsUpdate=!0),void 0!==(i=this.attributes.tangent)&&((e=(new a).getNormalMatrix(t)).applyToBufferAttribute(i),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return Go.makeRotationX(t),this.applyMatrix(Go),this},rotateY:function(t){return Go.makeRotationY(t),this.applyMatrix(Go),this},rotateZ:function(t){return Go.makeRotationZ(t),this.applyMatrix(Go),this},translate:function(t,e,i){return Go.makeTranslation(t,e,i),this.applyMatrix(Go),this},scale:function(t,e,i){return Go.makeScale(t,e,i),this.applyMatrix(Go),this},lookAt:function(t){return jo.lookAt(t),jo.updateMatrix(),this.applyMatrix(jo.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Vo).negate(),this.translate(Vo.x,Vo.y,Vo.z),this},setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){t=new N(3*e.vertices.length,3);var i=new N(3*e.colors.length,3);this.setAttribute("position",t.copyVector3sArray(e.vertices)),this.setAttribute("color",i.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length&&(t=new N(e.lineDistances.length,1),this.setAttribute("lineDistance",t.copyArray(e.lineDistances))),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){for(var e=[],i=0,r=t.length;i<r;i++){var n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new N(e,3)),this},updateFromObject:function(t){var e=t.geometry;if(t.isMesh){var i=e.__directGeometry;if(!0===e.elementsNeedUpdate&&(i=void 0,e.elementsNeedUpdate=!1),void 0===i)return this.fromGeometry(e);i.verticesNeedUpdate=e.verticesNeedUpdate,i.normalsNeedUpdate=e.normalsNeedUpdate,i.colorsNeedUpdate=e.colorsNeedUpdate,i.uvsNeedUpdate=e.uvsNeedUpdate,i.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=i}return!0===e.verticesNeedUpdate&&(void 0!==(i=this.attributes.position)&&(i.copyVector3sArray(e.vertices),i.needsUpdate=!0),e.verticesNeedUpdate=!1),!0===e.normalsNeedUpdate&&(void 0!==(i=this.attributes.normal)&&(i.copyVector3sArray(e.normals),i.needsUpdate=!0),e.normalsNeedUpdate=!1),!0===e.colorsNeedUpdate&&(void 0!==(i=this.attributes.color)&&(i.copyColorsArray(e.colors),i.needsUpdate=!0),e.colorsNeedUpdate=!1),e.uvsNeedUpdate&&(void 0!==(i=this.attributes.uv)&&(i.copyVector2sArray(e.uvs),i.needsUpdate=!0),e.uvsNeedUpdate=!1),e.lineDistancesNeedUpdate&&(void 0!==(i=this.attributes.lineDistance)&&(i.copyArray(e.lineDistances),i.needsUpdate=!0),e.lineDistancesNeedUpdate=!1),e.groupsNeedUpdate&&(e.computeGroups(t.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new F).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);for(var i in this.setAttribute("position",new D(e,3).copyVector3sArray(t.vertices)),0<t.normals.length&&(e=new Float32Array(3*t.normals.length),this.setAttribute("normal",new D(e,3).copyVector3sArray(t.normals))),0<t.colors.length&&(e=new Float32Array(3*t.colors.length),this.setAttribute("color",new D(e,3).copyColorsArray(t.colors))),0<t.uvs.length&&(e=new Float32Array(2*t.uvs.length),this.setAttribute("uv",new D(e,2).copyVector2sArray(t.uvs))),0<t.uvs2.length&&(e=new Float32Array(2*t.uvs2.length),this.setAttribute("uv2",new D(e,2).copyVector2sArray(t.uvs2))),this.groups=t.groups,t.morphTargets){e=[];for(var r=t.morphTargets[i],n=0,a=r.length;n<a;n++){var o=r[n],s=new N(3*o.data.length,3);s.name=o.name,e.push(s.copyVector3sArray(o.data))}this.morphAttributes[i]=e}return 0<t.skinIndices.length&&(i=new N(4*t.skinIndices.length,4),this.setAttribute("skinIndex",i.copyVector4sArray(t.skinIndices))),0<t.skinWeights.length&&(i=new N(4*t.skinWeights.length,4),this.setAttribute("skinWeight",i.copyVector4sArray(t.skinWeights))),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new m);var t=this.attributes.position,e=this.morphAttributes.position;if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e){t=0;for(var i=e.length;t<i;t++)ko.setFromBufferAttribute(e[t]),this.boundingBox.expandByPoint(ko.min),this.boundingBox.expandByPoint(ko.max)}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&void 0},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new v);var t=this.attributes.position,e=this.morphAttributes.position;if(t){var i=this.boundingSphere.center;if(ko.setFromBufferAttribute(t),e)for(var r=0,n=e.length;r<n;r++){var a=e[r];Wo.setFromBufferAttribute(a),ko.expandByPoint(Wo.min),ko.expandByPoint(Wo.max)}ko.getCenter(i);var o=0;for(r=0,n=t.count;r<n;r++)qo.fromBufferAttribute(t,r),o=Math.max(o,i.distanceToSquared(qo));if(e)for(r=0,n=e.length;r<n;r++){t=0;for(var s=(a=e[r]).count;t<s;t++)qo.fromBufferAttribute(a,t),o=Math.max(o,i.distanceToSquared(qo))}this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&void 0}},computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes;if(e.position){var i=e.position.array;if(void 0===e.normal)this.setAttribute("normal",new D(new Float32Array(i.length),3));else for(var r=e.normal.array,a=0,o=r.length;a<o;a++)r[a]=0;r=e.normal.array;var s=new n,c=new n,h=new n,l=new n,u=new n;if(t){var p=t.array;for(a=0,o=t.count;a<o;a+=3){t=3*p[a+0];var d=3*p[a+1],f=3*p[a+2];s.fromArray(i,t),c.fromArray(i,d),h.fromArray(i,f),l.subVectors(h,c),u.subVectors(s,c),l.cross(u),r[t]+=l.x,r[t+1]+=l.y,r[t+2]+=l.z,r[d]+=l.x,r[d+1]+=l.y,r[d+2]+=l.z,r[f]+=l.x,r[f+1]+=l.y,r[f+2]+=l.z}}else for(a=0,o=i.length;a<o;a+=9)s.fromArray(i,a),c.fromArray(i,a+3),h.fromArray(i,a+6),l.subVectors(h,c),u.subVectors(s,c),l.cross(u),r[a]=l.x,r[a+1]=l.y,r[a+2]=l.z,r[a+3]=l.x,r[a+4]=l.y,r[a+5]=l.z,r[a+6]=l.x,r[a+7]=l.y,r[a+8]=l.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0,void 0);var i,r=this.attributes;for(i in r)if(void 0!==t.attributes[i]){var n=r[i].array,a=t.attributes[i],o=a.array,s=a.itemSize*e;a=Math.min(o.length,n.length-s);for(var c=0;c<a;c++,s++)n[s]=o[c]}return this}void 0},normalizeNormals:function(){for(var t=this.attributes.normal,e=0,i=t.count;e<i;e++)qo.x=t.getX(e),qo.y=t.getY(e),qo.z=t.getZ(e),qo.normalize(),t.setXYZ(e,qo.x,qo.y,qo.z)},toNonIndexed:function(){function t(t,e){var i=t.array;t=t.itemSize;for(var r,n=new i.constructor(e.length*t),a=0,o=0,s=e.length;o<s;o++){r=e[o]*t;for(var c=0;c<t;c++)n[a++]=i[r++]}return new D(n,t)}if(null===this.index)return void 0,this;var e,i=new z,r=this.index.array,n=this.attributes;for(e in n){var a=n[e];a=t(a,r),i.setAttribute(e,a)}var o=this.morphAttributes;for(e in o){var s=[],c=o[e];n=0;for(var h=c.length;n<h;n++)a=t(a=c[n],r),s.push(a);i.morphAttributes[e]=s}for(n=0,e=(r=this.groups).length;n<e;n++)a=r[n],i.addGroup(a.start,a.count,a.materialIndex);return i},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),0<Object.keys(this.userData).length&&(t.userData=this.userData),void 0!==this.parameters){var e=this.parameters;for(h in e)void 0!==e[h]&&(t[h]=e[h]);return t}t.data={attributes:{}},null!==(e=this.index)&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});var i=this.attributes;for(h in i){var r=(e=i[h]).toJSON();""!==e.name&&(r.name=e.name),t.data.attributes[h]=r}i={};var n=!1;for(h in this.morphAttributes){for(var a=this.morphAttributes[h],o=[],s=0,c=a.length;s<c;s++)r=(e=a[s]).toJSON(),""!==e.name&&(r.name=e.name),o.push(r);0<o.length&&(i[h]=o,n=!0)}n&&(t.data.morphAttributes=i);var h=this.groups;return 0<h.length&&(t.data.groups=JSON.parse(JSON.stringify(h))),null!==(h=this.boundingSphere)&&(t.data.boundingSphere={center:h.center.toArray(),radius:h.radius}),t},clone:function(){return(new z).copy(this)},copy:function(t){var e;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingSphere=this.boundingBox=null,this.name=t.name;var i=t.index;for(o in null!==i&&this.setIndex(i.clone()),i=t.attributes)this.setAttribute(o,i[o].clone());var r=t.morphAttributes;for(o in r){var n=[],a=r[o];for(i=0,e=a.length;i<e;i++)n.push(a[i].clone());this.morphAttributes[o]=n}var o=t.groups;for(i=0,e=o.length;i<e;i++)r=o[i],this.addGroup(r.start,r.count,r.materialIndex);return null!==(o=t.boundingBox)&&(this.boundingBox=o.clone()),null!==(o=t.boundingSphere)&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Xo=new l,Yo=new y,Jo=new v,Zo=new n,Ko=new n,Qo=new n,$o=new n,ts=new n,es=new n,is=new n,rs=new n,ns=new n,as=new i,os=new i,ss=new i,cs=new n,hs=new n;G.prototype=Object.assign(Object.create(d.prototype),{constructor:G,isMesh:!0,setDrawMode:function(t){this.drawMode=t},copy:function(t){return d.prototype.copy.call(this,t),this.drawMode=t.drawMode,void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t=this.geometry;if(t.isBufferGeometry){t=t.morphAttributes;var e=Object.keys(t);if(0<e.length){var i=t[e[0]];if(void 0!==i)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=i.length;t<e;t++){var r=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}}else void 0!==(t=t.morphTargets)&&0<t.length&&void 0},raycast:function(t,e){var r=this.geometry,n=this.material,a=this.matrixWorld;if(void 0!==n&&(null===r.boundingSphere&&r.computeBoundingSphere(),Jo.copy(r.boundingSphere),Jo.applyMatrix4(a),!1!==t.ray.intersectsSphere(Jo)&&(Xo.getInverse(a),Yo.copy(t.ray).applyMatrix4(Xo),null===r.boundingBox||!1!==Yo.intersectsBox(r.boundingBox))))if(0!==this.drawMode)void 0;else if(r.isBufferGeometry){var o=r.index;a=r.attributes.position;var s,c,h=r.morphAttributes.position,l=r.attributes.uv,u=r.attributes.uv2,p=r.groups,d=r.drawRange;if(null!==o)if(Array.isArray(n)){var f=0;for(s=p.length;f<s;f++){var m=p[f],g=n[m.materialIndex],v=Math.max(m.start,d.start);for(c=r=Math.min(m.start+m.count,d.start+d.count);v<c;v+=3){r=o.getX(v);var y=o.getX(v+1),E=o.getX(v+2);(r=V(this,g,t,Yo,a,h,l,u,r,y,E))&&(r.faceIndex=Math.floor(v/3),r.face.materialIndex=m.materialIndex,e.push(r))}}}else for(f=v=Math.max(0,d.start),s=r=Math.min(o.count,d.start+d.count);f<s;f+=3)r=o.getX(f),y=o.getX(f+1),E=o.getX(f+2),(r=V(this,n,t,Yo,a,h,l,u,r,y,E))&&(r.faceIndex=Math.floor(f/3),e.push(r));else if(void 0!==a)if(Array.isArray(n))for(f=0,s=p.length;f<s;f++)for(g=n[(m=p[f]).materialIndex],v=Math.max(m.start,d.start),c=r=Math.min(m.start+m.count,d.start+d.count);v<c;v+=3)(r=V(this,g,t,Yo,a,h,l,u,r=v,y=v+1,E=v+2))&&(r.faceIndex=Math.floor(v/3),r.face.materialIndex=m.materialIndex,e.push(r));else for(f=v=Math.max(0,d.start),s=r=Math.min(a.count,d.start+d.count);f<s;f+=3)(r=V(this,n,t,Yo,a,h,l,u,r=f,y=f+1,E=f+2))&&(r.faceIndex=Math.floor(f/3),e.push(r))}else if(r.isGeometry)for(a=Array.isArray(n),h=r.vertices,l=r.faces,0<(r=r.faceVertexUvs[0]).length&&(o=r),f=0,s=l.length;f<s;f++)m=l[f],void 0!==(r=a?n[m.materialIndex]:n)&&(u=h[m.a],p=h[m.b],d=h[m.c],r=j(this,r,t,Yo,u,p,d,cs))&&(o&&o[f]&&(g=o[f],as.copy(g[0]),os.copy(g[1]),ss.copy(g[2]),r.uv=x.getUV(cs,u,p,d,as,os,ss,new i)),r.face=m,r.faceIndex=f,e.push(r))},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var ls=0,us=new l,ps=new d,ds=new n;k.prototype=Object.assign(Object.create(e.prototype),{constructor:k,isGeometry:!0,applyMatrix:function(t){for(var e=(new a).getNormalMatrix(t),i=0,r=this.vertices.length;i<r;i++)this.vertices[i].applyMatrix4(t);for(i=0,r=this.faces.length;i<r;i++){(t=this.faces[i]).normal.applyMatrix3(e).normalize();for(var n=0,o=t.vertexNormals.length;n<o;n++)t.vertexNormals[n].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.normalsNeedUpdate=this.verticesNeedUpdate=!0,this},rotateX:function(t){return us.makeRotationX(t),this.applyMatrix(us),this},rotateY:function(t){return us.makeRotationY(t),this.applyMatrix(us),this},rotateZ:function(t){return us.makeRotationZ(t),this.applyMatrix(us),this},translate:function(t,e,i){return us.makeTranslation(t,e,i),this.applyMatrix(us),this},scale:function(t,e,i){return us.makeScale(t,e,i),this.applyMatrix(us),this},lookAt:function(t){return ps.lookAt(t),ps.updateMatrix(),this.applyMatrix(ps.matrix),this},fromBufferGeometry:function(t){function e(t,e,a,o){var s=void 0===h?[]:[r.colors[t].clone(),r.colors[e].clone(),r.colors[a].clone()];o=new M(t,e,a,void 0===c?[]:[(new n).fromArray(c,3*t),(new n).fromArray(c,3*e),(new n).fromArray(c,3*a)],s,o),r.faces.push(o),void 0!==l&&r.faceVertexUvs[0].push([(new i).fromArray(l,2*t),(new i).fromArray(l,2*e),(new i).fromArray(l,2*a)]),void 0!==u&&r.faceVertexUvs[1].push([(new i).fromArray(u,2*t),(new i).fromArray(u,2*e),(new i).fromArray(u,2*a)])}var r=this,a=null!==t.index?t.index.array:void 0,o=t.attributes;if(void 0===o.position)return void 0,this;var s=o.position.array,c=void 0!==o.normal?o.normal.array:void 0,h=void 0!==o.color?o.color.array:void 0,l=void 0!==o.uv?o.uv.array:void 0,u=void 0!==o.uv2?o.uv2.array:void 0;for(void 0!==u&&(this.faceVertexUvs[1]=[]),o=0;o<s.length;o+=3)r.vertices.push((new n).fromArray(s,o)),void 0!==h&&r.colors.push((new b).fromArray(h,o));var p=t.groups;if(0<p.length)for(o=0;o<p.length;o++){var d=(s=p[o]).start,f=d;for(d+=s.count;f<d;f+=3)void 0!==a?e(a[f],a[f+1],a[f+2],s.materialIndex):e(f,f+1,f+2,s.materialIndex)}else if(void 0!==a)for(o=0;o<a.length;o+=3)e(a[o],a[o+1],a[o+2]);else for(o=0;o<s.length/3;o+=3)e(o,o+1,o+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(ds).negate(),this.translate(ds.x,ds.y,ds.z),this},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius;e=0===e?1:1/e;var i=new l;return i.set(e,0,0,-e*t.x,0,e,0,-e*t.y,0,0,e,-e*t.z,0,0,0,1),this.applyMatrix(i),this},computeFaceNormals:function(){for(var t=new n,e=new n,i=0,r=this.faces.length;i<r;i++){var a=this.faces[i],o=this.vertices[a.a],s=this.vertices[a.b];t.subVectors(this.vertices[a.c],s),e.subVectors(o,s),t.cross(e),t.normalize(),a.normal.copy(t)}},computeVertexNormals:function(t){var e;void 0===t&&(t=!0);var i=Array(this.vertices.length),r=0;for(e=this.vertices.length;r<e;r++)i[r]=new n;if(t){var a=new n,o=new n;for(t=0,r=this.faces.length;t<r;t++){e=this.faces[t];var s=this.vertices[e.a],c=this.vertices[e.b],h=this.vertices[e.c];a.subVectors(h,c),o.subVectors(s,c),a.cross(o),i[e.a].add(a),i[e.b].add(a),i[e.c].add(a)}}else for(this.computeFaceNormals(),t=0,r=this.faces.length;t<r;t++)i[(e=this.faces[t]).a].add(e.normal),i[e.b].add(e.normal),i[e.c].add(e.normal);for(r=0,e=this.vertices.length;r<e;r++)i[r].normalize();for(t=0,r=this.faces.length;t<r;t++)3===(s=(e=this.faces[t]).vertexNormals).length?(s[0].copy(i[e.a]),s[1].copy(i[e.b]),s[2].copy(i[e.c])):(s[0]=i[e.a].clone(),s[1]=i[e.b].clone(),s[2]=i[e.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t;this.computeFaceNormals();var e=0;for(t=this.faces.length;e<t;e++){var i=this.faces[e],r=i.vertexNormals;3===r.length?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,i=0;for(e=this.faces.length;i<e;i++){var r=this.faces[i];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);var a=0;for(t=r.vertexNormals.length;a<t;a++)r.__originalVertexNormals[a]?r.__originalVertexNormals[a].copy(r.vertexNormals[a]):r.__originalVertexNormals[a]=r.vertexNormals[a].clone()}var o=new k;for(o.faces=this.faces,a=0,t=this.morphTargets.length;a<t;a++){if(!this.morphNormals[a]){this.morphNormals[a]={},this.morphNormals[a].faceNormals=[],this.morphNormals[a].vertexNormals=[],r=this.morphNormals[a].faceNormals;var s=this.morphNormals[a].vertexNormals;for(i=0,e=this.faces.length;i<e;i++){var c=new n,h={a:new n,b:new n,c:new n};r.push(c),s.push(h)}}for(s=this.morphNormals[a],o.vertices=this.morphTargets[a].vertices,o.computeFaceNormals(),o.computeVertexNormals(),i=0,e=this.faces.length;i<e;i++)r=this.faces[i],c=s.faceNormals[i],h=s.vertexNormals[i],c.copy(r.normal),h.a.copy(r.vertexNormals[0]),h.b.copy(r.vertexNormals[1]),h.c.copy(r.vertexNormals[2])}for(i=0,e=this.faces.length;i<e;i++)(r=this.faces[i]).normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new m),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new v),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,i){if(t&&t.isGeometry){var r,n=this.vertices.length,o=this.vertices,s=t.vertices,c=this.faces,h=t.faces,l=this.colors,u=t.colors;void 0===i&&(i=0),void 0!==e&&(r=(new a).getNormalMatrix(e));for(var p=0,d=s.length;p<d;p++){var f=s[p].clone();void 0!==e&&f.applyMatrix4(e),o.push(f)}for(p=0,d=u.length;p<d;p++)l.push(u[p].clone());for(p=0,d=h.length;p<d;p++){var m=(s=h[p]).vertexNormals;for(u=s.vertexColors,(l=new M(s.a+n,s.b+n,s.c+n)).normal.copy(s.normal),void 0!==r&&l.normal.applyMatrix3(r).normalize(),e=0,o=m.length;e<o;e++)f=m[e].clone(),void 0!==r&&f.applyMatrix3(r).normalize(),l.vertexNormals.push(f);for(l.color.copy(s.color),e=0,o=u.length;e<o;e++)f=u[e],l.vertexColors.push(f.clone());l.materialIndex=s.materialIndex+i,c.push(l)}for(p=0,d=t.faceVertexUvs.length;p<d;p++)for(i=t.faceVertexUvs[p],void 0===this.faceVertexUvs[p]&&(this.faceVertexUvs[p]=[]),e=0,o=i.length;e<o;e++){for(n=[],c=0,h=(r=i[e]).length;c<h;c++)n.push(r[c].clone());this.faceVertexUvs[p].push(n)}}else void 0},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):void 0},mergeVertices:function(){var t,e={},i=[],r=[],n=Math.pow(10,4),a=0;for(t=this.vertices.length;a<t;a++){var o=this.vertices[a];void 0===e[o=Math.round(o.x*n)+"_"+Math.round(o.y*n)+"_"+Math.round(o.z*n)]?(e[o]=a,i.push(this.vertices[a]),r[a]=i.length-1):r[a]=r[e[o]]}for(e=[],a=0,t=this.faces.length;a<t;a++)for((n=this.faces[a]).a=r[n.a],n.b=r[n.b],n.c=r[n.c],n=[n.a,n.b,n.c],o=0;3>o;o++)if(n[o]===n[(o+1)%3]){e.push(a);break}for(a=e.length-1;0<=a;a--)for(n=e[a],this.faces.splice(n,1),r=0,t=this.faceVertexUvs.length;r<t;r++)this.faceVertexUvs[r].splice(n,1);return a=this.vertices.length-i.length,this.vertices=i,a},setFromPoints:function(t){this.vertices=[];for(var e=0,i=t.length;e<i;e++){var r=t[e];this.vertices.push(new n(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,i=0;i<e;i++)t[i]._id=i;t.sort((function(t,e){return t.materialIndex-e.materialIndex}));var r,n,a=this.faceVertexUvs[0],o=this.faceVertexUvs[1];for(a&&a.length===e&&(r=[]),o&&o.length===e&&(n=[]),i=0;i<e;i++){var s=t[i]._id;r&&r.push(a[s]),n&&n.push(o[s])}r&&(this.faceVertexUvs[0]=r),n&&(this.faceVertexUvs[1]=n)},toJSON:function(){function t(t,e,i){return i?t|1<<e:t&~(1<<e)}function e(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==h[e]||(h[e]=c.length/3,c.push(t.x,t.y,t.z)),h[e]}function i(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==u[e]||(u[e]=l.length,l.push(t.getHex())),u[e]}function r(t){var e=t.x.toString()+t.y.toString();return void 0!==d[e]||(d[e]=p.length/2,p.push(t.x,t.y)),d[e]}var n={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),void 0!==this.parameters){var a,o=this.parameters;for(a in o)void 0!==o[a]&&(n[a]=o[a]);return n}for(o=[],a=0;a<this.vertices.length;a++){var s=this.vertices[a];o.push(s.x,s.y,s.z)}s=[];var c=[],h={},l=[],u={},p=[],d={};for(a=0;a<this.faces.length;a++){var f=this.faces[a],m=void 0!==this.faceVertexUvs[0][a],g=0<f.normal.length(),v=0<f.vertexNormals.length,y=1!==f.color.r||1!==f.color.g||1!==f.color.b,E=0<f.vertexColors.length,x=0;x=t(x,0,0),x=t(x,1,!0),x=t(x,2,!1),x=t(x,3,m),x=t(x,4,g),x=t(x,5,v),x=t(x,6,y),x=t(x,7,E),s.push(x),s.push(f.a,f.b,f.c),s.push(f.materialIndex),m&&(m=this.faceVertexUvs[0][a],s.push(r(m[0]),r(m[1]),r(m[2]))),g&&s.push(e(f.normal)),v&&(g=f.vertexNormals,s.push(e(g[0]),e(g[1]),e(g[2]))),y&&s.push(i(f.color)),E&&(f=f.vertexColors,s.push(i(f[0]),i(f[1]),i(f[2])))}return n.data={},n.data.vertices=o,n.data.normals=c,0<l.length&&(n.data.colors=l),0<p.length&&(n.data.uvs=[p]),n.data.faces=s,n},clone:function(){return(new k).copy(this)},copy:function(t){var e,i,r;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.name=t.name;var n=t.vertices,a=0;for(e=n.length;a<e;a++)this.vertices.push(n[a].clone());for(a=0,e=(n=t.colors).length;a<e;a++)this.colors.push(n[a].clone());for(a=0,e=(n=t.faces).length;a<e;a++)this.faces.push(n[a].clone());for(a=0,e=t.faceVertexUvs.length;a<e;a++){var o=t.faceVertexUvs[a];for(void 0===this.faceVertexUvs[a]&&(this.faceVertexUvs[a]=[]),n=0,i=o.length;n<i;n++){var s=o[n],c=[],h=0;for(r=s.length;h<r;h++)c.push(s[h].clone());this.faceVertexUvs[a].push(c)}}for(a=0,e=(h=t.morphTargets).length;a<e;a++){if((r={}).name=h[a].name,void 0!==h[a].vertices)for(r.vertices=[],n=0,i=h[a].vertices.length;n<i;n++)r.vertices.push(h[a].vertices[n].clone());if(void 0!==h[a].normals)for(r.normals=[],n=0,i=h[a].normals.length;n<i;n++)r.normals.push(h[a].normals[n].clone());this.morphTargets.push(r)}for(a=0,e=(h=t.morphNormals).length;a<e;a++){if(r={},void 0!==h[a].vertexNormals)for(r.vertexNormals=[],n=0,i=h[a].vertexNormals.length;n<i;n++)o=h[a].vertexNormals[n],(s={}).a=o.a.clone(),s.b=o.b.clone(),s.c=o.c.clone(),r.vertexNormals.push(s);if(void 0!==h[a].faceNormals)for(r.faceNormals=[],n=0,i=h[a].faceNormals.length;n<i;n++)r.faceNormals.push(h[a].faceNormals[n].clone());this.morphNormals.push(r)}for(a=0,e=(n=t.skinWeights).length;a<e;a++)this.skinWeights.push(n[a].clone());for(a=0,e=(n=t.skinIndices).length;a<e;a++)this.skinIndices.push(n[a].clone());for(a=0,e=(n=t.lineDistances).length;a<e;a++)this.lineDistances.push(n[a]);return null!==(a=t.boundingBox)&&(this.boundingBox=a.clone()),null!==(a=t.boundingSphere)&&(this.boundingSphere=a.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var fs=function(t){function e(e,i,r,n,a,o){t.call(this),this.type="BoxGeometry",this.parameters={width:e,height:i,depth:r,widthSegments:n,heightSegments:a,depthSegments:o},this.fromBufferGeometry(new ms(e,i,r,n,a,o)),this.mergeVertices()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e}(k),ms=function(t){function e(e,i,r,a,o,s){function c(t,e,i,r,a,o,s,c,g,v,y){var E=o/g,x=s/v,b=o/2,S=s/2,w=c/2;s=g+1;var _,M,A=v+1,T=o=0,D=new n;for(M=0;M<A;M++){var R=M*x-S;for(_=0;_<s;_++)D[t]=(_*E-b)*r,D[e]=R*a,D[i]=w,u.push(D.x,D.y,D.z),D[t]=0,D[e]=0,D[i]=0<c?1:-1,p.push(D.x,D.y,D.z),d.push(_/g),d.push(1-M/v),o+=1}for(M=0;M<v;M++)for(_=0;_<g;_++)t=f+_+s*(M+1),e=f+(_+1)+s*(M+1),i=f+(_+1)+s*M,l.push(f+_+s*M,t,i),l.push(t,e,i),T+=6;h.addGroup(m,T,y),m+=T,f+=o}t.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:i,depth:r,widthSegments:a,heightSegments:o,depthSegments:s};var h=this;e=e||1,i=i||1,r=r||1,a=Math.floor(a)||1,o=Math.floor(o)||1,s=Math.floor(s)||1;var l=[],u=[],p=[],d=[],f=0,m=0;c("z","y","x",-1,-1,r,i,e,s,o,0),c("z","y","x",1,-1,r,i,-e,s,o,1),c("x","z","y",1,1,e,r,i,a,s,2),c("x","z","y",1,-1,e,r,-i,a,s,3),c("x","y","z",1,-1,e,i,r,a,o,4),c("x","y","z",-1,-1,e,i,-r,a,o,5),this.setIndex(l),this.setAttribute("position",new N(u,3)),this.setAttribute("normal",new N(p,3)),this.setAttribute("uv",new N(d,2))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e}(z),gs={clone:W,merge:q};X.prototype=Object.create(A.prototype),X.prototype.constructor=X,X.prototype.isShaderMaterial=!0,X.prototype.copy=function(t){return A.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=W(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},X.prototype.toJSON=function(t){var e=A.prototype.toJSON.call(this,t);for(var i in e.uniforms={},this.uniforms){var r=this.uniforms[i].value;e.uniforms[i]=r&&r.isTexture?{type:"t",value:r.toJSON(t).uuid}:r&&r.isColor?{type:"c",value:r.getHex()}:r&&r.isVector2?{type:"v2",value:r.toArray()}:r&&r.isVector3?{type:"v3",value:r.toArray()}:r&&r.isVector4?{type:"v4",value:r.toArray()}:r&&r.isMatrix3?{type:"m3",value:r.toArray()}:r&&r.isMatrix4?{type:"m4",value:r.toArray()}:{value:r}}for(var n in 0<Object.keys(this.defines).length&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,t={},this.extensions)!0===this.extensions[n]&&(t[n]=!0);return 0<Object.keys(t).length&&(e.extensions=t),e},Y.prototype=Object.assign(Object.create(d.prototype),{constructor:Y,isCamera:!0,copy:function(t,e){return d.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(void 0,t=new n),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){d.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),J.prototype=Object.assign(Object.create(Y.prototype),{constructor:J,isPerspectiveCamera:!0,copy:function(t,e){return Y.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){t=.5*this.getFilmHeight()/t,this.fov=2*Ta.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*Ta.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*Ta.RAD2DEG*Math.atan(Math.tan(.5*Ta.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,i,r,n,a){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*Ta.DEG2RAD*this.fov)/this.zoom,i=2*e,r=this.aspect*i,n=-.5*r,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;n+=a.offsetX*r/o,e-=a.offsetY*i/s,r*=a.width/o,i*=a.height/s}0!==(a=this.filmOffset)&&(n+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,e,e-i,t,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){return(t=d.prototype.toJSON.call(this,t)).object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),Z.prototype=Object.create(d.prototype),Z.prototype.constructor=Z,K.prototype=Object.create(c.prototype),K.prototype.constructor=K,K.prototype.isWebGLRenderTargetCube=!0,K.prototype.fromEquirectangularTexture=function(t,e){this.texture.type=e.type,this.texture.format=e.format,this.texture.encoding=e.encoding;var i=new f,r=new X({type:"CubemapFromEquirect",uniforms:W({tEquirect:{value:null}}),vertexShader:"varying vec3 vWorldDirection;\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",fragmentShader:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}",side:1,blending:0});return r.uniforms.tEquirect.value=e,e=new G(new ms(5,5,5),r),i.add(e),(r=new Z(1,10,1)).renderTarget=this,r.renderTarget.texture.name="CubeCameraTexture",r.update(t,i),e.geometry.dispose(),e.material.dispose(),this},Q.prototype=Object.create(o.prototype),Q.prototype.constructor=Q,Q.prototype.isDataTexture=!0;var vs=new v,ys=new n;Object.assign($.prototype,{set:function(t,e,i,r,n,a){var o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(i),o[3].copy(r),o[4].copy(n),o[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,i=0;6>i;i++)e[i].copy(t.planes[i]);return this},setFromMatrix:function(t){var e=this.planes,i=t.elements;t=i[0];var r=i[1],n=i[2],a=i[3],o=i[4],s=i[5],c=i[6],h=i[7],l=i[8],u=i[9],p=i[10],d=i[11],f=i[12],m=i[13],g=i[14];return i=i[15],e[0].setComponents(a-t,h-o,d-l,i-f).normalize(),e[1].setComponents(a+t,h+o,d+l,i+f).normalize(),e[2].setComponents(a+r,h+s,d+u,i+m).normalize(),e[3].setComponents(a-r,h-s,d-u,i-m).normalize(),e[4].setComponents(a-n,h-c,d-p,i-g).normalize(),e[5].setComponents(a+n,h+c,d+p,i+g).normalize(),this},intersectsObject:function(t){var e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),vs.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(vs)},intersectsSprite:function(t){return vs.center.set(0,0,0),vs.radius=.7071067811865476,vs.applyMatrix4(t.matrixWorld),this.intersectsSphere(vs)},intersectsSphere:function(t){var e=this.planes,i=t.center;t=-t.radius;for(var r=0;6>r;r++)if(e[r].distanceToPoint(i)<t)return!1;return!0},intersectsBox:function(t){for(var e=this.planes,i=0;6>i;i++){var r=e[i];if(ys.x=0<r.normal.x?t.max.x:t.min.x,ys.y=0<r.normal.y?t.max.y:t.min.y,ys.z=0<r.normal.z?t.max.z:t.min.z,0>r.distanceToPoint(ys))return!1}return!0},containsPoint:function(t){for(var e=this.planes,i=0;6>i;i++)if(0>e[i].distanceToPoint(t))return!1;return!0}});var Es={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\ttransformedNormal = mat3( instanceMatrix ) * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = normalMatrix * objectTangent;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = saturate( clearcoat );\tmaterial.clearcoatRoughness = clamp( clearcoatRoughness, 0.04, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( pointLight.shadow, directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( spotLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( directionalLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\t#ifdef USE_TANGENT\n\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, normalScale, normalMap );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec2 normalScale, in sampler2D normalMap ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy *= normalScale;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tbool frontFacing = dot( cross( S, T ), N ) > 0.0;\n\t\t\tmapN.xy *= ( float( frontFacing ) * 2.0 - 1.0 );\n\t\t#else\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 vTBN = mat3( tangent, bitangent, clearcoatNormal );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = clearcoatNormalScale * mapN.xy;\n\t\tclearcoatNormal = normalize( vTBN * mapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatNormalScale, clearcoatNormalMap );\n\t#endif\n#endif",clearcoat_normalmap_pars_fragment:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 encodeHalfRGBA ( vec2 v ) {\n\tvec4 encoded = vec4( 0.0 );\n\tconst vec2 offset = vec2( 1.0 / 255.0, 0.0 );\n\tencoded.xy = vec2( v.x, fract( v.x * 255.0 ) );\n\tencoded.xy = encoded.xy - ( encoded.yy * offset );\n\tencoded.zw = vec2( v.y, fract( v.y * 255.0 ) );\n\tencoded.zw = encoded.zw - ( encoded.ww * offset );\n\treturn encoded;\n}\nvec2 decodeHalfRGBA( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn decodeHalfRGBA( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = ( floor( uv * size - 0.5 ) + 0.5 ) * texelSize;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= all( bvec2( directionalLight.shadow, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= all( bvec2( spotLight.shadow, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= all( bvec2( pointLight.shadow, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},xs={common:{diffuse:{value:new b(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new a},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new i(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new b(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new b(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new a}},sprite:{diffuse:{value:new b(15658734)},opacity:{value:1},center:{value:new i(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new a}}},bs={basic:{uniforms:q([xs.common,xs.specularmap,xs.envmap,xs.aomap,xs.lightmap,xs.fog]),vertexShader:Es.meshbasic_vert,fragmentShader:Es.meshbasic_frag},lambert:{uniforms:q([xs.common,xs.specularmap,xs.envmap,xs.aomap,xs.lightmap,xs.emissivemap,xs.fog,xs.lights,{emissive:{value:new b(0)}}]),vertexShader:Es.meshlambert_vert,fragmentShader:Es.meshlambert_frag},phong:{uniforms:q([xs.common,xs.specularmap,xs.envmap,xs.aomap,xs.lightmap,xs.emissivemap,xs.bumpmap,xs.normalmap,xs.displacementmap,xs.gradientmap,xs.fog,xs.lights,{emissive:{value:new b(0)},specular:{value:new b(1118481)},shininess:{value:30}}]),vertexShader:Es.meshphong_vert,fragmentShader:Es.meshphong_frag},standard:{uniforms:q([xs.common,xs.envmap,xs.aomap,xs.lightmap,xs.emissivemap,xs.bumpmap,xs.normalmap,xs.displacementmap,xs.roughnessmap,xs.metalnessmap,xs.fog,xs.lights,{emissive:{value:new b(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Es.meshphysical_vert,fragmentShader:Es.meshphysical_frag},matcap:{uniforms:q([xs.common,xs.bumpmap,xs.normalmap,xs.displacementmap,xs.fog,{matcap:{value:null}}]),vertexShader:Es.meshmatcap_vert,fragmentShader:Es.meshmatcap_frag},points:{uniforms:q([xs.points,xs.fog]),vertexShader:Es.points_vert,fragmentShader:Es.points_frag},dashed:{uniforms:q([xs.common,xs.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Es.linedashed_vert,fragmentShader:Es.linedashed_frag},depth:{uniforms:q([xs.common,xs.displacementmap]),vertexShader:Es.depth_vert,fragmentShader:Es.depth_frag},normal:{uniforms:q([xs.common,xs.bumpmap,xs.normalmap,xs.displacementmap,{opacity:{value:1}}]),vertexShader:Es.normal_vert,fragmentShader:Es.normal_frag},sprite:{uniforms:q([xs.sprite,xs.fog]),vertexShader:Es.sprite_vert,fragmentShader:Es.sprite_frag},background:{uniforms:{uvTransform:{value:new a},t2D:{value:null}},vertexShader:Es.background_vert,fragmentShader:Es.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Es.cube_vert,fragmentShader:Es.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Es.equirect_vert,fragmentShader:Es.equirect_frag},distanceRGBA:{uniforms:q([xs.common,xs.displacementmap,{referencePosition:{value:new n},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Es.distanceRGBA_vert,fragmentShader:Es.distanceRGBA_frag},shadow:{uniforms:q([xs.lights,xs.fog,{color:{value:new b(0)},opacity:{value:1}}]),vertexShader:Es.shadow_vert,fragmentShader:Es.shadow_frag}};bs.physical={uniforms:q([bs.standard.uniforms,{transparency:{value:0},clearcoat:{value:0},clearcoatRoughness:{value:0},sheen:{value:new b(0)},clearcoatNormalScale:{value:new i(1,1)},clearcoatNormalMap:{value:null}}]),vertexShader:Es.meshphysical_vert,fragmentShader:Es.meshphysical_frag},it.prototype=Object.create(k.prototype),it.prototype.constructor=it,rt.prototype=Object.create(z.prototype),rt.prototype.constructor=rt,mt.prototype=Object.create(o.prototype),mt.prototype.constructor=mt,mt.prototype.isCubeTexture=!0,Object.defineProperty(mt.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),gt.prototype=Object.create(o.prototype),gt.prototype.constructor=gt,gt.prototype.isDataTexture2DArray=!0,vt.prototype=Object.create(o.prototype),vt.prototype.constructor=vt,vt.prototype.isDataTexture3D=!0;var Ss=new o,ws=new gt,_s=new vt,Ms=new mt,As=[],Ts=[],Ds=new Float32Array(16),Rs=new Float32Array(9),Ls=new Float32Array(4);Kt.prototype.updateCache=function(t){var e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),xt(e,t)},Qt.prototype.setValue=function(t,e,i){for(var r=this.seq,n=0,a=r.length;n!==a;++n){var o=r[n];o.setValue(t,e[o.id],i)}};var Cs=/([\w\d_]+)(\])?(\[|\.)?/g;$t.prototype.setValue=function(t,e,i,r){void 0!==(e=this.map[e])&&e.setValue(t,i,r)},$t.prototype.setOptional=function(t,e,i){void 0!==(e=e[i])&&this.setValue(t,i,e)},$t.upload=function(t,e,i,r){for(var n=0,a=e.length;n!==a;++n){var o=e[n],s=i[o.id];!1!==s.needsUpdate&&o.setValue(t,s.value,r)}},$t.seqWithValue=function(t,e){for(var i=[],r=0,n=t.length;r!==n;++r){var a=t[r];a.id in e&&i.push(a)}return i};var Ps=0,Os=/^[ \t]*#include +<([\w\d./]+)>/gm,Is=/#pragma unroll_loop[\s]+?for \( int i = (\d+); i < (\d+); i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Hs=0;_e.prototype=Object.create(A.prototype),_e.prototype.constructor=_e,_e.prototype.isMeshDepthMaterial=!0,_e.prototype.copy=function(t){return A.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},Me.prototype=Object.create(A.prototype),Me.prototype.constructor=Me,Me.prototype.isMeshDistanceMaterial=!0,Me.prototype.copy=function(t){return A.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this},Le.prototype=Object.assign(Object.create(c.prototype),{constructor:Le,isWebGLMultiviewRenderTarget:!0,copy:function(t){return c.prototype.copy.call(this,t),this.numViews=t.numViews,this},setNumViews:function(t){return this.numViews!==t&&(this.numViews=t,this.dispose()),this}}),Pe.prototype=Object.assign(Object.create(d.prototype),{constructor:Pe,isGroup:!0}),Oe.prototype=Object.assign(Object.create(J.prototype),{constructor:Oe,isArrayCamera:!0});var Ns=new n,Us=new n;Object.assign(He.prototype,e.prototype),Object.assign(Ne.prototype,e.prototype),Object.assign(Fe.prototype,{isFogExp2:!0,clone:function(){return new Fe(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(Be.prototype,{isFog:!0,clone:function(){return new Be(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(ze.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(ze.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,e,i){t*=this.stride,i*=e.stride;for(var r=0,n=this.stride;r<n;r++)this.array[t+r]=e.array[i+r];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}}),Object.defineProperties(Ge.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Ge.prototype,{isInterleavedBufferAttribute:!0,setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this},setXYZ:function(t,e,i,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=r,this},setXYZW:function(t,e,i,r,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=r,this.data.array[t+3]=n,this}}),je.prototype=Object.create(A.prototype),je.prototype.constructor=je,je.prototype.isSpriteMaterial=!0,je.prototype.copy=function(t){return A.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};var Fs,Bs=new n,zs=new n,Gs=new n,js=new i,Vs=new i,ks=new l,Ws=new n,qs=new n,Xs=new n,Ys=new i,Js=new i,Zs=new i;Ve.prototype=Object.assign(Object.create(d.prototype),{constructor:Ve,isSprite:!0,raycast:function(t,e){null===t.camera&&void 0,zs.setFromMatrixScale(this.matrixWorld),ks.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Gs.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&zs.multiplyScalar(-Gs.z);var r=this.material.rotation;if(0!==r)var n=Math.cos(r),a=Math.sin(r);r=this.center,ke(Ws.set(-.5,-.5,0),Gs,r,zs,a,n),ke(qs.set(.5,-.5,0),Gs,r,zs,a,n),ke(Xs.set(.5,.5,0),Gs,r,zs,a,n),Ys.set(0,0),Js.set(1,0),Zs.set(1,1);var o=t.ray.intersectTriangle(Ws,qs,Xs,!1,Bs);null===o&&(ke(qs.set(-.5,.5,0),Gs,r,zs,a,n),Js.set(0,1),null===(o=t.ray.intersectTriangle(Ws,Xs,qs,!1,Bs)))||(a=t.ray.origin.distanceTo(Bs))<t.near||a>t.far||e.push({distance:a,point:Bs.clone(),uv:x.getUV(Bs,Ws,qs,Xs,Ys,Js,Zs,new i),face:null,object:this})},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(t){return d.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this}});var Ks=new n,Qs=new n;We.prototype=Object.assign(Object.create(d.prototype),{constructor:We,isLOD:!0,copy:function(t){d.prototype.copy.call(this,t,!1);for(var e=0,i=(t=t.levels).length;e<i;e++){var r=t[e];this.addLevel(r.object.clone(),r.distance)}return this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);for(var i=this.levels,r=0;r<i.length&&!(e<i[r].distance);r++);return i.splice(r,0,{distance:e,object:t}),this.add(t),this},getObjectForDistance:function(t){for(var e=this.levels,i=1,r=e.length;i<r&&!(t<e[i].distance);i++);return e[i-1].object},raycast:function(t,e){Ks.setFromMatrixPosition(this.matrixWorld);var i=t.ray.origin.distanceTo(Ks);this.getObjectForDistance(i).raycast(t,e)},update:function(t){var e=this.levels;if(1<e.length){Ks.setFromMatrixPosition(t.matrixWorld),Qs.setFromMatrixPosition(this.matrixWorld),t=Ks.distanceTo(Qs),e[0].object.visible=!0;for(var i=1,r=e.length;i<r&&t>=e[i].distance;i++)e[i-1].object.visible=!1,e[i].object.visible=!0;for(;i<r;i++)e[i].object.visible=!1}},toJSON:function(t){(t=d.prototype.toJSON.call(this,t)).object.levels=[];for(var e=this.levels,i=0,r=e.length;i<r;i++){var n=e[i];t.object.levels.push({object:n.object.uuid,distance:n.distance})}return t}}),qe.prototype=Object.assign(Object.create(G.prototype),{constructor:qe,isSkinnedMesh:!0,bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var t=new s,e=this.geometry.attributes.skinWeight,i=0,r=e.count;i<r;i++){t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.w=e.getW(i);var n=1/t.manhattanLength();1/0!==n?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){G.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):void 0},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var $s=new l,tc=new l;Object.assign(Xe.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var i=new l;this.bones[t]&&i.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(i)}},pose:function(){var t,e,i=0;for(e=this.bones.length;i<e;i++)(t=this.bones[i])&&t.matrixWorld.getInverse(this.boneInverses[i]);for(i=0,e=this.bones.length;i<e;i++)(t=this.bones[i])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){for(var t=this.bones,e=this.boneInverses,i=this.boneMatrices,r=this.boneTexture,n=0,a=t.length;n<a;n++)$s.multiplyMatrices(t[n]?t[n].matrixWorld:tc,e[n]),$s.toArray(i,16*n);void 0!==r&&(r.needsUpdate=!0)},clone:function(){return new Xe(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,i=this.bones.length;e<i;e++){var r=this.bones[e];if(r.name===t)return r}}}),Ye.prototype=Object.assign(Object.create(d.prototype),{constructor:Ye,isBone:!0}),Je.prototype=Object.assign(Object.create(G.prototype),{constructor:Je,isInstancedMesh:!0,raycast:function(){},setMatrixAt:function(t,e){e.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){}}),Ze.prototype=Object.create(A.prototype),Ze.prototype.constructor=Ze,Ze.prototype.isLineBasicMaterial=!0,Ze.prototype.copy=function(t){return A.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this};var ec=new n,ic=new n,rc=new l,nc=new y,ac=new v;Ke.prototype=Object.assign(Object.create(d.prototype),{constructor:Ke,isLine:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,i=[0],r=1,n=e.count;r<n;r++)ec.fromBufferAttribute(e,r-1),ic.fromBufferAttribute(e,r),i[r]=i[r-1],i[r]+=ec.distanceTo(ic);t.setAttribute("lineDistance",new N(i,1))}else void 0;else if(t.isGeometry)for(e=t.vertices,(i=t.lineDistances)[0]=0,r=1,n=e.length;r<n;r++)i[r]=i[r-1],i[r]+=e[r-1].distanceTo(e[r]);return this},raycast:function(t,e){var i=t.linePrecision,r=this.geometry,a=this.matrixWorld;if(null===r.boundingSphere&&r.computeBoundingSphere(),ac.copy(r.boundingSphere),ac.applyMatrix4(a),ac.radius+=i,!1!==t.ray.intersectsSphere(ac)){rc.getInverse(a),nc.copy(t.ray).applyMatrix4(rc),i/=(this.scale.x+this.scale.y+this.scale.z)/3,i*=i;var o=new n,s=new n;a=new n;var c=new n,h=this&&this.isLineSegments?2:1;if(r.isBufferGeometry){var l=r.index,u=r.attributes.position.array;if(null!==l){r=0;for(var p=(l=l.array).length-1;r<p;r+=h){var d=l[r+1];o.fromArray(u,3*l[r]),s.fromArray(u,3*d),(d=nc.distanceSqToSegment(o,s,c,a))>i||(c.applyMatrix4(this.matrixWorld),(d=t.ray.origin.distanceTo(c))<t.near||d>t.far||e.push({distance:d,point:a.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this}))}}else for(r=0,p=u.length/3-1;r<p;r+=h)o.fromArray(u,3*r),s.fromArray(u,3*r+3),(d=nc.distanceSqToSegment(o,s,c,a))>i||(c.applyMatrix4(this.matrixWorld),(d=t.ray.origin.distanceTo(c))<t.near||d>t.far||e.push({distance:d,point:a.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this}))}else if(r.isGeometry)for(s=(o=r.vertices).length,r=0;r<s-1;r+=h)(d=nc.distanceSqToSegment(o[r],o[r+1],c,a))>i||(c.applyMatrix4(this.matrixWorld),(d=t.ray.origin.distanceTo(c))<t.near||d>t.far||e.push({distance:d,point:a.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this}))}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var oc=new n,sc=new n;Qe.prototype=Object.assign(Object.create(Ke.prototype),{constructor:Qe,isLineSegments:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,i=[],r=0,n=e.count;r<n;r+=2)oc.fromBufferAttribute(e,r),sc.fromBufferAttribute(e,r+1),i[r]=0===r?0:i[r-1],i[r+1]=i[r]+oc.distanceTo(sc);t.setAttribute("lineDistance",new N(i,1))}else void 0;else if(t.isGeometry)for(e=t.vertices,i=t.lineDistances,r=0,n=e.length;r<n;r+=2)oc.copy(e[r]),sc.copy(e[r+1]),i[r]=0===r?0:i[r-1],i[r+1]=i[r]+oc.distanceTo(sc);return this}}),$e.prototype=Object.assign(Object.create(Ke.prototype),{constructor:$e,isLineLoop:!0}),ti.prototype=Object.create(A.prototype),ti.prototype.constructor=ti,ti.prototype.isPointsMaterial=!0,ti.prototype.copy=function(t){return A.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};var cc=new l,hc=new y,lc=new v,uc=new n;ei.prototype=Object.assign(Object.create(d.prototype),{constructor:ei,isPoints:!0,raycast:function(t,e){var i=this.geometry,r=this.matrixWorld,n=t.params.Points.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),lc.copy(i.boundingSphere),lc.applyMatrix4(r),lc.radius+=n,!1!==t.ray.intersectsSphere(lc))if(cc.getInverse(r),hc.copy(t.ray).applyMatrix4(cc),n/=(this.scale.x+this.scale.y+this.scale.z)/3,n*=n,i.isBufferGeometry){var a=i.index;if(i=i.attributes.position.array,null!==a){var o=a.array;a=0;for(var s=o.length;a<s;a++){var c=o[a];uc.fromArray(i,3*c),ii(uc,c,n,r,t,e,this)}}else for(a=0,o=i.length/3;a<o;a++)uc.fromArray(i,3*a),ii(uc,a,n,r,t,e,this)}else for(a=0,o=(i=i.vertices).length;a<o;a++)ii(i[a],a,n,r,t,e,this)},updateMorphTargets:function(){var t=this.geometry;if(t.isBufferGeometry){t=t.morphAttributes;var e=Object.keys(t);if(0<e.length){var i=t[e[0]];if(void 0!==i)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=i.length;t<e;t++){var r=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}}else void 0!==(t=t.morphTargets)&&0<t.length&&void 0},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),ri.prototype=Object.assign(Object.create(o.prototype),{constructor:ri,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),ni.prototype=Object.create(o.prototype),ni.prototype.constructor=ni,ni.prototype.isCompressedTexture=!0,ai.prototype=Object.create(o.prototype),ai.prototype.constructor=ai,ai.prototype.isCanvasTexture=!0,oi.prototype=Object.create(o.prototype),oi.prototype.constructor=oi,oi.prototype.isDepthTexture=!0,si.prototype=Object.create(z.prototype),si.prototype.constructor=si,ci.prototype=Object.create(k.prototype),ci.prototype.constructor=ci,hi.prototype=Object.create(z.prototype),hi.prototype.constructor=hi,li.prototype=Object.create(k.prototype),li.prototype.constructor=li,ui.prototype=Object.create(z.prototype),ui.prototype.constructor=ui,pi.prototype=Object.create(k.prototype),pi.prototype.constructor=pi,di.prototype=Object.create(ui.prototype),di.prototype.constructor=di,fi.prototype=Object.create(k.prototype),fi.prototype.constructor=fi,mi.prototype=Object.create(ui.prototype),mi.prototype.constructor=mi,gi.prototype=Object.create(k.prototype),gi.prototype.constructor=gi,vi.prototype=Object.create(ui.prototype),vi.prototype.constructor=vi,yi.prototype=Object.create(k.prototype),yi.prototype.constructor=yi,Ei.prototype=Object.create(ui.prototype),Ei.prototype.constructor=Ei,xi.prototype=Object.create(k.prototype),xi.prototype.constructor=xi,bi.prototype=Object.create(z.prototype),bi.prototype.constructor=bi,bi.prototype.toJSON=function(){var t=z.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t},Si.prototype=Object.create(k.prototype),Si.prototype.constructor=Si,wi.prototype=Object.create(z.prototype),wi.prototype.constructor=wi,_i.prototype=Object.create(k.prototype),_i.prototype.constructor=_i,Mi.prototype=Object.create(z.prototype),Mi.prototype.constructor=Mi;var pc=function(t,e,i){i=i||2;var r,n=e&&e.length,a=n?e[0]*i:t.length,o=Ai(t,0,a,i,!0),s=[];if(!o||o.next===o.prev)return s;if(n){var c,h=i;n=[];var l=0;for(c=e.length;l<c;l++){var u=e[l]*h;(u=Ai(t,u,l<c-1?e[l+1]*h:t.length,h,!1))===u.next&&(u.steiner=!0),n.push(Pi(u))}for(n.sort(Ri),l=0;l<n.length;l++)(h=Li(e=n[l],h=o))&&Ti(e=Fi(h,e),e.next),o=Ti(o,o.next)}if(t.length>80*i){var p=r=t[0],d=n=t[1];for(h=i;h<a;h+=i)(l=t[h])<p&&(p=l),(e=t[h+1])<d&&(d=e),l>r&&(r=l),e>n&&(n=e);r=0!==(r=Math.max(r-p,n-d))?1/r:0}return function t(e,i,r,n,a,o,s){if(e){if(!s&&o){var c=e,h=c;do{null===h.z&&(h.z=Ci(h.x,h.y,n,a,o)),h.prevZ=h.prev,h=h.nextZ=h.next}while(h!==c);h.prevZ.nextZ=null,h.prevZ=null,c=h;var l,u,p,d,f=1;do{h=c;var m=c=null;for(u=0;h;){u++;var g=h;for(l=p=0;l<f&&(p++,g=g.nextZ);l++);for(d=f;0<p||0<d&&g;)0!==p&&(0===d||!g||h.z<=g.z)?(l=h,h=h.nextZ,p--):(l=g,g=g.nextZ,d--),m?m.nextZ=l:c=l,l.prevZ=m,m=l;h=g}m.nextZ=null,f*=2}while(1<u)}for(c=e;e.prev!==e.next;){if(h=e.prev,g=e.next,o)m=Di(e,n,a,o);else t:if(m=e,u=m.prev,p=m,f=m.next,0<=Ii(u,p,f))m=!1;else{for(l=m.next.next;l!==m.prev;){if(Oi(u.x,u.y,p.x,p.y,f.x,f.y,l.x,l.y)&&0<=Ii(l.prev,l,l.next)){m=!1;break t}l=l.next}m=!0}if(m)i.push(h.i/r),i.push(e.i/r),i.push(g.i/r),zi(e),c=e=g.next;else if((e=g)===c){if(s){if(1===s){s=i,c=r,h=e;do{!Hi(g=h.prev,m=h.next.next)&&Ni(g,h,h.next,m)&&Ui(g,m)&&Ui(m,g)&&(s.push(g.i/c),s.push(h.i/c),s.push(m.i/c),zi(h),zi(h.next),h=e=m),h=h.next}while(h!==e);t(e=h,i,r,n,a,o,2)}else if(2===s)t:{s=e;do{for(c=s.next.next;c!==s.prev;){if(h=s.i!==c.i){if(g=c,m=(h=s).next.i!==g.i&&h.prev.i!==g.i){e:{m=h;do{if(m.i!==h.i&&m.next.i!==h.i&&m.i!==g.i&&m.next.i!==g.i&&Ni(m,m.next,h,g)){m=!0;break e}m=m.next}while(m!==h);m=!1}m=!m}if(m=m&&Ui(h,g)&&Ui(g,h)){m=h,u=!1,p=(h.x+g.x)/2,g=(h.y+g.y)/2;do{m.y>g!=m.next.y>g&&m.next.y!==m.y&&p<(m.next.x-m.x)*(g-m.y)/(m.next.y-m.y)+m.x&&(u=!u),m=m.next}while(m!==h);m=u}h=m}if(h){e=Fi(s,c),s=Ti(s,s.next),e=Ti(e,e.next),t(s,i,r,n,a,o),t(e,i,r,n,a,o);break t}c=c.next}s=s.next}while(s!==e)}}else t(Ti(e),i,r,n,a,o,1);break}}}}(o,s,i,p,d,r),s},dc={area:function(t){for(var e=t.length,i=0,r=e-1,n=0;n<e;r=n++)i+=t[r].x*t[n].y-t[n].x*t[r].y;return.5*i},isClockWise:function(t){return 0>dc.area(t)},triangulateShape:function(t,e){var i=[],r=[],n=[];ji(t),Vi(i,t);var a=t.length;for(e.forEach(ji),t=0;t<e.length;t++)r.push(a),a+=e[t].length,Vi(i,e[t]);for(e=pc(i,r),t=0;t<e.length;t+=3)n.push(e.slice(t,t+3));return n}};ki.prototype=Object.create(k.prototype),ki.prototype.constructor=ki,ki.prototype.toJSON=function(){var t=k.prototype.toJSON.call(this);return qi(this.parameters.shapes,this.parameters.options,t)},Wi.prototype=Object.create(z.prototype),Wi.prototype.constructor=Wi,Wi.prototype.toJSON=function(){var t=z.prototype.toJSON.call(this);return qi(this.parameters.shapes,this.parameters.options,t)};var fc={generateTopUV:function(t,e,r,n,a){t=e[3*n],n=e[3*n+1];var o=e[3*a];return a=e[3*a+1],[new i(e[3*r],e[3*r+1]),new i(t,n),new i(o,a)]},generateSideWallUV:function(t,e,r,n,a,o){t=e[3*r];var s=e[3*r+1];r=e[3*r+2];var c=e[3*n],h=e[3*n+1];n=e[3*n+2];var l=e[3*a],u=e[3*a+1];a=e[3*a+2];var p=e[3*o],d=e[3*o+1];return e=e[3*o+2],.01>Math.abs(s-h)?[new i(t,1-r),new i(c,1-n),new i(l,1-a),new i(p,1-e)]:[new i(s,1-r),new i(h,1-n),new i(u,1-a),new i(d,1-e)]}};Xi.prototype=Object.create(k.prototype),Xi.prototype.constructor=Xi,Yi.prototype=Object.create(Wi.prototype),Yi.prototype.constructor=Yi,Ji.prototype=Object.create(k.prototype),Ji.prototype.constructor=Ji,Zi.prototype=Object.create(z.prototype),Zi.prototype.constructor=Zi,Ki.prototype=Object.create(k.prototype),Ki.prototype.constructor=Ki,Qi.prototype=Object.create(z.prototype),Qi.prototype.constructor=Qi,$i.prototype=Object.create(k.prototype),$i.prototype.constructor=$i,tr.prototype=Object.create(z.prototype),tr.prototype.constructor=tr,er.prototype=Object.create(k.prototype),er.prototype.constructor=er,er.prototype.toJSON=function(){var t=k.prototype.toJSON.call(this);return rr(this.parameters.shapes,t)},ir.prototype=Object.create(z.prototype),ir.prototype.constructor=ir,ir.prototype.toJSON=function(){var t=z.prototype.toJSON.call(this);return rr(this.parameters.shapes,t)},nr.prototype=Object.create(z.prototype),nr.prototype.constructor=nr,ar.prototype=Object.create(k.prototype),ar.prototype.constructor=ar,or.prototype=Object.create(z.prototype),or.prototype.constructor=or,sr.prototype=Object.create(ar.prototype),sr.prototype.constructor=sr,cr.prototype=Object.create(or.prototype),cr.prototype.constructor=cr,hr.prototype=Object.create(k.prototype),hr.prototype.constructor=hr,lr.prototype=Object.create(z.prototype),lr.prototype.constructor=lr;var mc=Object.freeze({__proto__:null,WireframeGeometry:si,ParametricGeometry:ci,ParametricBufferGeometry:hi,TetrahedronGeometry:pi,TetrahedronBufferGeometry:di,OctahedronGeometry:fi,OctahedronBufferGeometry:mi,IcosahedronGeometry:gi,IcosahedronBufferGeometry:vi,DodecahedronGeometry:yi,DodecahedronBufferGeometry:Ei,PolyhedronGeometry:li,PolyhedronBufferGeometry:ui,TubeGeometry:xi,TubeBufferGeometry:bi,TorusKnotGeometry:Si,TorusKnotBufferGeometry:wi,TorusGeometry:_i,TorusBufferGeometry:Mi,TextGeometry:Xi,TextBufferGeometry:Yi,SphereGeometry:Ji,SphereBufferGeometry:Zi,RingGeometry:Ki,RingBufferGeometry:Qi,PlaneGeometry:it,PlaneBufferGeometry:rt,LatheGeometry:$i,LatheBufferGeometry:tr,ShapeGeometry:er,ShapeBufferGeometry:ir,ExtrudeGeometry:ki,ExtrudeBufferGeometry:Wi,EdgesGeometry:nr,ConeGeometry:sr,ConeBufferGeometry:cr,CylinderGeometry:ar,CylinderBufferGeometry:or,CircleGeometry:hr,CircleBufferGeometry:lr,BoxGeometry:fs,BoxBufferGeometry:ms});ur.prototype=Object.create(A.prototype),ur.prototype.constructor=ur,ur.prototype.isShadowMaterial=!0,ur.prototype.copy=function(t){return A.prototype.copy.call(this,t),this.color.copy(t.color),this},pr.prototype=Object.create(X.prototype),pr.prototype.constructor=pr,pr.prototype.isRawShaderMaterial=!0,dr.prototype=Object.create(A.prototype),dr.prototype.constructor=dr,dr.prototype.isMeshStandardMaterial=!0,dr.prototype.copy=function(t){return A.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},fr.prototype=Object.create(dr.prototype),fr.prototype.constructor=fr,fr.prototype.isMeshPhysicalMaterial=!0,fr.prototype.copy=function(t){return dr.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.reflectivity=t.reflectivity,this.clearcoat=t.clearcoat,this.clearcoatRoughness=t.clearcoatRoughness,this.sheen=t.sheen?(this.sheen||new b).copy(t.sheen):null,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.transparency=t.transparency,this},mr.prototype=Object.create(A.prototype),mr.prototype.constructor=mr,mr.prototype.isMeshPhongMaterial=!0,mr.prototype.copy=function(t){return A.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},gr.prototype=Object.create(mr.prototype),gr.prototype.constructor=gr,gr.prototype.isMeshToonMaterial=!0,gr.prototype.copy=function(t){return mr.prototype.copy.call(this,t),this.gradientMap=t.gradientMap,this},vr.prototype=Object.create(A.prototype),vr.prototype.constructor=vr,vr.prototype.isMeshNormalMaterial=!0,vr.prototype.copy=function(t){return A.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},yr.prototype=Object.create(A.prototype),yr.prototype.constructor=yr,yr.prototype.isMeshLambertMaterial=!0,yr.prototype.copy=function(t){return A.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Er.prototype=Object.create(A.prototype),Er.prototype.constructor=Er,Er.prototype.isMeshMatcapMaterial=!0,Er.prototype.copy=function(t){return A.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},xr.prototype=Object.create(Ze.prototype),xr.prototype.constructor=xr,xr.prototype.isLineDashedMaterial=!0,xr.prototype.copy=function(t){return Ze.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var gc=Object.freeze({__proto__:null,ShadowMaterial:ur,SpriteMaterial:je,RawShaderMaterial:pr,ShaderMaterial:X,PointsMaterial:ti,MeshPhysicalMaterial:fr,MeshStandardMaterial:dr,MeshPhongMaterial:mr,MeshToonMaterial:gr,MeshNormalMaterial:vr,MeshLambertMaterial:yr,MeshDepthMaterial:_e,MeshDistanceMaterial:Me,MeshBasicMaterial:T,MeshMatcapMaterial:Er,LineDashedMaterial:xr,LineBasicMaterial:Ze,Material:A}),vc={arraySlice:function(t,e,i){return vc.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==i?i:t.length)):t.slice(e,i)},convertArray:function(t,e,i){return!t||!i&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,i=Array(e),r=0;r!==e;++r)i[r]=r;return i.sort((function(e,i){return t[e]-t[i]})),i},sortedArray:function(t,e,i){for(var r=t.length,n=new t.constructor(r),a=0,o=0;o!==r;++a)for(var s=i[a]*e,c=0;c!==e;++c)n[o++]=t[s+c];return n},flattenJSON:function(t,e,i,r){for(var n=1,a=t[0];void 0!==a&&void 0===a[r];)a=t[n++];if(void 0!==a){var o=a[r];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[r])&&(e.push(a.time),i.push.apply(i,o)),a=t[n++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[r])&&(e.push(a.time),o.toArray(i,i.length)),a=t[n++]}while(void 0!==a);else do{void 0!==(o=a[r])&&(e.push(a.time),i.push(o)),a=t[n++]}while(void 0!==a)}},subclip:function(t,e,i,r,n){n=n||30,(t=t.clone()).name=e;var a=[];for(e=0;e<t.tracks.length;++e){for(var o=t.tracks[e],s=o.getValueSize(),c=[],h=[],l=0;l<o.times.length;++l){var u=o.times[l]*n;if(!(u<i||u>=r))for(c.push(o.times[l]),u=0;u<s;++u)h.push(o.values[l*s+u])}0!==c.length&&(o.times=vc.convertArray(c,o.times.constructor),o.values=vc.convertArray(h,o.values.constructor),a.push(o))}for(t.tracks=a,i=1/0,e=0;e<t.tracks.length;++e)i>t.tracks[e].times[0]&&(i=t.tracks[e].times[0]);for(e=0;e<t.tracks.length;++e)t.tracks[e].shift(-1*i);return t.resetDuration(),t}};Object.assign(br.prototype,{evaluate:function(t){var e=this.parameterPositions,i=this._cachedIndex,r=e[i],n=e[i-1];t:{e:{i:{r:if(!(t<r)){for(var a=i+2;;){if(void 0===r){if(t<n)break r;return this._cachedIndex=i=e.length,this.afterEnd_(i-1,t,n)}if(i===a)break;if(n=r,t<(r=e[++i]))break e}r=e.length;break i}if(t>=n)break t;for(t<(a=e[1])&&(i=2,n=a),a=i-2;;){if(void 0===n)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(i===a)break;if(r=n,t>=(n=e[--i-1]))break e}r=i,i=0}for(;i<r;)t<e[n=i+r>>>1]?r=n:i=n+1;if(r=e[i],void 0===(n=e[i-1]))return this._cachedIndex=0,this.beforeStart_(0,t,r);if(void 0===r)return this._cachedIndex=i=e.length,this.afterEnd_(i-1,n,t)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,t,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){var e=this.resultBuffer,i=this.sampleValues,r=this.valueSize;t*=r;for(var n=0;n!==r;++n)e[n]=i[t+n];return e},interpolate_:function(){throw Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(br.prototype,{beforeStart_:br.prototype.copySampleValue_,afterEnd_:br.prototype.copySampleValue_}),Sr.prototype=Object.assign(Object.create(br.prototype),{constructor:Sr,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(t,e,i){var r=this.parameterPositions,n=t-2,a=t+1,o=r[n],s=r[a];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:n=t,o=2*e-i;break;case 2402:o=e+r[n=r.length-2]-r[n+1];break;default:n=t,o=i}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:a=t,s=2*i-e;break;case 2402:a=1,s=i+r[1]-r[0];break;default:a=t-1,s=e}t=.5*(i-e),r=this.valueSize,this._weightPrev=t/(e-o),this._weightNext=t/(s-i),this._offsetPrev=n*r,this._offsetNext=a*r},interpolate_:function(t,e,i,r){var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(t*=o)-o,c=this._offsetPrev,h=this._offsetNext,l=this._weightPrev,u=this._weightNext,p=(i-e)/(r-e);for(e=-l*(r=(i=p*p)*p)+2*l*i-l*p,l=(1+l)*r+(-1.5-2*l)*i+(-.5+l)*p+1,p=(-1-u)*r+(1.5+u)*i+.5*p,u=u*r-u*i,i=0;i!==o;++i)n[i]=e*a[c+i]+l*a[s+i]+p*a[t+i]+u*a[h+i];return n}}),wr.prototype=Object.assign(Object.create(br.prototype),{constructor:wr,interpolate_:function(t,e,i,r){var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(t*=o)-o;for(i=1-(e=(i-e)/(r-e)),r=0;r!==o;++r)n[r]=a[s+r]*i+a[t+r]*e;return n}}),_r.prototype=Object.assign(Object.create(br.prototype),{constructor:_r,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(Mr,{toJSON:function(t){var e=t.constructor;if(void 0!==e.toJSON)e=e.toJSON(t);else{e={name:t.name,times:vc.convertArray(t.times,Array),values:vc.convertArray(t.values,Array)};var i=t.getInterpolation();i!==t.DefaultInterpolation&&(e.interpolation=i)}return e.type=t.ValueTypeName,e}}),Object.assign(Mr.prototype,{constructor:Mr,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(t){return new _r(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new wr(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new Sr(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){switch(t){case 2300:var e=this.InterpolantFactoryMethodDiscrete;break;case 2301:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){if(e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name,void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw Error(e);this.setInterpolation(this.DefaultInterpolation)}return void 0,this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,i=0,r=e.length;i!==r;++i)e[i]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,i=0,r=e.length;i!==r;++i)e[i]*=t;return this},trim:function(t,e){for(var i=this.times,r=i.length,n=0,a=r-1;n!==r&&i[n]<t;)++n;for(;-1!==a&&i[a]>e;)--a;return++a,0===n&&a===r||(n>=a&&(n=(a=Math.max(a,1))-1),t=this.getValueSize(),this.times=vc.arraySlice(i,n,a),this.values=vc.arraySlice(this.values,n*t,a*t)),this},validate:function(){var t=!0,e=this.getValueSize();0!=e-Math.floor(e)&&(void 0,t=!1);var i=this.times;e=this.values;var r=i.length;0===r&&(void 0,t=!1);for(var n=null,a=0;a!==r;a++){var o=i[a];if("number"==typeof o&&isNaN(o)){void 0,t=!1;break}if(null!==n&&n>o){void 0,t=!1;break}n=o}if(void 0!==e&&vc.isTypedArray(e))for(a=0,i=e.length;a!==i;++a)if(r=e[a],isNaN(r)){void 0,t=!1;break}return t},optimize:function(){for(var t=this.times,e=this.values,i=this.getValueSize(),r=2302===this.getInterpolation(),n=1,a=t.length-1,o=1;o<a;++o){var s=!1,c=t[o];if(c!==t[o+1]&&(1!==o||c!==c[0]))if(r)s=!0;else{var h=o*i,l=h-i,u=h+i;for(c=0;c!==i;++c){var p=e[h+c];if(p!==e[l+c]||p!==e[u+c]){s=!0;break}}}if(s){if(o!==n)for(t[n]=t[o],s=o*i,h=n*i,c=0;c!==i;++c)e[h+c]=e[s+c];++n}}if(0<a){for(t[n]=t[a],s=a*i,h=n*i,c=0;c!==i;++c)e[h+c]=e[s+c];++n}return n!==t.length&&(this.times=vc.arraySlice(t,0,n),this.values=vc.arraySlice(e,0,n*i)),this},clone:function(){var t=vc.arraySlice(this.times,0),e=vc.arraySlice(this.values,0);return(t=new this.constructor(this.name,t,e)).createInterpolant=this.createInterpolant,t}}),Ar.prototype=Object.assign(Object.create(Mr.prototype),{constructor:Ar,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Tr.prototype=Object.assign(Object.create(Mr.prototype),{constructor:Tr,ValueTypeName:"color"}),Dr.prototype=Object.assign(Object.create(Mr.prototype),{constructor:Dr,ValueTypeName:"number"}),Rr.prototype=Object.assign(Object.create(br.prototype),{constructor:Rr,interpolate_:function(t,e,i,n){var a=this.resultBuffer,o=this.sampleValues,s=this.valueSize;for(e=(i-e)/(n-e),i=(t*=s)+s;t!==i;t+=4)r.slerpFlat(a,0,o,t-s,o,t,e);return a}}),Lr.prototype=Object.assign(Object.create(Mr.prototype),{constructor:Lr,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(t){return new Rr(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),Cr.prototype=Object.assign(Object.create(Mr.prototype),{constructor:Cr,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Pr.prototype=Object.assign(Object.create(Mr.prototype),{constructor:Pr,ValueTypeName:"vector"}),Object.assign(Or,{parse:function(t){for(var e=[],i=t.tracks,r=1/(t.fps||1),n=0,a=i.length;n!==a;++n)e.push(Ir(i[n]).scale(r));return new Or(t.name,t.duration,e)},toJSON:function(t){var e=[],i=t.tracks;t={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid};for(var r=0,n=i.length;r!==n;++r)e.push(Mr.toJSON(i[r]));return t},CreateFromMorphTargetSequence:function(t,e,i,r){for(var n=e.length,a=[],o=0;o<n;o++){var s=[],c=[];s.push((o+n-1)%n,o,(o+1)%n),c.push(0,1,0);var h=vc.getKeyframeOrder(s);s=vc.sortedArray(s,1,h),c=vc.sortedArray(c,1,h),r||0!==s[0]||(s.push(n),c.push(c[0])),a.push(new Dr(".morphTargetInfluences["+e[o].name+"]",s,c).scale(1/i))}return new Or(t,-1,a)},findByName:function(t,e){var i=t;for(Array.isArray(t)||(i=t.geometry&&t.geometry.animations||t.animations),t=0;t<i.length;t++)if(i[t].name===e)return i[t];return null},CreateClipsFromMorphTargetSequences:function(t,e,i){for(var r={},n=/^([\w-]*?)([\d]+)$/,a=0,o=t.length;a<o;a++){var s=t[a],c=s.name.match(n);if(c&&1<c.length){var h=c[1];(c=r[h])||(r[h]=c=[]),c.push(s)}}for(h in t=[],r)t.push(Or.CreateFromMorphTargetSequence(h,r[h],e,i));return t},parseAnimation:function(t,e){if(!t)return void 0,null;var i=function(t,e,i,r,n){if(0!==i.length){var a=[],o=[];vc.flattenJSON(i,a,o,r),0!==a.length&&n.push(new t(e,a,o))}},r=[],n=t.name||"default",a=t.length||-1,o=t.fps||30;t=t.hierarchy||[];for(var s=0;s<t.length;s++){var c=t[s].keys;if(c&&0!==c.length)if(c[0].morphTargets){a={};for(var h=0;h<c.length;h++)if(c[h].morphTargets)for(var l=0;l<c[h].morphTargets.length;l++)a[c[h].morphTargets[l]]=-1;for(var u in a){var p=[],d=[];for(l=0;l!==c[h].morphTargets.length;++l){var f=c[h];p.push(f.time),d.push(f.morphTarget===u?1:0)}r.push(new Dr(".morphTargetInfluence["+u+"]",p,d))}a=a.length*(o||1)}else i(Pr,(h=".bones["+e[s].name+"]")+".position",c,"pos",r),i(Lr,h+".quaternion",c,"rot",r),i(Pr,h+".scale",c,"scl",r)}return 0===r.length?null:new Or(n,a,r)}}),Object.assign(Or.prototype,{resetDuration:function(){for(var t=0,e=0,i=this.tracks.length;e!==i;++e){var r=this.tracks[e];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){for(var t=[],e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new Or(this.name,this.duration,t)}});var yc={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},Ec=new Hr;Object.assign(Nr.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this}});var xc={};Ur.prototype=Object.assign(Object.create(Nr.prototype),{constructor:Ur,load:function(t,e,i,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var n=this,a=yc.get(t);if(void 0!==a)return n.manager.itemStart(t),setTimeout((function(){e&&e(a),n.manager.itemEnd(t)}),0),a;if(void 0===xc[t]){var o=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(o){i=o[1];var s=!!o[2];o=o[3],o=decodeURIComponent(o),s&&(o=atob(o));try{var c=(this.responseType||"").toLowerCase();switch(c){case"arraybuffer":case"blob":var h=new Uint8Array(o.length);for(s=0;s<o.length;s++)h[s]=o.charCodeAt(s);var l="blob"===c?new Blob([h.buffer],{type:i}):h.buffer;break;case"document":l=(new DOMParser).parseFromString(o,i);break;case"json":l=JSON.parse(o);break;default:l=o}setTimeout((function(){e&&e(l),n.manager.itemEnd(t)}),0)}catch(e){setTimeout((function(){r&&r(e),n.manager.itemError(t),n.manager.itemEnd(t)}),0)}}else{xc[t]=[],xc[t].push({onLoad:e,onProgress:i,onError:r});var u=new XMLHttpRequest;for(s in u.open("GET",t,!0),u.addEventListener("load",(function(e){var i=this.response,r=xc[t];if(delete xc[t],200===this.status||0===this.status){0===this.status&&void 0,yc.add(t,i);for(var a=0,o=r.length;a<o;a++){var s=r[a];s.onLoad&&s.onLoad(i)}}else{for(a=0,o=r.length;a<o;a++)(s=r[a]).onError&&s.onError(e);n.manager.itemError(t)}n.manager.itemEnd(t)}),!1),u.addEventListener("progress",(function(e){for(var i=xc[t],r=0,n=i.length;r<n;r++){var a=i[r];a.onProgress&&a.onProgress(e)}}),!1),u.addEventListener("error",(function(e){var i=xc[t];delete xc[t];for(var r=0,a=i.length;r<a;r++){var o=i[r];o.onError&&o.onError(e)}n.manager.itemError(t),n.manager.itemEnd(t)}),!1),u.addEventListener("abort",(function(e){var i=xc[t];delete xc[t];for(var r=0,a=i.length;r<a;r++){var o=i[r];o.onError&&o.onError(e)}n.manager.itemError(t),n.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(u.responseType=this.responseType),void 0!==this.withCredentials&&(u.withCredentials=this.withCredentials),u.overrideMimeType&&u.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)u.setRequestHeader(s,this.requestHeader[s]);u.send(null)}return n.manager.itemStart(t),u}xc[t].push({onLoad:e,onProgress:i,onError:r})},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}}),Fr.prototype=Object.assign(Object.create(Nr.prototype),{constructor:Fr,load:function(t,e,i,r){var n=this,a=new Ur(n.manager);a.setPath(n.path),a.load(t,(function(t){e(n.parse(JSON.parse(t)))}),i,r)},parse:function(t){for(var e=[],i=0;i<t.length;i++){var r=Or.parse(t[i]);e.push(r)}return e}}),Br.prototype=Object.assign(Object.create(Nr.prototype),{constructor:Br,load:function(t,e,i,r){function n(n){c.load(t[n],(function(t){t=a.parse(t,!0),o[n]={width:t.width,height:t.height,format:t.format,mipmaps:t.mipmaps},6===(h+=1)&&(1===t.mipmapCount&&(s.minFilter=1006),s.format=t.format,s.needsUpdate=!0,e&&e(s))}),i,r)}var a=this,o=[],s=new ni;s.image=o;var c=new Ur(this.manager);if(c.setPath(this.path),c.setResponseType("arraybuffer"),Array.isArray(t))for(var h=0,l=0,u=t.length;l<u;++l)n(l);else c.load(t,(function(t){if((t=a.parse(t,!0)).isCubemap)for(var i=t.mipmaps.length/t.mipmapCount,r=0;r<i;r++){o[r]={mipmaps:[]};for(var n=0;n<t.mipmapCount;n++)o[r].mipmaps.push(t.mipmaps[r*t.mipmapCount+n]),o[r].format=t.format,o[r].width=t.width,o[r].height=t.height}else s.image.width=t.width,s.image.height=t.height,s.mipmaps=t.mipmaps;1===t.mipmapCount&&(s.minFilter=1006),s.format=t.format,s.needsUpdate=!0,e&&e(s)}),i,r);return s}}),zr.prototype=Object.assign(Object.create(Nr.prototype),{constructor:zr,load:function(t,e,i,r){var n=this,a=new Q,o=new Ur(this.manager);return o.setResponseType("arraybuffer"),o.setPath(this.path),o.load(t,(function(t){(t=n.parse(t))&&(void 0!==t.image?a.image=t.image:void 0!==t.data&&(a.image.width=t.width,a.image.height=t.height,a.image.data=t.data),a.wrapS=void 0!==t.wrapS?t.wrapS:1001,a.wrapT=void 0!==t.wrapT?t.wrapT:1001,a.magFilter=void 0!==t.magFilter?t.magFilter:1006,a.minFilter=void 0!==t.minFilter?t.minFilter:1006,a.anisotropy=void 0!==t.anisotropy?t.anisotropy:1,void 0!==t.format&&(a.format=t.format),void 0!==t.type&&(a.type=t.type),void 0!==t.mipmaps&&(a.mipmaps=t.mipmaps,a.minFilter=1008),1===t.mipmapCount&&(a.minFilter=1006),a.needsUpdate=!0,e&&e(a,t))}),i,r),a}}),Gr.prototype=Object.assign(Object.create(Nr.prototype),{constructor:Gr,load:function(t,e,i,r){function n(){c.removeEventListener("load",n,!1),c.removeEventListener("error",a,!1),yc.add(t,this),e&&e(this),o.manager.itemEnd(t)}function a(e){c.removeEventListener("load",n,!1),c.removeEventListener("error",a,!1),r&&r(e),o.manager.itemError(t),o.manager.itemEnd(t)}void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var o=this,s=yc.get(t);if(void 0!==s)return o.manager.itemStart(t),setTimeout((function(){e&&e(s),o.manager.itemEnd(t)}),0),s;var c=document.createElementNS("http://www.w3.org/1999/xhtml","img");return c.addEventListener("load",n,!1),c.addEventListener("error",a,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(c.crossOrigin=this.crossOrigin),o.manager.itemStart(t),c.src=t,c}}),jr.prototype=Object.assign(Object.create(Nr.prototype),{constructor:jr,load:function(t,e,i,r){function n(i){o.load(t[i],(function(t){a.images[i]=t,6===++s&&(a.needsUpdate=!0,e&&e(a))}),void 0,r)}var a=new mt,o=new Gr(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var s=0;for(i=0;i<t.length;++i)n(i);return a}}),Vr.prototype=Object.assign(Object.create(Nr.prototype),{constructor:Vr,load:function(t,e,i,r){var n=new o,a=new Gr(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,(function(i){n.image=i,i=0<t.search(/\.jpe?g($|\?)/i)||0===t.search(/^data:image\/jpeg/),n.format=i?1022:1023,n.needsUpdate=!0,void 0!==e&&e(n)}),i,r),n}}),Object.assign(kr.prototype,{getPoint:function(){return void 0,null},getPointAt:function(t,e){return t=this.getUtoTmapping(t),this.getPoint(t,e)},getPoints:function(t){void 0===t&&(t=5);for(var e=[],i=0;i<=t;i++)e.push(this.getPoint(i/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);for(var e=[],i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,i=[],r=this.getPoint(0),n=0;for(i.push(0),e=1;e<=t;e++){var a=this.getPoint(e/t);n+=a.distanceTo(r),i.push(n),r=a}return this.cacheArcLengths=i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var i=this.getLengths(),r=i.length;e=e||t*i[r-1];for(var n,a=0,o=r-1;a<=o;)if(0>(n=i[t=Math.floor(a+(o-a)/2)]-e))a=t+1;else{if(!(0<n)){o=t;break}o=t-1}return i[t=o]===e?t/(r-1):(t+(e-(a=i[t]))/(i[t+1]-a))/(r-1)},getTangent:function(t){var e=t-1e-4;return 0>e&&(e=0),1<(t+=1e-4)&&(t=1),e=this.getPoint(e),this.getPoint(t).clone().sub(e).normalize()},getTangentAt:function(t){return t=this.getUtoTmapping(t),this.getTangent(t)},computeFrenetFrames:function(t,e){var i,r=new n,a=[],o=[],s=[],c=new n,h=new l;for(i=0;i<=t;i++){var u=i/t;a[i]=this.getTangentAt(u),a[i].normalize()}o[0]=new n,s[0]=new n,i=Number.MAX_VALUE,u=Math.abs(a[0].x);var p=Math.abs(a[0].y),d=Math.abs(a[0].z);for(u<=i&&(i=u,r.set(1,0,0)),p<=i&&(i=p,r.set(0,1,0)),d<=i&&r.set(0,0,1),c.crossVectors(a[0],r).normalize(),o[0].crossVectors(a[0],c),s[0].crossVectors(a[0],o[0]),i=1;i<=t;i++)o[i]=o[i-1].clone(),s[i]=s[i-1].clone(),c.crossVectors(a[i-1],a[i]),c.length()>Number.EPSILON&&(c.normalize(),r=Math.acos(Ta.clamp(a[i-1].dot(a[i]),-1,1)),o[i].applyMatrix4(h.makeRotationAxis(c,r))),s[i].crossVectors(a[i],o[i]);if(!0===e)for(r=Math.acos(Ta.clamp(o[0].dot(o[t]),-1,1)),r/=t,0<a[0].dot(c.crossVectors(o[0],o[t]))&&(r=-r),i=1;i<=t;i++)o[i].applyMatrix4(h.makeRotationAxis(a[i],r*i)),s[i].crossVectors(a[i],o[i]);return{tangents:a,normals:o,binormals:s}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),Wr.prototype=Object.create(kr.prototype),Wr.prototype.constructor=Wr,Wr.prototype.isEllipseCurve=!0,Wr.prototype.getPoint=function(t,e){e=e||new i;for(var r=2*Math.PI,n=this.aEndAngle-this.aStartAngle,a=Math.abs(n)<Number.EPSILON;0>n;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(n=a?0:r),!0!==this.aClockwise||a||(n=n===r?-r:n-r),r=this.aStartAngle+t*n,t=this.aX+this.xRadius*Math.cos(r);var o=this.aY+this.yRadius*Math.sin(r);return 0!==this.aRotation&&(r=Math.cos(this.aRotation),n=Math.sin(this.aRotation),t=(a=t-this.aX)*r-(o-=this.aY)*n+this.aX,o=a*n+o*r+this.aY),e.set(t,o)},Wr.prototype.copy=function(t){return kr.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},Wr.prototype.toJSON=function(){var t=kr.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},Wr.prototype.fromJSON=function(t){return kr.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},qr.prototype=Object.create(Wr.prototype),qr.prototype.constructor=qr,qr.prototype.isArcCurve=!0;var bc=new n,Sc=new Xr,wc=new Xr,_c=new Xr;Yr.prototype=Object.create(kr.prototype),Yr.prototype.constructor=Yr,Yr.prototype.isCatmullRomCurve3=!0,Yr.prototype.getPoint=function(t,e){e=e||new n;var i=this.points,r=i.length;t*=r-(this.closed?0:1);var a=Math.floor(t);if(t-=a,this.closed?a+=0<a?0:(Math.floor(Math.abs(a)/r)+1)*r:0===t&&a===r-1&&(a=r-2,t=1),this.closed||0<a)var o=i[(a-1)%r];else bc.subVectors(i[0],i[1]).add(i[0]),o=bc;var s=i[a%r],c=i[(a+1)%r];if(this.closed||a+2<r?i=i[(a+2)%r]:(bc.subVectors(i[r-1],i[r-2]).add(i[r-1]),i=bc),"centripetal"===this.curveType||"chordal"===this.curveType){var h="chordal"===this.curveType?.5:.25;r=Math.pow(o.distanceToSquared(s),h),1e-4>(a=Math.pow(s.distanceToSquared(c),h))&&(a=1),1e-4>r&&(r=a),1e-4>(h=Math.pow(c.distanceToSquared(i),h))&&(h=a),Sc.initNonuniformCatmullRom(o.x,s.x,c.x,i.x,r,a,h),wc.initNonuniformCatmullRom(o.y,s.y,c.y,i.y,r,a,h),_c.initNonuniformCatmullRom(o.z,s.z,c.z,i.z,r,a,h)}else"catmullrom"===this.curveType&&(Sc.initCatmullRom(o.x,s.x,c.x,i.x,this.tension),wc.initCatmullRom(o.y,s.y,c.y,i.y,this.tension),_c.initCatmullRom(o.z,s.z,c.z,i.z,this.tension));return e.set(Sc.calc(t),wc.calc(t),_c.calc(t)),e},Yr.prototype.copy=function(t){kr.prototype.copy.call(this,t),this.points=[];for(var e=0,i=t.points.length;e<i;e++)this.points.push(t.points[e].clone());return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Yr.prototype.toJSON=function(){var t=kr.prototype.toJSON.call(this);t.points=[];for(var e=0,i=this.points.length;e<i;e++)t.points.push(this.points[e].toArray());return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},Yr.prototype.fromJSON=function(t){kr.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,i=t.points.length;e<i;e++){var r=t.points[e];this.points.push((new n).fromArray(r))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Qr.prototype=Object.create(kr.prototype),Qr.prototype.constructor=Qr,Qr.prototype.isCubicBezierCurve=!0,Qr.prototype.getPoint=function(t,e){e=e||new i;var r=this.v0,n=this.v1,a=this.v2,o=this.v3;return e.set(Kr(t,r.x,n.x,a.x,o.x),Kr(t,r.y,n.y,a.y,o.y)),e},Qr.prototype.copy=function(t){return kr.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Qr.prototype.toJSON=function(){var t=kr.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Qr.prototype.fromJSON=function(t){return kr.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},$r.prototype=Object.create(kr.prototype),$r.prototype.constructor=$r,$r.prototype.isCubicBezierCurve3=!0,$r.prototype.getPoint=function(t,e){e=e||new n;var i=this.v0,r=this.v1,a=this.v2,o=this.v3;return e.set(Kr(t,i.x,r.x,a.x,o.x),Kr(t,i.y,r.y,a.y,o.y),Kr(t,i.z,r.z,a.z,o.z)),e},$r.prototype.copy=function(t){return kr.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},$r.prototype.toJSON=function(){var t=kr.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},$r.prototype.fromJSON=function(t){return kr.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},tn.prototype=Object.create(kr.prototype),tn.prototype.constructor=tn,tn.prototype.isLineCurve=!0,tn.prototype.getPoint=function(t,e){return e=e||new i,1===t?e.copy(this.v2):(e.copy(this.v2).sub(this.v1),e.multiplyScalar(t).add(this.v1)),e},tn.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},tn.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},tn.prototype.copy=function(t){return kr.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},tn.prototype.toJSON=function(){var t=kr.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},tn.prototype.fromJSON=function(t){return kr.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},en.prototype=Object.create(kr.prototype),en.prototype.constructor=en,en.prototype.isLineCurve3=!0,en.prototype.getPoint=function(t,e){return e=e||new n,1===t?e.copy(this.v2):(e.copy(this.v2).sub(this.v1),e.multiplyScalar(t).add(this.v1)),e},en.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},en.prototype.copy=function(t){return kr.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},en.prototype.toJSON=function(){var t=kr.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},en.prototype.fromJSON=function(t){return kr.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},rn.prototype=Object.create(kr.prototype),rn.prototype.constructor=rn,rn.prototype.isQuadraticBezierCurve=!0,rn.prototype.getPoint=function(t,e){e=e||new i;var r=this.v0,n=this.v1,a=this.v2;return e.set(Zr(t,r.x,n.x,a.x),Zr(t,r.y,n.y,a.y)),e},rn.prototype.copy=function(t){return kr.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},rn.prototype.toJSON=function(){var t=kr.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},rn.prototype.fromJSON=function(t){return kr.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},nn.prototype=Object.create(kr.prototype),nn.prototype.constructor=nn,nn.prototype.isQuadraticBezierCurve3=!0,nn.prototype.getPoint=function(t,e){e=e||new n;var i=this.v0,r=this.v1,a=this.v2;return e.set(Zr(t,i.x,r.x,a.x),Zr(t,i.y,r.y,a.y),Zr(t,i.z,r.z,a.z)),e},nn.prototype.copy=function(t){return kr.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},nn.prototype.toJSON=function(){var t=kr.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},nn.prototype.fromJSON=function(t){return kr.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},an.prototype=Object.create(kr.prototype),an.prototype.constructor=an,an.prototype.isSplineCurve=!0,an.prototype.getPoint=function(t,e){e=e||new i;var r=this.points,n=(r.length-1)*t;n-=t=Math.floor(n);var a=r[0===t?t:t-1],o=r[t],s=r[t>r.length-2?r.length-1:t+1];return r=r[t>r.length-3?r.length-1:t+2],e.set(Jr(n,a.x,o.x,s.x,r.x),Jr(n,a.y,o.y,s.y,r.y)),e},an.prototype.copy=function(t){kr.prototype.copy.call(this,t),this.points=[];for(var e=0,i=t.points.length;e<i;e++)this.points.push(t.points[e].clone());return this},an.prototype.toJSON=function(){var t=kr.prototype.toJSON.call(this);t.points=[];for(var e=0,i=this.points.length;e<i;e++)t.points.push(this.points[e].toArray());return t},an.prototype.fromJSON=function(t){kr.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push((new i).fromArray(n))}return this};var Mc=Object.freeze({__proto__:null,ArcCurve:qr,CatmullRomCurve3:Yr,CubicBezierCurve:Qr,CubicBezierCurve3:$r,EllipseCurve:Wr,LineCurve:tn,LineCurve3:en,QuadraticBezierCurve:rn,QuadraticBezierCurve3:nn,SplineCurve:an});on.prototype=Object.assign(Object.create(kr.prototype),{constructor:on,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new tn(e,t))},getPoint:function(t){var e=t*this.getLength(),i=this.getCurveLengths();for(t=0;t<i.length;){if(i[t]>=e)return e=i[t]-e,i=(t=this.curves[t]).getLength(),t.getPointAt(0===i?0:1-e/i);t++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,i=0,r=this.curves.length;i<r;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var e=[],i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,i=[],r=0,n=this.curves;r<n.length;r++){var a=n[r];a=a.getPoints(a&&a.isEllipseCurve?2*t:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?t*a.points.length:t);for(var o=0;o<a.length;o++){var s=a[o];e&&e.equals(s)||(i.push(s),e=s)}}return this.autoClose&&1<i.length&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i},copy:function(t){kr.prototype.copy.call(this,t),this.curves=[];for(var e=0,i=t.curves.length;e<i;e++)this.curves.push(t.curves[e].clone());return this.autoClose=t.autoClose,this},toJSON:function(){var t=kr.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var e=0,i=this.curves.length;e<i;e++)t.curves.push(this.curves[e].toJSON());return t},fromJSON:function(t){kr.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var e=0,i=t.curves.length;e<i;e++){var r=t.curves[e];this.curves.push((new Mc[r.type]).fromJSON(r))}return this}}),sn.prototype=Object.assign(Object.create(on.prototype),{constructor:sn,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this},moveTo:function(t,e){return this.currentPoint.set(t,e),this},lineTo:function(t,e){var r=new tn(this.currentPoint.clone(),new i(t,e));return this.curves.push(r),this.currentPoint.set(t,e),this},quadraticCurveTo:function(t,e,r,n){return t=new rn(this.currentPoint.clone(),new i(t,e),new i(r,n)),this.curves.push(t),this.currentPoint.set(r,n),this},bezierCurveTo:function(t,e,r,n,a,o){return t=new Qr(this.currentPoint.clone(),new i(t,e),new i(r,n),new i(a,o)),this.curves.push(t),this.currentPoint.set(a,o),this},splineThru:function(t){var e=[this.currentPoint.clone()].concat(t);return e=new an(e),this.curves.push(e),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,e,i,r,n,a){return this.absarc(t+this.currentPoint.x,e+this.currentPoint.y,i,r,n,a),this},absarc:function(t,e,i,r,n,a){return this.absellipse(t,e,i,i,r,n,a),this},ellipse:function(t,e,i,r,n,a,o,s){return this.absellipse(t+this.currentPoint.x,e+this.currentPoint.y,i,r,n,a,o,s),this},absellipse:function(t,e,i,r,n,a,o,s){return t=new Wr(t,e,i,r,n,a,o,s),0<this.curves.length&&((e=t.getPoint(0)).equals(this.currentPoint)||this.lineTo(e.x,e.y)),this.curves.push(t),t=t.getPoint(1),this.currentPoint.copy(t),this},copy:function(t){return on.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){var t=on.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return on.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),cn.prototype=Object.assign(Object.create(sn.prototype),{constructor:cn,getPointsHoles:function(t){for(var e=[],i=0,r=this.holes.length;i<r;i++)e[i]=this.holes[i].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){sn.prototype.copy.call(this,t),this.holes=[];for(var e=0,i=t.holes.length;e<i;e++)this.holes.push(t.holes[e].clone());return this},toJSON:function(){var t=sn.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var e=0,i=this.holes.length;e<i;e++)t.holes.push(this.holes[e].toJSON());return t},fromJSON:function(t){sn.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(var e=0,i=t.holes.length;e<i;e++){var r=t.holes[e];this.holes.push((new sn).fromJSON(r))}return this}}),hn.prototype=Object.assign(Object.create(d.prototype),{constructor:hn,isLight:!0,copy:function(t){return d.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){return(t=d.prototype.toJSON.call(this,t)).object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),ln.prototype=Object.assign(Object.create(hn.prototype),{constructor:ln,isHemisphereLight:!0,copy:function(t){return hn.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(un.prototype,{_projScreenMatrix:new l,_lightPositionWorld:new n,_lookTarget:new n,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){var e=this.camera,i=this.matrix,r=this._projScreenMatrix,n=this._lookTarget,a=this._lightPositionWorld;a.setFromMatrixPosition(t.matrixWorld),e.position.copy(a),n.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(n),e.updateMatrixWorld(),r.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromMatrix(r),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(e.projectionMatrix),i.multiply(e.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),pn.prototype=Object.assign(Object.create(un.prototype),{constructor:pn,isSpotLightShadow:!0,updateMatrices:function(t){var e=this.camera,i=2*Ta.RAD2DEG*t.angle,r=this.mapSize.width/this.mapSize.height,n=t.distance||e.far;i===e.fov&&r===e.aspect&&n===e.far||(e.fov=i,e.aspect=r,e.far=n,e.updateProjectionMatrix()),un.prototype.updateMatrices.call(this,t)}}),dn.prototype=Object.assign(Object.create(hn.prototype),{constructor:dn,isSpotLight:!0,copy:function(t){return hn.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),fn.prototype=Object.assign(Object.create(un.prototype),{constructor:fn,isPointLightShadow:!0,updateMatrices:function(t,e){void 0===e&&(e=0);var i=this.camera,r=this.matrix,n=this._lightPositionWorld,a=this._lookTarget,o=this._projScreenMatrix;n.setFromMatrixPosition(t.matrixWorld),i.position.copy(n),a.copy(i.position),a.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(a),i.updateMatrixWorld(),r.makeTranslation(-n.x,-n.y,-n.z),o.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromMatrix(o)}}),mn.prototype=Object.assign(Object.create(hn.prototype),{constructor:mn,isPointLight:!0,copy:function(t){return hn.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),gn.prototype=Object.assign(Object.create(Y.prototype),{constructor:gn,isOrthographicCamera:!0,copy:function(t,e){return Y.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,i,r,n,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,n=i-t;if(i+=t,t=r+e,e=r-e,null!==this.view&&this.view.enabled){i=this.zoom/(this.view.width/this.view.fullWidth),e=this.zoom/(this.view.height/this.view.fullHeight);var a=(this.right-this.left)/this.view.width;r=(this.top-this.bottom)/this.view.height,i=(n+=this.view.offsetX/i*a)+this.view.width/i*a,e=(t-=this.view.offsetY/e*r)-this.view.height/e*r}this.projectionMatrix.makeOrthographic(n,i,t,e,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){return(t=d.prototype.toJSON.call(this,t)).object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),vn.prototype=Object.assign(Object.create(un.prototype),{constructor:vn,isDirectionalLightShadow:!0,updateMatrices:function(t){un.prototype.updateMatrices.call(this,t)}}),yn.prototype=Object.assign(Object.create(hn.prototype),{constructor:yn,isDirectionalLight:!0,copy:function(t){return hn.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),En.prototype=Object.assign(Object.create(hn.prototype),{constructor:En,isAmbientLight:!0}),xn.prototype=Object.assign(Object.create(hn.prototype),{constructor:xn,isRectAreaLight:!0,copy:function(t){return hn.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){return(t=hn.prototype.toJSON.call(this,t)).object.width=this.width,t.object.height=this.height,t}}),bn.prototype=Object.assign(Object.create(Nr.prototype),{constructor:bn,load:function(t,e,i,r){var n=this,a=new Ur(n.manager);a.setPath(n.path),a.load(t,(function(t){e(n.parse(JSON.parse(t)))}),i,r)},parse:function(t){function e(t){return void 0===r[t]&&void 0,r[t]}var r=this.textures,o=new gc[t.type];if(void 0!==t.uuid&&(o.uuid=t.uuid),void 0!==t.name&&(o.name=t.name),void 0!==t.color&&o.color.setHex(t.color),void 0!==t.roughness&&(o.roughness=t.roughness),void 0!==t.metalness&&(o.metalness=t.metalness),void 0!==t.sheen&&(o.sheen=(new b).setHex(t.sheen)),void 0!==t.emissive&&o.emissive.setHex(t.emissive),void 0!==t.specular&&o.specular.setHex(t.specular),void 0!==t.shininess&&(o.shininess=t.shininess),void 0!==t.clearcoat&&(o.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(o.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.vertexColors&&(o.vertexColors=t.vertexColors),void 0!==t.fog&&(o.fog=t.fog),void 0!==t.flatShading&&(o.flatShading=t.flatShading),void 0!==t.blending&&(o.blending=t.blending),void 0!==t.combine&&(o.combine=t.combine),void 0!==t.side&&(o.side=t.side),void 0!==t.opacity&&(o.opacity=t.opacity),void 0!==t.transparent&&(o.transparent=t.transparent),void 0!==t.alphaTest&&(o.alphaTest=t.alphaTest),void 0!==t.depthTest&&(o.depthTest=t.depthTest),void 0!==t.depthWrite&&(o.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(o.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(o.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(o.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(o.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(o.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(o.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(o.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(o.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(o.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(o.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(o.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(o.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(o.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(o.rotation=t.rotation),1!==t.linewidth&&(o.linewidth=t.linewidth),void 0!==t.dashSize&&(o.dashSize=t.dashSize),void 0!==t.gapSize&&(o.gapSize=t.gapSize),void 0!==t.scale&&(o.scale=t.scale),void 0!==t.polygonOffset&&(o.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(o.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(o.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(o.skinning=t.skinning),void 0!==t.morphTargets&&(o.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(o.morphNormals=t.morphNormals),void 0!==t.dithering&&(o.dithering=t.dithering),void 0!==t.visible&&(o.visible=t.visible),void 0!==t.toneMapped&&(o.toneMapped=t.toneMapped),void 0!==t.userData&&(o.userData=t.userData),void 0!==t.uniforms)for(var c in t.uniforms){var h=t.uniforms[c];switch(o.uniforms[c]={},h.type){case"t":o.uniforms[c].value=e(h.value);break;case"c":o.uniforms[c].value=(new b).setHex(h.value);break;case"v2":o.uniforms[c].value=(new i).fromArray(h.value);break;case"v3":o.uniforms[c].value=(new n).fromArray(h.value);break;case"v4":o.uniforms[c].value=(new s).fromArray(h.value);break;case"m3":o.uniforms[c].value=(new a).fromArray(h.value);case"m4":o.uniforms[c].value=(new l).fromArray(h.value);break;default:o.uniforms[c].value=h.value}}if(void 0!==t.defines&&(o.defines=t.defines),void 0!==t.vertexShader&&(o.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(o.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(var u in t.extensions)o.extensions[u]=t.extensions[u];return void 0!==t.shading&&(o.flatShading=1===t.shading),void 0!==t.size&&(o.size=t.size),void 0!==t.sizeAttenuation&&(o.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(o.map=e(t.map)),void 0!==t.matcap&&(o.matcap=e(t.matcap)),void 0!==t.alphaMap&&(o.alphaMap=e(t.alphaMap),o.transparent=!0),void 0!==t.bumpMap&&(o.bumpMap=e(t.bumpMap)),void 0!==t.bumpScale&&(o.bumpScale=t.bumpScale),void 0!==t.normalMap&&(o.normalMap=e(t.normalMap)),void 0!==t.normalMapType&&(o.normalMapType=t.normalMapType),void 0!==t.normalScale&&(c=t.normalScale,!1===Array.isArray(c)&&(c=[c,c]),o.normalScale=(new i).fromArray(c)),void 0!==t.displacementMap&&(o.displacementMap=e(t.displacementMap)),void 0!==t.displacementScale&&(o.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(o.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(o.roughnessMap=e(t.roughnessMap)),void 0!==t.metalnessMap&&(o.metalnessMap=e(t.metalnessMap)),void 0!==t.emissiveMap&&(o.emissiveMap=e(t.emissiveMap)),void 0!==t.emissiveIntensity&&(o.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(o.specularMap=e(t.specularMap)),void 0!==t.envMap&&(o.envMap=e(t.envMap)),void 0!==t.envMapIntensity&&(o.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(o.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(o.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(o.lightMap=e(t.lightMap)),void 0!==t.lightMapIntensity&&(o.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(o.aoMap=e(t.aoMap)),void 0!==t.aoMapIntensity&&(o.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(o.gradientMap=e(t.gradientMap)),void 0!==t.clearcoatNormalMap&&(o.clearcoatNormalMap=e(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(o.clearcoatNormalScale=(new i).fromArray(t.clearcoatNormalScale)),o},setTextures:function(t){return this.textures=t,this}});var Ac={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);for(var e="",i=0,r=t.length;i<r;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch(t){return e}},extractUrlBase:function(t){var e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}};Sn.prototype=Object.assign(Object.create(z.prototype),{constructor:Sn,isInstancedBufferGeometry:!0,copy:function(t){return z.prototype.copy.call(this,t),this.maxInstancedCount=t.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t=z.prototype.toJSON.call(this);return t.maxInstancedCount=this.maxInstancedCount,t.isInstancedBufferGeometry=!0,t}}),wn.prototype=Object.assign(Object.create(D.prototype),{constructor:wn,isInstancedBufferAttribute:!0,copy:function(t){return D.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){var t=D.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}),_n.prototype=Object.assign(Object.create(Nr.prototype),{constructor:_n,load:function(t,e,i,r){var n=this,a=new Ur(n.manager);a.setPath(n.path),a.load(t,(function(t){e(n.parse(JSON.parse(t)))}),i,r)},parse:function(t){var e=t.isInstancedBufferGeometry?new Sn:new z,i=t.data.index;if(void 0!==i){var r=new Tc[i.type](i.array);e.setIndex(new D(r,1))}for(var a in i=t.data.attributes){var o=i[a];r=new Tc[o.type](o.array),r=new(o.isInstancedBufferAttribute?wn:D)(r,o.itemSize,o.normalized),void 0!==o.name&&(r.name=o.name),e.setAttribute(a,r)}var s=t.data.morphAttributes;if(s)for(a in s){var c=s[a],h=[];i=0;for(var l=c.length;i<l;i++)o=c[i],r=new D(r=new Tc[o.type](o.array),o.itemSize,o.normalized),void 0!==o.name&&(r.name=o.name),h.push(r);e.morphAttributes[a]=h}if(void 0!==(a=t.data.groups||t.data.drawcalls||t.data.offsets))for(i=0,o=a.length;i!==o;++i)r=a[i],e.addGroup(r.start,r.count,r.materialIndex);return void 0!==(i=t.data.boundingSphere)&&(a=new n,void 0!==i.center&&a.fromArray(i.center),e.boundingSphere=new v(a,i.radius)),t.name&&(e.name=t.name),t.userData&&(e.userData=t.userData),e}});var Tc={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};Mn.prototype=Object.assign(Object.create(Nr.prototype),{constructor:Mn,load:function(t,e,i,r){var n=this,a=""===this.path?Ac.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||a,(a=new Ur(n.manager)).setPath(this.path),a.load(t,(function(i){var a=null;try{a=JSON.parse(i)}catch(e){return void 0!==r&&r(e),void void 0}void 0===(i=a.metadata)||void 0===i.type||"geometry"===i.type.toLowerCase()?void 0:n.parse(a,e)}),i,r)},parse:function(t,e){var i=this.parseShape(t.shapes);i=this.parseGeometries(t.geometries,i);var r=this.parseImages(t.images,(function(){void 0!==e&&e(n)}));r=this.parseTextures(t.textures,r),r=this.parseMaterials(t.materials,r);var n=this.parseObject(t.object,i,r);return t.animations&&(n.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0===e||e(n),n},parseShape:function(t){var e={};if(void 0!==t)for(var i=0,r=t.length;i<r;i++){var n=(new cn).fromJSON(t[i]);e[n.uuid]=n}return e},parseGeometries:function(t,e){var i={};if(void 0!==t)for(var r=new _n,n=0,a=t.length;n<a;n++){var o=t[n];switch(o.type){case"PlaneGeometry":case"PlaneBufferGeometry":var s=new mc[o.type](o.width,o.height,o.widthSegments,o.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":s=new mc[o.type](o.width,o.height,o.depth,o.widthSegments,o.heightSegments,o.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new mc[o.type](o.radius,o.segments,o.thetaStart,o.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new mc[o.type](o.radiusTop,o.radiusBottom,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new mc[o.type](o.radius,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new mc[o.type](o.radius,o.widthSegments,o.heightSegments,o.phiStart,o.phiLength,o.thetaStart,o.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":s=new mc[o.type](o.radius,o.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new mc[o.type](o.innerRadius,o.outerRadius,o.thetaSegments,o.phiSegments,o.thetaStart,o.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new mc[o.type](o.radius,o.tube,o.radialSegments,o.tubularSegments,o.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new mc[o.type](o.radius,o.tube,o.tubularSegments,o.radialSegments,o.p,o.q);break;case"TubeGeometry":case"TubeBufferGeometry":s=new mc[o.type]((new Mc[o.path.type]).fromJSON(o.path),o.tubularSegments,o.radius,o.radialSegments,o.closed);break;case"LatheGeometry":case"LatheBufferGeometry":s=new mc[o.type](o.points,o.segments,o.phiStart,o.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":s=new mc[o.type](o.vertices,o.indices,o.radius,o.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":s=[];for(var c=0,h=o.shapes.length;c<h;c++){var l=e[o.shapes[c]];s.push(l)}s=new mc[o.type](s,o.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(s=[],c=0,h=o.shapes.length;c<h;c++)l=e[o.shapes[c]],s.push(l);void 0!==(c=o.options.extrudePath)&&(o.options.extrudePath=(new Mc[c.type]).fromJSON(c)),s=new mc[o.type](s,o.options);break;case"BufferGeometry":case"InstancedBufferGeometry":s=r.parse(o);break;case"Geometry":"THREE"in window&&"LegacyJSONLoader"in THREE?s=(new THREE.LegacyJSONLoader).parse(o,this.resourcePath).geometry:void 0;break;default:void 0;continue}s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),!0===s.isBufferGeometry&&void 0!==o.userData&&(s.userData=o.userData),i[o.uuid]=s}return i},parseMaterials:function(t,e){var i={},r={};if(void 0!==t){var n=new bn;n.setTextures(e),e=0;for(var a=t.length;e<a;e++){var o=t[e];if("MultiMaterial"===o.type){for(var s=[],c=0;c<o.materials.length;c++){var h=o.materials[c];void 0===i[h.uuid]&&(i[h.uuid]=n.parse(h)),s.push(i[h.uuid])}r[o.uuid]=s}else void 0===i[o.uuid]&&(i[o.uuid]=n.parse(o)),r[o.uuid]=i[o.uuid]}}return r},parseAnimations:function(t){for(var e=[],i=0;i<t.length;i++){var r=t[i],n=Or.parse(r);void 0!==r.uuid&&(n.uuid=r.uuid),e.push(n)}return e},parseImages:function(t,e){function i(t){return r.manager.itemStart(t),a.load(t,(function(){r.manager.itemEnd(t)}),void 0,(function(){r.manager.itemError(t),r.manager.itemEnd(t)}))}var r=this,n={};if(void 0!==t&&0<t.length){var a=new Gr(e=new Hr(e));a.setCrossOrigin(this.crossOrigin),e=0;for(var o=t.length;e<o;e++){var s=t[e],c=s.url;if(Array.isArray(c)){n[s.uuid]=[];for(var h=0,l=c.length;h<l;h++){var u=c[h];u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u)?u:r.resourcePath+u,n[s.uuid].push(i(u))}}else u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(s.url)?s.url:r.resourcePath+s.url,n[s.uuid]=i(u)}}return n},parseTextures:function(t,e){function i(t,e){return"number"==typeof t?t:(void 0,e[t])}var r={};if(void 0!==t)for(var n=0,a=t.length;n<a;n++){var s=t[n];void 0===s.image&&void 0,void 0===e[s.image]&&void 0;var c=Array.isArray(e[s.image])?new mt(e[s.image]):new o(e[s.image]);c.needsUpdate=!0,c.uuid=s.uuid,void 0!==s.name&&(c.name=s.name),void 0!==s.mapping&&(c.mapping=i(s.mapping,Dc)),void 0!==s.offset&&c.offset.fromArray(s.offset),void 0!==s.repeat&&c.repeat.fromArray(s.repeat),void 0!==s.center&&c.center.fromArray(s.center),void 0!==s.rotation&&(c.rotation=s.rotation),void 0!==s.wrap&&(c.wrapS=i(s.wrap[0],Rc),c.wrapT=i(s.wrap[1],Rc)),void 0!==s.format&&(c.format=s.format),void 0!==s.type&&(c.type=s.type),void 0!==s.encoding&&(c.encoding=s.encoding),void 0!==s.minFilter&&(c.minFilter=i(s.minFilter,Lc)),void 0!==s.magFilter&&(c.magFilter=i(s.magFilter,Lc)),void 0!==s.anisotropy&&(c.anisotropy=s.anisotropy),void 0!==s.flipY&&(c.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(c.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(c.unpackAlignment=s.unpackAlignment),r[s.uuid]=c}return r},parseObject:function(t,e,i){function r(t){return void 0===e[t]&&void 0,e[t]}function n(t){if(void 0!==t){if(Array.isArray(t)){for(var e=[],r=0,n=t.length;r<n;r++){var a=t[r];void 0===i[a]&&void 0,e.push(i[a])}return e}return void 0===i[t]&&void 0,i[t]}}switch(t.type){case"Scene":var a=new f;void 0!==t.background&&Number.isInteger(t.background)&&(a.background=new b(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?a.fog=new Be(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(a.fog=new Fe(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":a=new J(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(a.focus=t.focus),void 0!==t.zoom&&(a.zoom=t.zoom),void 0!==t.filmGauge&&(a.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(a.filmOffset=t.filmOffset),void 0!==t.view&&(a.view=Object.assign({},t.view));break;case"OrthographicCamera":a=new gn(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(a.zoom=t.zoom),void 0!==t.view&&(a.view=Object.assign({},t.view));break;case"AmbientLight":a=new En(t.color,t.intensity);break;case"DirectionalLight":a=new yn(t.color,t.intensity);break;case"PointLight":a=new mn(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":a=new xn(t.color,t.intensity,t.width,t.height);break;case"SpotLight":a=new dn(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":a=new ln(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":void 0;case"Mesh":a=r(t.geometry);var o=n(t.material);a=a.bones&&0<a.bones.length?new qe(a,o):new G(a,o);break;case"InstancedMesh":a=r(t.geometry),o=n(t.material);var s=t.instanceMatrix;(a=new Je(a,o,t.count)).instanceMatrix=new D(new Float32Array(s.array),16);break;case"LOD":a=new We;break;case"Line":a=new Ke(r(t.geometry),n(t.material),t.mode);break;case"LineLoop":a=new $e(r(t.geometry),n(t.material));break;case"LineSegments":a=new Qe(r(t.geometry),n(t.material));break;case"PointCloud":case"Points":a=new ei(r(t.geometry),n(t.material));break;case"Sprite":a=new Ve(n(t.material));break;case"Group":a=new Pe;break;default:a=new d}if(a.uuid=t.uuid,void 0!==t.name&&(a.name=t.name),void 0!==t.matrix?(a.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(a.matrixAutoUpdate=t.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(void 0!==t.position&&a.position.fromArray(t.position),void 0!==t.rotation&&a.rotation.fromArray(t.rotation),void 0!==t.quaternion&&a.quaternion.fromArray(t.quaternion),void 0!==t.scale&&a.scale.fromArray(t.scale)),void 0!==t.castShadow&&(a.castShadow=t.castShadow),void 0!==t.receiveShadow&&(a.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(a.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(a.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&a.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(a.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(a.visible=t.visible),void 0!==t.frustumCulled&&(a.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(a.renderOrder=t.renderOrder),void 0!==t.userData&&(a.userData=t.userData),void 0!==t.layers&&(a.layers.mask=t.layers),void 0!==t.drawMode&&a.setDrawMode(t.drawMode),void 0!==t.children)for(s=t.children,o=0;o<s.length;o++)a.add(this.parseObject(s[o],e,i));if("LOD"===t.type)for(t=t.levels,s=0;s<t.length;s++){o=t[s];var c=a.getObjectByProperty("uuid",o.object);void 0!==c&&a.addLevel(c,o.distance)}return a}});var Dc={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},Rc={RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},Lc={NearestFilter:1003,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:1006,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:1008};An.prototype=Object.assign(Object.create(Nr.prototype),{constructor:An,setOptions:function(t){return this.options=t,this},load:function(t,e,i,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var n=this,a=yc.get(t);if(void 0!==a)return n.manager.itemStart(t),setTimeout((function(){e&&e(a),n.manager.itemEnd(t)}),0),a;fetch(t).then((function(t){return t.blob()})).then((function(t){return void 0===n.options?createImageBitmap(t):createImageBitmap(t,n.options)})).then((function(i){yc.add(t,i),e&&e(i),n.manager.itemEnd(t)})).catch((function(e){r&&r(e),n.manager.itemError(t),n.manager.itemEnd(t)})),n.manager.itemStart(t)}}),Object.assign(Tn.prototype,{moveTo:function(t,e){return this.currentPath=new sn,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},lineTo:function(t,e){return this.currentPath.lineTo(t,e),this},quadraticCurveTo:function(t,e,i,r){return this.currentPath.quadraticCurveTo(t,e,i,r),this},bezierCurveTo:function(t,e,i,r,n,a){return this.currentPath.bezierCurveTo(t,e,i,r,n,a),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,e){function i(t){for(var e=[],i=0,r=t.length;i<r;i++){var n=t[i],a=new cn;a.curves=n.curves,e.push(a)}return e}function r(t,e){for(var i=e.length,r=!1,n=i-1,a=0;a<i;n=a++){var o=e[n],s=e[a],c=s.x-o.x,h=s.y-o.y;if(Math.abs(h)>Number.EPSILON){if(0>h&&(o=e[a],c=-c,s=e[n],h=-h),!(t.y<o.y||t.y>s.y))if(t.y===o.y){if(t.x===o.x)return!0}else{if(0===(n=h*(t.x-o.x)-c*(t.y-o.y)))return!0;0>n||(r=!r)}}else if(t.y===o.y&&(s.x<=t.x&&t.x<=o.x||o.x<=t.x&&t.x<=s.x))return!0}return r}var n=dc.isClockWise,a=this.subPaths;if(0===a.length)return[];if(!0===e)return i(a);if(e=[],1===a.length){var o=a[0],s=new cn;return s.curves=o.curves,e.push(s),e}var c=!n(a[0].getPoints());c=t?!c:c,s=[];var h=[],l=[],u=0;h[u]=void 0,l[u]=[];for(var p=0,d=a.length;p<d;p++){var f=(o=a[p]).getPoints(),m=n(f);(m=t?!m:m)?(!c&&h[u]&&u++,h[u]={s:new cn,p:f},h[u].s.curves=o.curves,c&&u++,l[u]=[]):l[u].push({h:o,p:f[0]})}if(!h[0])return i(a);if(1<h.length){for(p=!1,t=[],n=0,a=h.length;n<a;n++)s[n]=[];for(n=0,a=h.length;n<a;n++)for(o=l[n],m=0;m<o.length;m++){for(c=o[m],u=!0,f=0;f<h.length;f++)r(c.p,h[f].p)&&(n!==f&&t.push({froms:n,tos:f,hole:m}),u?(u=!1,s[f].push(c)):p=!0);u&&s[n].push(c)}0<t.length&&(p||(l=s))}for(p=0,n=h.length;p<n;p++)for(s=h[p].s,e.push(s),a=0,o=(t=l[p]).length;a<o;a++)s.holes.push(t[a].h);return e}}),Object.assign(Dn.prototype,{isFont:!0,generateShapes:function(t,e){void 0===e&&(e=100);var i=[],r=e;e=this.data;var n=Array.from?Array.from(t):String(t).split("");r/=e.resolution;var a=(e.boundingBox.yMax-e.boundingBox.yMin+e.underlineThickness)*r;t=[];for(var o=0,s=0,c=0;c<n.length;c++){var h=n[c];if("\n"===h)o=0,s-=a;else{var l=h;h=r;var u=o,p=s,d=e,f=d.glyphs[l]||d.glyphs["?"];if(f){if(l=new Tn,f.o)for(var m=0,g=(d=f._cachedOutline||(f._cachedOutline=f.o.split(" "))).length;m<g;)switch(d[m++]){case"m":var v=d[m++]*h+u,y=d[m++]*h+p;l.moveTo(v,y);break;case"l":v=d[m++]*h+u,y=d[m++]*h+p,l.lineTo(v,y);break;case"q":var E=d[m++]*h+u,x=d[m++]*h+p,b=d[m++]*h+u,S=d[m++]*h+p;l.quadraticCurveTo(b,S,E,x);break;case"b":E=d[m++]*h+u,x=d[m++]*h+p,b=d[m++]*h+u,S=d[m++]*h+p,v=d[m++]*h+u,y=d[m++]*h+p,l.bezierCurveTo(b,S,v,y,E,x)}h={offsetX:f.ha*h,path:l}}else void 0,h=void 0;o+=h.offsetX,t.push(h.path)}}for(e=0,n=t.length;e<n;e++)Array.prototype.push.apply(i,t[e].toShapes());return i}}),Rn.prototype=Object.assign(Object.create(Nr.prototype),{constructor:Rn,load:function(t,e,i,r){var n=this,a=new Ur(this.manager);a.setPath(this.path),a.load(t,(function(t){try{var i=JSON.parse(t)}catch(e){void 0,i=JSON.parse(t.substring(65,t.length-2))}t=n.parse(i),e&&e(t)}),i,r)},parse:function(t){return new Dn(t)}});var Cc,Pc={getContext:function(){return void 0===Cc&&(Cc=new(window.AudioContext||window.webkitAudioContext)),Cc},setContext:function(t){Cc=t}};Ln.prototype=Object.assign(Object.create(Nr.prototype),{constructor:Ln,load:function(t,e,i,r){var n=new Ur(this.manager);n.setResponseType("arraybuffer"),n.setPath(this.path),n.load(t,(function(t){t=t.slice(0),Pc.getContext().decodeAudioData(t,(function(t){e(t)}))}),i,r)}}),Object.assign(Cn.prototype,{isSphericalHarmonics3:!0,set:function(t){for(var e=0;9>e;e++)this.coefficients[e].copy(t[e]);return this},zero:function(){for(var t=0;9>t;t++)this.coefficients[t].set(0,0,0);return this},getAt:function(t,e){var i=t.x,r=t.y;t=t.z;var n=this.coefficients;return e.copy(n[0]).multiplyScalar(.282095),e.addScale(n[1],.488603*r),e.addScale(n[2],.488603*t),e.addScale(n[3],.488603*i),e.addScale(n[4],1.092548*i*r),e.addScale(n[5],1.092548*r*t),e.addScale(n[6],.315392*(3*t*t-1)),e.addScale(n[7],1.092548*i*t),e.addScale(n[8],.546274*(i*i-r*r)),e},getIrradianceAt:function(t,e){var i=t.x,r=t.y;t=t.z;var n=this.coefficients;return e.copy(n[0]).multiplyScalar(.886227),e.addScale(n[1],1.023328*r),e.addScale(n[2],1.023328*t),e.addScale(n[3],1.023328*i),e.addScale(n[4],.858086*i*r),e.addScale(n[5],.858086*r*t),e.addScale(n[6],.743125*t*t-.247708),e.addScale(n[7],.858086*i*t),e.addScale(n[8],.429043*(i*i-r*r)),e},add:function(t){for(var e=0;9>e;e++)this.coefficients[e].add(t.coefficients[e]);return this},scale:function(t){for(var e=0;9>e;e++)this.coefficients[e].multiplyScalar(t);return this},lerp:function(t,e){for(var i=0;9>i;i++)this.coefficients[i].lerp(t.coefficients[i],e);return this},equals:function(t){for(var e=0;9>e;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0},copy:function(t){return this.set(t.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(t,e){void 0===e&&(e=0);for(var i=this.coefficients,r=0;9>r;r++)i[r].fromArray(t,e+3*r);return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);for(var i=this.coefficients,r=0;9>r;r++)i[r].toArray(t,e+3*r);return t}}),Object.assign(Cn,{getBasisAt:function(t,e){var i=t.x,r=t.y;t=t.z,e[0]=.282095,e[1]=.488603*r,e[2]=.488603*t,e[3]=.488603*i,e[4]=1.092548*i*r,e[5]=1.092548*r*t,e[6]=.315392*(3*t*t-1),e[7]=1.092548*i*t,e[8]=.546274*(i*i-r*r)}}),Pn.prototype=Object.assign(Object.create(hn.prototype),{constructor:Pn,isLightProbe:!0,copy:function(t){return hn.prototype.copy.call(this,t),this.sh.copy(t.sh),this.intensity=t.intensity,this},toJSON:function(t){return hn.prototype.toJSON.call(this,t)}}),On.prototype=Object.assign(Object.create(Pn.prototype),{constructor:On,isHemisphereLightProbe:!0,copy:function(t){return Pn.prototype.copy.call(this,t),this},toJSON:function(t){return Pn.prototype.toJSON.call(this,t)}}),In.prototype=Object.assign(Object.create(Pn.prototype),{constructor:In,isAmbientLightProbe:!0,copy:function(t){return Pn.prototype.copy.call(this,t),this},toJSON:function(t){return Pn.prototype.toJSON.call(this,t)}});var Oc=new l,Ic=new l;Object.assign(Hn.prototype,{update:function(t){var e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;var i=t.projectionMatrix.clone(),r=e.eyeSep/2,n=r*e.near/e.focus,a=e.near*Math.tan(Ta.DEG2RAD*e.fov*.5)/e.zoom;Ic.elements[12]=-r,Oc.elements[12]=r,r=-a*e.aspect+n;var o=a*e.aspect+n;i.elements[0]=2*e.near/(o-r),i.elements[8]=(o+r)/(o-r),this.cameraL.projectionMatrix.copy(i),r=-a*e.aspect-n,o=a*e.aspect-n,i.elements[0]=2*e.near/(o-r),i.elements[8]=(o+r)/(o-r),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(Ic),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Oc)}}),Object.assign(Nn.prototype,{start:function(){this.oldTime=this.startTime=("undefined"==typeof performance?Date:performance).now(),this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.autoStart=this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}});var Hc=new n,Nc=new r,Uc=new n,Fc=new n;Un.prototype=Object.assign(Object.create(d.prototype),{constructor:Un,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this},updateMatrixWorld:function(t){d.prototype.updateMatrixWorld.call(this,t),t=this.context.listener;var e=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Hc,Nc,Uc),Fc.set(0,0,-1).applyQuaternion(Nc),t.positionX){var i=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Hc.x,i),t.positionY.linearRampToValueAtTime(Hc.y,i),t.positionZ.linearRampToValueAtTime(Hc.z,i),t.forwardX.linearRampToValueAtTime(Fc.x,i),t.forwardY.linearRampToValueAtTime(Fc.y,i),t.forwardZ.linearRampToValueAtTime(Fc.z,i),t.upX.linearRampToValueAtTime(e.x,i),t.upY.linearRampToValueAtTime(e.y,i),t.upZ.linearRampToValueAtTime(e.z,i)}else t.setPosition(Hc.x,Hc.y,Hc.z),t.setOrientation(Fc.x,Fc.y,Fc.z,e.x,e.y,e.z)}}),Fn.prototype=Object.assign(Object.create(d.prototype),{constructor:Fn,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setMediaElementSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this},setMediaStreamSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(t){if(void 0===t&&(t=0),!0===this.isPlaying)void 0;else{if(!1!==this.hasPlaybackControl)return this._startedAt=this.context.currentTime+t,(t=this.context.createBufferSource()).buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._pausedAt+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect();void 0}},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._pausedAt=(this.context.currentTime-this._startedAt)*this.playbackRate,this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;void 0},stop:function(){if(!1!==this.hasPlaybackControl)return this._pausedAt=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;void 0},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},setDetune:function(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;void 0},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(void 0,!1):this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;void 0},setLoopStart:function(t){return this.loopStart=t,this},setLoopEnd:function(t){return this.loopEnd=t,this},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}});var Bc=new n,zc=new r,Gc=new n,jc=new n;Bn.prototype=Object.assign(Object.create(Fn.prototype),{constructor:Bn,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){return this.panner.refDistance=t,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){return this.panner.rolloffFactor=t,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){return this.panner.distanceModel=t,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){return this.panner.maxDistance=t,this},setDirectionalCone:function(t,e,i){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=i,this},updateMatrixWorld:function(t){if(d.prototype.updateMatrixWorld.call(this,t),!0!==this.hasPlaybackControl||!1!==this.isPlaying)if(this.matrixWorld.decompose(Bc,zc,Gc),jc.set(0,0,1).applyQuaternion(zc),(t=this.panner).positionX){var e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Bc.x,e),t.positionY.linearRampToValueAtTime(Bc.y,e),t.positionZ.linearRampToValueAtTime(Bc.z,e),t.orientationX.linearRampToValueAtTime(jc.x,e),t.orientationY.linearRampToValueAtTime(jc.y,e),t.orientationZ.linearRampToValueAtTime(jc.z,e)}else t.setPosition(Bc.x,Bc.y,Bc.z),t.setOrientation(jc.x,jc.y,jc.z)}}),Object.assign(zn.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),i=0;i<e.length;i++)t+=e[i];return t/e.length}}),Object.assign(Gn.prototype,{accumulate:function(t,e){var i=this.buffer,r=this.valueSize;t=t*r+r;var n=this.cumulativeWeight;if(0===n){for(n=0;n!==r;++n)i[t+n]=i[n];n=e}else n+=e,this._mixBufferRegion(i,t,0,e/n,r);this.cumulativeWeight=n},apply:function(t){var e=this.valueSize,i=this.buffer;t=t*e+e;var r=this.cumulativeWeight,n=this.binding;this.cumulativeWeight=0,1>r&&this._mixBufferRegion(i,t,3*e,1-r,e),r=e;for(var a=e+e;r!==a;++r)if(i[r]!==i[r+e]){n.setValue(i,t);break}},saveOriginalState:function(){var t=this.buffer,e=this.valueSize,i=3*e;this.binding.getValue(t,i);for(var r=e;r!==i;++r)t[r]=t[i+r%e];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(t,e,i,r,n){if(.5<=r)for(r=0;r!==n;++r)t[e+r]=t[i+r]},_slerp:function(t,e,i,n){r.slerpFlat(t,e,t,e,t,i,n)},_lerp:function(t,e,i,r,n){for(var a=1-r,o=0;o!==n;++o){var s=e+o;t[s]=t[s]*a+t[i+o]*r}}});var Vc=/[\[\]\.:\/]/g,kc="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Wc=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),qc=/(WCOD+)?/.source.replace("WCOD",kc),Xc=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Yc=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Jc=new RegExp("^"+Wc+qc+Xc+Yc+"$"),Zc=["material","materials","bones"];Object.assign(jn.prototype,{getValue:function(t,e){this.bind();var i=this._bindings[this._targetGroup.nCachedObjects_];void 0!==i&&i.getValue(t,e)},setValue:function(t,e){for(var i=this._bindings,r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}}),Object.assign(Vn,{Composite:jn,create:function(t,e,i){return t&&t.isAnimationObjectGroup?new Vn.Composite(t,e,i):new Vn(t,e,i)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(Vc,"")},parseTrackName:function(t){var e=Jc.exec(t);if(!e)throw Error("PropertyBinding: Cannot parse trackName: "+t);var i=(e={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]}).nodeName&&e.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){var r=e.nodeName.substring(i+1);-1!==Zc.indexOf(r)&&(e.nodeName=e.nodeName.substring(0,i),e.objectName=r)}if(null===e.propertyName||0===e.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+t);return e},findNode:function(t,e){if(!e||""===e||"root"===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var i=t.skeleton.getBoneByName(e);if(void 0!==i)return i}if(t.children){var r=function(t){for(var i=0;i<t.length;i++){var n=t[i];if(n.name===e||n.uuid===e||(n=r(n.children)))return n}return null};if(t=r(t.children))return t}return null}}),Object.assign(Vn.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)t[e++]=i[r]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=t[e++]},function(t,e){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,i=e.objectName,r=e.propertyName,n=e.propertyIndex;if(t||(this.node=t=Vn.findNode(this.rootNode,e.nodeName)||this.rootNode),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(i){var a=e.objectIndex;switch(i){case"materials":if(!t.material)return void void 0;if(!t.material.materials)return void void 0;t=t.material.materials;break;case"bones":if(!t.skeleton)return void void 0;for(t=t.skeleton.bones,i=0;i<t.length;i++)if(t[i].name===a){a=i;break}break;default:if(void 0===t[i])return void void 0;t=t[i]}if(void 0!==a){if(void 0===t[a])return void void 0;t=t[a]}}if(void 0===(a=t[r]))void 0;else{if(e=this.Versioning.None,this.targetObject=t,void 0!==t.needsUpdate?e=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(e=this.Versioning.MatrixWorldNeedsUpdate),i=this.BindingType.Direct,void 0!==n){if("morphTargetInfluences"===r){if(!t.geometry)return void void 0;if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return void void 0;for(i=0;i<this.node.geometry.morphAttributes.position.length;i++)if(t.geometry.morphAttributes.position[i].name===n){n=i;break}}else{if(!t.geometry.morphTargets)return void void 0;for(i=0;i<this.node.geometry.morphTargets.length;i++)if(t.geometry.morphTargets[i].name===n){n=i;break}}}i=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=n}else void 0!==a.fromArray&&void 0!==a.toArray?(i=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(i=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[i],this.setValue=this.SetterByBindingTypeAndVersioning[i][e]}}else void 0},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(Vn.prototype,{_getValue_unbound:Vn.prototype.getValue,_setValue_unbound:Vn.prototype.setValue}),Object.assign(kn.prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=this._objects,e=t.length,i=this.nCachedObjects_,r=this._indicesByUUID,n=this._paths,a=this._parsedPaths,o=this._bindings,s=o.length,c=void 0,h=0,l=arguments.length;h!==l;++h){var u=arguments[h],p=u.uuid,d=r[p];if(void 0===d){d=e++,r[p]=d,t.push(u),p=0;for(var f=s;p!==f;++p)o[p].push(new Vn(u,n[p],a[p]))}else if(d<i){c=t[d];var m=--i;for(r[(f=t[m]).uuid]=d,t[d]=f,r[p]=m,t[m]=u,p=0,f=s;p!==f;++p){var g=o[p],v=g[d];g[d]=g[m],void 0===v&&(v=new Vn(u,n[p],a[p])),g[m]=v}}else t[d]!==c&&void 0}this.nCachedObjects_=i},remove:function(){for(var t=this._objects,e=this.nCachedObjects_,i=this._indicesByUUID,r=this._bindings,n=r.length,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],c=s.uuid,h=i[c];if(void 0!==h&&h>=e){var l=e++,u=t[l];for(i[u.uuid]=h,t[h]=u,i[c]=l,t[l]=s,s=0,c=n;s!==c;++s){var p=(u=r[s])[h];u[h]=u[l],u[l]=p}}}this.nCachedObjects_=e},uncache:function(){for(var t=this._objects,e=t.length,i=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,a=n.length,o=0,s=arguments.length;o!==s;++o){var c=arguments[o].uuid,h=r[c];if(void 0!==h)if(delete r[c],h<i){var l=t[c=--i],u=--e,p=t[u];for(r[l.uuid]=h,t[h]=l,r[p.uuid]=c,t[c]=p,t.pop(),l=0,p=a;l!==p;++l){var d=n[l],f=d[u];d[h]=d[c],d[c]=f,d.pop()}}else for(r[(p=t[u=--e]).uuid]=h,t[h]=p,t.pop(),l=0,p=a;l!==p;++l)(d=n[l])[h]=d[u],d.pop()}this.nCachedObjects_=i},subscribe_:function(t,e){var i=this._bindingsIndicesByPath,r=i[t],n=this._bindings;if(void 0!==r)return n[r];var a=this._paths,o=this._parsedPaths,s=this._objects,c=this.nCachedObjects_,h=Array(s.length);for(r=n.length,i[t]=r,a.push(t),o.push(e),n.push(h),i=c,r=s.length;i!==r;++i)h[i]=new Vn(s[i],t,e);return h},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,i=e[t];if(void 0!==i){var r=this._paths,n=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];e[t[o]]=i,a[i]=s,a.pop(),n[i]=n[o],n.pop(),r[i]=r[o],r.pop()}}}),Object.assign(Wn.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){i=this._clip.duration;var r=t._clip.duration,n=i/r;t.warp(1,r/i,e),this.warp(n,1,e)}return this},crossFadeTo:function(t,e,i){return t.crossFadeFrom(this,e,i)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,i){var r=this._mixer,n=r.time,a=this._timeScaleInterpolant,o=this.timeScale;return null===a&&(this._timeScaleInterpolant=a=r._lendControlInterpolant()),r=a.parameterPositions,a=a.sampleValues,r[0]=n,r[1]=n+i,a[0]=t/o,a[1]=e/o,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,i,r){if(this.enabled){var n=this._startTime;if(null!==n){if(0>(e=(t-n)*i)||0===i)return;this._startTime=null,e*=i}if(e*=this._updateTimeScale(t),i=this._updateTime(e),0<(t=this._updateWeight(t))){e=this._interpolants,n=this._propertyBindings;for(var a=0,o=e.length;a!==o;++a)e[a].evaluate(i),n[a].accumulate(r,t)}}else this._updateWeight(t)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var i=this._weightInterpolant;if(null!==i){var r=i.evaluate(t)[0];e*=r,t>i.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var i=this._timeScaleInterpolant;if(null!==i)e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}return this._effectiveTimeScale=e},_updateTime:function(t){var e=this.time+t,i=this._clip.duration,r=this.loop,n=this._loopCount,a=2202===r;if(0===t)return-1===n?e:a&&1==(1&n)?i-e:e;if(2200===r)t:{if(-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1)),e>=i)e=i;else{if(!(0>e)){this.time=e;break t}e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:0>t?-1:1})}else{if(-1===n&&(0<=t?(n=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),e>=i||0>e){e-=i*(r=Math.floor(e/i)),n+=Math.abs(r);var o=this.repetitions-n;0>=o?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=e=0<t?i:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<t?1:-1})):(1===o?(t=0>t,this._setEndings(t,!t,a)):this._setEndings(!1,!1,a),this._loopCount=n,this.time=e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:r}))}else this.time=e;if(a&&1==(1&n))return i-e}return e},_setEndings:function(t,e,i){var r=this._interpolantSettings;i?(r.endingStart=2401,r.endingEnd=2401):(r.endingStart=t?this.zeroSlopeAtStart?2401:2400:2402,r.endingEnd=e?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(t,e,i){var r=this._mixer,n=r.time,a=this._weightInterpolant;return null===a&&(this._weightInterpolant=a=r._lendControlInterpolant()),r=a.parameterPositions,a=a.sampleValues,r[0]=n,a[0]=e,r[1]=n+t,a[1]=i,this}}),qn.prototype=Object.assign(Object.create(e.prototype),{constructor:qn,_bindAction:function(t,e){var i=t._localRoot||this._root,r=t._clip.tracks,n=r.length,a=t._propertyBindings;t=t._interpolants;var o=i.uuid,s=this._bindingsByRootAndName,c=s[o];for(void 0===c&&(c={},s[o]=c),s=0;s!==n;++s){var h=r[s],l=h.name,u=c[l];if(void 0===u){if(void 0!==(u=a[s])){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,o,l));continue}++(u=new Gn(Vn.create(i,l,e&&e._propertyBindings[s].binding.parsedPath),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(u,o,l)}a[s]=u,t[s].resultBuffer=u.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,i=t._clip.uuid,r=this._actionsByClip[i];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,i,e)}for(i=0,r=(e=t._propertyBindings).length;i!==r;++i){var n=e[i];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,i=0,r=e.length;i!==r;++i){var n=e[i];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){return null!==(t=t._cacheIndex)&&t<this._nActiveActions},_addInactiveAction:function(t,e,i){var r=this._actions,n=this._actionsByClip,a=n[e];void 0===a?(a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,n[e]=a):(e=a.knownActions,t._byClipCacheIndex=e.length,e.push(t)),t._cacheIndex=r.length,r.push(t),a.actionByRoot[i]=t},_removeInactiveAction:function(t){var e=this._actions,i=e[e.length-1],r=t._cacheIndex;i._cacheIndex=r,e[r]=i,e.pop(),t._cacheIndex=null,e=t._clip.uuid;var n=(r=(i=this._actionsByClip)[e]).knownActions,a=n[n.length-1],o=t._byClipCacheIndex;a._byClipCacheIndex=o,n[o]=a,n.pop(),t._byClipCacheIndex=null,delete r.actionByRoot[(t._localRoot||this._root).uuid],0===n.length&&delete i[e],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=0,i=(t=t._propertyBindings).length;e!==i;++e){var r=t[e];0==--r.referenceCount&&this._removeInactiveBinding(r)}},_lendAction:function(t){var e=this._actions,i=t._cacheIndex,r=this._nActiveActions++,n=e[r];t._cacheIndex=r,e[r]=t,n._cacheIndex=i,e[i]=n},_takeBackAction:function(t){var e=this._actions,i=t._cacheIndex,r=--this._nActiveActions,n=e[r];t._cacheIndex=r,e[r]=t,n._cacheIndex=i,e[i]=n},_addInactiveBinding:function(t,e,i){var r=this._bindingsByRootAndName,n=r[e],a=this._bindings;void 0===n&&(n={},r[e]=n),n[i]=t,t._cacheIndex=a.length,a.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,i=t.binding,r=i.rootNode.uuid;i=i.path;var n=this._bindingsByRootAndName,a=n[r],o=e[e.length-1];t=t._cacheIndex,o._cacheIndex=t,e[t]=o,e.pop(),delete a[i],0===Object.keys(a).length&&delete n[r]},_lendBinding:function(t){var e=this._bindings,i=t._cacheIndex,r=this._nActiveBindings++,n=e[r];t._cacheIndex=r,e[r]=t,n._cacheIndex=i,e[i]=n},_takeBackBinding:function(t){var e=this._bindings,i=t._cacheIndex,r=--this._nActiveBindings,n=e[r];t._cacheIndex=r,e[r]=t,n._cacheIndex=i,e[i]=n},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,i=t[e];return void 0===i&&((i=new wr(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=i),i},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,i=t.__cacheIndex,r=--this._nActiveControlInterpolants,n=e[r];t.__cacheIndex=r,e[r]=t,n.__cacheIndex=i,e[i]=n},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e){var i=e||this._root,r=i.uuid;t=null!==(i="string"==typeof t?Or.findByName(i,t):t)?i.uuid:t;var n=this._actionsByClip[t],a=null;if(void 0!==n){if(void 0!==(a=n.actionByRoot[r]))return a;a=n.knownActions[0],null===i&&(i=a._clip)}return null===i?null:(e=new Wn(this,i,e),this._bindAction(e,a),this._addInactiveAction(e,t,r),e)},existingAction:function(t,e){var i=e||this._root;return e=i.uuid,i="string"==typeof t?Or.findByName(i,t):t,void 0!==(t=this._actionsByClip[i?i.uuid:t])&&t.actionByRoot[e]||null},stopAllAction:function(){for(var t=this._actions,e=this._nActiveActions,i=this._bindings,r=this._nActiveBindings,n=this._nActiveBindings=this._nActiveActions=0;n!==e;++n)t[n].reset();for(n=0;n!==r;++n)i[n].useCount=0;return this},update:function(t){t*=this.timeScale;for(var e=this._actions,i=this._nActiveActions,r=this.time+=t,n=Math.sign(t),a=this._accuIndex^=1,o=0;o!==i;++o)e[o]._update(r,t,n,a);for(t=this._bindings,e=this._nActiveBindings,o=0;o!==e;++o)t[o].apply(a);return this},setTime:function(t){for(var e=this.time=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions;t=t.uuid;var i=this._actionsByClip,r=i[t];if(void 0!==r){for(var n=0,a=(r=r.knownActions).length;n!==a;++n){var o=r[n];this._deactivateAction(o);var s=o._cacheIndex,c=e[e.length-1];o._cacheIndex=null,o._byClipCacheIndex=null,c._cacheIndex=s,e[s]=c,e.pop(),this._removeInactiveBindingsForAction(o)}delete i[t]}},uncacheRoot:function(t){t=t.uuid;var e=this._actionsByClip;for(r in e){var i=e[r].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var r=this._bindingsByRootAndName[t];if(void 0!==r)for(var n in r)(t=r[n]).restoreOriginalState(),this._removeInactiveBinding(t)},uncacheAction:function(t,e){null!==(t=this.existingAction(t,e))&&(this._deactivateAction(t),this._removeInactiveAction(t))}}),Xn.prototype.clone=function(){return new Xn(void 0===this.value.clone?this.value:this.value.clone())},Yn.prototype=Object.assign(Object.create(ze.prototype),{constructor:Yn,isInstancedInterleavedBuffer:!0,copy:function(t){return ze.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Object.assign(Jn.prototype,{linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):void 0},intersectObject:function(t,e,i){return Kn(t,this,i=i||[],e),i.sort(Zn),i},intersectObjects:function(t,e,i){if(i=i||[],!1===Array.isArray(t))return void 0,i;for(var r=0,n=t.length;r<n;r++)Kn(t[r],this,i,e);return i.sort(Zn),i}}),Object.assign(Qn.prototype,{set:function(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(t,i),this.phi=Math.acos(Ta.clamp(e/this.radius,-1,1))),this}}),Object.assign($n.prototype,{set:function(t,e,i){return this.radius=t,this.theta=e,this.y=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,i){return this.radius=Math.sqrt(t*t+i*i),this.theta=Math.atan2(t,i),this.y=e,this}});var Kc=new i;Object.assign(ta.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){return e=Kc.copy(e).multiplyScalar(.5),this.min.copy(t).sub(e),this.max.copy(t).add(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return void 0===t&&(void 0,t=new i),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(void 0,t=new i),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return void 0===e&&(void 0,e=new i),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return void 0===e&&(void 0,e=new i),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return Kc.copy(t).clamp(this.min,this.max).sub(t).length()},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var Qc=new n,$c=new n;Object.assign(ea.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return void 0===t&&(void 0,t=new n),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return void 0===t&&(void 0,t=new n),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return void 0===e&&(void 0,e=new n),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(t,e){return Qc.subVectors(t,this.start),$c.subVectors(this.end,this.start),t=$c.dot($c),t=$c.dot(Qc)/t,e&&(t=Ta.clamp(t,0,1)),t},closestPointToPoint:function(t,e,i){return t=this.closestPointToPointParameter(t,e),void 0===i&&(void 0,i=new n),this.delta(i).multiplyScalar(t).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),ia.prototype=Object.create(d.prototype),ia.prototype.constructor=ia,ia.prototype.isImmediateRenderObject=!0;var th=new n,eh=new n,ih=new a,rh=["a","b","c"];ra.prototype=Object.create(Qe.prototype),ra.prototype.constructor=ra,ra.prototype.update=function(){this.object.updateMatrixWorld(!0),ih.getNormalMatrix(this.object.matrixWorld);var t=this.object.matrixWorld,e=this.geometry.attributes.position,i=this.object.geometry;if(i&&i.isGeometry)for(var r=i.vertices,n=i.faces,a=i=0,o=n.length;a<o;a++)for(var s=n[a],c=0,h=s.vertexNormals.length;c<h;c++){var l=s.vertexNormals[c];th.copy(r[s[rh[c]]]).applyMatrix4(t),eh.copy(l).applyMatrix3(ih).normalize().multiplyScalar(this.size).add(th),e.setXYZ(i,th.x,th.y,th.z),i+=1,e.setXYZ(i,eh.x,eh.y,eh.z),i+=1}else if(i&&i.isBufferGeometry)for(r=i.attributes.position,n=i.attributes.normal,c=i=0,h=r.count;c<h;c++)th.set(r.getX(c),r.getY(c),r.getZ(c)).applyMatrix4(t),eh.set(n.getX(c),n.getY(c),n.getZ(c)),eh.applyMatrix3(ih).normalize().multiplyScalar(this.size).add(th),e.setXYZ(i,th.x,th.y,th.z),i+=1,e.setXYZ(i,eh.x,eh.y,eh.z),i+=1;e.needsUpdate=!0};var nh=new n;na.prototype=Object.create(d.prototype),na.prototype.constructor=na,na.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},na.prototype.update=function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),nh.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(nh),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var ah=new n,oh=new l,sh=new l;aa.prototype=Object.create(Qe.prototype),aa.prototype.constructor=aa,aa.prototype.updateMatrixWorld=function(t){var e=this.bones,i=this.geometry,r=i.getAttribute("position");sh.getInverse(this.root.matrixWorld);for(var n=0,a=0;n<e.length;n++){var o=e[n];o.parent&&o.parent.isBone&&(oh.multiplyMatrices(sh,o.matrixWorld),ah.setFromMatrixPosition(oh),r.setXYZ(a,ah.x,ah.y,ah.z),oh.multiplyMatrices(sh,o.parent.matrixWorld),ah.setFromMatrixPosition(oh),r.setXYZ(a+1,ah.x,ah.y,ah.z),a+=2)}i.getAttribute("position").needsUpdate=!0,d.prototype.updateMatrixWorld.call(this,t)},oa.prototype=Object.create(G.prototype),oa.prototype.constructor=oa,oa.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},oa.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},sa.prototype=Object.create(Ke.prototype),sa.prototype.constructor=sa,sa.prototype.update=function(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var t=this.material.color,e=Math.max(t.r,t.g,t.b);1<e&&t.multiplyScalar(1/e),this.children[0].material.color.copy(this.material.color)}},sa.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()};var ch=new n,hh=new b,lh=new b;ca.prototype=Object.create(d.prototype),ca.prototype.constructor=ca,ca.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},ca.prototype.update=function(){var t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var e=t.geometry.getAttribute("color");hh.copy(this.light.color),lh.copy(this.light.groundColor);for(var i=0,r=e.count;i<r;i++){var n=i<r/2?hh:lh;e.setXYZ(i,n.r,n.g,n.b)}e.needsUpdate=!0}t.lookAt(ch.setFromMatrixPosition(this.light.matrixWorld).negate())},ha.prototype=Object.create(G.prototype),ha.prototype.constructor=ha,ha.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},ha.prototype.onBeforeRender=function(){this.position.copy(this.lightProbe.position),this.scale.set(1,1,1).multiplyScalar(this.size),this.material.uniforms.intensity.value=this.lightProbe.intensity},la.prototype=Object.assign(Object.create(Qe.prototype),{constructor:la,copy:function(t){return Qe.prototype.copy.call(this,t),this.geometry.copy(t.geometry),this.material.copy(t.material),this},clone:function(){return(new this.constructor).copy(this)}}),ua.prototype=Object.create(Qe.prototype),ua.prototype.constructor=ua,pa.prototype=Object.create(Ke.prototype),pa.prototype.constructor=pa,pa.prototype.update=function(){function t(t,r,a,o){for(a=(r-t)/a,d.setXYZ(l,0,0,0),u++,e=t;e<r;e+=a)i=l+u,d.setXYZ(i,Math.sin(e)*n,0,Math.cos(e)*n),d.setXYZ(i+1,Math.sin(Math.min(e+a,r))*n,0,Math.cos(Math.min(e+a,r))*n),d.setXYZ(i+2,0,0,0),u+=3;p.addGroup(l,u,o),l+=u,u=0}var e,i,r=this.audio,n=this.range,a=this.divisionsInnerAngle,o=this.divisionsOuterAngle,s=Ta.degToRad(r.panner.coneInnerAngle),c=s/2,h=(r=Ta.degToRad(r.panner.coneOuterAngle))/2,l=0,u=0,p=this.geometry,d=p.attributes.position;p.clearGroups(),t(-h,-c,o,0),t(-c,c,a,1),t(c,h,o,0),d.needsUpdate=!0,s===r&&(this.material[0].visible=!1)},pa.prototype.dispose=function(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()};var uh=new n,ph=new n,dh=new a;da.prototype=Object.create(Qe.prototype),da.prototype.constructor=da,da.prototype.update=function(){this.object.updateMatrixWorld(!0),dh.getNormalMatrix(this.object.matrixWorld);for(var t=this.object.matrixWorld,e=this.geometry.attributes.position,i=this.object.geometry,r=i.vertices,n=0,a=0,o=(i=i.faces).length;a<o;a++){var s=i[a],c=s.normal;uh.copy(r[s.a]).add(r[s.b]).add(r[s.c]).divideScalar(3).applyMatrix4(t),ph.copy(c).applyMatrix3(dh).normalize().multiplyScalar(this.size).add(uh),e.setXYZ(n,uh.x,uh.y,uh.z),n+=1,e.setXYZ(n,ph.x,ph.y,ph.z),n+=1}e.needsUpdate=!0};var fh=new n,mh=new n,gh=new n;fa.prototype=Object.create(d.prototype),fa.prototype.constructor=fa,fa.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},fa.prototype.update=function(){fh.setFromMatrixPosition(this.light.matrixWorld),mh.setFromMatrixPosition(this.light.target.matrixWorld),gh.subVectors(mh,fh),this.lightPlane.lookAt(mh),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(mh),this.targetLine.scale.z=gh.length()};var vh=new n,yh=new Y;ma.prototype=Object.create(Qe.prototype),ma.prototype.constructor=ma,ma.prototype.update=function(){var t=this.geometry,e=this.pointMap;yh.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ga("c",e,t,yh,0,0,-1),ga("t",e,t,yh,0,0,1),ga("n1",e,t,yh,-1,-1,-1),ga("n2",e,t,yh,1,-1,-1),ga("n3",e,t,yh,-1,1,-1),ga("n4",e,t,yh,1,1,-1),ga("f1",e,t,yh,-1,-1,1),ga("f2",e,t,yh,1,-1,1),ga("f3",e,t,yh,-1,1,1),ga("f4",e,t,yh,1,1,1),ga("u1",e,t,yh,.7,1.1,-1),ga("u2",e,t,yh,-.7,1.1,-1),ga("u3",e,t,yh,0,2,-1),ga("cf1",e,t,yh,-1,0,1),ga("cf2",e,t,yh,1,0,1),ga("cf3",e,t,yh,0,-1,1),ga("cf4",e,t,yh,0,1,1),ga("cn1",e,t,yh,-1,0,-1),ga("cn2",e,t,yh,1,0,-1),ga("cn3",e,t,yh,0,-1,-1),ga("cn4",e,t,yh,0,1,-1),t.getAttribute("position").needsUpdate=!0};var Eh=new m;va.prototype=Object.create(Qe.prototype),va.prototype.constructor=va,va.prototype.update=function(t){if(void 0!==t&&void 0,void 0!==this.object&&Eh.setFromObject(this.object),!Eh.isEmpty()){t=Eh.min;var e=Eh.max,i=this.geometry.attributes.position,r=i.array;r[0]=e.x,r[1]=e.y,r[2]=e.z,r[3]=t.x,r[4]=e.y,r[5]=e.z,r[6]=t.x,r[7]=t.y,r[8]=e.z,r[9]=e.x,r[10]=t.y,r[11]=e.z,r[12]=e.x,r[13]=e.y,r[14]=t.z,r[15]=t.x,r[16]=e.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=e.x,r[22]=t.y,r[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}},va.prototype.setFromObject=function(t){return this.object=t,this.update(),this},va.prototype.copy=function(t){return Qe.prototype.copy.call(this,t),this.object=t.object,this},va.prototype.clone=function(){return(new this.constructor).copy(this)},ya.prototype=Object.create(Qe.prototype),ya.prototype.constructor=ya,ya.prototype.updateMatrixWorld=function(t){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),d.prototype.updateMatrixWorld.call(this,t))},Ea.prototype=Object.create(Ke.prototype),Ea.prototype.constructor=Ea,Ea.prototype.updateMatrixWorld=function(t){var e=-this.plane.constant;1e-8>Math.abs(e)&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=0>e?1:0,this.lookAt(this.plane.normal),d.prototype.updateMatrixWorld.call(this,t)};var xh,bh,Sh=new n;xa.prototype=Object.create(d.prototype),xa.prototype.constructor=xa,xa.prototype.setDirection=function(t){.99999<t.y?this.quaternion.set(0,0,0,1):-.99999>t.y?this.quaternion.set(1,0,0,0):(Sh.set(t.z,0,-t.x).normalize(),this.quaternion.setFromAxisAngle(Sh,Math.acos(t.y)))},xa.prototype.setLength=function(t,e,i){void 0===e&&(e=.2*t),void 0===i&&(i=.2*e),this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(i,e,i),this.cone.position.y=t,this.cone.updateMatrix()},xa.prototype.setColor=function(t){this.line.material.color.set(t),this.cone.material.color.set(t)},xa.prototype.copy=function(t){return d.prototype.copy.call(this,t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this},xa.prototype.clone=function(){return(new this.constructor).copy(this)},ba.prototype=Object.create(Qe.prototype),ba.prototype.constructor=ba,kr.create=function(t,e){return void 0,t.prototype=Object.create(kr.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(on.prototype,{createPointsGeometry:function(t){return void 0,t=this.getPoints(t),this.createGeometry(t)},createSpacedPointsGeometry:function(t){return void 0,t=this.getSpacedPoints(t),this.createGeometry(t)},createGeometry:function(t){void 0;for(var e=new k,i=0,r=t.length;i<r;i++){var a=t[i];e.vertices.push(new n(a.x,a.y,a.z||0))}return e}}),Object.assign(sn.prototype,{fromPoints:function(t){return void 0,this.setFromPoints(t)}}),Sa.prototype=Object.create(Yr.prototype),wa.prototype=Object.create(Yr.prototype),_a.prototype=Object.create(Yr.prototype),Object.assign(_a.prototype,{initFromArray:function(){void 0},getControlPointsArray:function(){void 0},reparametrizeByArcLength:function(){void 0}}),la.prototype.setColors=function(){void 0},aa.prototype.update=function(){void 0},Object.assign(Nr.prototype,{extractUrlBase:function(t){return void 0,Ac.extractUrlBase(t)}}),Nr.Handlers={add:function(){void 0},get:function(){void 0}},Object.assign(Mn.prototype,{setTexturePath:function(t){return void 0,this.setResourcePath(t)}}),Object.assign(ta.prototype,{center:function(t){return void 0,this.getCenter(t)},empty:function(){return void 0,this.isEmpty()},isIntersectionBox:function(t){return void 0,this.intersectsBox(t)},size:function(t){return void 0,this.getSize(t)}}),Object.assign(m.prototype,{center:function(t){return void 0,this.getCenter(t)},empty:function(){return void 0,this.isEmpty()},isIntersectionBox:function(t){return void 0,this.intersectsBox(t)},isIntersectionSphere:function(t){return void 0,this.intersectsSphere(t)},size:function(t){return void 0,this.getSize(t)}}),ea.prototype.center=function(t){return void 0,this.getCenter(t)},Object.assign(Ta,{random16:function(){return void 0,Math.random()},nearestPowerOfTwo:function(t){return void 0,Ta.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return void 0,Ta.ceilPowerOfTwo(t)}}),Object.assign(a.prototype,{flattenToArrayOffset:function(t,e){return void 0,this.toArray(t,e)},multiplyVector3:function(t){return void 0,t.applyMatrix3(this)},multiplyVector3Array:function(){void 0},applyToBuffer:function(t){return void 0,this.applyToBufferAttribute(t)},applyToVector3Array:function(){void 0}}),Object.assign(l.prototype,{extractPosition:function(t){return void 0,this.copyPosition(t)},flattenToArrayOffset:function(t,e){return void 0,this.toArray(t,e)},getPosition:function(){return void 0,(new n).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return void 0,this.makeRotationFromQuaternion(t)},multiplyToArray:function(){void 0},multiplyVector3:function(t){return void 0,t.applyMatrix4(this)},multiplyVector4:function(t){return void 0,t.applyMatrix4(this)},multiplyVector3Array:function(){void 0},rotateAxis:function(t){void 0,t.transformDirection(this)},crossVector:function(t){return void 0,t.applyMatrix4(this)},translate:function(){void 0},rotateX:function(){void 0},rotateY:function(){void 0},rotateZ:function(){void 0},rotateByAxis:function(){void 0},applyToBuffer:function(t){return void 0,this.applyToBufferAttribute(t)},applyToVector3Array:function(){void 0},makeFrustum:function(t,e,i,r,n,a){return void 0,this.makePerspective(t,e,r,i,n,a)}}),E.prototype.isIntersectionLine=function(t){return void 0,this.intersectsLine(t)},r.prototype.multiplyVector3=function(t){return void 0,t.applyQuaternion(this)},Object.assign(y.prototype,{isIntersectionBox:function(t){return void 0,this.intersectsBox(t)},isIntersectionPlane:function(t){return void 0,this.intersectsPlane(t)},isIntersectionSphere:function(t){return void 0,this.intersectsSphere(t)}}),Object.assign(x.prototype,{area:function(){return void 0,this.getArea()},barycoordFromPoint:function(t,e){return void 0,this.getBarycoord(t,e)},midpoint:function(t){return void 0,this.getMidpoint(t)},normal:function(t){return void 0,this.getNormal(t)},plane:function(t){return void 0,this.getPlane(t)}}),Object.assign(x,{barycoordFromPoint:function(t,e,i,r,n){return void 0,x.getBarycoord(t,e,i,r,n)},normal:function(t,e,i,r){return void 0,x.getNormal(t,e,i,r)}}),Object.assign(cn.prototype,{extractAllPoints:function(t){return void 0,this.extractPoints(t)},extrude:function(t){return void 0,new ki(this,t)},makeGeometry:function(t){return void 0,new er(this,t)}}),Object.assign(i.prototype,{fromAttribute:function(t,e,i){return void 0,this.fromBufferAttribute(t,e,i)},distanceToManhattan:function(t){return void 0,this.manhattanDistanceTo(t)},lengthManhattan:function(){return void 0,this.manhattanLength()}}),Object.assign(n.prototype,{setEulerFromRotationMatrix:function(){void 0},setEulerFromQuaternion:function(){void 0},getPositionFromMatrix:function(t){return void 0,this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return void 0,this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return void 0,this.setFromMatrixColumn(e,t)},applyProjection:function(t){return void 0,this.applyMatrix4(t)},fromAttribute:function(t,e,i){return void 0,this.fromBufferAttribute(t,e,i)},distanceToManhattan:function(t){return void 0,this.manhattanDistanceTo(t)},lengthManhattan:function(){return void 0,this.manhattanLength()}}),Object.assign(s.prototype,{fromAttribute:function(t,e,i){return void 0,this.fromBufferAttribute(t,e,i)},lengthManhattan:function(){return void 0,this.manhattanLength()}}),Object.assign(k.prototype,{computeTangents:function(){void 0},computeLineDistances:function(){void 0}}),Object.assign(d.prototype,{getChildByName:function(t){return void 0,this.getObjectByName(t)},renderDepth:function(){void 0},translate:function(t,e){return void 0,this.translateOnAxis(e,t)},getWorldRotation:function(){void 0}}),Object.defineProperties(d.prototype,{eulerOrder:{get:function(){return void 0,this.rotation.order},set:function(t){void 0,this.rotation.order=t}},useQuaternion:{get:function(){void 0},set:function(){void 0}}}),Object.defineProperties(We.prototype,{objects:{get:function(){return void 0,this.levels}}}),Object.defineProperty(Xe.prototype,"useVertexTexture",{get:function(){void 0},set:function(){void 0}}),qe.prototype.initBones=function(){void 0},Object.defineProperty(kr.prototype,"__arcLengthDivisions",{get:function(){return void 0,this.arcLengthDivisions},set:function(t){void 0,this.arcLengthDivisions=t}}),J.prototype.setLens=function(t,e){void 0,void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(hn.prototype,{onlyShadow:{set:function(){void 0}},shadowCameraFov:{set:function(t){void 0,this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){void 0,this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){void 0,this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){void 0,this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){void 0,this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){void 0,this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){void 0,this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){void 0}},shadowBias:{set:function(t){void 0,this.shadow.bias=t}},shadowDarkness:{set:function(){void 0}},shadowMapWidth:{set:function(t){void 0,this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){void 0,this.shadow.mapSize.height=t}}}),Object.defineProperties(D.prototype,{length:{get:function(){return void 0,this.array.length}},dynamic:{get:function(){return void 0,35048===this.usage},set:function(){void 0,this.setUsage(35048)}}}),Object.assign(D.prototype,{setDynamic:function(t){return void 0,this.setUsage(!0===t?35048:35044),this},copyIndicesArray:function(){void 0},setArray:function(){void 0}}),Object.assign(z.prototype,{addIndex:function(t){void 0,this.setIndex(t)},addAttribute:function(t,e,i){return void 0,e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(void 0,this.setIndex(e),this):this.setAttribute(t,e):(void 0,this.setAttribute(t,new D(e,i)))},addDrawCall:function(t,e,i){void 0!==i&&void 0,void 0,this.addGroup(t,e)},clearDrawCalls:function(){void 0,this.clearGroups()},computeTangents:function(){void 0},computeOffsets:function(){void 0},removeAttribute:function(t){return void 0,this.deleteAttribute(t)}}),Object.defineProperties(z.prototype,{drawcalls:{get:function(){return void 0,this.groups}},offsets:{get:function(){return void 0,this.groups}}}),Object.defineProperties(ze.prototype,{dynamic:{get:function(){return void 0,35048===this.usage},set:function(t){void 0,this.setUsage(t)}}}),Object.assign(ze.prototype,{setDynamic:function(t){return void 0,this.setUsage(!0===t?35048:35044),this},setArray:function(){void 0}}),Object.assign(Wi.prototype,{getArrays:function(){void 0},addShapeList:function(){void 0},addShape:function(){void 0}}),Object.defineProperties(Xn.prototype,{dynamic:{set:function(){void 0}},onUpdate:{value:function(){return void 0,this}}}),Object.defineProperties(A.prototype,{wrapAround:{get:function(){void 0},set:function(){void 0}},overdraw:{get:function(){void 0},set:function(){void 0}},wrapRGB:{get:function(){return void 0,new b}},shading:{get:function(){void 0},set:function(t){void 0,this.flatShading=1===t}},stencilMask:{get:function(){return void 0,this.stencilFuncMask},set:function(t){void 0,this.stencilFuncMask=t}}}),Object.defineProperties(mr.prototype,{metal:{get:function(){return void 0,!1},set:function(){void 0}}}),Object.defineProperties(X.prototype,{derivatives:{get:function(){return void 0,this.extensions.derivatives},set:function(t){void 0,this.extensions.derivatives=t}}}),Object.assign(Ue.prototype,{clearTarget:function(t,e,i,r){void 0,this.setRenderTarget(t),this.clear(e,i,r)},animate:function(t){void 0,this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return void 0,this.getRenderTarget()},getMaxAnisotropy:function(){return void 0,this.capabilities.getMaxAnisotropy()},getPrecision:function(){return void 0,this.capabilities.precision},resetGLState:function(){return void 0,this.state.reset()},supportsFloatTextures:function(){return void 0,this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return void 0,this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return void 0,this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return void 0,this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return void 0,this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return void 0,this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return void 0,this.capabilities.vertexTextures},supportsInstancedArrays:function(){return void 0,this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){void 0,this.setScissorTest(t)},initMaterial:function(){void 0},addPrePlugin:function(){void 0},addPostPlugin:function(){void 0},updateShadowMap:function(){void 0},setFaceCulling:function(){void 0},allocTextureUnit:function(){void 0},setTexture:function(){void 0},setTexture2D:function(){void 0},setTextureCube:function(){void 0},getActiveMipMapLevel:function(){return void 0,this.getActiveMipmapLevel()}}),Object.defineProperties(Ue.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){void 0,this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){void 0,this.shadowMap.type=t}},shadowMapCullFace:{get:function(){void 0},set:function(){void 0}},context:{get:function(){return void 0,this.getContext()}}}),Object.defineProperties(Ae.prototype,{cullFace:{get:function(){void 0},set:function(){void 0}},renderReverseSided:{get:function(){void 0},set:function(){void 0}},renderSingleSided:{get:function(){void 0},set:function(){void 0}}}),Object.defineProperties(K.prototype,{activeCubeFace:{set:function(){void 0}},activeMipMapLevel:{set:function(){void 0}}}),Object.defineProperties(c.prototype,{wrapS:{get:function(){return void 0,this.texture.wrapS},set:function(t){void 0,this.texture.wrapS=t}},wrapT:{get:function(){return void 0,this.texture.wrapT},set:function(t){void 0,this.texture.wrapT=t}},magFilter:{get:function(){return void 0,this.texture.magFilter},set:function(t){void 0,this.texture.magFilter=t}},minFilter:{get:function(){return void 0,this.texture.minFilter},set:function(t){void 0,this.texture.minFilter=t}},anisotropy:{get:function(){return void 0,this.texture.anisotropy},set:function(t){void 0,this.texture.anisotropy=t}},offset:{get:function(){return void 0,this.texture.offset},set:function(t){void 0,this.texture.offset=t}},repeat:{get:function(){return void 0,this.texture.repeat},set:function(t){void 0,this.texture.repeat=t}},format:{get:function(){return void 0,this.texture.format},set:function(t){void 0,this.texture.format=t}},type:{get:function(){return void 0,this.texture.type},set:function(t){void 0,this.texture.type=t}},generateMipmaps:{get:function(){return void 0,this.texture.generateMipmaps},set:function(t){void 0,this.texture.generateMipmaps=t}}}),Object.defineProperties(He.prototype,{standing:{set:function(){void 0}},userHeight:{set:function(){void 0}}}),Object.defineProperties(Fn.prototype,{load:{value:function(t){void 0;var e=this;return(new Ln).load(t,(function(t){e.setBuffer(t)})),this}},startTime:{set:function(){void 0}}}),zn.prototype.getData=function(){return void 0,this.getFrequencyData()},Z.prototype.updateCubeMap=function(t,e){return void 0,this.update(t,e)},Pa.crossOrigin=void 0,Pa.loadTexture=function(t,e,i,r){void 0;var n=new Vr;return n.setCrossOrigin(this.crossOrigin),t=n.load(t,i,void 0,r),e&&(t.mapping=e),t},Pa.loadTextureCube=function(t,e,i,r){void 0;var n=new jr;return n.setCrossOrigin(this.crossOrigin),t=n.load(t,i,void 0,r),e&&(t.mapping=e),t},Pa.loadCompressedTexture=function(){void 0},Pa.loadCompressedTextureCube=function(){void 0},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"110"}})),t.ACESFilmicToneMapping=5,t.AddEquation=100,t.AddOperation=2,t.AdditiveBlending=2,t.AlphaFormat=1021,t.AlwaysDepth=1,t.AlwaysStencilFunc=519,t.AmbientLight=En,t.AmbientLightProbe=In,t.AnimationClip=Or,t.AnimationLoader=Fr,t.AnimationMixer=qn,t.AnimationObjectGroup=kn,t.AnimationUtils=vc,t.ArcCurve=qr,t.ArrayCamera=Oe,t.ArrowHelper=xa,t.Audio=Fn,t.AudioAnalyser=zn,t.AudioContext=Pc,t.AudioListener=Un,t.AudioLoader=Ln,t.AxesHelper=ba,t.AxisHelper=function(t){return void 0,new ba(t)},t.BackSide=1,t.BasicDepthPacking=3200,t.BasicShadowMap=0,t.BinaryTextureLoader=function(t){return void 0,new zr(t)},t.Bone=Ye,t.BooleanKeyframeTrack=Ar,t.BoundingBoxHelper=function(t,e){return void 0,new va(t,e)},t.Box2=ta,t.Box3=m,t.Box3Helper=ya,t.BoxBufferGeometry=ms,t.BoxGeometry=fs,t.BoxHelper=va,t.BufferAttribute=D,t.BufferGeometry=z,t.BufferGeometryLoader=_n,t.ByteType=1010,t.Cache=yc,t.Camera=Y,t.CameraHelper=ma,t.CanvasRenderer=function(){void 0},t.CanvasTexture=ai,t.CatmullRomCurve3=Yr,t.CineonToneMapping=4,t.CircleBufferGeometry=lr,t.CircleGeometry=hr,t.ClampToEdgeWrapping=1001,t.Clock=Nn,t.ClosedSplineCurve3=Sa,t.Color=b,t.ColorKeyframeTrack=Tr,t.CompressedTexture=ni,t.CompressedTextureLoader=Br,t.ConeBufferGeometry=cr,t.ConeGeometry=sr,t.CubeCamera=Z,t.CubeGeometry=fs,t.CubeReflectionMapping=301,t.CubeRefractionMapping=302,t.CubeTexture=mt,t.CubeTextureLoader=jr,t.CubeUVReflectionMapping=306,t.CubeUVRefractionMapping=307,t.CubicBezierCurve=Qr,t.CubicBezierCurve3=$r,t.CubicInterpolant=Sr,t.CullFaceBack=1,t.CullFaceFront=2,t.CullFaceFrontBack=3,t.CullFaceNone=0,t.Curve=kr,t.CurvePath=on,t.CustomBlending=5,t.CylinderBufferGeometry=or,t.CylinderGeometry=ar,t.Cylindrical=$n,t.DataTexture=Q,t.DataTexture2DArray=gt,t.DataTexture3D=vt,t.DataTextureLoader=zr,t.DecrementStencilOp=7683,t.DecrementWrapStencilOp=34056,t.DefaultLoadingManager=Ec,t.DepthFormat=1026,t.DepthStencilFormat=1027,t.DepthTexture=oi,t.DirectionalLight=yn,t.DirectionalLightHelper=fa,t.DirectionalLightShadow=vn,t.DiscreteInterpolant=_r,t.DodecahedronBufferGeometry=Ei,t.DodecahedronGeometry=yi,t.DoubleSide=2,t.DstAlphaFactor=206,t.DstColorFactor=208,t.DynamicBufferAttribute=function(t,e){return void 0,new D(t,e).setDynamic(!0)},t.DynamicCopyUsage=35050,t.DynamicDrawUsage=35048,t.DynamicReadUsage=35049,t.EdgesGeometry=nr,t.EdgesHelper=function(t,e){return void 0,new Qe(new nr(t.geometry),new Ze({color:void 0!==e?e:16777215}))},t.EllipseCurve=Wr,t.EqualDepth=4,t.EqualStencilFunc=514,t.EquirectangularReflectionMapping=303,t.EquirectangularRefractionMapping=304,t.Euler=u,t.EventDispatcher=e,t.ExtrudeBufferGeometry=Wi,t.ExtrudeGeometry=ki,t.Face3=M,t.Face4=function(t,e,i,r,n,a,o){return void 0,new M(t,e,i,n,a,o)},t.FaceColors=1,t.FaceNormalsHelper=da,t.FileLoader=Ur,t.FlatShading=1,t.Float32Attribute=function(t,e){return void 0,new N(t,e)},t.Float32BufferAttribute=N,t.Float64Attribute=function(t,e){return void 0,new U(t,e)},t.Float64BufferAttribute=U,t.FloatType=1015,t.Fog=Be,t.FogExp2=Fe,t.Font=Dn,t.FontLoader=Rn,t.FrontFaceDirectionCCW=1,t.FrontFaceDirectionCW=0,t.FrontSide=0,t.Frustum=$,t.GammaEncoding=3007,t.Geometry=k,t.GeometryUtils={merge:function(t,e,i){if(void 0,e.isMesh){e.matrixAutoUpdate&&e.updateMatrix();var r=e.matrix;e=e.geometry}t.merge(e,r,i)},center:function(t){return void 0,t.center()}},t.GreaterDepth=6,t.GreaterEqualDepth=5,t.GreaterEqualStencilFunc=518,t.GreaterStencilFunc=516,t.GridHelper=la,t.Group=Pe,t.HalfFloatType=1016,t.HemisphereLight=ln,t.HemisphereLightHelper=ca,t.HemisphereLightProbe=On,t.IcosahedronBufferGeometry=vi,t.IcosahedronGeometry=gi,t.ImageBitmapLoader=An,t.ImageLoader=Gr,t.ImageUtils=Pa,t.ImmediateRenderObject=ia,t.IncrementStencilOp=7682,t.IncrementWrapStencilOp=34055,t.InstancedBufferAttribute=wn,t.InstancedBufferGeometry=Sn,t.InstancedInterleavedBuffer=Yn,t.InstancedMesh=Je,t.Int16Attribute=function(t,e){return void 0,new P(t,e)},t.Int16BufferAttribute=P,t.Int32Attribute=function(t,e){return void 0,new I(t,e)},t.Int32BufferAttribute=I,t.Int8Attribute=function(t,e){return void 0,new R(t,e)},t.Int8BufferAttribute=R,t.IntType=1013,t.InterleavedBuffer=ze,t.InterleavedBufferAttribute=Ge,t.Interpolant=br,t.InterpolateDiscrete=2300,t.InterpolateLinear=2301,t.InterpolateSmooth=2302,t.InvertStencilOp=5386,t.JSONLoader=function(){void 0},t.KeepStencilOp=7680,t.KeyframeTrack=Mr,t.LOD=We,t.LatheBufferGeometry=tr,t.LatheGeometry=$i,t.Layers=p,t.LensFlare=function(){void 0},t.LessDepth=2,t.LessEqualDepth=3,t.LessEqualStencilFunc=515,t.LessStencilFunc=513,t.Light=hn,t.LightProbe=Pn,t.LightProbeHelper=ha,t.LightShadow=un,t.Line=Ke,t.Line3=ea,t.LineBasicMaterial=Ze,t.LineCurve=tn,t.LineCurve3=en,t.LineDashedMaterial=xr,t.LineLoop=$e,t.LinePieces=1,t.LineSegments=Qe,t.LineStrip=0,t.LinearEncoding=3e3,t.LinearFilter=1006,t.LinearInterpolant=wr,t.LinearMipMapLinearFilter=1008,t.LinearMipMapNearestFilter=1007,t.LinearMipmapLinearFilter=1008,t.LinearMipmapNearestFilter=1007,t.LinearToneMapping=1,t.Loader=Nr,t.LoaderUtils=Ac,t.LoadingManager=Hr,t.LogLuvEncoding=3003,t.LoopOnce=2200,t.LoopPingPong=2202,t.LoopRepeat=2201,t.LuminanceAlphaFormat=1025,t.LuminanceFormat=1024,t.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},t.Material=A,t.MaterialLoader=bn,t.Math=Ta,t.Matrix3=a,t.Matrix4=l,t.MaxEquation=104,t.Mesh=G,t.MeshBasicMaterial=T,t.MeshDepthMaterial=_e,t.MeshDistanceMaterial=Me,t.MeshFaceMaterial=function(t){return void 0,t},t.MeshLambertMaterial=yr,t.MeshMatcapMaterial=Er,t.MeshNormalMaterial=vr,t.MeshPhongMaterial=mr,t.MeshPhysicalMaterial=fr,t.MeshStandardMaterial=dr,t.MeshToonMaterial=gr,t.MinEquation=103,t.MirroredRepeatWrapping=1002,t.MixOperation=1,t.MultiMaterial=function(t){return void 0===t&&(t=[]),void 0,t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t},t.MultiplyBlending=4,t.MultiplyOperation=0,t.NearestFilter=1003,t.NearestMipMapLinearFilter=1005,t.NearestMipMapNearestFilter=1004,t.NearestMipmapLinearFilter=1005,t.NearestMipmapNearestFilter=1004,t.NeverDepth=0,t.NeverStencilFunc=512,t.NoBlending=0,t.NoColors=0,t.NoToneMapping=0,t.NormalBlending=1,t.NotEqualDepth=7,t.NotEqualStencilFunc=517,t.NumberKeyframeTrack=Dr,t.Object3D=d,t.ObjectLoader=Mn,t.ObjectSpaceNormalMap=1,t.OctahedronBufferGeometry=mi,t.OctahedronGeometry=fi,t.OneFactor=201,t.OneMinusDstAlphaFactor=207,t.OneMinusDstColorFactor=209,t.OneMinusSrcAlphaFactor=205,t.OneMinusSrcColorFactor=203,t.OrthographicCamera=gn,t.PCFShadowMap=1,t.PCFSoftShadowMap=2,t.ParametricBufferGeometry=hi,t.ParametricGeometry=ci,t.Particle=function(t){return void 0,new Ve(t)},t.ParticleBasicMaterial=function(t){return void 0,new ti(t)},t.ParticleSystem=function(t,e){return void 0,new ei(t,e)},t.ParticleSystemMaterial=function(t){return void 0,new ti(t)},t.Path=sn,t.PerspectiveCamera=J,t.Plane=E,t.PlaneBufferGeometry=rt,t.PlaneGeometry=it,t.PlaneHelper=Ea,t.PointCloud=function(t,e){return void 0,new ei(t,e)},t.PointCloudMaterial=function(t){return void 0,new ti(t)},t.PointLight=mn,t.PointLightHelper=oa,t.Points=ei,t.PointsMaterial=ti,t.PolarGridHelper=ua,t.PolyhedronBufferGeometry=ui,t.PolyhedronGeometry=li,t.PositionalAudio=Bn,t.PositionalAudioHelper=pa,t.PropertyBinding=Vn,t.PropertyMixer=Gn,t.QuadraticBezierCurve=rn,t.QuadraticBezierCurve3=nn,t.Quaternion=r,t.QuaternionKeyframeTrack=Lr,t.QuaternionLinearInterpolant=Rr,t.REVISION="110",t.RGBADepthPacking=3201,t.RGBAFormat=1023,t.RGBA_ASTC_10x10_Format=37819,t.RGBA_ASTC_10x5_Format=37816,t.RGBA_ASTC_10x6_Format=37817,t.RGBA_ASTC_10x8_Format=37818,t.RGBA_ASTC_12x10_Format=37820,t.RGBA_ASTC_12x12_Format=37821,t.RGBA_ASTC_4x4_Format=37808,t.RGBA_ASTC_5x4_Format=37809,t.RGBA_ASTC_5x5_Format=37810,t.RGBA_ASTC_6x5_Format=37811,t.RGBA_ASTC_6x6_Format=37812,t.RGBA_ASTC_8x5_Format=37813,t.RGBA_ASTC_8x6_Format=37814,t.RGBA_ASTC_8x8_Format=37815,t.RGBA_PVRTC_2BPPV1_Format=35843,t.RGBA_PVRTC_4BPPV1_Format=35842,t.RGBA_S3TC_DXT1_Format=33777,t.RGBA_S3TC_DXT3_Format=33778,t.RGBA_S3TC_DXT5_Format=33779,t.RGBDEncoding=3006,t.RGBEEncoding=3002,t.RGBEFormat=1023,t.RGBFormat=1022,t.RGBM16Encoding=3005,t.RGBM7Encoding=3004,t.RGB_ETC1_Format=36196,t.RGB_PVRTC_2BPPV1_Format=35841,t.RGB_PVRTC_4BPPV1_Format=35840,t.RGB_S3TC_DXT1_Format=33776,t.RawShaderMaterial=pr,t.Ray=y,t.Raycaster=Jn,t.RectAreaLight=xn,t.RectAreaLightHelper=sa,t.RedFormat=1028,t.ReinhardToneMapping=2,t.RepeatWrapping=1e3,t.ReplaceStencilOp=7681,t.ReverseSubtractEquation=102,t.RingBufferGeometry=Qi,t.RingGeometry=Ki,t.Scene=f,t.SceneUtils={createMultiMaterialObject:function(){void 0},detach:function(){void 0},attach:function(){void 0}},t.ShaderChunk=Es,t.ShaderLib=bs,t.ShaderMaterial=X,t.ShadowMaterial=ur,t.Shape=cn,t.ShapeBufferGeometry=ir,t.ShapeGeometry=er,t.ShapePath=Tn,t.ShapeUtils=dc,t.ShortType=1011,t.Skeleton=Xe,t.SkeletonHelper=aa,t.SkinnedMesh=qe,t.SmoothShading=2,t.Sphere=v,t.SphereBufferGeometry=Zi,t.SphereGeometry=Ji,t.Spherical=Qn,t.SphericalHarmonics3=Cn,t.SphericalReflectionMapping=305,t.Spline=_a,t.SplineCurve=an,t.SplineCurve3=wa,t.SpotLight=dn,t.SpotLightHelper=na,t.SpotLightShadow=pn,t.Sprite=Ve,t.SpriteMaterial=je,t.SrcAlphaFactor=204,t.SrcAlphaSaturateFactor=210,t.SrcColorFactor=202,t.StaticCopyUsage=35046,t.StaticDrawUsage=35044,t.StaticReadUsage=35045,t.StereoCamera=Hn,t.StreamCopyUsage=35042,t.StreamDrawUsage=35040,t.StreamReadUsage=35041,t.StringKeyframeTrack=Cr,t.SubtractEquation=101,t.SubtractiveBlending=3,t.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},t.TangentSpaceNormalMap=0,t.TetrahedronBufferGeometry=di,t.TetrahedronGeometry=pi,t.TextBufferGeometry=Yi,t.TextGeometry=Xi,t.Texture=o,t.TextureLoader=Vr,t.TorusBufferGeometry=Mi,t.TorusGeometry=_i,t.TorusKnotBufferGeometry=wi,t.TorusKnotGeometry=Si,t.Triangle=x,t.TriangleFanDrawMode=2,t.TriangleStripDrawMode=1,t.TrianglesDrawMode=0,t.TubeBufferGeometry=bi,t.TubeGeometry=xi,t.UVMapping=300,t.Uint16Attribute=function(t,e){return void 0,new O(t,e)},t.Uint16BufferAttribute=O,t.Uint32Attribute=function(t,e){return void 0,new H(t,e)},t.Uint32BufferAttribute=H,t.Uint8Attribute=function(t,e){return void 0,new L(t,e)},t.Uint8BufferAttribute=L,t.Uint8ClampedAttribute=function(t,e){return void 0,new C(t,e)},t.Uint8ClampedBufferAttribute=C,t.Uncharted2ToneMapping=3,t.Uniform=Xn,t.UniformsLib=xs,t.UniformsUtils=gs,t.UnsignedByteType=1009,t.UnsignedInt248Type=1020,t.UnsignedIntType=1014,t.UnsignedShort4444Type=1017,t.UnsignedShort5551Type=1018,t.UnsignedShort565Type=1019,t.UnsignedShortType=1012,t.VSMShadowMap=3,t.Vector2=i,t.Vector3=n,t.Vector4=s,t.VectorKeyframeTrack=Pr,t.Vertex=function(t,e,i){return void 0,new n(t,e,i)},t.VertexColors=2,t.VertexNormalsHelper=ra,t.VideoTexture=ri,t.WebGLMultisampleRenderTarget=h,t.WebGLRenderTarget=c,t.WebGLRenderTargetCube=K,t.WebGLRenderer=Ue,t.WebGLUtils=Re,t.WireframeGeometry=si,t.WireframeHelper=function(t,e){return void 0,new Qe(new si(t.geometry),new Ze({color:void 0!==e?e:16777215}))},t.WrapAroundEnding=2402,t.XHRLoader=function(t){return void 0,new Ur(t)},t.ZeroCurvatureEnding=2400,t.ZeroFactor=200,t.ZeroSlopeEnding=2401,t.ZeroStencilOp=0,t.sRGBEncoding=3001,Object.defineProperty(t,"__esModule",{value:!0})})),THREE.OrbitControls=function(t,e){var i,r,n,a,o;void 0===e&&void 0,e===document&&void 0,this.object=t,this.domElement=e,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:THREE.MOUSE.ROTATE,MIDDLE:THREE.MOUSE.DOLLY,RIGHT:THREE.MOUSE.PAN},this.touches={ONE:THREE.TOUCH.ROTATE,TWO:THREE.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return f.phi},this.getAzimuthalAngle=function(){return f.theta},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(c),s.update(),p=u.NONE},this.update=(i=new THREE.Vector3,r=(new THREE.Quaternion).setFromUnitVectors(t.up,new THREE.Vector3(0,1,0)),n=r.clone().inverse(),a=new THREE.Vector3,o=new THREE.Quaternion,function(){var t=s.object.position;return i.copy(t).sub(s.target),i.applyQuaternion(r),f.setFromVector3(i),s.autoRotate&&p===u.NONE&&R(2*Math.PI/60/60*s.autoRotateSpeed),s.enableDamping?(f.theta+=m.theta*s.dampingFactor,f.phi+=m.phi*s.dampingFactor):(f.theta+=m.theta,f.phi+=m.phi),f.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,f.theta)),f.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,f.phi)),f.makeSafe(),f.radius*=g,f.radius=Math.max(s.minDistance,Math.min(s.maxDistance,f.radius)),!0===s.enableDamping?s.target.addScaledVector(v,s.dampingFactor):s.target.add(v),i.setFromSpherical(f),i.applyQuaternion(n),t.copy(s.target).add(i),s.object.lookAt(s.target),!0===s.enableDamping?(m.theta*=1-s.dampingFactor,m.phi*=1-s.dampingFactor,v.multiplyScalar(1-s.dampingFactor)):(m.set(0,0,0),v.set(0,0,0)),g=1,!!(y||a.distanceToSquared(s.object.position)>d||8*(1-o.dot(s.object.quaternion))>d)&&(s.dispatchEvent(c),a.copy(s.object.position),o.copy(s.object.quaternion),y=!1,!0)}),this.dispose=function(){s.domElement.removeEventListener("contextmenu",$,!1),s.domElement.removeEventListener("mousedown",W,!1),s.domElement.removeEventListener("wheel",Y,!1),s.domElement.removeEventListener("touchstart",Z,!1),s.domElement.removeEventListener("touchend",Q,!1),s.domElement.removeEventListener("touchmove",K,!1),document.removeEventListener("mousemove",q,!1),document.removeEventListener("mouseup",X,!1),s.domElement.removeEventListener("keydown",J,!1)};var s=this,c={type:"change"},h={type:"start"},l={type:"end"},u={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},p=u.NONE,d=1e-6,f=new THREE.Spherical,m=new THREE.Spherical,g=1,v=new THREE.Vector3,y=!1,E=new THREE.Vector2,x=new THREE.Vector2,b=new THREE.Vector2,S=new THREE.Vector2,w=new THREE.Vector2,_=new THREE.Vector2,M=new THREE.Vector2,A=new THREE.Vector2,T=new THREE.Vector2;function D(){return Math.pow(.95,s.zoomSpeed)}function R(t){m.theta-=t}function L(t){m.phi-=t}var C,P=(C=new THREE.Vector3,function(t,e){C.setFromMatrixColumn(e,0),C.multiplyScalar(-t),v.add(C)}),O=function(){var t=new THREE.Vector3;return function(e,i){!0===s.screenSpacePanning?t.setFromMatrixColumn(i,1):(t.setFromMatrixColumn(i,0),t.crossVectors(s.object.up,t)),t.multiplyScalar(e),v.add(t)}}(),I=function(){var t=new THREE.Vector3;return function(e,i){var r=s.domElement;if(s.object.isPerspectiveCamera){var n=s.object.position;t.copy(n).sub(s.target);var a=t.length();a*=Math.tan(s.object.fov/2*Math.PI/180),P(2*e*a/r.clientHeight,s.object.matrix),O(2*i*a/r.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(P(e*(s.object.right-s.object.left)/s.object.zoom/r.clientWidth,s.object.matrix),O(i*(s.object.top-s.object.bottom)/s.object.zoom/r.clientHeight,s.object.matrix)):(void 0,s.enablePan=!1)}}();function H(t){s.object.isPerspectiveCamera?g/=t:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*t)),s.object.updateProjectionMatrix(),y=!0):(void 0,s.enableZoom=!1)}function N(t){s.object.isPerspectiveCamera?g*=t:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/t)),s.object.updateProjectionMatrix(),y=!0):(void 0,s.enableZoom=!1)}function U(t){E.set(t.clientX,t.clientY)}function F(t){S.set(t.clientX,t.clientY)}function B(t){if(1==t.touches.length)E.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),i=.5*(t.touches[0].pageY+t.touches[1].pageY);E.set(e,i)}}function z(t){if(1==t.touches.length)S.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),i=.5*(t.touches[0].pageY+t.touches[1].pageY);S.set(e,i)}}function G(t){var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,r=Math.sqrt(e*e+i*i);M.set(0,r)}function j(t){if(1==t.touches.length)x.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),i=.5*(t.touches[0].pageY+t.touches[1].pageY);x.set(e,i)}b.subVectors(x,E).multiplyScalar(s.rotateSpeed);var r=s.domElement;R(2*Math.PI*b.x/r.clientHeight),L(2*Math.PI*b.y/r.clientHeight),E.copy(x)}function V(t){if(1==t.touches.length)w.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),i=.5*(t.touches[0].pageY+t.touches[1].pageY);w.set(e,i)}_.subVectors(w,S).multiplyScalar(s.panSpeed),I(_.x,_.y),S.copy(w)}function k(t){var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,r=Math.sqrt(e*e+i*i);A.set(0,r),T.set(0,Math.pow(A.y/M.y,s.zoomSpeed)),H(T.y),M.copy(A)}function W(t){if(!1!==s.enabled){switch(t.preventDefault(),s.domElement.focus?s.domElement.focus():window.focus(),t.button){case 0:switch(s.mouseButtons.LEFT){case THREE.MOUSE.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===s.enablePan)return;F(t),p=u.PAN}else{if(!1===s.enableRotate)return;U(t),p=u.ROTATE}break;case THREE.MOUSE.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===s.enableRotate)return;U(t),p=u.ROTATE}else{if(!1===s.enablePan)return;F(t),p=u.PAN}break;default:p=u.NONE}break;case 1:switch(s.mouseButtons.MIDDLE){case THREE.MOUSE.DOLLY:if(!1===s.enableZoom)return;!function(t){M.set(t.clientX,t.clientY)}(t),p=u.DOLLY;break;default:p=u.NONE}break;case 2:switch(s.mouseButtons.RIGHT){case THREE.MOUSE.ROTATE:if(!1===s.enableRotate)return;U(t),p=u.ROTATE;break;case THREE.MOUSE.PAN:if(!1===s.enablePan)return;F(t),p=u.PAN;break;default:p=u.NONE}}p!==u.NONE&&(document.addEventListener("mousemove",q,!1),document.addEventListener("mouseup",X,!1),s.dispatchEvent(h))}}function q(t){if(!1!==s.enabled)switch(t.preventDefault(),p){case u.ROTATE:if(!1===s.enableRotate)return;!function(t){x.set(t.clientX,t.clientY),b.subVectors(x,E).multiplyScalar(s.rotateSpeed);var e=s.domElement;R(2*Math.PI*b.x/e.clientHeight),L(2*Math.PI*b.y/e.clientHeight),E.copy(x),s.update()}(t);break;case u.DOLLY:if(!1===s.enableZoom)return;!function(t){A.set(t.clientX,t.clientY),T.subVectors(A,M),T.y>0?H(D()):T.y<0&&N(D()),M.copy(A),s.update()}(t);break;case u.PAN:if(!1===s.enablePan)return;!function(t){w.set(t.clientX,t.clientY),_.subVectors(w,S).multiplyScalar(s.panSpeed),I(_.x,_.y),S.copy(w),s.update()}(t)}}function X(t){!1!==s.enabled&&(document.removeEventListener("mousemove",q,!1),document.removeEventListener("mouseup",X,!1),s.dispatchEvent(l),p=u.NONE)}function Y(t){!1===s.enabled||!1===s.enableZoom||p!==u.NONE&&p!==u.ROTATE||(t.preventDefault(),t.stopPropagation(),s.dispatchEvent(h),function(t){t.deltaY<0?N(D()):t.deltaY>0&&H(D()),s.update()}(t),s.dispatchEvent(l))}function J(t){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(t){var e=!1;switch(t.keyCode){case s.keys.UP:I(0,s.keyPanSpeed),e=!0;break;case s.keys.BOTTOM:I(0,-s.keyPanSpeed),e=!0;break;case s.keys.LEFT:I(s.keyPanSpeed,0),e=!0;break;case s.keys.RIGHT:I(-s.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),s.update())}(t)}function Z(t){if(!1!==s.enabled){switch(t.preventDefault(),t.touches.length){case 1:switch(s.touches.ONE){case THREE.TOUCH.ROTATE:if(!1===s.enableRotate)return;B(t),p=u.TOUCH_ROTATE;break;case THREE.TOUCH.PAN:if(!1===s.enablePan)return;z(t),p=u.TOUCH_PAN;break;default:p=u.NONE}break;case 2:switch(s.touches.TWO){case THREE.TOUCH.DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(t){s.enableZoom&&G(t),s.enablePan&&z(t)}(t),p=u.TOUCH_DOLLY_PAN;break;case THREE.TOUCH.DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;!function(t){s.enableZoom&&G(t),s.enableRotate&&B(t)}(t),p=u.TOUCH_DOLLY_ROTATE;break;default:p=u.NONE}break;default:p=u.NONE}p!==u.NONE&&s.dispatchEvent(h)}}function K(t){if(!1!==s.enabled)switch(t.preventDefault(),t.stopPropagation(),p){case u.TOUCH_ROTATE:if(!1===s.enableRotate)return;j(t),s.update();break;case u.TOUCH_PAN:if(!1===s.enablePan)return;V(t),s.update();break;case u.TOUCH_DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(t){s.enableZoom&&k(t),s.enablePan&&V(t)}(t),s.update();break;case u.TOUCH_DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;!function(t){s.enableZoom&&k(t),s.enableRotate&&j(t)}(t),s.update();break;default:p=u.NONE}}function Q(t){!1!==s.enabled&&(s.dispatchEvent(l),p=u.NONE)}function $(t){!1!==s.enabled&&t.preventDefault()}s.domElement.addEventListener("contextmenu",$,!1),s.domElement.addEventListener("mousedown",W,!1),s.domElement.addEventListener("wheel",Y,!1),s.domElement.addEventListener("touchstart",Z,!1),s.domElement.addEventListener("touchend",Q,!1),s.domElement.addEventListener("touchmove",K,!1),s.domElement.addEventListener("keydown",J,!1),-1===s.domElement.tabIndex&&(s.domElement.tabIndex=0),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,THREE.MapControls=function(t,e){THREE.OrbitControls.call(this,t,e),this.mouseButtons.LEFT=THREE.MOUSE.PAN,this.mouseButtons.RIGHT=THREE.MOUSE.ROTATE,this.touches.ONE=THREE.TOUCH.PAN,this.touches.TWO=THREE.TOUCH.DOLLY_ROTATE},THREE.MapControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.MapControls.prototype.constructor=THREE.MapControls;var SEA3D={VERSION:18110,getVersion:function(){var t=SEA3D.VERSION.toString(),e=t.length;return t.substring(0,e-4)+"."+t.substring(e-4,e-3)+"."+t.substring(e-3,e-2)+"."+parseFloat(t.substring(e-2,e)).toString()}};void 0,SEA3D.Stream=function(t){this.position=0,this.buffer=t||new ArrayBuffer},SEA3D.Stream.NONE=0,SEA3D.Stream.BOOLEAN=1,SEA3D.Stream.BYTE=2,SEA3D.Stream.UBYTE=3,SEA3D.Stream.SHORT=4,SEA3D.Stream.USHORT=5,SEA3D.Stream.INT24=6,SEA3D.Stream.UINT24=7,SEA3D.Stream.INT=8,SEA3D.Stream.UINT=9,SEA3D.Stream.FLOAT=10,SEA3D.Stream.DOUBLE=11,SEA3D.Stream.DECIMAL=12,SEA3D.Stream.VECTOR3D=74,SEA3D.Stream.VECTOR4D=106,SEA3D.Stream.STRING_TINY=128,SEA3D.Stream.STRING_SHORT=129,SEA3D.Stream.STRING_LONG=130,SEA3D.Stream.ASSET=200,SEA3D.Stream.GROUP=255,SEA3D.Stream.BLEND_MODE=["normal","add","subtract","multiply","dividing","mix","alpha","screen","darken","overlay","colorburn","linearburn","lighten","colordodge","lineardodge","softlight","hardlight","pinlight","spotlight","spotlightblend","hardmix","average","difference","exclusion","hue","saturation","color","value","linearlight","grainextract","reflect","glow","darkercolor","lightercolor","phoenix","negation"],SEA3D.Stream.INTERPOLATION_TABLE=["normal","linear","sine.in","sine.out","sine.inout","cubic.in","cubic.out","cubic.inout","quint.in","quint.out","quint.inout","circ.in","circ.out","circ.inout","back.in","back.out","back.inout","quad.in","quad.out","quad.inout","quart.in","quart.out","quart.inout","expo.in","expo.out","expo.inout","elastic.in","elastic.out","elastic.inout","bounce.in","bounce.out","bounce.inout"],SEA3D.Stream.sizeOf=function(t){return 0===t?0:t>=1&&t<=31?1:t>=32&&t<=63?2:t>=64&&t<=95?3:t>=96&&t<=125?4:-1},SEA3D.Stream.prototype={constructor:SEA3D.Stream,set buffer(t){this.buf=t,this.data=new DataView(t)},get buffer(){return this.buf},get bytesAvailable(){return this.length-this.position},get length(){return this.buf.byteLength}},SEA3D.Stream.prototype.getByte=function(t){return this.data.getInt8(t)},SEA3D.Stream.prototype.readBytes=function(t){var e=this.buf.slice(this.position,this.position+t);return this.position+=t,e},SEA3D.Stream.prototype.readByte=function(){return this.data.getInt8(this.position++)},SEA3D.Stream.prototype.readUByte=function(){return this.data.getUint8(this.position++)},SEA3D.Stream.prototype.readBool=function(){return 0!=this.data.getInt8(this.position++)},SEA3D.Stream.prototype.readShort=function(){var t=this.data.getInt16(this.position,!0);return this.position+=2,t},SEA3D.Stream.prototype.readUShort=function(){var t=this.data.getUint16(this.position,!0);return this.position+=2,t},SEA3D.Stream.prototype.readUInt24=function(){var t=16777215&this.data.getUint32(this.position,!0);return this.position+=3,t},SEA3D.Stream.prototype.readUInt24F=function(){return this.readUShort()|this.readUByte()<<16},SEA3D.Stream.prototype.readInt=function(){var t=this.data.getInt32(this.position,!0);return this.position+=4,t},SEA3D.Stream.prototype.readUInt=function(){var t=this.data.getUint32(this.position,!0);return this.position+=4,t},SEA3D.Stream.prototype.readFloat=function(){var t=this.data.getFloat32(this.position,!0);return this.position+=4,t},SEA3D.Stream.prototype.readUInteger=function(){var t=this.readUByte(),e=127&t;return 0!=(128&t)&&(e|=(127&(t=this.readUByte()))<<7,0!=(128&t)&&(e|=(127&(t=this.readUByte()))<<13)),e},SEA3D.Stream.prototype.readVector2=function(){return{x:this.readFloat(),y:this.readFloat()}},SEA3D.Stream.prototype.readVector3=function(){return{x:this.readFloat(),y:this.readFloat(),z:this.readFloat()}},SEA3D.Stream.prototype.readVector4=function(){return{x:this.readFloat(),y:this.readFloat(),z:this.readFloat(),w:this.readFloat()}},SEA3D.Stream.prototype.readMatrix=function(){var t=new Float32Array(16);return t[0]=this.readFloat(),t[1]=this.readFloat(),t[2]=this.readFloat(),t[3]=0,t[4]=this.readFloat(),t[5]=this.readFloat(),t[6]=this.readFloat(),t[7]=0,t[8]=this.readFloat(),t[9]=this.readFloat(),t[10]=this.readFloat(),t[11]=0,t[12]=this.readFloat(),t[13]=this.readFloat(),t[14]=this.readFloat(),t[15]=1,t},SEA3D.Stream.prototype.decodeText=function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);for(var e="",i=0,r=t.length;i<r;i++)e+=String.fromCharCode(t[i]);return decodeURIComponent(escape(e))},SEA3D.Stream.prototype.readUTF8=function(t){var e=this.readBytes(t);return this.decodeText(new Uint8Array(e))},SEA3D.Stream.prototype.readExt=function(){return this.readUTF8(4).replace(/\0/g,"")},SEA3D.Stream.prototype.readUTF8Tiny=function(){return this.readUTF8(this.readUByte())},SEA3D.Stream.prototype.readUTF8Short=function(){return this.readUTF8(this.readUShort())},SEA3D.Stream.prototype.readUTF8Long=function(){return this.readUTF8(this.readUInt())},SEA3D.Stream.prototype.readUByteArray=function(t){var e=new Uint8Array(t);return SEA3D.Stream.memcpy(e.buffer,0,this.buffer,this.position,t),this.position+=t,e},SEA3D.Stream.prototype.readUShortArray=function(t){var e=new Uint16Array(t),i=2*t;return SEA3D.Stream.memcpy(e.buffer,0,this.buffer,this.position,i),this.position+=i,e},SEA3D.Stream.prototype.readUInt24Array=function(t){for(var e=new Uint32Array(t),i=0;i<t;i++)e[i]=this.readUInt24();return e},SEA3D.Stream.prototype.readUIntArray=function(t){var e=new Uint32Array(t),i=4*t;return SEA3D.Stream.memcpy(e.buffer,0,this.buffer,this.position,i),this.position+=i,e},SEA3D.Stream.prototype.readFloatArray=function(t){var e=new Float32Array(t),i=4*t;return SEA3D.Stream.memcpy(e.buffer,0,this.buffer,this.position,i),this.position+=i,e},SEA3D.Stream.prototype.readBlendMode=function(){return SEA3D.Stream.BLEND_MODE[this.readUByte()]},SEA3D.Stream.prototype.readInterpolation=function(){return SEA3D.Stream.INTERPOLATION_TABLE[this.readUByte()]},SEA3D.Stream.prototype.readTags=function(t){for(var e=this.readUByte(),i=0;i<e;++i){var r=this.readUShort(),n=this.readUInt(),a=this.position;t(r,this,n),this.position=a+=n}},SEA3D.Stream.prototype.readProperties=function(t){var e=this.readUByte(),i={},r={};i.__type=r;for(var n=0;n<e;n++){var a=this.readUTF8Tiny(),o=this.readUByte();r[a]=o,i[a]=o===SEA3D.Stream.GROUP?this.readProperties(t):this.readToken(o,t)}return i},SEA3D.Stream.prototype.readAnimationList=function(t){for(var e=[],i=this.readUByte(),r=0;r<i;){var n=this.readUByte(),a={};a.relative=0!=(1&n),2&n&&(a.timeScale=this.readFloat()),a.tag=t.getObject(this.readUInt()),e[r++]=a}return e},SEA3D.Stream.prototype.readScriptList=function(t){for(var e=[],i=this.readUByte(),r=0;r<i;){var n=this.readUByte(),a={};if(a.priority=1&n|2&n,4&n){var o=this.readUByte();a.params={};for(var s=0;s<o;s++){var c=this.readUTF8Tiny();a.params[c]=this.readObject(t)}}8&n&&(a.method=this.readUTF8Tiny()),a.tag=t.getObject(this.readUInt()),e[r++]=a}return e},SEA3D.Stream.prototype.readObject=function(t){return this.readToken(this.readUByte(),t)},SEA3D.Stream.prototype.readToken=function(t,e){switch(t){case SEA3D.Stream.BOOLEAN:return this.readBool();case SEA3D.Stream.UBYTE:return this.readUByte();case SEA3D.Stream.USHORT:return this.readUShort();case SEA3D.Stream.UINT24:return this.readUInt24();case SEA3D.Stream.INT:return this.readInt();case SEA3D.Stream.UINT:return this.readUInt();case SEA3D.Stream.FLOAT:return this.readFloat();case SEA3D.Stream.VECTOR3D:return this.readVector3();case SEA3D.Stream.VECTOR4D:return this.readVector4();case SEA3D.Stream.STRING_TINY:return this.readUTF8Tiny();case SEA3D.Stream.STRING_SHORT:return this.readUTF8Short();case SEA3D.Stream.STRING_LONG:return this.readUTF8Long();case SEA3D.Stream.ASSET:var i=this.readUInt();return i>0?e.getObject(i-1):null;default:void 0}return null},SEA3D.Stream.prototype.readVector=function(t,e,i){var r=SEA3D.Stream.sizeOf(t),n=i*r+e*r;switch(t){case SEA3D.Stream.BOOLEAN:case SEA3D.Stream.UBYTE:return this.readUByteArray(n);case SEA3D.Stream.USHORT:return this.readUShortArray(n);case SEA3D.Stream.UINT24:return this.readUInt24Array(n);case SEA3D.Stream.UINT:return this.readUIntArray(n);case SEA3D.Stream.FLOAT:case SEA3D.Stream.VECTOR3D:case SEA3D.Stream.VECTOR4D:return this.readFloatArray(n)}},SEA3D.Stream.prototype.append=function(t){var e=new ArrayBuffer(this.data.byteLength+t.byteLength);SEA3D.Stream.memcpy(e,0,this.data.buffer,0,this.data.byteLength),SEA3D.Stream.memcpy(e,this.data.byteLength,t,0,t.byteLength),this.buffer=e},SEA3D.Stream.prototype.concat=function(t,e){return new SEA3D.Stream(this.buffer.slice(t,t+e))},SEA3D.Stream.memcpy=function(t,e,i,r,n){var a=new Uint8Array(t,e,n),o=new Uint8Array(i,r,n);a.set(o)},SEA3D.UByteArray=function(){this.ubytes=[],this.length=0},SEA3D.UByteArray.prototype={constructor:SEA3D.UByteArray,add:function(t){this.ubytes.push(t),this.length+=t.byteLength},toBuffer:function(){for(var t=new Uint8Array(this.length),e=0,i=0;e<this.ubytes.length;e++)t.set(this.ubytes[e],i),i+=this.ubytes[e].byteLength;return t.buffer}},SEA3D.Math={RAD_TO_DEG:180/Math.PI,DEG_TO_RAD:Math.PI/180},SEA3D.Math.angle=function(t){var e=t<0;return(t=(e?-t:t)%360)>180&&(t=t-180-180),e?-t:t},SEA3D.Math.angleDiff=function(t,e){return t*=this.DEG_TO_RAD,e*=this.DEG_TO_RAD,Math.atan2(Math.sin(t-e),Math.cos(t-e))*this.RAD_TO_DEG},SEA3D.Math.angleArea=function(t,e,i){return Math.abs(this.angleDiff(t,e))<=i},SEA3D.Math.direction=function(t,e,i,r){return Math.atan2(r-e,i-t)},SEA3D.Math.physicalLerp=function(t,e,i,r){var n=i/r;return n>1&&(n=1),t+(e-t)*n},SEA3D.Math.physicalAngle=function(t,e,i,r){Math.abs(t-e)>180&&(t>e?e+=360:e-=360);var n=i/r;return n>1&&(n=1),this.angle(t+(e-t)*n)},SEA3D.Math.zero=function(t,e){return(t<0?-t:t)-(e=e||.001)<0&&(t=0),t},SEA3D.Math.round=function(t,e){return e=Math.pow(10,e),Math.round(t*e)/e},SEA3D.Math.lerpAngle=function(t,e,i){return Math.abs(t-e)>180&&(t>e?e+=360:e-=360),t+=(e-t)*i,SEA3D.Math.angle(t)},SEA3D.Math.lerpColor=function(t,e,i){var r=t>>24&255,n=t>>16&255,a=t>>8&255,o=255&t;return(r+=((e>>24&255)-r)*i)<<24|(n+=((e>>16&255)-n)*i)<<16|(a+=((e>>8&255)-a)*i)<<8|(o+=((255&e)-o)*i)},SEA3D.Math.lerp=function(t,e,i){return t+(e-t)*i},SEA3D.Timer=function(){this.time=this.start=Date.now()},SEA3D.Timer.prototype={constructor:SEA3D.Timer,get now(){return Date.now()},get deltaTime(){return Date.now()-this.time},get elapsedTime(){return Date.now()-this.start},update:function(){this.time=Date.now()}},SEA3D.Object=function(t,e,i,r){this.name=t,this.data=e,this.type=i,this.sea3d=r},SEA3D.GeometryBase=function(t,e,i){this.name=t,this.data=e,this.sea3d=i,this.attrib=e.readUShort(),this.isBig=0!=(1&this.attrib),e.readVInt=this.isBig?e.readUInt:e.readUShort,this.numVertex=e.readVInt(),this.length=3*this.numVertex},SEA3D.Geometry=function(t,e,i){var r,n,a;if(SEA3D.GeometryBase.call(this,t,e,i),4&this.attrib&&(this.normal=e.readFloatArray(this.length)),8&this.attrib&&(this.tangent=e.readFloatArray(this.length)),32&this.attrib){var o=e.readUByte();if(o)for(this.uv=[],a=2*this.numVertex,r=0;r<o;)this.uv[r++]=e.readFloatArray(a)}if(64&this.attrib){this.jointPerVertex=e.readUByte();var s=this.numVertex*this.jointPerVertex;this.joint=e.readUShortArray(s),this.weight=e.readFloatArray(s)}if(128&this.attrib){var c=e.readUByte(),h=e.readUByte();if(h)for(this.numColor=1+((64&c)>>6|(128&c)>>6),this.color=[],r=0;r<h;r++)this.color.push(e.readFloatArray(this.numVertex*this.numColor))}this.vertex=e.readFloatArray(this.length);var l=e.readUByte();if(this.groups=[],1024&this.attrib){for(r=0,a=0;r<l;r++)n=3*e.readVInt(),this.groups.push({start:a,count:n}),a+=n;2048&this.attrib||(this.indexes=this.isBig?e.readUIntArray(a):e.readUShortArray(a))}else{var u=this.isBig?4:2,p=new SEA3D.UByteArray;for(r=0,n=0;r<l;r++)a=3*e.readVInt(),this.groups.push({start:n,count:a}),n+=a,p.add(e.readUByteArray(a*u));this.indexes=this.isBig?new Uint32Array(p.toBuffer()):new Uint16Array(p.toBuffer())}},SEA3D.Geometry.prototype=Object.create(SEA3D.GeometryBase.prototype),SEA3D.Geometry.prototype.constructor=SEA3D.Geometry,SEA3D.Geometry.prototype.type="geo",SEA3D.Object3D=function(t,e,i){if(this.name=t,this.data=e,this.sea3d=i,this.isStatic=!1,this.visible=!0,this.attrib=e.readUShort(),1&this.attrib&&(this.parent=i.getObject(e.readUInt())),2&this.attrib&&(this.animations=e.readAnimationList(i)),4&this.attrib&&(this.scripts=e.readScriptList(i)),16&this.attrib&&(this.attributes=i.getObject(e.readUInt())),32&this.attrib){var r=e.readUByte();this.isStatic=0!=(1&r),this.visible=0==(2&r)}},SEA3D.Object3D.prototype.readTag=function(t,e,i){},SEA3D.Entity3D=function(t,e,i){if(SEA3D.Object3D.call(this,t,e,i),this.castShadows=!0,64&this.attrib){var r=e.readUByte();this.castShadows=0==(1&r)}},SEA3D.Entity3D.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.Entity3D.prototype.constructor=SEA3D.Entity3D,SEA3D.Sound3D=function(t,e,i){SEA3D.Object3D.call(this,t,e,i),this.autoPlay=0!=(64&this.attrib),128&this.attrib&&(this.mixer=i.getObject(e.readUInt())),this.sound=i.getObject(e.readUInt()),this.volume=e.readFloat()},SEA3D.Sound3D.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.Sound3D.prototype.constructor=SEA3D.Sound3D,SEA3D.SoundPoint=function(t,e,i){SEA3D.Sound3D.call(this,t,e,i),this.position=e.readVector3(),this.distance=e.readFloat(),e.readTags(this.readTag.bind(this))},SEA3D.SoundPoint.prototype=Object.create(SEA3D.Sound3D.prototype),SEA3D.SoundPoint.prototype.constructor=SEA3D.SoundPoint,SEA3D.SoundPoint.prototype.type="sp",SEA3D.Container3D=function(t,e,i){SEA3D.Object3D.call(this,t,e,i),this.transform=e.readMatrix(),e.readTags(this.readTag.bind(this))},SEA3D.Container3D.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.Container3D.prototype.constructor=SEA3D.Container3D,SEA3D.Container3D.prototype.type="c3d",SEA3D.ScriptURL=function(t,e,i){this.name=t,this.data=e,this.sea3d=i,this.url=e.readUTF8(e.length)},SEA3D.ScriptURL.prototype.type="src",SEA3D.TextureURL=function(t,e,i){this.name=t,this.data=e,this.sea3d=i,this.url=i.config.path+e.readUTF8(e.length)},SEA3D.TextureURL.prototype.type="urlT",SEA3D.CubeMapURL=function(t,e,i){this.name=t,this.data=e,this.sea3d=i,this.faces=[];for(var r=0;r<6;r++)this.faces[r]=e.readUTF8Tiny()},SEA3D.CubeMapURL.prototype.type="cURL",SEA3D.Actions=function(t,e,i){this.name=t,this.data=e,this.sea3d=i,this.count=e.readUInt(),this.actions=[];for(var r=0;r<this.count;r++){var n=e.readUByte(),a=e.readUShort(),o=e.readUShort(),s=e.position,c=this.actions[r]={kind:a};switch(1&n&&(c.range=[e.readUInt(),e.readUInt()]),2&n&&(c.time=e.readUInt()),4&n&&(c.intrpl=e.readInterpolation(),0===c.intrpl.indexOf("back.")?c.intrplParam0=e.readFloat():0===c.intrpl.indexOf("elastic.")&&(c.intrplParam0=e.readFloat(),c.intrplParam1=e.readFloat())),a){case SEA3D.Actions.RTT_TARGET:case SEA3D.Actions.LOOK_AT:c.source=i.getObject(e.readUInt()),c.target=i.getObject(e.readUInt());break;case SEA3D.Actions.PLAY_SOUND:c.sound=i.getObject(e.readUInt()),c.offset=e.readUInt();break;case SEA3D.Actions.PLAY_ANIMATION:c.object=i.getObject(e.readUInt()),c.name=e.readUTF8Tiny();break;case SEA3D.Actions.FOG:c.color=e.readUInt24(),c.min=e.readFloat(),c.max=e.readFloat();break;case SEA3D.Actions.ENVIRONMENT:c.texture=i.getObject(e.readUInt());break;case SEA3D.Actions.ENVIRONMENT_COLOR:c.color=e.readUInt24F();break;case SEA3D.Actions.CAMERA:c.camera=i.getObject(e.readUInt());break;case SEA3D.Actions.SCRIPTS:c.scripts=e.readScriptList(i);break;case SEA3D.Actions.CLASS_OF:c.classof=i.getObject(e.readUInt());break;case SEA3D.Actions.ATTRIBUTES:c.attributes=i.getObject(e.readUInt());break;default:void 0}e.position=s+o}},SEA3D.Actions.SCENE=0,SEA3D.Actions.ENVIRONMENT_COLOR=1,SEA3D.Actions.ENVIRONMENT=2,SEA3D.Actions.FOG=3,SEA3D.Actions.PLAY_ANIMATION=4,SEA3D.Actions.PLAY_SOUND=5,SEA3D.Actions.ANIMATION_AUDIO_SYNC=6,SEA3D.Actions.LOOK_AT=7,SEA3D.Actions.RTT_TARGET=8,SEA3D.Actions.CAMERA=9,SEA3D.Actions.SCRIPTS=10,SEA3D.Actions.CLASS_OF=11,SEA3D.Actions.ATTRIBUTES=12,SEA3D.Actions.prototype.type="act",SEA3D.Properties=function(t,e,i){this.name=t,this.data=e,this.sea3d=i,this.props=e.readProperties(i),this.props.__name=t},SEA3D.Properties.prototype.type="prop",SEA3D.FileInfo=function(t,e,i){this.name=t,this.data=e,this.sea3d=i,this.info=e.readProperties(i),this.info.__name=t,i.info=this.info},SEA3D.FileInfo.prototype.type="info",SEA3D.JavaScript=function(t,e,i){this.name=t,this.data=e,this.sea3d=i,this.src=e.readUTF8(e.length)},SEA3D.JavaScript.prototype.type="js",SEA3D.JavaScriptMethod=function(t,e,i){this.name=t,this.data=e,this.sea3d=i;var r=e.readUShort();this.methods={};for(var n=0;n<r;n++){e.readUByte();var a=e.readUTF8Tiny();this.methods[a]={src:e.readUTF8Long()}}},SEA3D.JavaScriptMethod.prototype.type="jsm",SEA3D.GLSL=function(t,e,i){this.name=t,this.data=e,this.sea3d=i,this.src=e.readUTF8(e.length)},SEA3D.GLSL.prototype.type="glsl",SEA3D.Dummy=function(t,e,i){SEA3D.Object3D.call(this,t,e,i),this.transform=e.readMatrix(),this.width=e.readFloat(),this.height=e.readFloat(),this.depth=e.readFloat(),e.readTags(this.readTag.bind(this))},SEA3D.Dummy.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.Dummy.prototype.constructor=SEA3D.Dummy,SEA3D.Dummy.prototype.type="dmy",SEA3D.Line=function(t,e,i){SEA3D.Object3D.call(this,t,e,i),this.count=3*(64&this.attrib?e.readUInt():e.readUShort()),this.closed=0!=(128&this.attrib),this.transform=e.readMatrix(),this.vertex=[];for(var r=0;r<this.count;)this.vertex[r++]=e.readFloat();e.readTags(this.readTag.bind(this))},SEA3D.Line.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.Line.prototype.constructor=SEA3D.Line,SEA3D.Line.prototype.type="line",SEA3D.Sprite=function(t,e,i){SEA3D.Object3D.call(this,t,e,i),256&this.attrib&&(this.material=i.getObject(e.readUInt())),this.position=e.readVector3(),this.width=e.readFloat(),this.height=e.readFloat(),e.readTags(this.readTag.bind(this))},SEA3D.Sprite.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.Sprite.prototype.constructor=SEA3D.Sprite,SEA3D.Sprite.prototype.type="m2d",SEA3D.Mesh=function(t,e,i){if(SEA3D.Entity3D.call(this,t,e,i),256&this.attrib)if(this.material=[],1===(a=e.readUByte()))this.material[0]=i.getObject(e.readUInt());else for(var r=0;r<a;){var n=e.readUInt();this.material[r++]=n>0?i.getObject(n-1):void 0}if(512&this.attrib){this.modifiers=[];var a=e.readUByte();for(r=0;r<a;r++)this.modifiers[r]=i.getObject(e.readUInt())}1024&this.attrib&&(this.reference={type:e.readUByte(),ref:i.getObject(e.readUInt())}),this.transform=e.readMatrix(),this.geometry=i.getObject(e.readUInt()),e.readTags(this.readTag.bind(this))},SEA3D.Mesh.prototype=Object.create(SEA3D.Entity3D.prototype),SEA3D.Mesh.prototype.constructor=SEA3D.Mesh,SEA3D.Mesh.prototype.type="m3d",SEA3D.Skeleton=function(t,e,i){this.name=t,this.data=e,this.sea3d=i;var r=e.readUShort();this.joint=[];for(var n=0;n<r;n++)this.joint[n]={name:e.readUTF8Tiny(),parentIndex:e.readUShort()-1,inverseBindMatrix:e.readMatrix()}},SEA3D.Skeleton.prototype.type="skl",SEA3D.SkeletonLocal=function(t,e,i){this.name=t,this.data=e,this.sea3d=i;var r=e.readUShort();this.joint=[];for(var n=0;n<r;n++)this.joint[n]={name:e.readUTF8Tiny(),parentIndex:e.readUShort()-1,x:e.readFloat(),y:e.readFloat(),z:e.readFloat(),qx:e.readFloat(),qy:e.readFloat(),qz:e.readFloat(),qw:e.readFloat()}},SEA3D.SkeletonLocal.prototype.type="sklq",SEA3D.AnimationBase=function(t,e,i){this.name=t,this.data=e,this.sea3d=i;var r=e.readUByte();if(this.sequence=[],1&r)for(var n=e.readUShort(),a=0;a<n;a++){var o=e.readUByte();this.sequence[a]={name:e.readUTF8Tiny(),start:e.readUInt(),count:e.readUInt(),repeat:0!=(1&o),intrpl:0==(2&o)}}this.frameRate=e.readUByte(),this.numFrames=e.readUInt(),0===this.sequence.length&&(this.sequence[0]={name:"root",start:0,count:this.numFrames,repeat:!0,intrpl:!0})},SEA3D.Animation=function(t,e,i){SEA3D.AnimationBase.call(this,t,e,i),this.dataList=[];for(var r=0,n=e.readUByte();r<n;r++){var a=e.readUShort(),o=e.readUByte(),s=e.readVector(o,this.numFrames,0);this.dataList.push({kind:a,type:o,blockSize:SEA3D.Stream.sizeOf(o),data:s})}},SEA3D.Animation.POSITION=0,SEA3D.Animation.ROTATION=1,SEA3D.Animation.SCALE=2,SEA3D.Animation.COLOR=3,SEA3D.Animation.MULTIPLIER=4,SEA3D.Animation.ATTENUATION_START=5,SEA3D.Animation.ATTENUATION_END=6,SEA3D.Animation.FOV=7,SEA3D.Animation.OFFSET_U=8,SEA3D.Animation.OFFSET_V=9,SEA3D.Animation.SCALE_U=10,SEA3D.Animation.SCALE_V=11,SEA3D.Animation.DEGREE=12,SEA3D.Animation.ALPHA=13,SEA3D.Animation.VOLUME=14,SEA3D.Animation.RADIAN=15,SEA3D.Animation.MORPH=250,SEA3D.Animation.prototype=Object.create(SEA3D.AnimationBase.prototype),SEA3D.Animation.prototype.constructor=SEA3D.Animation,SEA3D.Animation.prototype.type="anm",SEA3D.SkeletonAnimation=function(t,e,i){SEA3D.AnimationBase.call(this,t,e,i),this.name=t,this.data=e,this.sea3d=i,this.numJoints=e.readUShort(),this.raw=e.readFloatArray(this.numFrames*this.numJoints*7)},SEA3D.SkeletonAnimation.prototype.type="skla",SEA3D.UVWAnimation=function(t,e,i){SEA3D.Animation.call(this,t,e,i)},SEA3D.UVWAnimation.prototype.type="auvw",SEA3D.Morph=function(t,e,i){SEA3D.GeometryBase.call(this,t,e,i);var r=0!=(2&this.attrib),n=0!=(4&this.attrib),a=e.readUShort();this.node=[];for(var o=0;o<a;o++){var s,c,h=e.readUTF8Tiny();r&&(s=e.readFloatArray(this.length)),n&&(c=e.readFloatArray(this.length)),this.node[o]={vertex:s,normal:c,name:h}}},SEA3D.Morph.prototype=Object.create(SEA3D.GeometryBase.prototype),SEA3D.Morph.prototype.constructor=SEA3D.Morph,SEA3D.Morph.prototype.type="mph",SEA3D.MorphAnimation=function(t,e,i){SEA3D.AnimationBase.call(this,t,e,i),this.dataList=[];for(var r=0,n=e.readUByte();r<n;r++)this.dataList.push({kind:SEA3D.Animation.MORPH,type:SEA3D.Stream.FLOAT,name:e.readUTF8Tiny(),blockSize:1,data:e.readVector(SEA3D.Stream.FLOAT,this.numFrames,0)})},SEA3D.MorphAnimation.prototype.type="mpha",SEA3D.VertexAnimation=function(t,e,i){SEA3D.AnimationBase.call(this,t,e,i);var r=e.readUByte();this.isBig=0!=(1&r),e.readVInt=this.isBig?e.readUInt:e.readUShort,this.numVertex=e.readVInt(),this.length=3*this.numVertex;var n,a,o,s=0!=(2&r),c=0!=(4&r);for(this.frame=[],n=0;n<this.numFrames;n++)s&&(a=e.readFloatArray(this.length)),c&&(o=e.readFloatArray(this.length)),this.frame[n]={vertex:a,normal:o}},SEA3D.VertexAnimation.prototype=Object.create(SEA3D.AnimationBase.prototype),SEA3D.VertexAnimation.prototype.constructor=SEA3D.VertexAnimation,SEA3D.VertexAnimation.prototype.type="vtxa",SEA3D.Camera=function(t,e,i){SEA3D.Object3D.call(this,t,e,i),64&this.attrib&&(this.dof={distance:e.readFloat(),range:e.readFloat()}),this.transform=e.readMatrix(),this.fov=e.readFloat(),e.readTags(this.readTag.bind(this))},SEA3D.Camera.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.Camera.prototype.constructor=SEA3D.Camera,SEA3D.Camera.prototype.type="cam",SEA3D.OrthographicCamera=function(t,e,i){SEA3D.Object3D.call(this,t,e,i),this.transform=e.readMatrix(),this.height=e.readFloat(),e.readTags(this.readTag.bind(this))},SEA3D.OrthographicCamera.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.OrthographicCamera.prototype.constructor=SEA3D.OrthographicCamera,SEA3D.OrthographicCamera.prototype.type="camo",SEA3D.JointObject=function(t,e,i){SEA3D.Object3D.call(this,t,e,i),this.target=i.getObject(e.readUInt()),this.joint=e.readUShort(),e.readTags(this.readTag.bind(this))},SEA3D.JointObject.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.JointObject.prototype.constructor=SEA3D.JointObject,SEA3D.JointObject.prototype.type="jnt",SEA3D.Light=function(t,e,i){if(SEA3D.Object3D.call(this,t,e,i),this.attenStart=Number.MAX_VALUE,this.attenEnd=Number.MAX_VALUE,64&this.attrib){var r=e.readUByte();this.shadow={},this.shadow.opacity=1&r?e.readFloat():1,this.shadow.color=2&r?e.readUInt24():0}512&this.attrib&&(this.attenStart=e.readFloat(),this.attenEnd=e.readFloat()),this.color=e.readUInt24(),this.multiplier=e.readFloat()},SEA3D.Light.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.Light.prototype.constructor=SEA3D.Light,SEA3D.PointLight=function(t,e,i){SEA3D.Light.call(this,t,e,i),128&this.attrib&&(this.attenuation={start:e.readFloat(),end:e.readFloat()}),this.position=e.readVector3(),e.readTags(this.readTag.bind(this))},SEA3D.PointLight.prototype=Object.create(SEA3D.Light.prototype),SEA3D.PointLight.prototype.constructor=SEA3D.PointLight,SEA3D.PointLight.prototype.type="plht",SEA3D.HemisphereLight=function(t,e,i){SEA3D.Light.call(this,t,e,i),128&this.attrib&&(this.attenuation={start:e.readFloat(),end:e.readFloat()}),this.secondColor=e.readUInt24(),e.readTags(this.readTag.bind(this))},SEA3D.HemisphereLight.prototype=Object.create(SEA3D.Light.prototype),SEA3D.HemisphereLight.prototype.constructor=SEA3D.HemisphereLight,SEA3D.HemisphereLight.prototype.type="hlht",SEA3D.AmbientLight=function(t,e,i){SEA3D.Light.call(this,t,e,i),e.readTags(this.readTag.bind(this))},SEA3D.AmbientLight.prototype=Object.create(SEA3D.Light.prototype),SEA3D.AmbientLight.prototype.constructor=SEA3D.AmbientLight,SEA3D.AmbientLight.prototype.type="alht",SEA3D.DirectionalLight=function(t,e,i){SEA3D.Light.call(this,t,e,i),this.transform=e.readMatrix(),e.readTags(this.readTag.bind(this))},SEA3D.DirectionalLight.prototype=Object.create(SEA3D.Light.prototype),SEA3D.DirectionalLight.prototype.constructor=SEA3D.DirectionalLight,SEA3D.DirectionalLight.prototype.type="dlht",SEA3D.Material=function(t,e,i){this.name=t,this.data=e,this.sea3d=i,this.technique=[],this.tecniquesDict={},this.attrib=e.readUShort(),this.alpha=1,this.blendMode="normal",this.doubleSided=0!=(1&this.attrib),this.receiveLights=0==(2&this.attrib),this.receiveShadows=0==(4&this.attrib),this.receiveFog=0==(8&this.attrib),this.repeat=0==(16&this.attrib),32&this.attrib&&(this.alpha=e.readFloat()),64&this.attrib&&(this.blendMode=e.readBlendMode()),128&this.attrib&&(this.animations=e.readAnimationList(i)),this.depthWrite=0==(256&this.attrib),this.depthTest=0==(512&this.attrib),this.premultipliedAlpha=0!=(1024&this.attrib);for(var r=e.readUByte(),n=0;n<r;++n){var a,o,s=e.readUShort(),c=e.readUShort(),h=e.position;switch(s){case SEA3D.Material.PHONG:a={ambientColor:e.readUInt24(),diffuseColor:e.readUInt24(),specularColor:e.readUInt24(),specular:e.readFloat(),gloss:e.readFloat()};break;case SEA3D.Material.PHYSICAL:a={color:e.readUInt24(),roughness:e.readFloat(),metalness:e.readFloat()};break;case SEA3D.Material.ANISOTROPIC:break;case SEA3D.Material.COMPOSITE_TEXTURE:a={composite:i.getObject(e.readUInt())};break;case SEA3D.Material.DIFFUSE_MAP:case SEA3D.Material.SPECULAR_MAP:case SEA3D.Material.NORMAL_MAP:case SEA3D.Material.AMBIENT_MAP:case SEA3D.Material.ALPHA_MAP:case SEA3D.Material.EMISSIVE_MAP:case SEA3D.Material.ROUGHNESS_MAP:case SEA3D.Material.METALNESS_MAP:a={texture:i.getObject(e.readUInt())};break;case SEA3D.Material.REFLECTION:case SEA3D.Material.FRESNEL_REFLECTION:a={texture:i.getObject(e.readUInt()),alpha:e.readFloat()},s===SEA3D.Material.FRESNEL_REFLECTION&&(a.power=e.readFloat(),a.normal=e.readFloat());break;case SEA3D.Material.REFRACTION:a={texture:i.getObject(e.readUInt()),alpha:e.readFloat(),ior:e.readFloat()};break;case SEA3D.Material.RIM:a={color:e.readUInt24(),strength:e.readFloat(),power:e.readFloat(),blendMode:e.readBlendMode()};break;case SEA3D.Material.LIGHT_MAP:a={texture:i.getObject(e.readUInt()),channel:e.readUByte(),blendMode:e.readBlendMode()};break;case SEA3D.Material.DETAIL_MAP:a={texture:i.getObject(e.readUInt()),scale:e.readFloat(),blendMode:e.readBlendMode()};break;case SEA3D.Material.CEL:a={color:e.readUInt24(),levels:e.readUByte(),size:e.readFloat(),specularCutOff:e.readFloat(),smoothness:e.readFloat()};break;case SEA3D.Material.TRANSLUCENT:a={translucency:e.readFloat(),scattering:e.readFloat()};break;case SEA3D.Material.BLEND_NORMAL_MAP:o=e.readUByte(),a={texture:i.getObject(e.readUInt()),secondaryTexture:i.getObject(e.readUInt())},1&o?(a.offsetX0=e.readFloat(),a.offsetY0=e.readFloat(),a.offsetX1=e.readFloat(),a.offsetY1=e.readFloat()):a.offsetX0=a.offsetY0=a.offsetX1=a.offsetY1=0,a.animate=2&o;break;case SEA3D.Material.MIRROR_REFLECTION:a={texture:i.getObject(e.readUInt()),alpha:e.readFloat()};break;case SEA3D.Material.EMISSIVE:a={color:e.readUInt24F()};break;case SEA3D.Material.VERTEX_COLOR:a={blendMode:e.readBlendMode()};break;case SEA3D.Material.WRAP_LIGHTING:a={color:e.readUInt24(),strength:e.readFloat()};break;case SEA3D.Material.COLOR_REPLACE:o=e.readUByte(),a={red:e.readUInt24(),green:e.readUInt24(),blue:e.readUInt24F()},1&o&&(a.mask=i.getObject(e.readUInt())),2&o&&(a.alpha=e.readFloat());break;case SEA3D.Material.REFLECTION_SPHERICAL:a={texture:i.getObject(e.readUInt()),alpha:e.readFloat()};break;case SEA3D.Material.REFLECTIVITY:o=e.readUByte(),a={strength:e.readFloat()},1&o&&(a.mask=i.getObject(e.readUInt()));break;case SEA3D.Material.CLEAR_COAT:a={strength:e.readFloat(),roughness:e.readFloat()};break;case SEA3D.Material.FLACCIDITY:o=e.readUByte(),a={target:i.getObject(e.readUInt()),scale:e.readFloat(),spring:e.readFloat(),damping:e.readFloat()},1&o&&(a.mask=i.getObject(e.readUInt()));break;default:void 0,e.position=h+=c;continue}a.kind=s,this.technique.push(a),this.tecniquesDict[s]=a,e.position=h+=c}},SEA3D.Material.PHONG=0,SEA3D.Material.COMPOSITE_TEXTURE=1,SEA3D.Material.DIFFUSE_MAP=2,SEA3D.Material.SPECULAR_MAP=3,SEA3D.Material.REFLECTION=4,SEA3D.Material.REFRACTION=5,SEA3D.Material.NORMAL_MAP=6,SEA3D.Material.FRESNEL_REFLECTION=7,SEA3D.Material.RIM=8,SEA3D.Material.LIGHT_MAP=9,SEA3D.Material.DETAIL_MAP=10,SEA3D.Material.CEL=11,SEA3D.Material.TRANSLUCENT=12,SEA3D.Material.BLEND_NORMAL_MAP=13,SEA3D.Material.MIRROR_REFLECTION=14,SEA3D.Material.AMBIENT_MAP=15,SEA3D.Material.ALPHA_MAP=16,SEA3D.Material.EMISSIVE_MAP=17,SEA3D.Material.VERTEX_COLOR=18,SEA3D.Material.WRAP_LIGHTING=19,SEA3D.Material.COLOR_REPLACE=20,SEA3D.Material.REFLECTION_SPHERICAL=21,SEA3D.Material.ANISOTROPIC=22,SEA3D.Material.EMISSIVE=23,SEA3D.Material.PHYSICAL=24,SEA3D.Material.ROUGHNESS_MAP=25,SEA3D.Material.METALNESS_MAP=26,SEA3D.Material.REFLECTIVITY=27,SEA3D.Material.CLEAR_COAT=28,SEA3D.Material.FLACCIDITY=29,SEA3D.Material.prototype.type="mat",SEA3D.Composite=function(t,e,i){this.name=t,this.data=e,this.sea3d=i;var r=e.readUByte();this.layer=[];for(var n=0;n<r;n++)this.layer[n]=new SEA3D.Composite.prototype.Layer(e,i)},SEA3D.Composite.prototype.getLayerByName=function(t){for(var e=0;e<this.layer.length;e++)if(this.layer[e].name===t)return this.layer[e]},SEA3D.Composite.prototype.Layer=function(t,e){var i=t.readUShort();1&i?this.texture=new SEA3D.Composite.LayerBitmap(t,e):this.color=t.readUInt24(),2&i&&(this.mask=new SEA3D.Composite.LayerBitmap(t,e)),4&i&&(this.name=t.readUTF8Tiny()),this.blendMode=8&i?t.readBlendMode():"normal",this.opacity=16&i?t.readFloat():1},SEA3D.Composite.LayerBitmap=function(t,e){this.map=e.getObject(t.readUInt());var i=t.readUShort();this.channel=1&i?t.readUByte():0,this.repeat=!1&i,this.offsetU=4&i?t.readFloat():0,this.offsetV=8&i?t.readFloat():0,this.scaleU=16&i?t.readFloat():1,this.scaleV=32&i?t.readFloat():1,this.rotation=64&i?t.readFloat():0,128&i&&(this.animation=t.readAnimationList(e))},SEA3D.Composite.prototype.type="ctex",SEA3D.PlanarRender=function(t,e,i){this.name=t,this.data=e,this.sea3d=i,this.attrib=e.readUByte(),this.quality=1&this.attrib|2&this.attrib,this.transform=e.readMatrix()},SEA3D.PlanarRender.prototype.type="rttp",SEA3D.CubeRender=function(t,e,i){this.name=t,this.data=e,this.sea3d=i,this.attrib=e.readUByte(),this.quality=1&this.attrib|2&this.attrib,this.position=e.readVector3()},SEA3D.CubeRender.prototype.type="rttc",SEA3D.CubeMap=function(t,e,i){this.name=t,this.data=e,this.sea3d=i,this.transparent=!1,this.extension=e.readExt(),this.faces=[];for(var r=0;r<6;r++){var n=e.readUInt();this.faces[r]=e.concat(e.position,n),e.position+=n}},SEA3D.CubeMap.prototype.type="cmap",SEA3D.JPEG=function(t,e,i){this.name=t,this.data=e,this.sea3d=i,this.transparent=!1},SEA3D.JPEG.prototype.type="jpg",SEA3D.JPEG_XR=function(t,e,i){this.name=t,this.data=e,this.sea3d=i,this.transparent=!0},SEA3D.JPEG_XR.prototype.type="wdp",SEA3D.PNG=function(t,e,i){this.name=t,this.data=e,this.sea3d=i,this.transparent=6===e.getByte(25)},SEA3D.PNG.prototype.type="png",SEA3D.GIF=function(t,e,i){this.name=t,this.data=e,this.sea3d=i,this.transparent=e.getByte(11)>0},SEA3D.GIF.prototype.type="gif",SEA3D.OGG=function(t,e,i){this.name=t,this.data=e,this.sea3d=i},SEA3D.OGG.prototype.type="ogg",SEA3D.MP3=function(t,e,i){this.name=t,this.data=e,this.sea3d=i},SEA3D.MP3.prototype.type="mp3",SEA3D.AssetUpdate=function(t,e,i){this.name=t,this.data=e,this.sea3d=i,this.index=e.readUInt(),this.bytes=e.concat(e.position,e.length-e.position)},SEA3D.AssetUpdate.prototype.type="upDt",SEA3D.File=function(t){this.config={streaming:!0,timeLimit:60,progressive:!1},t&&(void 0!==t.streaming&&(this.config.streaming=t.streaming),void 0!==t.timeLimit&&(this.config.timeLimit=t.timeLimit),void 0!==t.progressive&&(this.config.progressive=t.progressive),void 0!==t.path&&(this.config.path=t.path)),this.version=SEA3D.VERSION,this.objects=[],this.typeClass={},this.typeRead={},this.typeUnique={},this.position=this.dataPosition=0,this.scope=this,this.addClass(SEA3D.FileInfo,!0),this.addClass(SEA3D.Geometry,!0),this.addClass(SEA3D.Mesh),this.addClass(SEA3D.Sprite),this.addClass(SEA3D.Material),this.addClass(SEA3D.Composite),this.addClass(SEA3D.PointLight),this.addClass(SEA3D.DirectionalLight),this.addClass(SEA3D.HemisphereLight),this.addClass(SEA3D.AmbientLight),this.addClass(SEA3D.Animation,!0),this.addClass(SEA3D.Skeleton,!0),this.addClass(SEA3D.SkeletonLocal,!0),this.addClass(SEA3D.SkeletonAnimation,!0),this.addClass(SEA3D.UVWAnimation,!0),this.addClass(SEA3D.JointObject),this.addClass(SEA3D.Camera),this.addClass(SEA3D.OrthographicCamera),this.addClass(SEA3D.Morph,!0),this.addClass(SEA3D.MorphAnimation,!0),this.addClass(SEA3D.VertexAnimation,!0),this.addClass(SEA3D.CubeMap,!0),this.addClass(SEA3D.Dummy),this.addClass(SEA3D.Line),this.addClass(SEA3D.SoundPoint),this.addClass(SEA3D.PlanarRender),this.addClass(SEA3D.CubeRender),this.addClass(SEA3D.Actions),this.addClass(SEA3D.Container3D),this.addClass(SEA3D.Properties),this.addClass(SEA3D.ScriptURL,!0),this.addClass(SEA3D.TextureURL,!0),this.addClass(SEA3D.CubeMapURL,!0),this.addClass(SEA3D.JPEG,!0),this.addClass(SEA3D.JPEG_XR,!0),this.addClass(SEA3D.PNG,!0),this.addClass(SEA3D.GIF,!0),this.addClass(SEA3D.OGG,!0),this.addClass(SEA3D.MP3,!0),this.addClass(SEA3D.JavaScript,!0),this.addClass(SEA3D.JavaScriptMethod,!0),this.addClass(SEA3D.GLSL,!0),this.addClass(SEA3D.AssetUpdate,!0);for(var e=SEA3D.File.Extensions.length;e--;)SEA3D.File.Extensions[e].call(this)},SEA3D.File.Extensions=[],SEA3D.File.CompressionLibs={},SEA3D.File.DecompressionMethod={},SEA3D.File.setExtension=function(t){SEA3D.File.Extensions.push(t)},SEA3D.File.setDecompressionEngine=function(t,e,i){SEA3D.File.CompressionLibs[t]=e,SEA3D.File.DecompressionMethod[t]=i},SEA3D.File.prototype.addClass=function(t,e){this.typeClass[t.prototype.type]=t,this.typeUnique[t.prototype.type]=!0===e},SEA3D.File.prototype.readHead=function(){if(this.stream.bytesAvailable<16)return!1;if("SEA"!=this.stream.readUTF8(3))throw new Error("Invalid SEA3D format.");if(this.sign=this.stream.readUTF8(3),this.version=this.stream.readUInt24(),0!=this.stream.readUByte())throw new Error("Protection algorithm not compatible.");if(this.compressionID=this.stream.readUByte(),this.compressionAlgorithm=SEA3D.File.CompressionLibs[this.compressionID],this.decompressionMethod=SEA3D.File.DecompressionMethod[this.compressionID],this.compressionID>0&&!this.decompressionMethod)throw new Error("Compression algorithm not compatible.");return this.length=this.stream.readUInt(),this.dataPosition=this.stream.position,this.objects.length=0,this.state=this.readBody,this.onHead&&this.onHead({file:this,sign:this.sign}),!0},SEA3D.File.prototype.getObject=function(t){return this.objects[t]},SEA3D.File.prototype.getObjectIndex=function(t){return this.objects[t].index},SEA3D.File.prototype.getObjectByName=function(t){return this.getObject(this.getObjectIndex(t))},SEA3D.File.prototype.readSEAObject=function(){if(this.stream.bytesAvailable<4)return null;var t=this.stream.readUInt(),e=this.stream.position;if(this.stream.bytesAvailable<t)return null;var i=this.stream.readUByte(),r=this.stream.readExt(),n=null,a=1&i?this.stream.readUTF8Tiny():"",o=0!=(2&i),s=0!=(4&i);if(8&i){var c=this.stream.readUShort(),h=this.stream.concat(this.stream.position,c);this.stream.position+=c,o&&this.decompressionMethod&&(h.buffer=this.decompressionMethod(h.buffer)),n=h.readProperties(this)}t-=this.stream.position-e,e=this.stream.position;var l,u=this.stream.concat(e,t);return this.typeClass[r]?(o&&this.decompressionMethod&&(u.buffer=this.decompressionMethod(u.buffer)),l=new this.typeClass[r](a,u,this),(this.config.streaming&&s||this.config.forceStreaming)&&this.typeRead[r]&&this.typeRead[r].call(this.scope,l)):(l=new SEA3D.Object(a,u,r,this),void 0),l.index=this.objects.length,l.streaming=s,l.metadata=n,this.objects.push(this.objects[l.name+"."+l.type]=l),this.dataPosition=e+t,++this.position,l},SEA3D.File.prototype.isDone=function(){return this.position===this.length},SEA3D.File.prototype.readBody=function(){if(this.timer.update(),!this.resume)return!1;for(;this.position<this.length;){if(!(this.timer.deltaTime<this.config.timeLimit))return!1;this.stream.position=this.dataPosition;var t=this.readSEAObject();if(!t)return!1;this.dispatchCompleteObject(t)}return this.state=this.readComplete,!0},SEA3D.File.prototype.initParse=function(){this.timer=new SEA3D.Timer,this.position=0,this.resume=!0},SEA3D.File.prototype.parse=function(){this.initParse(),isFinite(this.config.timeLimit)?requestAnimationFrame(this.parseObject.bind(this)):this.parseObject()},SEA3D.File.prototype.parseObject=function(){for(this.timer.update();this.position<this.length&&this.timer.deltaTime<this.config.timeLimit;){var t=this.objects[this.position++],e=t.type;this.typeUnique[e]||delete t.tag,(t.streaming||this.config.forceStreaming)&&this.typeRead[e]&&void 0===t.tag&&this.typeRead[e].call(this.scope,t)}if(this.position===this.length){var i=this.timer.elapsedTime,r=i+"ms, "+this.objects.length+" objects";this.onParseComplete?this.onParseComplete({file:this,timeTotal:i,message:r}):void 0}else this.onParseProgress&&this.onParseProgress({file:this,loaded:this.position,total:this.length}),setTimeout(this.parseObject.bind(this),10)},SEA3D.File.prototype.readComplete=function(){return this.stream.position=this.dataPosition,6202321!=this.stream.readUInt24F()&&void 0,delete this.state,!1},SEA3D.File.prototype.readState=function(){for(;this.state();)continue;this.state?(requestAnimationFrame(this.readState.bind(this)),this.dispatchProgress()):this.dispatchComplete()},SEA3D.File.prototype.append=function(t){this.state?this.stream.append(t):this.read(t)},SEA3D.File.prototype.read=function(t){if(!t)throw new Error("No data found.");this.initParse(),this.stream=new SEA3D.Stream(t),this.state=this.readHead,this.readState()},SEA3D.File.prototype.dispatchCompleteObject=function(t){this.onCompleteObject&&this.onCompleteObject({file:this,object:t})},SEA3D.File.prototype.dispatchProgress=function(){this.onProgress&&this.onProgress({file:this,loaded:this.position,total:this.length})},SEA3D.File.prototype.dispatchDownloadProgress=function(t,e){this.onDownloadProgress&&this.onDownloadProgress({file:this,loaded:t,total:e})},SEA3D.File.prototype.dispatchComplete=function(){var t=this.timer.elapsedTime,e=t+"ms, "+this.objects.length+" objects";this.onComplete?this.onComplete({file:this,timeTotal:t,message:e}):void 0},SEA3D.File.prototype.dispatchError=function(t,e){this.onError?this.onError({file:this,id:t,message:e}):void 0},SEA3D.File.prototype.extractUrlBase=function(t){var e=t.split("/");return 1===e.length?"./":(e.pop(),e.join("/")+"/")},SEA3D.File.prototype.load=function(t){var e=this,i=new XMLHttpRequest;if(i.open("GET",t,!0),this.config.path||(this.config.path=this.extractUrlBase(t)),e.config.progressive){var r=0;i.overrideMimeType("text/plain; charset=x-user-defined")}else i.responseType="arraybuffer";i.onprogress=function(t){if(e.config.progressive){for(var n=i.responseText.substring(r),a=new Uint8Array(n.length),o=0;o<n.length;o++)a[o]=255&n.charCodeAt(o);r+=n.length,e.append(a.buffer)}e.dispatchDownloadProgress(t.loaded,t.total)},e.config.progressive||(i.onreadystatechange=function(){4===i.readyState&&(200===i.status||0===i.status?e.read(this.response):this.dispatchError(1001,"Couldn't load ["+t+"] ["+i.status+"]"))}),i.send()},SEA3D.LZMA=function(){var t=t||{};return t.OutWindow=function(){this._windowSize=0},t.OutWindow.prototype.create=function(t){this._buffer&&this._windowSize===t||(this._buffer=[]),this._windowSize=t,this._pos=0,this._streamPos=0},t.OutWindow.prototype.flush=function(){var t=this._pos-this._streamPos;if(0!==t){for(;t--;)this._stream.writeByte(this._buffer[this._streamPos++]);this._pos>=this._windowSize&&(this._pos=0),this._streamPos=this._pos}},t.OutWindow.prototype.releaseStream=function(){this.flush(),this._stream=null},t.OutWindow.prototype.setStream=function(t){this.releaseStream(),this._stream=t},t.OutWindow.prototype.init=function(t){t||(this._streamPos=0,this._pos=0)},t.OutWindow.prototype.copyBlock=function(t,e){var i=this._pos-t-1;for(i<0&&(i+=this._windowSize);e--;)i>=this._windowSize&&(i=0),this._buffer[this._pos++]=this._buffer[i++],this._pos>=this._windowSize&&this.flush()},t.OutWindow.prototype.putByte=function(t){this._buffer[this._pos++]=t,this._pos>=this._windowSize&&this.flush()},t.OutWindow.prototype.getByte=function(t){var e=this._pos-t-1;return e<0&&(e+=this._windowSize),this._buffer[e]},t.RangeDecoder=function(){},t.RangeDecoder.prototype.setStream=function(t){this._stream=t},t.RangeDecoder.prototype.releaseStream=function(){this._stream=null},t.RangeDecoder.prototype.init=function(){var t=5;for(this._code=0,this._range=-1;t--;)this._code=this._code<<8|this._stream.readByte()},t.RangeDecoder.prototype.decodeDirectBits=function(t){for(var e,i=0,r=t;r--;)this._range>>>=1,e=this._code-this._range>>>31,this._code-=this._range&e-1,i=i<<1|1-e,0==(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8);return i},t.RangeDecoder.prototype.decodeBit=function(t,e){var i=t[e],r=(this._range>>>11)*i;return(2147483648^this._code)<(2147483648^r)?(this._range=r,t[e]+=2048-i>>>5,0==(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),0):(this._range-=r,this._code-=r,t[e]-=i>>>5,0==(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),1)},t.initBitModels=function(t,e){for(;e--;)t[e]=1024},t.BitTreeDecoder=function(t){this._models=[],this._numBitLevels=t},t.BitTreeDecoder.prototype.init=function(){t.initBitModels(this._models,1<<this._numBitLevels)},t.BitTreeDecoder.prototype.decode=function(t){for(var e=1,i=this._numBitLevels;i--;)e=e<<1|t.decodeBit(this._models,e);return e-(1<<this._numBitLevels)},t.BitTreeDecoder.prototype.reverseDecode=function(t){for(var e,i=1,r=0,n=0;n<this._numBitLevels;++n)i=i<<1|(e=t.decodeBit(this._models,i)),r|=e<<n;return r},t.reverseDecode2=function(t,e,i,r){for(var n,a=1,o=0,s=0;s<r;++s)a=a<<1|(n=i.decodeBit(t,e+a)),o|=n<<s;return o},t.LenDecoder=function(){this._choice=[],this._lowCoder=[],this._midCoder=[],this._highCoder=new t.BitTreeDecoder(8),this._numPosStates=0},t.LenDecoder.prototype.create=function(e){for(;this._numPosStates<e;++this._numPosStates)this._lowCoder[this._numPosStates]=new t.BitTreeDecoder(3),this._midCoder[this._numPosStates]=new t.BitTreeDecoder(3)},t.LenDecoder.prototype.init=function(){var e=this._numPosStates;for(t.initBitModels(this._choice,2);e--;)this._lowCoder[e].init(),this._midCoder[e].init();this._highCoder.init()},t.LenDecoder.prototype.decode=function(t,e){return 0===t.decodeBit(this._choice,0)?this._lowCoder[e].decode(t):0===t.decodeBit(this._choice,1)?8+this._midCoder[e].decode(t):16+this._highCoder.decode(t)},t.Decoder2=function(){this._decoders=[]},t.Decoder2.prototype.init=function(){t.initBitModels(this._decoders,768)},t.Decoder2.prototype.decodeNormal=function(t){var e=1;do{e=e<<1|t.decodeBit(this._decoders,e)}while(e<256);return 255&e},t.Decoder2.prototype.decodeWithMatchByte=function(t,e){var i,r,n=1;do{if(i=e>>7&1,e<<=1,n=n<<1|(r=t.decodeBit(this._decoders,(1+i<<8)+n)),i!==r){for(;n<256;)n=n<<1|t.decodeBit(this._decoders,n);break}}while(n<256);return 255&n},t.LiteralDecoder=function(){},t.LiteralDecoder.prototype.create=function(e,i){var r;if(!this._coders||this._numPrevBits!==i||this._numPosBits!==e)for(this._numPosBits=e,this._posMask=(1<<e)-1,this._numPrevBits=i,this._coders=[],r=1<<this._numPrevBits+this._numPosBits;r--;)this._coders[r]=new t.Decoder2},t.LiteralDecoder.prototype.init=function(){for(var t=1<<this._numPrevBits+this._numPosBits;t--;)this._coders[t].init()},t.LiteralDecoder.prototype.getDecoder=function(t,e){return this._coders[((t&this._posMask)<<this._numPrevBits)+((255&e)>>>8-this._numPrevBits)]},t.Decoder=function(){this._outWindow=new t.OutWindow,this._rangeDecoder=new t.RangeDecoder,this._isMatchDecoders=[],this._isRepDecoders=[],this._isRepG0Decoders=[],this._isRepG1Decoders=[],this._isRepG2Decoders=[],this._isRep0LongDecoders=[],this._posSlotDecoder=[],this._posDecoders=[],this._posAlignDecoder=new t.BitTreeDecoder(4),this._lenDecoder=new t.LenDecoder,this._repLenDecoder=new t.LenDecoder,this._literalDecoder=new t.LiteralDecoder,this._dictionarySize=-1,this._dictionarySizeCheck=-1,this._posSlotDecoder[0]=new t.BitTreeDecoder(6),this._posSlotDecoder[1]=new t.BitTreeDecoder(6),this._posSlotDecoder[2]=new t.BitTreeDecoder(6),this._posSlotDecoder[3]=new t.BitTreeDecoder(6)},t.Decoder.prototype.setDictionarySize=function(t){return!(t<0)&&(this._dictionarySize!==t&&(this._dictionarySize=t,this._dictionarySizeCheck=Math.max(this._dictionarySize,1),this._outWindow.create(Math.max(this._dictionarySizeCheck,4096))),!0)},t.Decoder.prototype.setLcLpPb=function(t,e,i){var r=1<<i;return!(t>8||e>4||i>4)&&(this._literalDecoder.create(e,t),this._lenDecoder.create(r),this._repLenDecoder.create(r),this._posStateMask=r-1,!0)},t.Decoder.prototype.init=function(){var e=4;for(this._outWindow.init(!1),t.initBitModels(this._isMatchDecoders,192),t.initBitModels(this._isRep0LongDecoders,192),t.initBitModels(this._isRepDecoders,12),t.initBitModels(this._isRepG0Decoders,12),t.initBitModels(this._isRepG1Decoders,12),t.initBitModels(this._isRepG2Decoders,12),t.initBitModels(this._posDecoders,114),this._literalDecoder.init();e--;)this._posSlotDecoder[e].init();this._lenDecoder.init(),this._repLenDecoder.init(),this._posAlignDecoder.init(),this._rangeDecoder.init()},t.Decoder.prototype.decode=function(e,i,r){var n,a,o,s,c,h,l=0,u=0,p=0,d=0,f=0,m=0,g=0;for(this._rangeDecoder.setStream(e),this._outWindow.setStream(i),this.init();r<0||m<r;)if(n=m&this._posStateMask,0===this._rangeDecoder.decodeBit(this._isMatchDecoders,(l<<4)+n))a=this._literalDecoder.getDecoder(m++,g),g=l>=7?a.decodeWithMatchByte(this._rangeDecoder,this._outWindow.getByte(u)):a.decodeNormal(this._rangeDecoder),this._outWindow.putByte(g),l=l<4?0:l-(l<10?3:6);else{if(1===this._rangeDecoder.decodeBit(this._isRepDecoders,l))o=0,0===this._rangeDecoder.decodeBit(this._isRepG0Decoders,l)?0===this._rangeDecoder.decodeBit(this._isRep0LongDecoders,(l<<4)+n)&&(l=l<7?9:11,o=1):(0===this._rangeDecoder.decodeBit(this._isRepG1Decoders,l)?s=p:(0===this._rangeDecoder.decodeBit(this._isRepG2Decoders,l)?s=d:(s=f,f=d),d=p),p=u,u=s),0===o&&(o=2+this._repLenDecoder.decode(this._rangeDecoder,n),l=l<7?8:11);else if(f=d,d=p,p=u,o=2+this._lenDecoder.decode(this._rangeDecoder,n),l=l<7?7:10,(c=this._posSlotDecoder[o<=5?o-2:3].decode(this._rangeDecoder))>=4){if(u=(2|1&c)<<(h=(c>>1)-1),c<14)u+=t.reverseDecode2(this._posDecoders,u-c-1,this._rangeDecoder,h);else if(u+=this._rangeDecoder.decodeDirectBits(h-4)<<4,(u+=this._posAlignDecoder.reverseDecode(this._rangeDecoder))<0){if(-1===u)break;return!1}}else u=c;if(u>=m||u>=this._dictionarySizeCheck)return!1;this._outWindow.copyBlock(u,o),m+=o,g=this._outWindow.getByte(0)}return this._outWindow.flush(),this._outWindow.releaseStream(),this._rangeDecoder.releaseStream(),!0},t.Decoder.prototype.setDecoderProperties=function(t){var e,i,r,n,a;return!(t.size<5)&&(i=(e=t.readByte())%9,r=(e=~~(e/9))%5,n=~~(e/5),!!this.setLcLpPb(i,r,n)&&(a=t.readByte(),a|=t.readByte()<<8,a|=t.readByte()<<16,a+=16777216*t.readByte(),this.setDictionarySize(a)))},t.decompress=function(e,i,r,n){var a=new t.Decoder;if(!a.setDecoderProperties(e))throw"Incorrect stream properties";if(!a.decode(i,r,n))throw"Error in data stream";return!0},t.decompressFile=function(e,i){var r,n=new t.Decoder;if(!n.setDecoderProperties(e))throw"Incorrect stream properties";if(r=e.readByte(),r|=e.readByte()<<8,r|=e.readByte()<<16,r+=16777216*e.readByte(),e.readByte(),e.readByte(),e.readByte(),e.readByte(),!n.decode(e,i,r))throw"Error in data stream";return!0},t}(),SEA3D.File.LZMAUncompress=function(t){var e={data:t=new Uint8Array(t),position:0,readByte:function(){return this.data[this.position++]}},i={data:[],position:0,writeByte:function(t){this.data[this.position++]=t}};return SEA3D.LZMA.decompressFile(e,i),new Uint8Array(i.data).buffer},SEA3D.File.setDecompressionEngine(2,"lzma",SEA3D.File.LZMAUncompress),THREE.SEA3D=function(t){this.config={id:"",scripts:!0,runScripts:!0,autoPlay:!1,dummys:!0,multiplier:1,bounding:!0,audioRolloffFactor:10,lights:!0,useEnvironment:!0,useVertexTexture:!0,forceStatic:!1,streaming:!0,async:!0,paths:{},timeLimit:10},t&&this.loadConfig(t)},THREE.SEA3D.MTXBUF=new THREE.Matrix4,THREE.SEA3D.VECBUF=new THREE.Vector3,THREE.SEA3D.QUABUF=new THREE.Quaternion,THREE.SEA3D.BACKGROUND_COLOR=3355443,THREE.SEA3D.HELPER_COLOR=10140133,THREE.SEA3D.RTT_SIZE=512,THREE.SEA3D.identityMatrixScale=function(){var t=new THREE.Vector3;return function(e){return t.setFromMatrixScale(e),e.scale(t.set(1/t.x,1/t.y,1/t.z))}}(),THREE.SEA3D.prototype=Object.assign(Object.create(THREE.EventDispatcher.prototype),{constructor:THREE.SEA3D,setShadowMap:function(t){t.shadow.mapSize.width=2048,t.shadow.mapSize.height=1024,t.castShadow=!0,t.shadow.camera.left=-200,t.shadow.camera.right=200,t.shadow.camera.top=200,t.shadow.camera.bottom=-200,t.shadow.camera.near=1,t.shadow.camera.far=3e3,t.shadow.camera.fov=45,t.shadow.bias=-.001}}),Object.defineProperties(THREE.SEA3D.prototype,{container:{set:function(t){this.config.container=t},get:function(){return this.config.container}},elapsedTime:{get:function(){return this.file.timer.elapsedTime}}}),THREE.SEA3D.Domain=function(t,e,i){this.id=t,this.objects=e,this.container=i,this.sources=[],this.local={},this.scriptTargets=[],this.events=new THREE.EventDispatcher},THREE.SEA3D.Domain.global={},THREE.SEA3D.Domain.prototype=Object.assign(Object.create(THREE.EventDispatcher.prototype),{constructor:THREE.SEA3D.Domain,add:function(t){this.sources.push(t)},remove:function(t){this.sources.splice(this.sources.indexOf(t),1)},contains:function(t){return-1!=this.sources.indexOf(t)},addEventListener:function(t,e){this.events.addEventListener(t,e)},hasEventListener:function(t,e){return this.events.hasEventListener(t,e)},removeEventListener:function(t,e){this.events.removeEventListener(t,e)},print:function(){console.log.apply(console,arguments)},watch:function(){console.log.apply(console,"watch:",arguments)},runScripts:function(){for(var t=0;t<this.scriptTargets.length;t++)this.runJSMList(this.scriptTargets[t])},runJSMList:function(t){for(var e=t.scripts,i=0;i<e.length;i++)this.runJSM(t,e[i]);return e},runJSM:function(t,e){var i={print:this.print,watch:this.watch,sea3d:this,scene:this.container,source:new THREE.SEA3D.ScriptDomain(this,t instanceof THREE.SEA3D.Domain)};Object.freeze(i.source),THREE.SEA3D.ScriptHandler.add(i.source);try{this.methods[e.method](i,this.getReference,THREE.SEA3D.Domain.global,this.local,t,e.params)}catch(t){void 0,void 0}},getReference:function(ns){return eval(ns)},disposeList:function(t){if(t&&t.length)for(var e=(t=t.concat()).length;e--;)t[e].dispose()},dispatchEvent:function(t){t.domain=this;for(var e=this.sources.concat(),i=e.length;i--;)e[i].dispatchEvent(t);this.events.dispatchEvent(t)},dispose:function(){for(this.disposeList(this.sources);this.container.children.length;)this.container.remove(this.container.children[0]);for(var t=THREE.SEA3D.EXTENSIONS_DOMAIN.length;t--;){var e=THREE.SEA3D.EXTENSIONS_DOMAIN[t];e.dispose&&e.dispose.call(this)}this.disposeList(this.materials),this.disposeList(this.dummys),this.dispatchEvent({type:"dispose"})}}),THREE.SEA3D.DomainManager=function(t){this.domains=[],this.autoDisposeRootDomain=void 0===t||t},Object.assign(THREE.SEA3D.DomainManager.prototype,{onDisposeDomain:function(t){this.remove(t.domain),this.autoDisposeRootDomain&&1===this.domains.length&&this.dispose()},add:function(t){this._onDisposeDomain=this._onDisposeDomain||this.onDisposeDomain.bind(this),t.on("dispose",this._onDisposeDomain),this.domains.push(t),this.textures=this.textures||t.textures,this.cubemaps=this.cubemaps||t.cubemaps,this.geometries=this.geometries||t.geometries},remove:function(t){t.removeEvent("dispose",this._onDisposeDomain),this.domains.splice(this.domains.indexOf(t),1)},contains:function(t){return-1!=this.domains.indexOf(t)},disposeList:function(t){if(t&&t.length)for(var e=(t=t.concat()).length;e--;)t[e].dispose()},dispose:function(){this.disposeList(this.domains),this.disposeList(this.textures),this.disposeList(this.cubemaps),this.disposeList(this.geometries)}}),THREE.SEA3D.ScriptDomain=function(t,e){(t=t||new THREE.SEA3D.Domain).add(this);var i=new THREE.EventDispatcher;this.getId=function(){return t.id},this.isRoot=function(){return e},this.addEventListener=function(t,e){i.addEventListener(t,e)},this.hasEventListener=function(t,e){return i.hasEventListener(t,e)},this.removeEventListener=function(t,e){i.removeEventListener(t,e)},this.dispatchEvent=function(t){t.script=this,i.dispatchEvent(t)},this.dispose=function(){t.remove(this),e&&t.dispose(),this.dispatchEvent({type:"dispose"})}},THREE.SEA3D.ScriptManager=function(){this.scripts=[];var t=function(t){this.remove(t.script)}.bind(this);this.add=function(e){e.addEventListener("dispose",t),this.scripts.push(e)},this.remove=function(e){e.removeEventListener("dispose",t),this.scripts.splice(this.scripts.indexOf(e),1)},this.contains=function(t){return this.scripts.indexOf(t)>-1},this.dispatchEvent=function(t){for(var e=this.scripts.concat(),i=e.length;i--;)e[i].dispatchEvent(t)}},THREE.SEA3D.ScriptHandler=new THREE.SEA3D.ScriptManager,THREE.SEA3D.ScriptHandler.dispatchUpdate=function(t){this.dispatchEvent({type:"update",delta:t})},THREE.SEA3D.AnimationClip=function(t,e,i,r){THREE.AnimationClip.call(this,t,e,i),this.repeat=void 0===r||r},THREE.SEA3D.AnimationClip.fromClip=function(t,e){return new THREE.SEA3D.AnimationClip(t.name,t.duration,t.tracks,e)},THREE.SEA3D.AnimationClip.prototype=Object.assign(Object.create(THREE.AnimationClip.prototype),{constructor:THREE.SEA3D.AnimationClip}),THREE.SEA3D.Animation=function(t,e){this.clip=t,this.timeScale=void 0!==e?e:1},THREE.SEA3D.Animation.COMPLETE="animationComplete",THREE.SEA3D.Animation.prototype=Object.assign(Object.create(THREE.EventDispatcher.prototype),{constructor:THREE.SEA3D.Animation,onComplete:function(t){this.dispatchEvent({type:THREE.SEA3D.Animation.COMPLETE,target:this})}}),Object.defineProperties(THREE.SEA3D.Animation.prototype,{name:{get:function(){return this.clip.name}},repeat:{get:function(){return this.clip.repeat}},duration:{get:function(){return this.clip.duration}},mixer:{set:function(t){this.mx&&(this.mx.uncacheClip(this.clip),delete this.mx),t&&(this.mx=t,this.mx.clipAction(this.clip))},get:function(){return this.mx}}}),THREE.SEA3D.Animator=function(t,e){this.updateAnimations(t,e),this.clone=function(t){return new this.constructor(this.clips,new THREE.AnimationMixer(t)).copyFrom(this)}.bind(this)},Object.assign(THREE.SEA3D.Animator.prototype,{update:function(t){return this.mixer.update(t||0),this.currentAnimationAction&&this.currentAnimationAction.paused&&(this.pause(),this.currentAnimation&&this.currentAnimation.onComplete(this)),this},updateAnimations:function(t,e){if(this.playing&&this.stop(),this.mixer&&THREE.SEA3D.AnimationHandler.remove(this),this.mixer=e,this.relative=!1,this.playing=!1,this.paused=!1,this.timeScale=1,this.animations=[],this.animation={},this.clips=[],t)for(var i=0;i<t.length;i++)this.addAnimation(t[i]);return this},addAnimation:function(t){return t instanceof THREE.AnimationClip&&(this.clips.push(t),t=new THREE.SEA3D.Animation(t)),this.animations.push(t),this.animation[t.name]=t,t.mixer=this.mixer,t},removeAnimation:function(t){return t instanceof THREE.AnimationClip&&(t=this.getAnimationByClip(t)),this.clips.splice(this.clips.indexOf(t.clip),1),delete this.animation[t.name],this.animations.splice(this.animations.indexOf(t),1),t.mixer=null,t},getAnimationByClip:function(t){for(var e=0;e<this.animations.length;e++)if(this.animations[e].clip===t)return t},getAnimationByName:function(t){return"number"==typeof t?this.animations[t]:this.animation[t]},setAnimationWeight:function(t,e){this.mixer.clipAction(this.getAnimationByName(t).clip).setEffectiveWeight(e)},getAnimationWeight:function(t){return this.mixer.clipAction(this.getAnimationByName(t).clip).getEffectiveWeight()},pause:function(){return this.playing&&this.currentAnimation&&(THREE.SEA3D.AnimationHandler.remove(this),this.playing=!1),this},resume:function(){return!this.playing&&this.currentAnimation&&(THREE.SEA3D.AnimationHandler.add(this),this.playing=!0),this},setTimeScale:function(t){return this.timeScale=t,this.currentAnimationAction&&this.updateTimeScale(),this},getTimeScale:function(){return this.timeScale},updateTimeScale:function(){return this.currentAnimationAction.setEffectiveTimeScale(this.timeScale*(this.currentAnimation?this.currentAnimation.timeScale:1)),this},play:function(t,e,i,r){var n=this.getAnimationByName(t);if(!n)throw new Error('Animation "'+t+'" not found.');return n===this.currentAnimation?(void 0===i&&n.repeat||(this.currentAnimationAction.time=void 0!==i?i:this.currentAnimationAction.timeScale>=0?0:this.currentAnimation.duration),this.currentAnimationAction.setEffectiveWeight(void 0!==r?r:1),this.currentAnimationAction.paused=!1,this.resume()):(this.previousAnimation=this.currentAnimation,this.currentAnimation=n,this.previousAnimationAction=this.currentAnimationAction,this.currentAnimationAction=this.mixer.clipAction(n.clip).setLoop(n.repeat?THREE.LoopRepeat:THREE.LoopOnce,1/0).reset(),this.currentAnimationAction.clampWhenFinished=!n.repeat,this.currentAnimationAction.paused=!1,this.updateTimeScale(),void 0===i&&n.repeat||(this.currentAnimationAction.time=void 0!==i?i:this.currentAnimationAction.timeScale>=0?0:this.currentAnimation.duration),this.currentAnimationAction.setEffectiveWeight(void 0!==r?r:1),this.currentAnimationAction.play(),this.playing||this.mixer.update(0),this.playing=!0,this.previousAnimation&&this.previousAnimationAction.crossFadeTo(this.currentAnimationAction,e||0,!1),THREE.SEA3D.AnimationHandler.add(this),this)},stop:function(){return this.playing&&THREE.SEA3D.AnimationHandler.remove(this),this.currentAnimation&&(this.currentAnimationAction.stop(),this.previousAnimation=this.currentAnimation,this.previousAnimationAction=this.currentAnimationAction,delete this.currentAnimationAction,delete this.currentAnimation,this.playing=!1),this},playw:function(t,e){this.playing||this.paused||THREE.SEA3D.AnimationHandler.add(this);var i=this.getAnimationByName(t);this.playing=!0;var r=this.mixer.clipAction(i.clip);return r.setLoop(i.repeat?THREE.LoopRepeat:THREE.LoopOnce,1/0).reset(),r.clampWhenFinished=!i.repeat,r.paused=!1,r.setEffectiveWeight(e).play(),r},crossFade:function(t,e,i,r){this.mixer.stopAllAction();var n=this.playw(t,1),a=this.playw(e,1);return n.crossFadeTo(a,i,void 0!==r&&r),this},stopAll:function(){return this.stop().mixer.stopAllAction(),this.playing=!1,this},unPauseAll:function(){return this.mixer.timeScale=1,this.playing=!0,this.paused=!1,this},pauseAll:function(){return this.mixer.timeScale=0,this.playing=!1,this.paused=!0,this},setRelative:function(t){if(this.relative!==t)return this.stop(),this.relative=t,this},getRelative:function(){return this.relative},copyFrom:function(t){for(var e=0;e<this.animations.length;e++)this.animations[e].timeScale=t.animations[e].timeScale;return this}}),THREE.SEA3D.Object3DAnimator=function(t,e){this.object3d=e,THREE.SEA3D.Animator.call(this,t,new THREE.AnimationMixer(e)),this.clone=function(t){return new this.constructor(this.clips,t).copyFrom(this)}.bind(this)},THREE.SEA3D.Object3DAnimator.prototype=Object.assign(Object.create(THREE.SEA3D.Animator.prototype),{constructor:THREE.SEA3D.Object3DAnimator,stop:function(){if(this.currentAnimation){var t=this.object3d.animate;t&&this instanceof THREE.SEA3D.Object3DAnimator&&(t.position.set(0,0,0),t.quaternion.set(0,0,0,1),t.scale.set(1,1,1))}THREE.SEA3D.Animator.prototype.stop.call(this)},setRelative:function(t){THREE.SEA3D.Animator.prototype.setRelative.call(this,t),this.object3d.setAnimator(this.relative),this.updateAnimations(this.clips,new THREE.AnimationMixer(this.relative?this.object3d.animate:this.object3d))}}),THREE.SEA3D.CameraAnimator=function(t,e){THREE.SEA3D.Object3DAnimator.call(this,t,e)},THREE.SEA3D.CameraAnimator.prototype=Object.assign(Object.create(THREE.SEA3D.Object3DAnimator.prototype),{constructor:THREE.SEA3D.CameraAnimator}),THREE.SEA3D.SoundAnimator=function(t,e){THREE.SEA3D.Object3DAnimator.call(this,t,e)},THREE.SEA3D.SoundAnimator.prototype=Object.assign(Object.create(THREE.SEA3D.Object3DAnimator.prototype),{constructor:THREE.SEA3D.SoundAnimator}),THREE.SEA3D.LightAnimator=function(t,e){THREE.SEA3D.Object3DAnimator.call(this,t,e)},THREE.SEA3D.LightAnimator.prototype=Object.assign(Object.create(THREE.SEA3D.Object3DAnimator.prototype),{constructor:THREE.SEA3D.LightAnimator}),THREE.SEA3D.Object3D=function(){THREE.Object3D.call(this)},THREE.SEA3D.Object3D.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.SEA3D.Object3D,updateAnimateMatrix:function(t){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==t||(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.animate.updateMatrix(),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.animate.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=0,i=this.children.length;e<i;e++)this.children[e].updateMatrixWorld(t)},setAnimator:function(t){this.getAnimator()!=t&&(t?(this.animate=new THREE.Object3D,this.updateMatrixWorld=THREE.SEA3D.Object3D.prototype.updateAnimateMatrix):(delete this.animate,this.updateMatrixWorld=THREE.Object3D.prototype.updateMatrixWorld),this.matrixWorldNeedsUpdate=!0)},getAnimator:function(){return null!=this.animate},copy:function(t){return THREE.Object3D.prototype.copy.call(this,t),this.attribs=t.attribs,this.scripts=t.scripts,t.animator&&(this.animator=t.animator.clone(this)),this}}),THREE.SEA3D.Dummy=function(t,e,i){this.width=null!=t?t:100,this.height=null!=e?e:100,this.depth=null!=i?i:100;var r=new THREE.BoxGeometry(this.width,this.height,this.depth,1,1,1);r.computeBoundingBox(),r.computeBoundingSphere(),THREE.Mesh.call(this,r,THREE.SEA3D.Dummy.MATERIAL)},THREE.SEA3D.Dummy.MATERIAL=new THREE.MeshBasicMaterial({wireframe:!0,color:THREE.SEA3D.HELPER_COLOR}),THREE.SEA3D.Dummy.prototype=Object.assign(Object.create(THREE.Mesh.prototype),THREE.SEA3D.Object3D.prototype,{constructor:THREE.SEA3D.Dummy,copy:function(t){return THREE.Mesh.prototype.copy.call(this,t),this.attribs=t.attribs,this.scripts=t.scripts,t.animator&&(this.animator=t.animator.clone(this)),this},dispose:function(){this.geometry.dispose()}}),THREE.SEA3D.Mesh=function(t,e){THREE.Mesh.call(this,t,e)},THREE.SEA3D.Mesh.prototype=Object.assign(Object.create(THREE.Mesh.prototype),THREE.SEA3D.Object3D.prototype,{constructor:THREE.SEA3D.Mesh,setWeight:function(t,e){var i="number"==typeof t?t:this.morphTargetDictionary[t];this.morphTargetInfluences[i]=e},getWeight:function(t){var e="number"==typeof t?t:this.morphTargetDictionary[t];return this.morphTargetInfluences[e]},copy:function(t){return THREE.Mesh.prototype.copy.call(this,t),this.attribs=t.attribs,this.scripts=t.scripts,t.animator&&(this.animator=t.animator.clone(this)),this}}),THREE.SEA3D.SkinnedMesh=function(t,e){THREE.SkinnedMesh.call(this,t,e),this.bind(new THREE.Skeleton(this.initBones()),this.matrixWorld),this.updateAnimations(t.animations,new THREE.AnimationMixer(this))},THREE.SEA3D.SkinnedMesh.prototype=Object.assign(Object.create(THREE.SkinnedMesh.prototype),THREE.SEA3D.Mesh.prototype,THREE.SEA3D.Animator.prototype,{constructor:THREE.SEA3D.SkinnedMesh,initBones:function(){var t,e,i,r,n=[];if(this.geometry&&void 0!==this.geometry.bones){for(i=0,r=this.geometry.bones.length;i<r;i++)e=this.geometry.bones[i],t=new THREE.Bone,n.push(t),t.name=e.name,t.position.fromArray(e.pos),t.quaternion.fromArray(e.rotq),void 0!==e.scl&&t.scale.fromArray(e.scl);for(i=0,r=this.geometry.bones.length;i<r;i++)-1!==(e=this.geometry.bones[i]).parent&&null!==e.parent&&void 0!==n[e.parent]?n[e.parent].add(n[i]):this.add(n[i])}return this.updateMatrixWorld(!0),n},boneByName:function(t){for(var e=this.skeleton.bones,i=0,r=e.length;i<r;i++)if(t===e[i].name)return e[i]},copy:function(t){return THREE.SkinnedMesh.prototype.copy.call(this,t),this.attribs=t.attribs,this.scripts=t.scripts,t.animator&&(this.animator=t.animator.clone(this)),this}}),THREE.SEA3D.VertexAnimationMesh=function(t,e){THREE.Mesh.call(this,t,e),this.type="MorphAnimMesh",this.updateAnimations(t.animations,new THREE.AnimationMixer(this))},THREE.SEA3D.VertexAnimationMesh.prototype=Object.assign(Object.create(THREE.Mesh.prototype),THREE.SEA3D.Mesh.prototype,THREE.SEA3D.Animator.prototype,{constructor:THREE.SEA3D.VertexAnimationMesh,copy:function(t){return THREE.Mesh.prototype.copy.call(this,t),this.attribs=t.attribs,this.scripts=t.scripts,t.animator&&(this.animator=t.animator.clone(this)),this}}),THREE.SEA3D.Camera=function(t,e,i,r){THREE.PerspectiveCamera.call(this,t,e,i,r)},THREE.SEA3D.Camera.prototype=Object.assign(Object.create(THREE.PerspectiveCamera.prototype),THREE.SEA3D.Object3D.prototype,{constructor:THREE.SEA3D.Camera,copy:function(t){return THREE.PerspectiveCamera.prototype.copy.call(this,t),this.attribs=t.attribs,this.scripts=t.scripts,t.animator&&(this.animator=t.animator.clone(this)),this}}),THREE.SEA3D.OrthographicCamera=function(t,e,i,r,n,a){THREE.OrthographicCamera.call(this,t,e,i,r,n,a)},THREE.SEA3D.OrthographicCamera.prototype=Object.assign(Object.create(THREE.OrthographicCamera.prototype),THREE.SEA3D.Object3D.prototype,{constructor:THREE.SEA3D.OrthographicCamera,copy:function(t){return THREE.OrthographicCamera.prototype.copy.call(this,t),this.attribs=t.attribs,this.scripts=t.scripts,t.animator&&(this.animator=t.animator.clone(this)),this}}),THREE.SEA3D.PointLight=function(t,e,i,r){THREE.PointLight.call(this,t,e,i,r)},THREE.SEA3D.PointLight.prototype=Object.assign(Object.create(THREE.PointLight.prototype),THREE.SEA3D.Object3D.prototype,{constructor:THREE.SEA3D.PointLight,copy:function(t){return THREE.PointLight.prototype.copy.call(this,t),this.attribs=t.attribs,this.scripts=t.scripts,t.animator&&(this.animator=t.animator.clone(this)),this}}),THREE.SEA3D.PointSound=function(t,e){THREE.PositionalAudio.call(this,t),this.setSound(e)},THREE.SEA3D.PointSound.prototype=Object.assign(Object.create(THREE.PositionalAudio.prototype),THREE.SEA3D.Object3D.prototype,{constructor:THREE.SEA3D.PointSound,setSound:function(t){return this.sound=t,t&&(t.buffer?this.setBuffer(t.buffer):t.addEventListener("complete",function(e){this.setBuffer(t.buffer)}.bind(this))),this},copy:function(t){return THREE.PositionalAudio.prototype.copy.call(this,t),this.attribs=t.attribs,this.scripts=t.scripts,t.animator&&(this.animator=t.animator.clone(this)),this}}),THREE.SEA3D.AnimationHandler={animators:[],update:function(t){for(var e=0;e<this.animators.length;)this.animators[e++].update(t)},add:function(t){-1===this.animators.indexOf(t)&&this.animators.push(t)},remove:function(t){var e=this.animators.indexOf(t);-1!==e&&this.animators.splice(e,1)}},THREE.SEA3D.Sound=function(t){this.uuid=THREE.Math.generateUUID(),this.src=t,(new THREE.AudioLoader).load(t,function(t){this.buffer=t,this.dispatchEvent({type:"complete"})}.bind(this))},THREE.SEA3D.Sound.prototype=Object.assign(Object.create(THREE.EventDispatcher.prototype),{constructor:THREE.SEA3D.Sound}),THREE.SEA3D.Domain.prototype.getMesh=THREE.SEA3D.prototype.getMesh=function(t){return this.objects["m3d/"+t]},THREE.SEA3D.Domain.prototype.getDummy=THREE.SEA3D.prototype.getDummy=function(t){return this.objects["dmy/"+t]},THREE.SEA3D.Domain.prototype.getLine=THREE.SEA3D.prototype.getLine=function(t){return this.objects["line/"+t]},THREE.SEA3D.Domain.prototype.getSound3D=THREE.SEA3D.prototype.getSound3D=function(t){return this.objects["sn3d/"+t]},THREE.SEA3D.Domain.prototype.getMaterial=THREE.SEA3D.prototype.getMaterial=function(t){return this.objects["mat/"+t]},THREE.SEA3D.Domain.prototype.getLight=THREE.SEA3D.prototype.getLight=function(t){return this.objects["lht/"+t]},THREE.SEA3D.Domain.prototype.getGLSL=THREE.SEA3D.prototype.getGLSL=function(t){return this.objects["glsl/"+t]},THREE.SEA3D.Domain.prototype.getCamera=THREE.SEA3D.prototype.getCamera=function(t){return this.objects["cam/"+t]},THREE.SEA3D.Domain.prototype.getTexture=THREE.SEA3D.prototype.getTexture=function(t){return this.objects["tex/"+t]},THREE.SEA3D.Domain.prototype.getCubeMap=THREE.SEA3D.prototype.getCubeMap=function(t){return this.objects["cmap/"+t]},THREE.SEA3D.Domain.prototype.getJointObject=THREE.SEA3D.prototype.getJointObject=function(t){return this.objects["jnt/"+t]},THREE.SEA3D.Domain.prototype.getContainer3D=THREE.SEA3D.prototype.getContainer3D=function(t){return this.objects["c3d/"+t]},THREE.SEA3D.Domain.prototype.getSprite=THREE.SEA3D.prototype.getSprite=function(t){return this.objects["m2d/"+t]},THREE.SEA3D.Domain.prototype.getProperties=THREE.SEA3D.prototype.getProperties=function(t){return this.objects["prop/"+t]},THREE.SEA3D.prototype.isPowerOfTwo=function(t){return!!t&&(t&-t)===t},THREE.SEA3D.prototype.nearestPowerOfTwo=function(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))},THREE.SEA3D.prototype.updateTransform=function(t,e){var i=THREE.SEA3D.MTXBUF;THREE.SEA3D.VECBUF;e.transform?i.fromArray(e.transform):i.makeTranslation(e.position.x,e.position.y,e.position.z),t.position.setFromMatrixPosition(i),t.scale.setFromMatrixScale(i),t.quaternion.setFromRotationMatrix(THREE.SEA3D.identityMatrixScale(i)),(this.config.forceStatic||e.isStatic)&&(t.updateMatrix(),t.matrixAutoUpdate=!1)},THREE.SEA3D.prototype.toVector3=function(t){return new THREE.Vector3(t.x,t.y,t.z)},THREE.SEA3D.prototype.toFaces=function(t){var e=[];return e[0]=t[1],e[1]=t[0],e[2]=t[3],e[3]=t[2],e[4]=t[5],e[5]=t[4],e},THREE.SEA3D.prototype.updateScene=function(){if(null!=this.materials)for(var t=0,e=this.materials.length;t<e;++t)this.materials[t].needsUpdate=!0},THREE.SEA3D.prototype.addSceneObject=function(t,e){(e=e||t.tag).visible=t.visible,t.parent?t.parent.tag.add(e):this.config.container&&this.config.container.add(e),t.attributes&&(e.attribs=t.attributes.tag),t.scripts&&(e.scripts=this.getJSMList(e,t.scripts),this.config.scripts&&this.config.runScripts&&this.domain.runJSMList(e))},THREE.SEA3D.prototype.createObjectURL=function(t,e){return(window.URL||window.webkitURL).createObjectURL(new Blob([t],{type:e}))},THREE.SEA3D.prototype.parsePath=function(t){var e=this.config.paths;for(var i in e)t=t.replace(new RegExp("%"+i+"%","g"),e[i]);return t=t.replace("/assets/models/","")},THREE.SEA3D.prototype.addDefaultAnimation=function(t,e){for(var i=t.tag,r=0,n=t.animations?t.animations.length:0;r<n;r++){var a=t.animations[r];switch(a.tag.type){case SEA3D.Animation.prototype.type:var o=a.tag.tag||this.getModifier({sea:a.tag,scope:i,relative:a.relative});return i.animator=new e(o,i),i.animator.setRelative(a.relative),this.config.autoPlay&&i.animator.play(0),i.animator}}},THREE.SEA3D.prototype.readGeometryBuffer=function(t){for(var e=t.tag||new THREE.BufferGeometry,i=0;i<t.groups.length;i++){var r=t.groups[i];e.addGroup(r.start,r.count,i)}t.indexes&&e.setIndex(new THREE.BufferAttribute(t.indexes,1)),e.setAttribute("position",new THREE.BufferAttribute(t.vertex,3)),t.uv&&(e.setAttribute("uv",new THREE.BufferAttribute(t.uv[0],2)),t.uv.length>1&&e.setAttribute("uv2",new THREE.BufferAttribute(t.uv[1],2))),t.normal?e.setAttribute("normal",new THREE.BufferAttribute(t.normal,3)):e.computeVertexNormals(),t.tangent4&&e.setAttribute("tangent",new THREE.BufferAttribute(t.tangent4,4)),t.color&&e.setAttribute("color",new THREE.BufferAttribute(t.color[0],t.numColor)),t.joint&&(e.setAttribute("skinIndex",new THREE.Float32BufferAttribute(t.joint,t.jointPerVertex)),e.setAttribute("skinWeight",new THREE.Float32BufferAttribute(t.weight,t.jointPerVertex))),this.config.bounding&&(e.computeBoundingBox(),e.computeBoundingSphere()),e.name=t.name,this.domain.geometries=this.geometries=this.geometries||[],this.geometries.push(this.objects["geo/"+t.name]=t.tag=e)},THREE.SEA3D.prototype.readDummy=function(t){var e=new THREE.SEA3D.Dummy(t.width,t.height,t.depth);e.name=t.name,this.domain.dummys=this.dummys=this.dummys||[],this.dummys.push(this.objects["dmy/"+t.name]=t.tag=e),this.addSceneObject(t),this.updateTransform(e,t),this.addDefaultAnimation(t,THREE.SEA3D.Object3DAnimator)},THREE.SEA3D.prototype.readLine=function(t){var e=new THREE.BufferGeometry;t.closed&&t.vertex.push(t.vertex[0],t.vertex[1],t.vertex[2]),e.setAttribute("position",new THREE.Float32BufferAttribute(t.vertex,3));var i=new THREE.Line(e,new THREE.LineBasicMaterial({color:THREE.SEA3D.HELPER_COLOR,linewidth:3}));i.name=t.name,this.lines=this.lines||[],this.lines.push(this.objects["line/"+t.name]=t.tag=i),this.addSceneObject(t),this.updateTransform(i,t),this.addDefaultAnimation(t,THREE.SEA3D.Object3DAnimator)},THREE.SEA3D.prototype.readContainer3D=function(t){var e=new THREE.SEA3D.Object3D;this.domain.containers=this.containers=this.containers||[],this.containers.push(this.objects["c3d/"+t.name]=t.tag=e),this.addSceneObject(t),this.updateTransform(e,t),this.addDefaultAnimation(t,THREE.SEA3D.Object3DAnimator)},THREE.SEA3D.prototype.readSprite=function(t){var e;if(t.material)if(t.material.tag.sprite)e=t.material.tag.sprite;else{e=t.material.tag.sprite=new THREE.SpriteMaterial,this.setBlending(e,t.blendMode);var i=t.material.tag.map;i&&(i.flipY=!0,e.map=i),e.color.set(t.material.tag.color),e.opacity=t.material.tag.opacity,e.fog=t.material.receiveFog}var r=new THREE.Sprite(e);r.name=t.name,this.domain.sprites=this.sprites=this.sprites||[],this.sprites.push(this.objects["m2d/"+t.name]=t.tag=r),this.addSceneObject(t),this.updateTransform(r,t),r.scale.set(t.width,t.height,1)},THREE.SEA3D.prototype.readMesh=function(t){var e,i,r,n,a,o,s,c,h,l,u=t.geometry.tag;for(e=0,i=t.modifiers?t.modifiers.length:0;e<i;e++){var p=t.modifiers[e];switch(p.type){case SEA3D.Skeleton.prototype.type:case SEA3D.SkeletonLocal.prototype.type:a=p,u.bones=a.tag;break;case SEA3D.Morph.prototype.type:o=p.tag||this.getModifier({sea:p,geometry:t.geometry}),u.morphAttributes=o.attribs,u.morphTargets=o.targets}}for(e=0,i=t.animations?t.animations.length:0;e<i;e++){var d=t.animations[e].tag;switch(d.type){case SEA3D.SkeletonAnimation.prototype.type:s=d,u.animations=s.tag||this.getModifier({sea:s,skeleton:a,relative:!0});break;case SEA3D.VertexAnimation.prototype.type:c=d,u.morphAttributes=c.tag.attribs,u.morphTargets=c.tag.targets,u.animations=c.tag.animations;break;case SEA3D.UVWAnimation.prototype.type:h=d.tag||this.getModifier({sea:d});break;case SEA3D.MorphAnimation.prototype.type:l=d.tag||this.getModifier({sea:d})}}var f=null!=o||null!=c,m=o&&null!=o.attribs.normal||c&&null!=c.tag.attribs.normal;if(t.material)if(t.material.length>1)for(n=[],e=0;e<t.material.length;e++)n[e]=t.material[e].tag,n[e].skinning=null!=a,n[e].morphTargets=f,n[e].morphNormals=m,n[e].vertexColors=t.geometry.color?THREE.VertexColors:THREE.NoColors;else(n=t.material[0].tag).skinning=null!=a,n.morphTargets=f,n.morphNormals=m,n.vertexColors=t.geometry.color?THREE.VertexColors:THREE.NoColors;a?(r=new THREE.SEA3D.SkinnedMesh(u,n,this.config.useVertexTexture),this.config.autoPlay&&s&&r.play(0)):c?(r=new THREE.SEA3D.VertexAnimationMesh(u,n),this.config.autoPlay&&r.play(0)):r=new THREE.SEA3D.Mesh(u,n),h&&(r.uvwAnimator=new THREE.SEA3D.Animator(h,new THREE.AnimationMixer(n.map)),this.config.autoPlay&&r.uvwAnimator.play(0)),l&&(r.morphAnimator=new THREE.SEA3D.Animator(l,new THREE.AnimationMixer(r)),this.config.autoPlay&&r.morphAnimator.play(0)),r.name=t.name,r.castShadow=t.castShadows,r.receiveShadow=!t.material||t.material[0].receiveShadows,this.domain.meshes=this.meshes=this.meshes||[],this.meshes.push(this.objects["m3d/"+t.name]=t.tag=r),this.addSceneObject(t),this.updateTransform(r,t),this.addDefaultAnimation(t,THREE.SEA3D.Object3DAnimator)},THREE.SEA3D.prototype.readSoundPoint=function(t){this.audioListener||(this.audioListener=new THREE.AudioListener,this.config.container&&this.config.container.add(this.audioListener));var e=new THREE.SEA3D.PointSound(this.audioListener);e.autoplay=t.autoPlay,e.setLoop(t.autoPlay),e.setVolume(t.volume),e.setRefDistance(t.distance),e.setRolloffFactor(this.config.audioRolloffFactor),e.setSound(t.sound.tag),e.name=t.name,this.domain.sounds3d=this.sounds3d=this.sounds3d||[],this.sounds3d.push(this.objects["sn3d/"+t.name]=t.tag=e),this.addSceneObject(t),this.updateTransform(e,t),this.addDefaultAnimation(t,THREE.SEA3D.SoundAnimator)},THREE.SEA3D.prototype.readCubeRender=function(t){var e=new THREE.CubeCamera(.1,5e3,THREE.SEA3D.RTT_SIZE);e.renderTarget.cubeCamera=e,t.tag=e.renderTarget,this.domain.cubeRenderers=this.cubeRenderers=this.cubeRenderers||[],this.cubeRenderers.push(this.objects["rttc/"+t.name]=e),this.addSceneObject(t,e),this.updateTransform(e,t)},THREE.SEA3D.prototype.readTexture=function(t){var e=new Image,i=new THREE.Texture;i.name=t.name,i.wrapS=i.wrapT=THREE.RepeatWrapping,i.flipY=!1,i.image=e,void 0!==this.config.anisotropy&&(i.anisotropy=this.config.anisotropy),e.onload=function(){i.needsUpdate=!0},e.src=this.createObjectURL(t.data.buffer,"image/"+t.type),this.domain.textures=this.textures=this.textures||[],this.textures.push(this.objects["tex/"+t.name]=t.tag=i)},THREE.SEA3D.prototype.readCubeMap=function(t){var e=this.toFaces(t.faces),i=new THREE.CubeTexture([]),r=0;i.name=t.name,i.flipY=!1,i.format=THREE.RGBFormat;for(var n=function(){6==++r&&(i.needsUpdate=!0,this.config.async||(this.file.resume=!0))}.bind(this),a=0;a<e.length;++a){var o=new Image;o.onload=n,o.src=this.createObjectURL(e[a].buffer,"image/"+t.extension),i.images[a]=o}this.config.async||(this.file.resume=!1),this.domain.cubemaps=this.cubemaps=this.cubemaps||[],this.cubemaps.push(this.objects["cmap/"+t.name]=t.tag=i)},THREE.SEA3D.prototype.readGeometryUpdate=function(t,e,i){var r=new(0,i.sea3d.typeClass[i.type])("",e,i.sea3d);r.tag=t,this.readGeometryBuffer(r)},THREE.SEA3D.prototype.readTextureUpdate=function(t,e,i){var r=new Image;r.onload=function(){t.image=r,t.needsUpdate=!0},r.src=this.createObjectURL(e.buffer,"image/"+i)},THREE.SEA3D.prototype.readAssetUpdate=function(t){var e=this.file.objects[t.index],i=t.bytes,r=e.tag;r&&(r.isBufferGeometry?this.readGeometryUpdate(r,i,e):r.isTexture&&this.readTextureUpdate(r,i,e.type))},THREE.SEA3D.prototype.readSound=function(t){var e=new THREE.SEA3D.Sound(this.createObjectURL(t.data.buffer,"audio/"+t.type));e.name=t.name,this.domain.sounds=this.sounds=this.sounds||[],this.sounds.push(this.objects["snd/"+t.name]=t.tag=e)},THREE.SEA3D.prototype.readScriptURL=function(t){this.file.resume=!1,(new THREE.FileLoader).setResponseType("text").load(t.url,function(e){this.file.resume=!0,this.domain.scripts=this.scripts=this.scripts||[],this.scripts.push(this.objects["src/"+t.name]=t.tag=e)}.bind(this))},THREE.SEA3D.prototype.readTextureURL=function(t){var e=(new THREE.TextureLoader).load(this.parsePath(t.url));e.name=t.name,e.wrapS=e.wrapT=THREE.RepeatWrapping,e.flipY=!1,void 0!==this.config.anisotropy&&(e.anisotropy=this.config.anisotropy),this.domain.textures=this.textures=this.textures||[],this.textures.push(this.objects["tex/"+t.name]=t.tag=e)},THREE.SEA3D.prototype.readCubeMapURL=function(t){for(var e=this.toFaces(t.faces),i=0;i<e.length;i++)e[i]=this.parsePath(e[i]);var r;if("hdr"===e[0].substr(-3)){var n=null!=THREE.PMREMGenerator;this.file.resume=!n,r=(new THREE.HDRCubeTextureLoader).load(THREE.UnsignedByteType,e,function(e){if(n){var i=new THREE.PMREMGenerator(e);i.update(this.config.renderer);var r=new THREE.PMREMCubeUVPacker(i.cubeLods);r.update(this.config.renderer),e.dispose(),this.objects["cmap/"+t.name]=t.tag=r.CubeUVRenderTarget.texture,this.file.resume=!0}}.bind(this))}else r=(new THREE.CubeTextureLoader).load(e);r.name=t.name,r.wrapS=r.wrapT=THREE.RepeatWrapping,r.flipY=!1,void 0!==this.config.anisotropy&&(r.anisotropy=this.config.anisotropy),this.domain.cubemaps=this.cubemaps=this.cubemaps||[],this.cubemaps.push(this.objects["cmap/"+t.name]=t.tag=r)},THREE.SEA3D.prototype.getJSMList=function(t,e){for(var i=[],r=0;r<e.length;r++){var n=e[r];n.tag.type===SEA3D.JavaScriptMethod.prototype.type&&i.push(n)}return this.domain.scriptTargets=this.scriptTargets=this.scriptTargets||[],this.scriptTargets.push(t),i},THREE.SEA3D.prototype.readJavaScriptMethod=function(sea){try{var src="(function() {\nvar $METHOD = {}\n",declare='function($INC, $REF, global, local, self, $PARAM) {\nvar watch = $INC["watch"],\nscene = $INC["scene"],\nsea3d = $INC["sea3d"],\nprint = $INC["print"];\n';for(var name in declare+='var $SRC = $INC["source"],\naddEventListener = $SRC.addEventListener.bind( $SRC ),\nhasEventListener = $SRC.hasEventListener.bind( $SRC ),\nremoveEventListener = $SRC.removeEventListener.bind( $SRC ),\ndispatchEvent = $SRC.dispatchEvent.bind( $SRC ),\ndispose = $SRC.dispose.bind( $SRC );\n',sea.methods)src+='$METHOD["'+name+'"] = '+declare+sea.methods[name].src+"}\n";src+="return $METHOD; })",this.domain.methods=eval(src)()}catch(t){void 0,void 0}},THREE.SEA3D.prototype.readGLSL=function(t){this.domain.glsl=this.glsl=this.glsl||[],this.glsl.push(this.objects["glsl/"+t.name]=t.tag=t.src)},THREE.SEA3D.prototype.materialTechnique=function(){var t={onComplete:function(t,e){(e.alpha<1||t.blending>THREE.NormalBlending)&&(t.opacity=e.alpha,t.transparent=!0)}};return t[SEA3D.Material.PHYSICAL]=function(t,e){t.color.setHex(e.color),t.roughness=e.roughness,t.metalness=e.metalness},t[SEA3D.Material.REFLECTIVITY]=function(t,e){t.reflectivity=e.strength},t[SEA3D.Material.CLEAR_COAT]=function(t,e){t.clearCoat=e.strength,t.clearCoatRoughness=e.roughness},t[SEA3D.Material.PHONG]=function(t,e){t.color.setHex(e.diffuseColor),t.specular.setHex(e.specularColor).multiplyScalar(e.specular),t.shininess=e.gloss},t[SEA3D.Material.DIFFUSE_MAP]=function(t,e,i){t.map=e.texture.tag,t.color.setHex(16777215),t.map.wrapS=t.map.wrapT=i.repeat?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,e.texture.transparent&&(t.transparent=!0)},t[SEA3D.Material.ROUGHNESS_MAP]=function(t,e){t.roughnessMap=e.texture.tag},t[SEA3D.Material.METALNESS_MAP]=function(t,e){t.metalnessMap=e.texture.tag},t[SEA3D.Material.SPECULAR_MAP]=function(t,e){t.specular&&(t.specularMap=e.texture.tag,t.specular.setHex(16777215))},t[SEA3D.Material.NORMAL_MAP]=function(t,e){t.normalMap=e.texture.tag},t[SEA3D.Material.REFLECTION]=t[SEA3D.Material.FRESNEL_REFLECTION]=function(t,e){t.envMap=e.texture.tag,t.envMap.mapping=THREE.CubeReflectionMapping,t.combine=THREE.MixOperation,t.reflectivity=e.alpha},t[SEA3D.Material.REFLECTION_SPHERICAL]=function(t,e){t.envMap=e.texture.tag,t.envMap.mapping=THREE.SphericalReflectionMapping,t.combine=THREE.MixOperation,t.reflectivity=e.alpha},t[SEA3D.Material.REFRACTION_MAP]=function(t,e){t.envMap=e.texture.tag,t.envMap.mapping=THREE.CubeRefractionMapping,t.refractionRatio=e.ior,t.reflectivity=e.alpha},t[SEA3D.Material.LIGHT_MAP]=function(t,e){"multiply"===e.blendMode?t.aoMap=e.texture.tag:t.lightMap=e.texture.tag},t[SEA3D.Material.EMISSIVE]=function(t,e){t.emissive.setHex(e.color)},t[SEA3D.Material.EMISSIVE_MAP]=function(t,e){t.emissiveMap=e.texture.tag},t[SEA3D.Material.ALPHA_MAP]=function(t,e,i){t.alphaMap=e.texture.tag,t.transparent=!0,t.alphaMap.wrapS=t.alphaMap.wrapT=i.repeat?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping},t}(),THREE.SEA3D.prototype.createMaterial=function(t){return t.tecniquesDict[SEA3D.Material.REFLECTIVITY]||t.tecniquesDict[SEA3D.Material.CLEAR_COAT]?new THREE.MeshPhysicalMaterial:t.tecniquesDict[SEA3D.Material.PHYSICAL]?new THREE.MeshStandardMaterial:new THREE.MeshPhongMaterial},THREE.SEA3D.prototype.setBlending=function(t,e){if("normal"!==e){switch(e){case"add":t.blending=THREE.AdditiveBlending;break;case"subtract":t.blending=THREE.SubtractiveBlending;break;case"multiply":t.blending=THREE.MultiplyBlending;break;case"screen":t.blending=THREE.CustomBlending,t.blendSrc=THREE.OneFactor,t.blendDst=THREE.OneMinusSrcColorFactor,t.blendEquation=THREE.AddEquation}t.transparent=!0}},THREE.SEA3D.prototype.readMaterial=function(t){var e=this.createMaterial(t);e.name=t.name,e.lights=t.receiveLights,e.fog=t.receiveFog,e.depthWrite=t.depthWrite,e.depthTest=t.depthTest,e.premultipliedAlpha=t.premultipliedAlpha,e.side=t.doubleSided?THREE.DoubleSide:THREE.FrontSide,this.setBlending(e,t.blendMode);for(var i=0;i<t.technique.length;i++){var r=t.technique[i];this.materialTechnique[r.kind]&&this.materialTechnique[r.kind].call(this,e,r,t)}this.materialTechnique.onComplete&&this.materialTechnique.onComplete.call(this,e,t),this.domain.materials=this.materials=this.materials||[],this.materials.push(this.objects["mat/"+t.name]=t.tag=e)},THREE.SEA3D.prototype.readPointLight=function(t){var e=new THREE.SEA3D.PointLight(t.color,t.multiplier*this.config.multiplier);e.name=t.name,t.attenuation&&(e.distance=t.attenuation.end),t.shadow&&this.setShadowMap(e),this.domain.lights=this.lights=this.lights||[],this.lights.push(this.objects["lht/"+t.name]=t.tag=e),this.addSceneObject(t),this.updateTransform(e,t),this.addDefaultAnimation(t,THREE.SEA3D.LightAnimator),this.updateScene()},THREE.SEA3D.prototype.readHemisphereLight=function(t){var e=new THREE.HemisphereLight(t.color,t.secondColor,t.multiplier*this.config.multiplier);e.position.set(0,500,0),e.name=t.name,this.domain.lights=this.lights=this.lights||[],this.lights.push(this.objects["lht/"+t.name]=t.tag=e),this.addSceneObject(t),this.addDefaultAnimation(t,THREE.SEA3D.LightAnimator),this.updateScene()},THREE.SEA3D.prototype.readAmbientLight=function(t){var e=new THREE.AmbientLight(t.color,t.multiplier*this.config.multiplier);e.name=t.name,this.domain.lights=this.lights=this.lights||[],this.lights.push(this.objects["lht/"+t.name]=t.tag=e),this.addSceneObject(t),this.addDefaultAnimation(t,THREE.SEA3D.LightAnimator),this.updateScene()},THREE.SEA3D.prototype.readDirectionalLight=function(t){var e=new THREE.DirectionalLight(t.color,t.multiplier*this.config.multiplier);e.name=t.name,t.shadow&&this.setShadowMap(e),this.domain.lights=this.lights=this.lights||[],this.lights.push(this.objects["lht/"+t.name]=t.tag=e),this.addSceneObject(t),this.updateTransform(e,t),this.addDefaultAnimation(t,THREE.SEA3D.LightAnimator),this.updateScene()},THREE.SEA3D.prototype.readCamera=function(t){var e=new THREE.SEA3D.Camera(t.fov);e.name=t.name,this.domain.cameras=this.cameras=this.cameras||[],this.cameras.push(this.objects["cam/"+t.name]=t.tag=e),this.addSceneObject(t),this.updateTransform(e,t),this.addDefaultAnimation(t,THREE.SEA3D.CameraAnimator)},THREE.SEA3D.prototype.readOrthographicCamera=function(t){var e,i,r,n=void 0!==this.config.stageWidth?this.config.stageWidth:window?window.innerWidth:1024,a=void 0!==this.config.stageHeight?this.config.stageHeight:window?window.innerHeight:1024;n>a?(e=n/a,i=t.height*e,r=t.height):(e=a/n,i=t.height,r=t.height*e);var o=new THREE.SEA3D.OrthographicCamera(-i,i,r,-r);o.name=t.name,this.domain.cameras=this.cameras=this.cameras||[],this.cameras.push(this.objects["cam/"+t.name]=t.tag=o),this.addSceneObject(t),this.updateTransform(o,t),this.addDefaultAnimation(t,THREE.SEA3D.CameraAnimator)},THREE.SEA3D.prototype.getSkeletonFromBones=function(t){var e,i,r,n,a=[];for(r=0,n=t.length;r<n;r++)i=t[r],e=new THREE.Bone,a.push(e),e.name=i.name,e.position.fromArray(i.pos),e.quaternion.fromArray(i.rotq),void 0!==i.scl&&e.scale.fromArray(i.scl);for(r=0,n=t.length;r<n;r++)-1!==(i=t[r]).parent&&null!==i.parent&&void 0!==a[i.parent]&&a[i.parent].add(a[r]);return new THREE.Skeleton(a)},THREE.SEA3D.prototype.readSkeletonLocal=function(t){for(var e=[],i=0;i<t.joint.length;i++){var r=t.joint[i];e[i]={name:r.name,pos:[r.x,r.y,r.z],rotq:[r.qx,r.qy,r.qz,r.qw],parent:r.parentIndex}}this.domain.bones=this.bones=this.bones||[],this.bones.push(this.objects[t.name+".sklq"]=t.tag=e)},THREE.SEA3D.prototype.readJointObject=function(t){var e=t.target.tag.skeleton.bones[t.joint];this.domain.joints=this.joints=this.joints||[],this.joints.push(this.objects["jnt/"+t.name]=t.tag=e)},THREE.SEA3D.prototype.readMorph=function(t){for(var e={position:[]},i=[],r=0;r<t.node.length;r++){var n=t.node[r];e.position[r]=new THREE.Float32BufferAttribute(n.vertex,3),e.position[r].name=n.name,n.normal&&(e.normal=e.normal||[],e.normal[r]=new THREE.Float32BufferAttribute(n.normal,3)),i[r]={name:n.name}}t.tag={attribs:e,targets:i}},THREE.SEA3D.prototype.readAnimation=function(t){for(var e=[],i=1e3/t.frameRate/1e3,r=0;r<t.sequence.length;r++){for(var n=t.sequence[r],a=[],o=0;o<t.dataList.length;o++){var s,c,h,l,u=t.dataList[o],p=u.data,d=n.start*u.blockSize,f=d+n.count*u.blockSize,m=!!n.intrpl&&THREE.InterpolateLinear,g=null;switch(u.kind){case SEA3D.Animation.POSITION:g=".position";break;case SEA3D.Animation.ROTATION:g=".quaternion";break;case SEA3D.Animation.SCALE:g=".scale";break;case SEA3D.Animation.COLOR:g=".color";break;case SEA3D.Animation.MULTIPLIER:g=".intensity";break;case SEA3D.Animation.FOV:g=".fov";break;case SEA3D.Animation.OFFSET_U:g=".offset[x]";break;case SEA3D.Animation.OFFSET_V:g=".offset[y]";break;case SEA3D.Animation.SCALE_U:g=".repeat[x]";break;case SEA3D.Animation.SCALE_V:g=".repeat[y]";break;case SEA3D.Animation.RADIAN:g=".rotation";break;case SEA3D.Animation.MORPH:g=".morphTargetInfluences["+u.name+"]"}if(g)switch(u.type){case SEA3D.Stream.BYTE:case SEA3D.Stream.UBYTE:case SEA3D.Stream.INT:case SEA3D.Stream.UINT:case SEA3D.Stream.FLOAT:case SEA3D.Stream.DOUBLE:case SEA3D.Stream.DECIMAL:for(l=p.subarray(d,f),h=new Float32Array(l.length),s=0,c=0;c<h.length;c++)h[c]=s,s+=i;a.push(new THREE.NumberKeyframeTrack(g,h,l,m));break;case SEA3D.Stream.VECTOR3D:for(l=p.subarray(d,f),h=new Float32Array(l.length/u.blockSize),s=0,c=0;c<h.length;c++)h[c]=s,s+=i;a.push(new THREE.VectorKeyframeTrack(g,h,l,m));break;case SEA3D.Stream.VECTOR4D:for(l=p.subarray(d,f),h=new Float32Array(l.length/u.blockSize),s=0,c=0;c<h.length;c++)h[c]=s,s+=i;a.push(new THREE.QuaternionKeyframeTrack(g,h,l,m));break;case SEA3D.Stream.INT24:case SEA3D.Stream.UINT24:for(l=new Float32Array(3*(f-d)),h=new Float32Array(l.length/3),s=0,c=0;c<h.length;c++)l[3*c]=(p[c]>>16&255)/255,l[3*c+1]=(p[c]>>8&255)/255,l[3*c+2]=(255&p[c])/255,h[c]=s,s+=i;a.push(new THREE.VectorKeyframeTrack(g,h,l,m))}}e.push(new THREE.SEA3D.AnimationClip(n.name,-1,a,n.repeat))}this.domain.clips=this.clips=this.clips||[],this.clips.push(this.objects[t.name+".anm"]=t.tag=e)},THREE.SEA3D.prototype.readSkeletonAnimation=function(t,e){if(!(e=!e&&t.metadata&&t.metadata.skeleton?t.metadata.skeleton:e)||t.tag)return t.tag;for(var i=[],r=1e3/t.frameRate/1e3,n=0;n<t.sequence.length;n++){for(var a=t.sequence[n],o=a.start,s=o+a.count,c={name:a.name,fps:t.frameRate,length:r*a.count,hierarchy:[]},h=t.numJoints,l=t.raw,u=0;u<h;u++){for(var p={parent:e.joint[u].parentIndex,keys:[]},d=p.keys,f=0,m=o;m<s;m++){var g=m*h*7+7*u;d.push({time:f,pos:[l[g],l[g+1],l[g+2]],rot:[l[g+3],l[g+4],l[g+5],l[g+6]],scl:[1,1,1]}),f+=r}c.hierarchy[u]=p}i.push(THREE.SEA3D.AnimationClip.fromClip(THREE.AnimationClip.parseAnimation(c,e.tag),a.repeat))}this.domain.clips=this.clips=this.clips||[],this.clips.push(this.objects[t.name+".skla"]=t.tag=i)},THREE.SEA3D.prototype.readVertexAnimation=function(t){var e,i,r,n={position:[]},a=[],o=[];for(e=0,r=t.frame.length;e<r;e++){var s=t.frame[e];n.position[e]=new THREE.Float32BufferAttribute(s.vertex,3),s.normal&&(n.normal=n.normal||[],n.normal[e]=new THREE.Float32BufferAttribute(s.normal,3)),a[e]={name:e}}for(e=0;e<t.sequence.length;e++){var c=t.sequence[e],h=[];for(i=0;i<c.count;i++)h[i]=a[c.start+i];o.push(THREE.SEA3D.AnimationClip.fromClip(THREE.AnimationClip.CreateFromMorphTargetSequence(c.name,h,t.frameRate,!c.repeat),c.repeat))}t.tag={attribs:n,targets:a,animations:o},this.domain.clips=this.clips=this.clips||[],this.clips.push(this.objects[t.name+".vtxa"]=t.tag)},THREE.SEA3D.prototype.getModifier=function(t){var e=t.sea;switch(e.type){case SEA3D.SkeletonAnimation.prototype.type:this.readSkeletonAnimation(e,t.skeleton);break;case SEA3D.Animation.prototype.type:case SEA3D.MorphAnimation.prototype.type:case SEA3D.UVWAnimation.prototype.type:this.readAnimation(e);break;case SEA3D.Morph.prototype.type:this.readMorph(e,t.geometry)}return e.tag},THREE.SEA3D.prototype.applyEnvironment=function(t){for(var e=0,i=this.materials.length;e<i;++e){var r=this.materials[e];if(r instanceof THREE.MeshStandardMaterial){if(r.envMap)continue;r.envMap=t,r.envMap.mapping=THREE.CubeReflectionMapping,r.needsUpdate=!0}}},THREE.SEA3D.prototype.readActions=function(t){for(var e=0;e<t.actions.length;e++){var i=t.actions[e];switch(i.kind){case SEA3D.Actions.ATTRIBUTES:this.attribs=this.domain.attribs=i.attributes.tag;break;case SEA3D.Actions.SCRIPTS:this.domain.scripts=this.getJSMList(this.domain,i.scripts),this.config.scripts&&this.config.runScripts&&this.domain.runJSMList(this.domain);break;case SEA3D.Actions.CAMERA:this.domain.camera=this.camera=i.camera.tag;break;case SEA3D.Actions.ENVIRONMENT_COLOR:this.domain.background=this.background=this.background||{},this.background.color=new THREE.Color(i.color);break;case SEA3D.Actions.ENVIRONMENT:this.domain.background=this.background=this.background||{},this.background.texture=i.texture.tag,this.config.useEnvironment&&null!=this.materials&&this.applyEnvironment(i.texture.tag)}}},THREE.SEA3D.prototype.updatePropertiesAssets=function(t,e){for(var i in e)switch(e.__type[i]){case SEA3D.Stream.ASSET:e.__asset||(e.__asset={}),e.__asset[i]||(e.__asset[i]=e[i]),e[i]=e.__asset[i].tag;break;case SEA3D.Stream.GROUP:e[i]=this.updatePropertiesAssets(t,e[i])}return e},THREE.SEA3D.prototype.readProperties=function(t){var e=this.updatePropertiesAssets(t,t.props);this.domain.properties=this.properties=this.properties||[],this.properties.push(this.objects["prop/"+t.name]=t.tag=e)},THREE.SEA3D.prototype.readFileInfo=function(t){this.domain.info=this.updatePropertiesAssets(t,t.info)},THREE.SEA3D.Event={PROGRESS:"sea3d_progress",LOAD_PROGRESS:"sea3d_load",DOWNLOAD_PROGRESS:"sea3d_download",COMPLETE:"sea3d_complete",OBJECT_COMPLETE:"sea3d_object",PARSE_PROGRESS:"parse_progress",PARSE_COMPLETE:"parse_complete",ERROR:"sea3d_error"},THREE.SEA3D.prototype.onProgress=function(t){t.status=t.type,t.progress=t.loaded/t.total,t.type=THREE.SEA3D.Event.PROGRESS,this.dispatchEvent(t)},THREE.SEA3D.prototype.onLoadProgress=function(t){t.type=THREE.SEA3D.Event.LOAD_PROGRESS,this.dispatchEvent(t),this.onProgress(t)},THREE.SEA3D.prototype.onDownloadProgress=function(t){t.type=THREE.SEA3D.Event.DOWNLOAD_PROGRESS,this.dispatchEvent(t),this.onProgress(t)},THREE.SEA3D.prototype.onComplete=function(t){t.type=THREE.SEA3D.Event.COMPLETE,this.dispatchEvent(t)},THREE.SEA3D.prototype.onCompleteObject=function(t){t.type=THREE.SEA3D.Event.OBJECT_COMPLETE,this.dispatchEvent(t)},THREE.SEA3D.prototype.onParseProgress=function(t){t.type=THREE.SEA3D.Event.PARSE_PROGRESS,this.dispatchEvent(t)},THREE.SEA3D.prototype.onParseComplete=function(t){t.type=THREE.SEA3D.Event.PARSE_COMPLETE,this.dispatchEvent(t)},THREE.SEA3D.prototype.onError=function(t){t.type=THREE.SEA3D.Event.ERROR,this.dispatchEvent(t)},THREE.SEA3D.prototype.createDomain=function(){return this.domain=new THREE.SEA3D.Domain(this.config.id,this.objects={},this.config.container)},THREE.SEA3D.prototype.clone=function(t,e,i){if(!this.file.isDone())throw new Error("Previous parse is not completed.");this.config.container=t&&void 0!==t.container?t.container:new THREE.Object3D,t&&this.loadConfig(t);var r=this.config.timeLimit;return this.config.timeLimit=t&&void 0!==t.timeLimit?t.timeLimit:1/0,this.parse(e,i),this.config.timeLimit=r,this.domain},THREE.SEA3D.prototype.loadConfig=function(t){for(var e in t)this.config[e]=t[e]},THREE.SEA3D.prototype.parse=function(t,e){delete this.cameras,delete this.containers,delete this.lights,delete this.joints,delete this.meshes,delete this.materials,delete this.sprites,delete this.sounds3d,delete this.cubeRenderers,delete this.sounds,delete this.glsl,delete this.dummy,delete this.camera,delete this.background,delete this.properties,delete this.scriptTargets,delete this.domain,this.createDomain(),this.setTypeRead(),this.file.onParseComplete=function(e){this.config.manager&&this.config.manager.add(this.domain),(t||this.onParseComplete).call(this,e)}.bind(this),this.file.onParseProgress=e||this.onParseProgress;for(var i=THREE.SEA3D.EXTENSIONS_LOADER.length;i--;){var r=THREE.SEA3D.EXTENSIONS_LOADER[i];r.parse&&r.parse.call(this)}return this.file.parse(),this.domain},THREE.SEA3D.prototype.onHead=function(t){if("TJS"!=t.sign)throw new Error("Sign '"+t.sign+"' not supported! Use SEA3D Studio to publish or SEA3DLegacy.js")},THREE.SEA3D.EXTENSIONS_LOADER=[],THREE.SEA3D.EXTENSIONS_DOMAIN=[],THREE.SEA3D.prototype.setTypeRead=function(){this.file.typeRead={},this.file.typeRead[SEA3D.Geometry.prototype.type]=this.readGeometryBuffer,this.file.typeRead[SEA3D.Mesh.prototype.type]=this.readMesh,this.file.typeRead[SEA3D.Sprite.prototype.type]=this.readSprite,this.file.typeRead[SEA3D.Container3D.prototype.type]=this.readContainer3D,this.file.typeRead[SEA3D.Line.prototype.type]=this.readLine,this.file.typeRead[SEA3D.Material.prototype.type]=this.readMaterial,this.file.typeRead[SEA3D.Camera.prototype.type]=this.readCamera,this.file.typeRead[SEA3D.OrthographicCamera.prototype.type]=this.readOrthographicCamera,this.file.typeRead[SEA3D.SkeletonLocal.prototype.type]=this.readSkeletonLocal,this.file.typeRead[SEA3D.SkeletonAnimation.prototype.type]=this.readSkeletonAnimation,this.file.typeRead[SEA3D.JointObject.prototype.type]=this.readJointObject,this.file.typeRead[SEA3D.CubeMap.prototype.type]=this.readCubeMap,this.file.typeRead[SEA3D.CubeRender.prototype.type]=this.readCubeRender,this.file.typeRead[SEA3D.Animation.prototype.type]=this.file.typeRead[SEA3D.MorphAnimation.prototype.type]=this.file.typeRead[SEA3D.UVWAnimation.prototype.type]=this.readAnimation,this.file.typeRead[SEA3D.SoundPoint.prototype.type]=this.readSoundPoint,this.file.typeRead[SEA3D.TextureURL.prototype.type]=this.readTextureURL,this.file.typeRead[SEA3D.CubeMapURL.prototype.type]=this.readCubeMapURL,this.file.typeRead[SEA3D.AssetUpdate.prototype.type]=this.readAssetUpdate,this.file.typeRead[SEA3D.Morph.prototype.type]=this.readMorph,this.file.typeRead[SEA3D.VertexAnimation.prototype.type]=this.readVertexAnimation,this.file.typeRead[SEA3D.Actions.prototype.type]=this.readActions,this.file.typeRead[SEA3D.FileInfo.prototype.type]=this.readFileInfo,this.file.typeRead[SEA3D.Properties.prototype.type]=this.readProperties,this.config.dummys&&(this.file.typeRead[SEA3D.Dummy.prototype.type]=this.readDummy),this.config.scripts&&(this.file.typeRead[SEA3D.ScriptURL.prototype.type]=this.readScriptURL,this.file.typeRead[SEA3D.JavaScriptMethod.prototype.type]=this.readJavaScriptMethod),this.config.lights&&(this.file.typeRead[SEA3D.PointLight.prototype.type]=this.readPointLight,this.file.typeRead[SEA3D.DirectionalLight.prototype.type]=this.readDirectionalLight,this.file.typeRead[SEA3D.HemisphereLight.prototype.type]=this.readHemisphereLight,this.file.typeRead[SEA3D.AmbientLight.prototype.type]=this.readAmbientLight),this.file.typeRead[SEA3D.JPEG.prototype.type]=this.file.typeRead[SEA3D.JPEG_XR.prototype.type]=this.file.typeRead[SEA3D.PNG.prototype.type]=this.file.typeRead[SEA3D.GIF.prototype.type]=this.readTexture,this.file.typeRead[SEA3D.MP3.prototype.type]=this.readSound,this.file.typeRead[SEA3D.GLSL.prototype.type]=this.readGLSL;for(var t=THREE.SEA3D.EXTENSIONS_LOADER.length;t--;){var e=THREE.SEA3D.EXTENSIONS_LOADER[t];e.setTypeRead&&e.setTypeRead.call(this)}},THREE.SEA3D.prototype.load=function(t){this.file=new SEA3D.File,this.file.scope=this,this.file.config=this.config,this.file.onProgress=this.onLoadProgress.bind(this),this.file.onCompleteObject=this.onCompleteObject.bind(this),this.file.onDownloadProgress=this.onDownloadProgress.bind(this),this.file.onParseProgress=this.onParseProgress.bind(this),this.file.onParseComplete=this.onParseComplete.bind(this),this.file.onError=this.onError.bind(this),this.file.onHead=this.onHead.bind(this),this.file.onComplete=function(t){this.config.manager&&this.config.manager.add(this.domain),this.onComplete.call(this,t)}.bind(this),this.createDomain(),this.setTypeRead(),void 0!==t&&("string"==typeof t?this.file.load(t):this.file.read(t))},THREE.Water=function(t,e){THREE.Mesh.call(this,t);var i=this,r=void 0!==(e=e||{}).textureWidth?e.textureWidth:512,n=void 0!==e.textureHeight?e.textureHeight:512,a=void 0!==e.clipBias?e.clipBias:0,o=void 0!==e.alpha?e.alpha:1,s=void 0!==e.time?e.time:0,c=void 0!==e.waterNormals?e.waterNormals:null,h=void 0!==e.sunDirection?e.sunDirection:new THREE.Vector3(.70707,.70707,0),l=new THREE.Color(void 0!==e.sunColor?e.sunColor:16777215),u=new THREE.Color(void 0!==e.waterColor?e.waterColor:8355711),p=void 0!==e.eye?e.eye:new THREE.Vector3(0,0,0),d=void 0!==e.distortionScale?e.distortionScale:20,f=void 0!==e.side?e.side:THREE.FrontSide,m=void 0!==e.fog&&e.fog,g=new THREE.Plane,v=new THREE.Vector3,y=new THREE.Vector3,E=new THREE.Vector3,x=new THREE.Matrix4,b=new THREE.Vector3(0,0,-1),S=new THREE.Vector4,w=new THREE.Vector3,_=new THREE.Vector3,M=new THREE.Vector4,A=new THREE.Matrix4,T=new THREE.PerspectiveCamera,D={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},R=new THREE.WebGLRenderTarget(r,n,D);THREE.Math.isPowerOfTwo(r)&&THREE.Math.isPowerOfTwo(n)||(R.texture.generateMipmaps=!1);var L={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new THREE.Matrix4},sunColor:{value:new THREE.Color(8355711)},sunDirection:{value:new THREE.Vector3(.70707,.70707,0)},eye:{value:new THREE.Vector3},waterColor:{value:new THREE.Color(5592405)}}]),vertexShader:["uniform mat4 textureMatrix;","uniform float time;","varying vec4 mirrorCoord;","varying vec4 worldPosition;",THREE.ShaderChunk.fog_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {","\tmirrorCoord = modelMatrix * vec4( position, 1.0 );","\tworldPosition = mirrorCoord.xyzw;","\tmirrorCoord = textureMatrix * mirrorCoord;","\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.fog_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D mirrorSampler;","uniform float alpha;","uniform float time;","uniform float size;","uniform float distortionScale;","uniform sampler2D normalSampler;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","varying vec4 mirrorCoord;","varying vec4 worldPosition;","vec4 getNoise( vec2 uv ) {","\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);","\tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );","\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );","\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );","\tvec4 noise = texture2D( normalSampler, uv0 ) +","\t\ttexture2D( normalSampler, uv1 ) +","\t\ttexture2D( normalSampler, uv2 ) +","\t\ttexture2D( normalSampler, uv3 );","\treturn noise * 0.5 - 1.0;","}","void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {","\tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );","\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );","\tspecularColor += pow( direction, shiny ) * sunColor * spec;","\tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;","}",THREE.ShaderChunk.common,THREE.ShaderChunk.packing,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_begin,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.shadowmask_pars_fragment,"void main() {","\tvec4 noise = getNoise( worldPosition.xz * size );","\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );","\tvec3 diffuseLight = vec3(0.0);","\tvec3 specularLight = vec3(0.0);","\tvec3 worldToEye = eye-worldPosition.xyz;","\tvec3 eyeDirection = normalize( worldToEye );","\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );","\tfloat distance = length(worldToEye);","\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;","\tvec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );","\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );","\tfloat rf0 = 0.3;","\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;","\tvec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);","\tvec3 outgoingLight = albedo;","\tgl_FragColor = vec4( outgoingLight, alpha );",THREE.ShaderChunk.tonemapping_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},C=new THREE.ShaderMaterial({fragmentShader:L.fragmentShader,vertexShader:L.vertexShader,uniforms:THREE.UniformsUtils.clone(L.uniforms),transparent:!0,lights:!0,side:f,fog:m});C.uniforms.mirrorSampler.value=R.texture,C.uniforms.textureMatrix.value=A,C.uniforms.alpha.value=o,C.uniforms.time.value=s,C.uniforms.normalSampler.value=c,C.uniforms.sunColor.value=l,C.uniforms.waterColor.value=u,C.uniforms.sunDirection.value=h,C.uniforms.distortionScale.value=d,C.uniforms.eye.value=p,i.material=C,i.onBeforeRender=function(t,e,r){if(y.setFromMatrixPosition(i.matrixWorld),E.setFromMatrixPosition(r.matrixWorld),x.extractRotation(i.matrixWorld),v.set(0,0,1),v.applyMatrix4(x),w.subVectors(y,E),!(w.dot(v)>0)){w.reflect(v).negate(),w.add(y),x.extractRotation(r.matrixWorld),b.set(0,0,-1),b.applyMatrix4(x),b.add(E),_.subVectors(y,b),_.reflect(v).negate(),_.add(y),T.position.copy(w),T.up.set(0,1,0),T.up.applyMatrix4(x),T.up.reflect(v),T.lookAt(_),T.far=r.far,T.updateMatrixWorld(),T.projectionMatrix.copy(r.projectionMatrix),A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(T.projectionMatrix),A.multiply(T.matrixWorldInverse),g.setFromNormalAndCoplanarPoint(v,y),g.applyMatrix4(T.matrixWorldInverse),S.set(g.normal.x,g.normal.y,g.normal.z,g.constant);var n=T.projectionMatrix;M.x=(Math.sign(S.x)+n.elements[8])/n.elements[0],M.y=(Math.sign(S.y)+n.elements[9])/n.elements[5],M.z=-1,M.w=(1+n.elements[10])/n.elements[14],S.multiplyScalar(2/S.dot(M)),n.elements[2]=S.x,n.elements[6]=S.y,n.elements[10]=S.z+1-a,n.elements[14]=S.w,p.setFromMatrixPosition(r.matrixWorld);var o=t.getRenderTarget(),s=t.vr.enabled,c=t.shadowMap.autoUpdate;i.visible=!1,t.vr.enabled=!1,t.shadowMap.autoUpdate=!1,t.setRenderTarget(R),t.clear(),t.render(e,T),i.visible=!0,t.vr.enabled=s,t.shadowMap.autoUpdate=c,t.setRenderTarget(o)}}},THREE.Water.prototype=Object.create(THREE.Mesh.prototype),THREE.Water.prototype.constructor=THREE.Water,THREE.CSS2DObject=function(t){THREE.Object3D.call(this),this.element=t,this.element.style.position="absolute",this.addEventListener("removed",(function(t){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)}))},THREE.CSS2DObject.prototype=Object.create(THREE.Object3D.prototype),THREE.CSS2DObject.prototype.constructor=THREE.CSS2DObject,THREE.CSS2DRenderer=function(){var t,e;void 0;var i=new THREE.Vector3,r=new THREE.Matrix4,n=new THREE.Matrix4,a=document.createElement("div");a.style.overflow="hidden",this.domElement=a,this.setSize=function(i,r){t=i/2,e=r/2,a.style.width=i+"px",a.style.height=r+"px"};var o=function(r,s){if(r instanceof THREE.CSS2DObject){i.setFromMatrixPosition(r.matrixWorld),i.applyMatrix4(n);var c=r.element,h="translate(-50%,-50%) translate("+(i.x*t+t)+"px,"+(-i.y*e+e)+"px)";c.style.WebkitTransform=h,c.style.MozTransform=h,c.style.oTransform=h,c.style.transform=h,c.parentNode!==a&&a.appendChild(c)}for(var l=0,u=r.children.length;l<u;l++)o(r.children[l],s)};this.render=function(t,e){t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),r.copy(e.matrixWorldInverse),n.multiplyMatrices(e.projectionMatrix,r),o(t,e)}};var WEBGL={isWebGLAvailable:function(){try{var t=document.createElement("canvas");return!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(t){return!1}},isWebGL2Available:function(){try{var t=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!t.getContext("webgl2"))}catch(t){return!1}},getWebGLErrorMessage:function(){return this.getErrorMessage(1)},getWebGL2ErrorMessage:function(){return this.getErrorMessage(2)},getErrorMessage:function(t){var e={1:window.WebGLRenderingContext,2:window.WebGL2RenderingContext},i='Your $0 does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">$1</a>',r=document.createElement("div");return r.id="webglmessage",r.style.fontFamily="monospace",r.style.fontSize="13px",r.style.fontWeight="normal",r.style.textAlign="center",r.style.background="#fff",r.style.color="#000",r.style.padding="1.5em",r.style.width="400px",r.style.margin="5em auto 0",i=(i=e[t]?i.replace("$0","graphics card"):i.replace("$0","browser")).replace("$1",{1:"WebGL",2:"WebGL 2"}[t]),r.innerHTML=i,r}},TWEEN=TWEEN||function(){var t=[];return{getAll:function(){return t},removeAll:function(){t=[]},add:function(e){t.push(e)},remove:function(e){var i=t.indexOf(e);-1!==i&&t.splice(i,1)},update:function(e,i){if(0===t.length)return!1;var r=0;for(e=void 0!==e?e:TWEEN.now();r<t.length;)t[r].update(e)||i?r++:t.splice(r,1);return!0}}}();!function(){void 0===this.window&&void 0!==this.process?TWEEN.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e3}:void 0!==this.window&&void 0!==window.performance&&void 0!==window.performance.now?TWEEN.now=window.performance.now.bind(window.performance):void 0!==Date.now?TWEEN.now=Date.now:TWEEN.now=function(){return(new Date).getTime()}}(),TWEEN.Tween=function(t){var e=t,i={},r={},n={},a=1e3,o=0,s=!1,c=!1,h=!1,l=0,u=null,p=TWEEN.Easing.Linear.None,d=TWEEN.Interpolation.Linear,f=[],m=null,g=!1,v=null,y=null,E=null;for(var x in t)i[x]=parseFloat(t[x],10);this.to=function(t,e){return void 0!==e&&(a=e),r=t,this},this.start=function(t){for(var a in TWEEN.add(this),c=!0,g=!1,u=void 0!==t?t:TWEEN.now(),u+=l,r){if(r[a]instanceof Array){if(0===r[a].length)continue;r[a]=[e[a]].concat(r[a])}void 0!==i[a]&&(i[a]=e[a],i[a]instanceof Array==0&&(i[a]*=1),n[a]=i[a]||0)}return this},this.stop=function(){return c?(TWEEN.remove(this),c=!1,null!==E&&E.call(e),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var t=0,e=f.length;e>t;t++)f[t].stop()},this.delay=function(t){return l=t,this},this.repeat=function(t){return o=t,this},this.yoyo=function(t){return s=t,this},this.easing=function(t){return p=t,this},this.interpolation=function(t){return d=t,this},this.chain=function(){return f=arguments,this},this.onStart=function(t){return m=t,this},this.onUpdate=function(t){return v=t,this},this.onComplete=function(t){return y=t,this},this.onStop=function(t){return E=t,this},this.update=function(t){var c,E,x;if(u>t)return!0;for(c in!1===g&&(null!==m&&m.call(e),g=!0),x=p(E=(E=(t-u)/a)>1?1:E),r)if(void 0!==i[c]){var b=i[c]||0,S=r[c];S instanceof Array?e[c]=d(S,x):("string"==typeof S&&(S="+"===S.charAt(0)||"-"===S.charAt(0)?b+parseFloat(S,10):parseFloat(S,10)),"number"==typeof S&&(e[c]=b+(S-b)*x))}if(null!==v&&v.call(e,x),1===E){if(o>0){for(c in isFinite(o)&&o--,n){if("string"==typeof r[c]&&(n[c]=n[c]+parseFloat(r[c],10)),s){var w=n[c];n[c]=r[c],r[c]=w}i[c]=n[c]}return s&&(h=!h),u=t+l,!0}null!==y&&y.call(e);for(var _=0,M=f.length;M>_;_++)f[_].start(u+a);return!1}return!0}},TWEEN.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:1>(t*=2)?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-TWEEN.Easing.Bounce.Out(1-t)},Out:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return.5>t?.5*TWEEN.Easing.Bounce.In(2*t):.5*TWEEN.Easing.Bounce.Out(2*t-1)+.5}}},TWEEN.Interpolation={Linear:function(t,e){var i=t.length-1,r=i*e,n=Math.floor(r),a=TWEEN.Interpolation.Utils.Linear;return 0>e?a(t[0],t[1],r):e>1?a(t[i],t[i-1],i-r):a(t[n],t[n+1>i?i:n+1],r-n)},Bezier:function(t,e){for(var i=0,r=t.length-1,n=Math.pow,a=TWEEN.Interpolation.Utils.Bernstein,o=0;r>=o;o++)i+=n(1-e,r-o)*n(e,o)*t[o]*a(r,o);return i},CatmullRom:function(t,e){var i=t.length-1,r=i*e,n=Math.floor(r),a=TWEEN.Interpolation.Utils.CatmullRom;return t[0]===t[i]?(0>e&&(n=Math.floor(r=i*(1+e))),a(t[(n-1+i)%i],t[n],t[(n+1)%i],t[(n+2)%i],r-n)):0>e?t[0]-(a(t[0],t[0],t[1],t[1],-r)-t[0]):e>1?t[i]-(a(t[i],t[i],t[i-1],t[i-1],r-i)-t[i]):a(t[n?n-1:0],t[n],t[n+1>i?i:n+1],t[n+2>i?i:n+2],r-n)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=TWEEN.Interpolation.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:function(){var t=[1];return function(e){var i=1;if(t[e])return t[e];for(var r=e;r>1;r--)i*=r;return t[e]=i,i}}(),CatmullRom:function(t,e,i,r,n){var a=.5*(i-t),o=.5*(r-e),s=n*n;return(2*e-2*i+a+o)*(n*s)+(-3*e+3*i-2*a-o)*s+a*n+e}}},function(t){"function"==typeof define&&define.amd?define([],(function(){return TWEEN})):"undefined"!=typeof module&&"object"==typeof exports?module.exports=TWEEN:void 0!==t&&(t.TWEEN=TWEEN)}(this);var Stats=function(){function t(t){return r.appendChild(t.dom),t}function e(t){for(var e=0;e<r.children.length;e++)r.children[e].style.display=e===t?"block":"none";i=t}var i=0,r=document.createElement("div");r.style.cssText="position:fixed;bottom:0;right:0;cursor:pointer;opacity:0.9;z-index:10000",r.addEventListener("click",(function(t){t.preventDefault(),e(++i%r.children.length)}),!1);var n=(performance||Date).now(),a=n,o=0,s=t(new Stats.Panel("FPS","#0ff","#002")),c=t(new Stats.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=t(new Stats.Panel("MB","#f08","#201"));return e(0),{REVISION:16,dom:r,addPanel:t,showPanel:e,begin:function(){n=(performance||Date).now()},end:function(){o++;var t=(performance||Date).now();if(c.update(t-n,200),t>a+1e3&&(s.update(1e3*o/(t-a),100),a=t,o=0,h)){var e=performance.memory;h.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){n=this.end()},domElement:r,setMode:e}};Stats.Panel=function(t,e,i){var r=1/0,n=0,a=Math.round,o=a(window.devicePixelRatio||1),s=80*o,c=48*o,h=3*o,l=2*o,u=3*o,p=15*o,d=74*o,f=30*o,m=document.createElement("canvas");m.width=s,m.height=c,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=i,g.fillRect(0,0,s,c),g.fillStyle=e,g.fillText(t,h,l),g.fillRect(u,p,d,f),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(u,p,d,f),{dom:m,update:function(c,v){r=Math.min(r,c),n=Math.max(n,c),g.fillStyle=i,g.globalAlpha=1,g.fillRect(0,0,s,p),g.fillStyle=e,g.fillText(a(c)+" "+t+" ("+a(r)+"-"+a(n)+")",h,l),g.drawImage(m,u+o,p,d-o,f,u,p,d-o,f),g.fillRect(u+d-o,p,o,f),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(u+d-o,p,o,a((1-c/v)*f))}}},"object"==typeof module&&(module.exports=Stats);