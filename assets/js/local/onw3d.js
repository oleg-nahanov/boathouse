var onw3d=null,Onw3dvw=function(e){var n,r=this,l=classie,t=window,d=document,i=d.documentElement,o=d.getElementsByTagName("head")[0],a=[],s=!1,c=!1,u="https://boathouse.ua/index.php?route=";r.model=e,r.category="",r.isfull=!1,r.color=!1;var m=d.querySelector(".photo-box")||null;m&&(m.style.position="relative",m.style.minHeight="400px",m.style.marginBottom="20px");var p=new function(){var n=this,i='<i class="fa fa-fw fa-chevron-down"></i> <span>подробнее..</span>',o='<i class="fa fa-fw fa-chevron-up"></i>',t=0;n.modelTitle=ko.observable(),n.baseName="Base",n.basePrice=ko.observable(0),n.modName=ko.observable(n.baseName),n.modPrice=ko.observable(0),n.moreBtn=ko.observable(i),n.modsList=ko.observableArray(),n.goodsList=ko.observableArray(),n.fullPrice=ko.computed(function(){return"$"+n.modPrice()}),n.detailsMode=function(){var e=d.querySelector(".mod-details"),t=d.querySelector(".duble");l.has(e,"active")?(l.remove(e,"active"),n.moreBtn(i),t.style.display="inline"):(l.add(e,"active"),n.moreBtn(o),t.style.display="none")},n.clearDetails=function(){n.modsList.removeAll(),n.modName(n.baseName),n.basePrice(0),n.modPrice(0);var e=d.querySelector(".mod-details");l.remove(e,"active"),n.moreBtn(i),t=0},n.setDetails=function(){var e,t=n.modsList();for(var i in t)if(t[i].name===n.modName()){n.goodsList(t[i].goods);break}if(n.modName()==n.baseName)n.modPrice(n.basePrice());else{for(var i in e=n.basePrice(),t=n.goodsList())e+=parseInt(t[i].price),void 0;n.modPrice(parseInt(e))}},n.isActive=function(){return"mod-item"+(1==++t?" active":"")}};function v(e,t){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){try{var e=JSON.parse(i.responseText)}catch(e){return}t(e)}},i.open("GET",e,!0),i.send()}ko.applyBindings(p),r.hideAll=function(){l.has(i,"onw3d_root")&&l.remove(i,"onw3d_root"),a.forEach(function(e,t,i){e.style.display="none"})},r.showAll=function(){!l.has(i,"onw3d_root")&&l.add(i,"onw3d_root"),a.forEach(function(e,t,i){e.style.display="block"})},r.setPreloader=function(e,t){n.style.display=e?"block":"none",t||(t="")},r.toggleColorBtn=function(e){C.classList="",l.add(C,e)},r.toggleFrame=function(e){e?l.add(h,"paused"):l.remove(h,"paused")},r.toggleMobile=function(e){e?l.add(d.body,"mobile"):l.remove(d.body,"mobile")},r.getGoods=function(){return p.goodsList()};var b=d.createElement("link");b.href="assets/css/web/style.css",b.type="text/css",b.rel="stylesheet",o.appendChild(b);var h=d.createElement("iframe");h.setAttribute("id","onw3d_viewer");var f=d.createElement("div");f.setAttribute("id","ctrl"),a.push(f);var g=d.createElement("div");g.setAttribute("id","ctrl_wrap"),f.appendChild(g);var A=d.createElement("div");l.add(A,"onw3d_cont"),g.appendChild(A);var y=d.createElement("div");y.setAttribute("id","c-btn"),f.appendChild(y);var E=d.createElement("div");E.setAttribute("id","c-btn2"),E.setAttribute("role","tooltip"),E.setAttribute("data-position","right"),E.setAttribute("aria-label","каталог"),f.appendChild(E);var w=d.createElement("div");w.setAttribute("id","c-btn3"),w.setAttribute("role","tooltip"),w.setAttribute("data-position","right"),w.setAttribute("aria-label","вращение камеры"),f.appendChild(w);var k=d.createElement("div");k.setAttribute("id","c-btn4"),k.setAttribute("role","tooltip"),k.setAttribute("data-position","right"),k.setAttribute("aria-label","полноэкранный режим"),f.appendChild(k);var _=d.createElement("div");_.setAttribute("id","c-btn5"),_.setAttribute("role","tooltip"),_.setAttribute("data-position","right"),_.setAttribute("aria-label","окружающий мир"),f.appendChild(_);var L=d.createElement("div");L.setAttribute("id","c-btn6"),L.setAttribute("role","tooltip"),L.setAttribute("data-position","right"),L.setAttribute("aria-label","сделать снимок"),f.appendChild(L);var C=d.createElement("div");C.setAttribute("id","c-btn7"),l.add(C,"disable"),m?m.appendChild(C):f.appendChild(C);var S=d.createElement("div");S.setAttribute("id","c-btn8"),S.setAttribute("title","Развернуть на весь экран"),m&&m.appendChild(S);var F=d.createElement("div");F.setAttribute("id","c-btn9"),F.setAttribute("role","tooltip"),F.setAttribute("data-position","right"),F.setAttribute("aria-label","вкл/выкл подсказки"),F.textContent="*",f.appendChild(F);var q=d.createElement("div");q.setAttribute("id","ctrl_test"),f.appendChild(q),y.addEventListener("click",function(e){l.toggle(f,"active"),l.remove(q,"open"),l.remove(E,"open")}),E.addEventListener("click",function(e){l.toggle(this,"open"),l.toggle(q,"open"),c||v(u+"get_json_data",function(e){q.innerHTML="<h2>КАТАЛОГ</h2>";for(var t=q.scrollTop=0;t<e.length;t++){var i=d.createElement("div");i.innerHTML="<h3>"+e[t].name+"</h3><p>"+e[t].description+"</p>",i.setAttribute("data-id",e[t].id),l.add(i,"onw3d_category_item"),i.addEventListener("click",function(e){var t=this.getAttribute("data-id"),n=this.querySelector("h3").innerText;s||v(u+"get_json_data&cid="+t,function(e){q.innerHTML="<h2>"+n+"</h2>",c=!1;for(var t=q.scrollTop=0;t<e.length;t++){var i=d.createElement("div");i.innerHTML="<h3>"+e[t].name+'</h3><p class="elipsis">'+e[t].description+"</p>",i.setAttribute("data-id",e[t].id),i.setAttribute("data-model",e[t].zcode),l.add(i,"onw3d_category_item"),i.addEventListener("click",function(e){r.model=this.getAttribute("data-model"),r.model&&""!=r.model&&(_w.init(),l.remove(q,"open"),l.remove(E,"open"))}),q.appendChild(i)}s=!1})}),q.appendChild(i)}c=!0})}),w.addEventListener("click",function(e){_w.toggleCameraRotate()}),k.addEventListener("click",function(e){l.toggle(this,"exitfs"),d.fullscreenElement||d.mozFullScreenElement||d.webkitFullscreenElement||d.msFullscreenElement?d.exitFullscreen?d.exitFullscreen():d.msExitFullscreen?d.msExitFullscreen():d.mozCancelFullScreen?d.mozCancelFullScreen():d.webkitExitFullscreen&&d.webkitExitFullscreen():i.requestFullscreen?i.requestFullscreen():i.msRequestFullscreen?i.msRequestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.webkitRequestFullscreen&&i.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}),_.addEventListener("click",function(e){_w.setEnv()}),L.addEventListener("click",function(e){_w.takeScreenshot()}),C.addEventListener("click",function(e){_w.toggleBaseColor(r.color)}),S.addEventListener("click",function(e){r.isfull=!0,this.style.display="none",classie.add(h,"full"),r.showAll()}),F.addEventListener("click",function(e){_w.toggleTooltips()});var x=d.createElement("div");function T(){p.clearDetails(),v(u+"get_json_data&pname="+r.model,function(o){var e,t=[];if(p.modelTitle(o.name),e=o.model,d.title=e,0<Object.keys(o.options).length){for(var i in o.options)t.push(o.options[i]);for(var i in t.sort(function(e,t){return e.sort-t.sort}),p.modsList.push({name:p.baseName,description:"Базовая"}),t)p.modsList.push(t[i]);p.basePrice(parseInt(o.price)),p.setDetails();var a=[].slice.call(d.querySelectorAll(".mod-item"));a.forEach(function(n){n.addEventListener("click",function(e){if(!classie.has(this,"active")){var t=this.getAttribute("data-name"),i="Base"!=(d.querySelector(".mod-name").innerText=t)?"_"+t.toLowerCase():"";r.model=m.getAttribute("data-model")+i,_w.init(),p.basePrice(parseInt(o.price)),p.modName(t),p.setDetails(),a.forEach(function(e){l.remove(e,"active")}),l.add(n,"active")}})})}})}x.setAttribute("id","onw3d_close"),a.push(x),x.addEventListener("click",function(e){r.isfull=!1,l.remove(f,"active"),l.remove(q,"open"),r.hideAll(),m&&(S.style.display="block"),l.remove(h,"full")}),this.hideAll(),m?m.appendChild(h):d.body.appendChild(h),l.add(h,"ready"),a.forEach(function(e,t,i){d.body.appendChild(e)}),h.setAttribute("src","viewer.html"),h.readyState?h.onreadystatechange=function(){("loaded"==h.readyState||"complete"==h.readyState)&&(h.onreadystatechange=null,B())}:h.onload=function(){B()};var P=new Event("build");function B(){_w=h.contentWindow,n=_w.document.getElementById("info");var e=new URLSearchParams(t.location.search),i=[].slice.call(d.querySelectorAll(".onw3d_btn"));m&&(null!==e.get("category")?(r.category=e.get("category"),m.setAttribute("data-category",r.category)):r.category=m.getAttribute("data-category")||"404",null!==e.get("model")?(r.model=e.get("model"),m.setAttribute("data-model",r.model),t.history.pushState(null,null,t.location.pathname),i.forEach(function(e){l.remove(e,"active")})):r.model=m.getAttribute("data-model")||"404","404"!=r.model?_w.init():m.innerHTML="model not found",d.dispatchEvent(P),T()),i.forEach(function(t){t&&(t.onclick=function(e){e.preventDefault(),r.model=t.getAttribute("data-model")||"404",i.forEach(function(e){l.remove(e,"active")}),l.add(t,"active"),r.model&&""!=r.model&&(m.setAttribute("data-model",r.model),T()),r.model&&""!=r.model&&_w.init()})})}};domready(function(){onw3d=new Onw3dvw});