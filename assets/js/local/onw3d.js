var onw3d=null,Onw3dvw=function(e){this.model=e,this.isfull=!1;var n,l=this,a=classie,s=(window,document),t=s.documentElement,i=s.getElementsByTagName("head")[0],o=[],r=!1,d=!1,c="https://boathouse.ua/index.php?route=",u=s.querySelector(".photo-box")||null;u&&(u.style.position="relative",u.style.minHeight="350px",u.style.marginBottom="20px");var m=new function(){var i=this,t='<i class="fa fa-fw fa-chevron-down"></i> <span>показать детали</span>',n='<i class="fa fa-fw fa-chevron-up"></i> <span>скрыть детали</span>',e=0;i.baseName="Base",i.basePrice=ko.observable(0),i.modName=ko.observable(i.baseName),i.modPrice=ko.observable(0),i.moreBtn=ko.observable(t),i.modsList=ko.observableArray(),i.goodsList=ko.observableArray(),i.fullPrice=ko.computed(function(){return"$"+i.modPrice()}),i.detailsMode=function(){var e=s.querySelector(".mod-details");classie.has(e,"active")?(classie.remove(e,"active"),i.moreBtn(t)):(classie.add(e,"active"),i.moreBtn(n))},i.setDetails=function(){var e,t=i.modsList();for(var n in t)if(t[n].name===i.modName()){i.goodsList(t[n].goods);break}if(i.modName()==i.baseName)i.modPrice(i.basePrice());else{for(var n in e=i.basePrice(),t=i.goodsList())e+=parseInt(t[n].price);i.modPrice(parseInt(e))}},i.isActive=function(){return"mod-item"+(1==++e?" active":"")}};function p(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){try{var e=JSON.parse(n.responseText)}catch(e){return}t(e)}},n.open("GET",e,!0),n.send()}ko.applyBindings(m),this.hideAll=function(){a.has(t,"onw3d_root")&&a.remove(t,"onw3d_root"),o.forEach(function(e,t,n){e.style.display="none"})},this.showAll=function(){!a.has(t,"onw3d_root")&&a.add(t,"onw3d_root"),o.forEach(function(e,t,n){e.style.display="block"})},this.setPreloader=function(e,t){n.style.display=e?"block":"none",t||(t="")},this.toggleColorBtn=function(e){L.classList="",a.add(L,e)};var v=s.createElement("link");v.href="assets/css/web/style.css",v.type="text/css",v.rel="stylesheet",i.appendChild(v);var h=s.createElement("iframe");h.setAttribute("id","onw3d_viewer");var f=s.createElement("div");f.setAttribute("id","ctrl"),o.push(f);var b=s.createElement("div");b.setAttribute("id","ctrl_wrap"),f.appendChild(b);var E=s.createElement("div");a.add(E,"onw3d_cont"),b.appendChild(E);var w=s.createElement("div");w.setAttribute("id","c-btn"),f.appendChild(w);var y=s.createElement("div");y.setAttribute("id","c-btn2"),f.appendChild(y);var g=s.createElement("div");g.setAttribute("id","c-btn3"),f.appendChild(g);var _=s.createElement("div");_.setAttribute("id","c-btn4"),f.appendChild(_);var A=s.createElement("div");A.setAttribute("id","c-btn5"),f.appendChild(A);var k=s.createElement("div");k.setAttribute("id","c-btn6"),f.appendChild(k);var L=s.createElement("div");L.setAttribute("id","c-btn7"),f.appendChild(L);var C=s.createElement("div");C.setAttribute("id","c-btn8"),C.setAttribute("title","Развернуть на весь экран"),u&&u.appendChild(C);var F=s.createElement("div");F.setAttribute("id","ctrl_test"),f.appendChild(F),w.addEventListener("click",function(e){a.toggle(f,"active"),a.remove(F,"open"),a.remove(y,"open")}),y.addEventListener("click",function(e){a.toggle(this,"open"),a.toggle(F,"open"),d||p(c+"get_json_data",function(e){F.innerHTML="<h2>КАТАЛОГ ПРОДУКЦИИ</h2>";for(var t=F.scrollTop=0;t<e.length;t++){var n=s.createElement("div");n.innerHTML="<h3>"+e[t].name+"</h3><p>"+e[t].description+"</p>",n.setAttribute("data-id",e[t].id),a.add(n,"onw3d_category_item"),n.addEventListener("click",function(e){var t=this.getAttribute("data-id"),i=this.querySelector("h3").innerText;r||p(c+"get_json_data&cid="+t,function(e){F.innerHTML="<h2>"+i+"</h2>",d=!1;for(var t=F.scrollTop=0;t<e.length;t++){var n=s.createElement("div");n.innerHTML="<h3>"+e[t].name+'</h3><p class="elipsis">'+e[t].description+"</p>",n.setAttribute("data-id",e[t].id),n.setAttribute("data-model",e[t].zcode),a.add(n,"onw3d_category_item"),n.addEventListener("click",function(e){l.model=this.getAttribute("data-model"),l.model&&""!=l.model&&(_w.init(),a.remove(F,"open"),a.remove(y,"open"),p(c+"get_json_data&pname="+l.model,function(e){E.innerHTML='<h2 style="float:left">'+e.name+"</h2>",a.add(E,"onw3d_cont"),b.appendChild(E)}))}),F.appendChild(n)}r=!1})}),F.appendChild(n)}d=!0})}),g.addEventListener("click",function(e){_w.toggleCameraRotate()}),_.addEventListener("click",function(e){a.toggle(this,"exitfs"),s.fullscreenElement||s.mozFullScreenElement||s.webkitFullscreenElement||s.msFullscreenElement?s.exitFullscreen?s.exitFullscreen():s.msExitFullscreen?s.msExitFullscreen():s.mozCancelFullScreen?s.mozCancelFullScreen():s.webkitExitFullscreen&&s.webkitExitFullscreen():t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}),A.addEventListener("click",function(e){_w.setEnv()}),k.addEventListener("click",function(e){_w.takeScreenshot()}),L.addEventListener("click",function(e){_w.toggleBaseColor(!0)}),C.addEventListener("click",function(e){l.isfull=!0,this.style.display="none",classie.add(h,"full"),l.showAll()});var S=s.createElement("div");function q(){_w=h.contentWindow,n=_w.document.getElementById("info"),u&&(l.model=u.getAttribute("data-model")||"404","404"!=l.model?_w.init():u.innerHTML="model not found",p(c+"get_json_data&pname="+l.model,function(a){if(0<Object.keys(a.options).length){for(var e in m.modsList.push({name:m.baseName}),a.options)m.modsList.push(a.options[e]);m.basePrice(parseInt(a.price)),m.setDetails();var o=[].slice.call(s.querySelectorAll(".mod-item"));o.forEach(function(i){i.addEventListener("click",function(e){if(!classie.has(this,"active")){var t=this.getAttribute("data-name"),n="Base"!=(s.querySelector(".mod-name").innerText=t)?"_"+t.toLowerCase():"";l.model=u.getAttribute("data-model")+n,_w.init(),m.basePrice(parseInt(a.price)),m.modName(t),m.setDetails(),o.forEach(function(e){classie.remove(e,"active")}),classie.add(i,"active")}})})}})),[].slice.call(s.querySelectorAll(".onw3d_btn")).forEach(function(t){t&&(t.onclick=function(e){e.preventDefault(),l.showAll(),l.model=t.getAttribute("data-model")||"404",l.model&&""!=l.model&&p(c+"get_json_data&pname="+l.model,function(e){E.innerHTML='<h2 style="float:left">'+e.name+"</h2>"}),l.model&&""!=l.model&&_w.init()})})}S.setAttribute("id","onw3d_close"),o.push(S),S.addEventListener("click",function(e){l.isfull=!1,a.remove(f,"active"),a.remove(F,"open"),l.hideAll(),u&&(C.style.display="block"),a.remove(h,"full")}),this.hideAll(),u?u.appendChild(h):s.body.appendChild(h),classie.add(h,"ready"),o.forEach(function(e,t,n){s.body.appendChild(e)}),h.setAttribute("src","viewer.html"),h.readyState?h.onreadystatechange=function(){("loaded"==h.readyState||"complete"==h.readyState)&&(h.onreadystatechange=null,q())}:h.onload=function(){q()}};domready(function(){onw3d=new Onw3dvw});