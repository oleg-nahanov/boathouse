var onw3d=null,Onw3dvw=function(e){var t,i=this,n=classie,o=window,a=document,r=a.documentElement,l=a.getElementsByTagName("head")[0],d=[],s=!1,c=!1,u="https://boathouse.ua/index.php?route=";i.model=e,i.category="",i.isfull=!1,i.color=!1;var m=a.querySelector(".photo-box")||null;m&&(m.style.position="relative",m.style.minHeight="500px",m.style.marginBottom="20px");var v=new function(){var e=this,t='<i class="fa fa-fw fa-chevron-down"></i> <span>подробнее..</span>',i='<i class="fa fa-fw fa-chevron-up"></i>',o=0;e.modelTitle=ko.observable(),e.baseName="Base",e.basePrice=ko.observable(0),e.modName=ko.observable(e.baseName),e.modPrice=ko.observable(0),e.moreBtn=ko.observable(t),e.modsList=ko.observableArray(),e.goodsList=ko.observableArray(),e.fullPrice=ko.computed((function(){return"$"+e.modPrice()})),e.detailsMode=function(){var o=a.querySelector(".mod-details"),r=a.querySelector(".duble");n.has(o,"active")?(n.remove(o,"active"),e.moreBtn(t),r.style.display="inline"):(n.add(o,"active"),e.moreBtn(i),r.style.display="none")},e.clearDetails=function(){e.modsList.removeAll(),e.modName(e.baseName),e.basePrice(0),e.modPrice(0);var i=a.querySelector(".mod-details");n.remove(i,"active"),e.moreBtn(t),o=0},e.setDetails=function(){var t,i=e.modsList();for(var n in i)if(i[n].name===e.modName()){e.goodsList(i[n].goods);break}if(e.modName()==e.baseName)e.modPrice(e.basePrice());else{for(var n in t=e.basePrice(),i=e.goodsList())t+=parseInt(i[n].price);e.modPrice(parseInt(t))}},e.isActive=function(){return"mod-item"+(1==++o?" active":"")}};function p(e,t){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){try{var e=JSON.parse(i.responseText)}catch(e){return}t(e)}},i.open("GET",e,!0),i.send()}ko.applyBindings(v),i.hideAll=function(){n.has(r,"onw3d_root")&&n.remove(r,"onw3d_root"),d.forEach((function(e,t,i){e.style.display="none"}))},i.showAll=function(){!n.has(r,"onw3d_root")&&n.add(r,"onw3d_root"),d.forEach((function(e,t,i){e.style.display="block"}))},i.setPreloader=function(e,i){t.style.display=e?"flex":"none",i||(i="")},i.toggleColorBtn=function(e){C.classList="",n.add(C,e)},i.toggleFrame=function(e){e?n.add(h,"paused"):n.remove(h,"paused")},i.toggleMobile=function(e){e?n.add(a.body,"mobile"):n.remove(a.body,"mobile")},i.getGoods=function(){return v.goodsList()};var b=a.createElement("link");b.href="assets/css/web/style.css",b.type="text/css",b.rel="stylesheet",l.appendChild(b);var h=a.createElement("iframe");h.setAttribute("id","onw3d_viewer");var f=a.createElement("div");f.setAttribute("id","ctrl"),d.push(f);var g=a.createElement("div");g.setAttribute("id","ctrl_wrap"),f.appendChild(g);var A=a.createElement("div");n.add(A,"onw3d_cont"),g.appendChild(A);var y=a.createElement("div");y.setAttribute("id","c-btn"),f.appendChild(y);var E=a.createElement("div");E.setAttribute("id","c-btn2"),E.setAttribute("role","tooltip"),E.setAttribute("data-position","right"),E.setAttribute("aria-label","каталог"),f.appendChild(E);var w=a.createElement("div");w.setAttribute("id","c-btn3"),w.setAttribute("role","tooltip"),w.setAttribute("data-position","right"),w.setAttribute("aria-label","вращение камеры"),f.appendChild(w);var k=a.createElement("div");k.setAttribute("id","c-btn4"),k.setAttribute("role","tooltip"),k.setAttribute("data-position","right"),k.setAttribute("aria-label","полноэкранный режим"),f.appendChild(k);var _=a.createElement("div");_.setAttribute("id","c-btn5"),_.setAttribute("role","tooltip"),_.setAttribute("data-position","right"),_.setAttribute("aria-label","окружающий мир"),f.appendChild(_);var L=a.createElement("div");L.setAttribute("id","c-btn6"),L.setAttribute("role","tooltip"),L.setAttribute("data-position","right"),L.setAttribute("aria-label","сделать снимок"),f.appendChild(L);var C=a.createElement("div");C.setAttribute("id","c-btn7"),n.add(C,"disable"),m?m.appendChild(C):f.appendChild(C);var S=a.createElement("div");S.setAttribute("id","c-btn8"),S.setAttribute("title","Развернуть на весь экран"),m&&m.appendChild(S);var F=a.createElement("div");F.setAttribute("id","c-btn9"),F.setAttribute("role","tooltip"),F.setAttribute("data-position","right"),F.setAttribute("aria-label","вкл/выкл подсказки"),F.textContent="*",f.appendChild(F);var q=a.createElement("div");q.setAttribute("id","ctrl_test"),f.appendChild(q),y.addEventListener("click",(function(e){n.toggle(f,"active"),n.remove(q,"open"),n.remove(E,"open")})),E.addEventListener("click",(function(e){n.toggle(this,"open"),n.toggle(q,"open"),c||p(u+"get_json_data",(function(e){q.innerHTML="<h2>КАТАЛОГ</h2>",q.scrollTop=0;for(var t=0;t<e.length;t++){var o=a.createElement("div");o.innerHTML="<h3>"+e[t].name+"</h3><p>"+e[t].description+"</p>",o.setAttribute("data-id",e[t].id),n.add(o,"onw3d_category_item"),o.addEventListener("click",(function(e){var t=this.getAttribute("data-id"),o=this.querySelector("h3").innerText;s||p(u+"get_json_data&cid="+t,(function(e){q.innerHTML="<h2>"+o+"</h2>",c=!1,q.scrollTop=0;for(var t=0;t<e.length;t++){var r=a.createElement("div");r.innerHTML="<h3>"+e[t].name+'</h3><p class="elipsis">'+e[t].description+"</p>",r.setAttribute("data-id",e[t].id),r.setAttribute("data-model",e[t].zcode),n.add(r,"onw3d_category_item"),r.addEventListener("click",(function(e){i.model=this.getAttribute("data-model"),i.model&&""!=i.model&&(_w.init(),n.remove(q,"open"),n.remove(E,"open"))})),q.appendChild(r)}s=!1}))})),q.appendChild(o)}c=!0}))})),w.addEventListener("click",(function(e){_w.toggleCameraRotate()})),k.addEventListener("click",(function(e){n.toggle(this,"exitfs"),a.fullscreenElement||a.mozFullScreenElement||a.webkitFullscreenElement||a.msFullscreenElement?a.exitFullscreen?a.exitFullscreen():a.msExitFullscreen?a.msExitFullscreen():a.mozCancelFullScreen?a.mozCancelFullScreen():a.webkitExitFullscreen&&a.webkitExitFullscreen():r.requestFullscreen?r.requestFullscreen():r.msRequestFullscreen?r.msRequestFullscreen():r.mozRequestFullScreen?r.mozRequestFullScreen():r.webkitRequestFullscreen&&r.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)})),_.addEventListener("click",(function(e){_w.setEnv()})),L.addEventListener("click",(function(e){_w.takeScreenshot()})),C.addEventListener("click",(function(e){_w.toggleBaseColor(i.color)})),S.addEventListener("click",(function(e){i.isfull=!0,this.style.display="none",classie.add(h,"full"),i.showAll()})),F.addEventListener("click",(function(e){_w.toggleTooltips()}));var x=a.createElement("div");function T(){v.clearDetails(),p(u+"get_json_data&pname="+i.model,(function(e){var t,o=[];if(v.modelTitle(e.name),t=e.model,a.title=t,Object.keys(e.options).length>0){for(var r in e.options)o.push(e.options[r]);for(var r in o.sort((function(e,t){return e.sort-t.sort})),v.modsList.push({name:v.baseName,description:"Базовая"}),o)v.modsList.push(o[r]);v.basePrice(parseInt(e.price)),v.setDetails();var l=[].slice.call(a.querySelectorAll(".mod-item"));l.forEach((function(t){t.addEventListener("click",(function(o){if(!classie.has(this,"active")){var r=this.getAttribute("data-name");a.querySelector(".mod-name").innerText=r;var d="Base"!=r?"_"+r.toLowerCase():"";i.model=m.getAttribute("data-model")+d,_w.init(),v.basePrice(parseInt(e.price)),v.modName(r),v.setDetails(),l.forEach((function(e){n.remove(e,"active")})),n.add(t,"active")}}))}))}}))}x.setAttribute("id","onw3d_close"),d.push(x),x.addEventListener("click",(function(e){i.isfull=!1,n.remove(f,"active"),n.remove(q,"open"),i.hideAll(),m&&(S.style.display="block"),n.remove(h,"full")})),this.hideAll(),m?m.appendChild(h):a.body.appendChild(h),n.add(h,"ready"),d.forEach((function(e,t,i){a.body.appendChild(e)})),h.setAttribute("src","viewer.html"),h.readyState?h.onreadystatechange=function(){("loaded"==h.readyState||"complete"==h.readyState)&&(h.onreadystatechange=null,B())}:h.onload=function(){B()};var P=new Event("build");function B(){_w=h.contentWindow,t=_w.document.getElementById("info");var e=new URLSearchParams(o.location.search),r=[].slice.call(a.querySelectorAll(".onw3d_btn"));m&&(null!==e.get("category")?(i.category=e.get("category"),m.setAttribute("data-category",i.category)):i.category=m.getAttribute("data-category")||"404",null!==e.get("model")?(i.model=e.get("model"),m.setAttribute("data-model",i.model),o.history.pushState(null,null,o.location.pathname),r.forEach((function(e){n.remove(e,"active")}))):i.model=m.getAttribute("data-model")||"404","404"!=i.model?_w.init():m.innerHTML="model not found",a.dispatchEvent(P),T()),r.forEach((function(e){e&&(e.onclick=function(t){t.preventDefault(),i.model=e.getAttribute("data-model")||"404",r.forEach((function(e){n.remove(e,"active")})),n.add(e,"active"),i.model&&""!=i.model&&(m.setAttribute("data-model",i.model),T()),i.model&&""!=i.model&&_w.init()})}))}};domready((function(){onw3d=new Onw3dvw}));